(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function size(e){return e.reduce(mult)}function mult(e,r){return e*r}var createScene=require("gl-plot3d"),readAudio=require("read-audio"),CBuffer=require("CBuffer"),writable=require("writable2"),nextTick=require("next-tick"),Scope=require("./"),scene=createScene(),scope=Scope({gl:scene.gl});scene.add(scope);var opts={buffer:2048,channels:1};readAudio(opts,function(e,r){if(e)throw e;var t=[10*opts.buffer,opts.channels],i=CBuffer(size(t));i.fill(0),r.pipe(writable.obj({highWaterMark:1},function(e,r,a){for(var u=0;u<e.shape[0];u++)i.push(e.data[u]);scope.render({data:i,shape:t}),nextTick(a)}))});
},{"./":2,"CBuffer":3,"gl-plot3d":295,"next-tick":299,"read-audio":311,"writable2":309}],2:[function(require,module,exports){
function oscilloscope(e){function r(r){n.update(extend(e,{position:getPoints(r)}))}var n=createLines(extend(e,{position:null}));return n.render=r,n}function getPoints(e){var r=new Array(e.shape[0]);if(!defined(e))return r;for(var n=ndarray(e.data,e.shape,e.stride),a=0;a<n.shape[0];a++)for(var t=0;t<n.shape[1];t++){var i=Math.max(-1,Math.min(1,n.get(a,t)));r[a]=[a/n.shape[0],i,t/n.shape[1]]}return r}var defined=require("defined"),ndarray=require("ndarray"),createLines=require("gl-line3d"),extend=require("xtend");module.exports=oscilloscope;

},{"defined":28,"gl-line3d":30,"ndarray":296,"xtend":310}],3:[function(require,module,exports){
!function(t){function s(){if(!(this instanceof s))return arguments.length>1||"number"!=typeof arguments[0]?s.apply(new s(arguments.length),arguments):new s(arguments[0]);if(0===arguments.length)throw new Error("Missing Argument: You must pass a valid buffer length");return this.size=this.start=0,this.overflow=null,arguments.length>1||"number"!=typeof arguments[0]?(this.data=new Array(arguments.length),this.end=(this.length=arguments.length)-1,this.push.apply(this,arguments)):(this.data=new Array(arguments[0]),this.end=(this.length=arguments[0])-1),this}function i(t,s){return t==s?0:t>s?1:-1}s.prototype={constructor:s,pop:function(){var t;if(0!==this.size)return t=this.data[this.end],delete this.data[this.end],this.end=(this.end-1+this.length)%this.length,this.size--,t},push:function(){var t=0;if(this.overflow&&this.size+arguments.length>this.length)for(;t<this.size+arguments.length-this.length;t++)this.overflow(this.data[(this.end+t+1)%this.length],this);for(t=0;t<arguments.length;t++)this.data[(this.end+t+1)%this.length]=arguments[t];return this.size<this.length&&(this.size+t>this.length?this.size=this.length:this.size+=t),this.end=(this.end+t)%this.length,this.start=(this.length+this.end-this.size+1)%this.length,this.size},reverse:function(){for(var t,s=0;s<~~(this.size/2);s++)t=this.data[(this.start+s)%this.length],this.data[(this.start+s)%this.length]=this.data[(this.start+(this.size-s-1))%this.length],this.data[(this.start+(this.size-s-1))%this.length]=t;return this},rotateLeft:function(t){if("undefined"==typeof t&&(t=1),"number"!=typeof t)throw new Error("Argument must be a number");for(;--t>=0;)this.push(this.shift());return this},rotateRight:function(t){if("undefined"==typeof t&&(t=1),"number"!=typeof t)throw new Error("Argument must be a number");for(;--t>=0;)this.unshift(this.pop());return this},shift:function(){var t;if(0!==this.size)return t=this.data[this.start],this.start=(this.start+1)%this.length,this.size--,t},sort:function(t){return this.data.sort(t||i),this.start=0,this.end=this.size-1,this},unshift:function(){var t=0;if(this.overflow&&this.size+arguments.length>this.length)for(;t<this.size+arguments.length-this.length;t++)this.overflow(this.data[this.end-t%this.length],this);for(t=0;t<arguments.length;t++)this.data[(this.length+this.start-t%this.length-1)%this.length]=arguments[t];return this.length-this.size-t<0&&(this.end+=this.length-this.size-t,this.end<0&&(this.end=this.length+this.end%this.length)),this.size<this.length&&(this.size+t>this.length?this.size=this.length:this.size+=t),this.start-=arguments.length,this.start<0&&(this.start=this.length+this.start%this.length),this.size},indexOf:function(t,s){for(s||(s=0);s<this.size;s++)if(this.data[(this.start+s)%this.length]===t)return s;return-1},lastIndexOf:function(t,s){for(s||(s=this.size-1);s>=0;s--)if(this.data[(this.start+s)%this.length]===t)return s;return-1},sortedIndex:function(t,s,h){s=s||i;var e=this.start,n=this.size-1;for(e&&s.call(h,t,this.data[n])>0&&(e=0,n=this.end);n>e;){var r=e+n>>>1;s.call(h,t,this.data[r])>0?e=r+1:n=r}return((e-this.start)%this.size+this.size)%this.size},every:function(t,s){for(var i=0;i<this.size;i++)if(!t.call(s,this.data[(this.start+i)%this.length],i,this))return!1;return!0},forEach:function(t,s){for(var i=0;i<this.size;i++)t.call(s,this.data[(this.start+i)%this.length],i,this)},some:function(t,s){for(var i=0;i<this.size;i++)if(t.call(s,this.data[(this.start+i)%this.length],i,this))return!0;return!1},avg:function(){return 0==this.size?0:this.sum()/this.size},sum:function(){for(var t=this.size,s=0;t--;)s+=this.data[t];return s},median:function(){if(0===this.size)return 0;var t=this.slice().sort(i),s=Math.floor(t.length/2);return t.length%2?t[s]:(t[s-1]+t[s])/2},empty:function(){return this.size=this.start=0,this.end=this.length-1,this},fill:function(t){var s=0;if("function"==typeof t)for(;this.data[s]=t(),++s<this.length;);else for(;this.data[s]=t,++s<this.length;);return this.start=0,this.end=this.length-1,this.size=this.length,this},first:function(){return this.data[this.start]},last:function(){return this.data[this.end]},get:function(t){return this.data[(this.start+t)%this.length]},isFull:function(t){return this.length===this.size},set:function(t,s){return this.data[(this.start+t)%this.length]=s},toArray:function(){return this.slice()},slice:function(t,s){var i=this.size;if(t=+t||0,0>t){if(t>=s)return[];t=-t>i?0:i+t}null==s||s>i?s=i:0>s?s+=i:s=+s||0,i=s>t?s-t:0;for(var h=Array(i),e=0;i>e;e++)h[e]=this.data[(this.start+t+e)%this.length];return h}},"object"==typeof module&&module.exports?module.exports=s:t.CBuffer=s}(this);

},{}],4:[function(require,module,exports){

},{}],5:[function(require,module,exports){
function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(t){return this instanceof Buffer?(this.length=0,this.parent=void 0,"number"==typeof t?fromNumber(this,t):"string"==typeof t?fromString(this,t,arguments.length>1?arguments[1]:"utf8"):fromObject(this,t)):arguments.length>1?new Buffer(t,arguments[1]):new Buffer(t)}function fromNumber(t,e){if(t=allocate(t,0>e?0:0|checked(e)),!Buffer.TYPED_ARRAY_SUPPORT)for(var r=0;e>r;r++)t[r]=0;return t}function fromString(t,e,r){("string"!=typeof r||""===r)&&(r="utf8");var n=0|byteLength(e,r);return t=allocate(t,n),t.write(e,r),t}function fromObject(t,e){if(Buffer.isBuffer(e))return fromBuffer(t,e);if(isArray(e))return fromArray(t,e);if(null==e)throw new TypeError("must start with number, buffer, array or string");return"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer?fromTypedArray(t,e):e.length?fromArrayLike(t,e):fromJsonObject(t,e)}function fromBuffer(t,e){var r=0|checked(e.length);return t=allocate(t,r),e.copy(t,0,0,r),t}function fromArray(t,e){var r=0|checked(e.length);t=allocate(t,r);for(var n=0;r>n;n+=1)t[n]=255&e[n];return t}function fromTypedArray(t,e){var r=0|checked(e.length);t=allocate(t,r);for(var n=0;r>n;n+=1)t[n]=255&e[n];return t}function fromArrayLike(t,e){var r=0|checked(e.length);t=allocate(t,r);for(var n=0;r>n;n+=1)t[n]=255&e[n];return t}function fromJsonObject(t,e){var r,n=0;"Buffer"===e.type&&isArray(e.data)&&(r=e.data,n=0|checked(r.length)),t=allocate(t,n);for(var i=0;n>i;i+=1)t[i]=255&r[i];return t}function allocate(t,e){Buffer.TYPED_ARRAY_SUPPORT?t=Buffer._augment(new Uint8Array(e)):(t.length=e,t._isBuffer=!0);var r=0!==e&&e<=Buffer.poolSize>>>1;return r&&(t.parent=rootParent),t}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function SlowBuffer(t,e){if(!(this instanceof SlowBuffer))return new SlowBuffer(t,e);var r=new Buffer(t,e);return delete r.parent,r}function byteLength(t,e){"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"binary":case"raw":case"raws":return r;case"utf8":case"utf-8":return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(t).length;default:if(n)return utf8ToBytes(t).length;e=(""+e).toLowerCase(),n=!0}}function slowToString(t,e,r){var n=!1;if(e=0|e,r=void 0===r||r===1/0?this.length:0|r,t||(t="utf8"),0>e&&(e=0),r>this.length&&(r=this.length),e>=r)return"";for(;;)switch(t){case"hex":return hexSlice(this,e,r);case"utf8":case"utf-8":return utf8Slice(this,e,r);case"ascii":return asciiSlice(this,e,r);case"binary":return binarySlice(this,e,r);case"base64":return base64Slice(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function hexWrite(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;var f=e.length;if(f%2!==0)throw new Error("Invalid hex string");n>f/2&&(n=f/2);for(var o=0;n>o;o++){var u=parseInt(e.substr(2*o,2),16);if(isNaN(u))throw new Error("Invalid hex string");t[r+o]=u}return o}function utf8Write(t,e,r,n){return blitBuffer(utf8ToBytes(e,t.length-r),t,r,n)}function asciiWrite(t,e,r,n){return blitBuffer(asciiToBytes(e),t,r,n)}function binaryWrite(t,e,r,n){return asciiWrite(t,e,r,n)}function base64Write(t,e,r,n){return blitBuffer(base64ToBytes(e),t,r,n)}function ucs2Write(t,e,r,n){return blitBuffer(utf16leToBytes(e,t.length-r),t,r,n)}function base64Slice(t,e,r){return 0===e&&r===t.length?base64.fromByteArray(t):base64.fromByteArray(t.slice(e,r))}function utf8Slice(t,e,r){var n="",i="";r=Math.min(t.length,r);for(var f=e;r>f;f++)t[f]<=127?(n+=decodeUtf8Char(i)+String.fromCharCode(t[f]),i=""):i+="%"+t[f].toString(16);return n+decodeUtf8Char(i)}function asciiSlice(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;r>i;i++)n+=String.fromCharCode(127&t[i]);return n}function binarySlice(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;r>i;i++)n+=String.fromCharCode(t[i]);return n}function hexSlice(t,e,r){var n=t.length;(!e||0>e)&&(e=0),(!r||0>r||r>n)&&(r=n);for(var i="",f=e;r>f;f++)i+=toHex(t[f]);return i}function utf16leSlice(t,e,r){for(var n=t.slice(e,r),i="",f=0;f<n.length;f+=2)i+=String.fromCharCode(n[f]+256*n[f+1]);return i}function checkOffset(t,e,r){if(t%1!==0||0>t)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,r,n,i,f){if(!Buffer.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");if(e>i||f>e)throw new RangeError("value is out of bounds");if(r+n>t.length)throw new RangeError("index out of range")}function objectWriteUInt16(t,e,r,n){0>e&&(e=65535+e+1);for(var i=0,f=Math.min(t.length-r,2);f>i;i++)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function objectWriteUInt32(t,e,r,n){0>e&&(e=4294967295+e+1);for(var i=0,f=Math.min(t.length-r,4);f>i;i++)t[r+i]=e>>>8*(n?i:3-i)&255}function checkIEEE754(t,e,r,n,i,f){if(e>i||f>e)throw new RangeError("value is out of bounds");if(r+n>t.length)throw new RangeError("index out of range");if(0>r)throw new RangeError("index out of range")}function writeFloat(t,e,r,n,i){return i||checkIEEE754(t,e,r,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(t,e,r,n,23,4),r+4}function writeDouble(t,e,r,n,i){return i||checkIEEE754(t,e,r,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(t,e,r,n,52,8),r+8}function base64clean(t){if(t=stringtrim(t).replace(INVALID_BASE64_RE,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t}function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function toHex(t){return 16>t?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,e){e=e||1/0;for(var r,n=t.length,i=null,f=[],o=0;n>o;o++){if(r=t.charCodeAt(o),r>55295&&57344>r){if(!i){if(r>56319){(e-=3)>-1&&f.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&f.push(239,191,189);continue}i=r;continue}if(56320>r){(e-=3)>-1&&f.push(239,191,189),i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&((e-=3)>-1&&f.push(239,191,189),i=null);if(128>r){if((e-=1)<0)break;f.push(r)}else if(2048>r){if((e-=2)<0)break;f.push(r>>6|192,63&r|128)}else if(65536>r){if((e-=3)<0)break;f.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(2097152>r))throw new Error("Invalid code point");if((e-=4)<0)break;f.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return f}function asciiToBytes(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e}function utf16leToBytes(t,e){for(var r,n,i,f=[],o=0;o<t.length&&!((e-=2)<0);o++)r=t.charCodeAt(o),n=r>>8,i=r%256,f.push(i),f.push(n);return f}function base64ToBytes(t){return base64.toByteArray(base64clean(t))}function blitBuffer(t,e,r,n){for(var i=0;n>i&&!(i+r>=e.length||i>=t.length);i++)e[i+r]=t[i];return i}function decodeUtf8Char(t){try{return decodeURIComponent(t)}catch(e){return String.fromCharCode(65533)}}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("is-array");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=function(){function t(){}try{var e=new ArrayBuffer(0),r=new Uint8Array(e);return r.foo=function(){return 42},r.constructor=t,42===r.foo()&&r.constructor===t&&"function"==typeof r.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(n){return!1}}(),Buffer.isBuffer=function(t){return!(null==t||!t._isBuffer)},Buffer.compare=function(t,e){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,f=Math.min(r,n);f>i&&t[i]===e[i];)++i;return i!==f&&(r=t[i],n=e[i]),n>r?-1:r>n?1:0},Buffer.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(t,e){if(!isArray(t))throw new TypeError("list argument must be an Array of Buffers.");if(0===t.length)return new Buffer(0);if(1===t.length)return t[0];var r;if(void 0===e)for(e=0,r=0;r<t.length;r++)e+=t[r].length;var n=new Buffer(e),i=0;for(r=0;r<t.length;r++){var f=t[r];f.copy(n,i),i+=f.length}return n},Buffer.byteLength=byteLength,Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0,Buffer.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:0===Buffer.compare(this,t)},Buffer.prototype.inspect=function(){var t="",e=exports.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?0:Buffer.compare(this,t)},Buffer.prototype.indexOf=function(t,e){function r(t,e,r){for(var n=-1,i=0;r+i<t.length;i++)if(t[r+i]===e[-1===n?0:i-n]){if(-1===n&&(n=i),i-n+1===e.length)return r+n}else n=-1;return-1}if(e>2147483647?e=2147483647:-2147483648>e&&(e=-2147483648),e>>=0,0===this.length)return-1;if(e>=this.length)return-1;if(0>e&&(e=Math.max(this.length+e,0)),"string"==typeof t)return 0===t.length?-1:String.prototype.indexOf.call(this,t,e);if(Buffer.isBuffer(t))return r(this,t,e);if("number"==typeof t)return Buffer.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,t,e):r(this,[t],e);throw new TypeError("val must be string, number or Buffer")},Buffer.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t)},Buffer.prototype.set=function(t,e){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,e)},Buffer.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e=0|e,isFinite(r)?(r=0|r,void 0===n&&(n="utf8")):(n=r,r=void 0);else{var i=n;n=e,e=0|r,r=i}var f=this.length-e;if((void 0===r||r>f)&&(r=f),t.length>0&&(0>r||0>e)||e>this.length)throw new RangeError("attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return hexWrite(this,t,e,r);case"utf8":case"utf-8":return utf8Write(this,t,e,r);case"ascii":return asciiWrite(this,t,e,r);case"binary":return binaryWrite(this,t,e,r);case"base64":return base64Write(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,0>t?(t+=r,0>t&&(t=0)):t>r&&(t=r),0>e?(e+=r,0>e&&(e=0)):e>r&&(e=r),t>e&&(e=t);var n;if(Buffer.TYPED_ARRAY_SUPPORT)n=Buffer._augment(this.subarray(t,e));else{var i=e-t;n=new Buffer(i,void 0);for(var f=0;i>f;f++)n[f]=this[f+t]}return n.length&&(n.parent=this.parent||this),n},Buffer.prototype.readUIntLE=function(t,e,r){t=0|t,e=0|e,r||checkOffset(t,e,this.length);for(var n=this[t],i=1,f=0;++f<e&&(i*=256);)n+=this[t+f]*i;return n},Buffer.prototype.readUIntBE=function(t,e,r){t=0|t,e=0|e,r||checkOffset(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},Buffer.prototype.readUInt8=function(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function(t,e,r){t=0|t,e=0|e,r||checkOffset(t,e,this.length);for(var n=this[t],i=1,f=0;++f<e&&(i*=256);)n+=this[t+f]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*e)),n},Buffer.prototype.readIntBE=function(t,e,r){t=0|t,e=0|e,r||checkOffset(t,e,this.length);for(var n=e,i=1,f=this[t+--n];n>0&&(i*=256);)f+=this[t+--n]*i;return i*=128,f>=i&&(f-=Math.pow(2,8*e)),f},Buffer.prototype.readInt8=function(t,e){return e||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function(t,e){return e||checkOffset(t,4,this.length),ieee754.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function(t,e){return e||checkOffset(t,4,this.length),ieee754.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function(t,e){return e||checkOffset(t,8,this.length),ieee754.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function(t,e){return e||checkOffset(t,8,this.length),ieee754.read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function(t,e,r,n){t=+t,e=0|e,r=0|r,n||checkInt(this,t,e,r,Math.pow(2,8*r),0);var i=1,f=0;for(this[e]=255&t;++f<r&&(i*=256);)this[e+f]=t/i&255;return e+r},Buffer.prototype.writeUIntBE=function(t,e,r,n){t=+t,e=0|e,r=0|r,n||checkInt(this,t,e,r,Math.pow(2,8*r),0);var i=r-1,f=1;for(this[e+i]=255&t;--i>=0&&(f*=256);)this[e+i]=t/f&255;return e+r},Buffer.prototype.writeUInt8=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=t,e+1},Buffer.prototype.writeUInt16LE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e=0|e,!n){var i=Math.pow(2,8*r-1);checkInt(this,t,e,r,i-1,-i)}var f=0,o=1,u=0>t?1:0;for(this[e]=255&t;++f<r&&(o*=256);)this[e+f]=(t/o>>0)-u&255;return e+r},Buffer.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e=0|e,!n){var i=Math.pow(2,8*r-1);checkInt(this,t,e,r,i-1,-i)}var f=r-1,o=1,u=0>t?1:0;for(this[e+f]=255&t;--f>=0&&(o*=256);)this[e+f]=(t/o>>0)-u&255;return e+r},Buffer.prototype.writeInt8=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),0>t&&(t=255+t+1),this[e]=t,e+1},Buffer.prototype.writeInt16LE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function(t,e,r){return t=+t,e=0|e,r||checkInt(this,t,e,4,2147483647,-2147483648),0>t&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function(t,e,r){return writeFloat(this,t,e,!0,r)},Buffer.prototype.writeFloatBE=function(t,e,r){return writeFloat(this,t,e,!1,r)},Buffer.prototype.writeDoubleLE=function(t,e,r){return writeDouble(this,t,e,!0,r)},Buffer.prototype.writeDoubleBE=function(t,e,r){return writeDouble(this,t,e,!1,r)},Buffer.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&r>n&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(0>e)throw new RangeError("targetStart out of bounds");if(0>r||r>=this.length)throw new RangeError("sourceStart out of bounds");if(0>n)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i=n-r;if(1e3>i||!Buffer.TYPED_ARRAY_SUPPORT)for(var f=0;i>f;f++)t[f+e]=this[f+r];else t._set(this.subarray(r,r+i),e);return i},Buffer.prototype.fill=function(t,e,r){if(t||(t=0),e||(e=0),r||(r=this.length),e>r)throw new RangeError("end < start");if(r!==e&&0!==this.length){if(0>e||e>=this.length)throw new RangeError("start out of bounds");if(0>r||r>this.length)throw new RangeError("end out of bounds");var n;if("number"==typeof t)for(n=e;r>n;n++)this[n]=t;else{var i=utf8ToBytes(t.toString()),f=i.length;for(n=e;r>n;n++)this[n]=i[n%f]}return this}},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer.TYPED_ARRAY_SUPPORT)return new Buffer(this).buffer;for(var t=new Uint8Array(this.length),e=0,r=t.length;r>e;e+=1)t[e]=this[e];return t.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(t){return t.constructor=Buffer,t._isBuffer=!0,t._set=t.set,t.get=BP.get,t.set=BP.set,t.write=BP.write,t.toString=BP.toString,t.toLocaleString=BP.toString,t.toJSON=BP.toJSON,t.equals=BP.equals,t.compare=BP.compare,t.indexOf=BP.indexOf,t.copy=BP.copy,t.slice=BP.slice,t.readUIntLE=BP.readUIntLE,t.readUIntBE=BP.readUIntBE,t.readUInt8=BP.readUInt8,t.readUInt16LE=BP.readUInt16LE,t.readUInt16BE=BP.readUInt16BE,t.readUInt32LE=BP.readUInt32LE,t.readUInt32BE=BP.readUInt32BE,t.readIntLE=BP.readIntLE,t.readIntBE=BP.readIntBE,t.readInt8=BP.readInt8,t.readInt16LE=BP.readInt16LE,t.readInt16BE=BP.readInt16BE,t.readInt32LE=BP.readInt32LE,t.readInt32BE=BP.readInt32BE,t.readFloatLE=BP.readFloatLE,t.readFloatBE=BP.readFloatBE,t.readDoubleLE=BP.readDoubleLE,t.readDoubleBE=BP.readDoubleBE,t.writeUInt8=BP.writeUInt8,t.writeUIntLE=BP.writeUIntLE,t.writeUIntBE=BP.writeUIntBE,t.writeUInt16LE=BP.writeUInt16LE,t.writeUInt16BE=BP.writeUInt16BE,t.writeUInt32LE=BP.writeUInt32LE,t.writeUInt32BE=BP.writeUInt32BE,t.writeIntLE=BP.writeIntLE,t.writeIntBE=BP.writeIntBE,t.writeInt8=BP.writeInt8,t.writeInt16LE=BP.writeInt16LE,t.writeInt16BE=BP.writeInt16BE,t.writeInt32LE=BP.writeInt32LE,t.writeInt32BE=BP.writeInt32BE,t.writeFloatLE=BP.writeFloatLE,t.writeFloatBE=BP.writeFloatBE,t.writeDoubleLE=BP.writeDoubleLE,t.writeDoubleBE=BP.writeDoubleBE,t.fill=BP.fill,t.inspect=BP.inspect,t.toArrayBuffer=BP.toArrayBuffer,t};var INVALID_BASE64_RE=/[^+\/0-9A-z\-]/g;

},{"base64-js":6,"ieee754":7,"is-array":8}],6:[function(require,module,exports){
var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(t){"use strict";function r(t){var r=t.charCodeAt(0);return r===h||r===u?62:r===c||r===f?63:o>r?-1:o+10>r?r-o+26+26:i+26>r?r-i:A+26>r?r-A+26:void 0}function e(t){function e(t){i[f++]=t}var n,h,c,o,A,i;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u=t.length;A="="===t.charAt(u-2)?2:"="===t.charAt(u-1)?1:0,i=new a(3*t.length/4-A),c=A>0?t.length-4:t.length;var f=0;for(n=0,h=0;c>n;n+=4,h+=3)o=r(t.charAt(n))<<18|r(t.charAt(n+1))<<12|r(t.charAt(n+2))<<6|r(t.charAt(n+3)),e((16711680&o)>>16),e((65280&o)>>8),e(255&o);return 2===A?(o=r(t.charAt(n))<<2|r(t.charAt(n+1))>>4,e(255&o)):1===A&&(o=r(t.charAt(n))<<10|r(t.charAt(n+1))<<4|r(t.charAt(n+2))>>2,e(o>>8&255),e(255&o)),i}function n(t){function r(t){return lookup.charAt(t)}function e(t){return r(t>>18&63)+r(t>>12&63)+r(t>>6&63)+r(63&t)}var n,a,h,c=t.length%3,o="";for(n=0,h=t.length-c;h>n;n+=3)a=(t[n]<<16)+(t[n+1]<<8)+t[n+2],o+=e(a);switch(c){case 1:a=t[t.length-1],o+=r(a>>2),o+=r(a<<4&63),o+="==";break;case 2:a=(t[t.length-2]<<8)+t[t.length-1],o+=r(a>>10),o+=r(a>>4&63),o+=r(a<<2&63),o+="="}return o}var a="undefined"!=typeof Uint8Array?Uint8Array:Array,h="+".charCodeAt(0),c="/".charCodeAt(0),o="0".charCodeAt(0),A="a".charCodeAt(0),i="A".charCodeAt(0),u="-".charCodeAt(0),f="_".charCodeAt(0);t.toByteArray=e,t.fromByteArray=n}("undefined"==typeof exports?this.base64js={}:exports);

},{}],7:[function(require,module,exports){
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:(s?-1:1)*(1/0);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=0>o||0===o&&0>1/o?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),o+=p+N>=1?n/f:n*Math.pow(2,1-N),o*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};

},{}],8:[function(require,module,exports){
var isArray=Array.isArray,str=Object.prototype.toString;module.exports=isArray||function(r){return!!r&&"[object Array]"==str.call(r)};

},{}],9:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,s,i,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];n.apply(this,i)}else if(isObject(n)){for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];for(o=n.slice(),s=o.length,r=0;s>r;r++)o[r].apply(this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned){var n;n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var s=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,s,i,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,s=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(r=i;r-->0;)if(n[r]===t||n[r].listener&&n[r].listener===t){s=r;break}if(0>s)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0};

},{}],10:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};

},{}],11:[function(require,module,exports){
module.exports=Array.isArray||function(r){return"[object Array]"==Object.prototype.toString.call(r)};

},{}],12:[function(require,module,exports){
function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var e=setTimeout(cleanUpNextTick);draining=!0;for(var n=queue.length;n;){for(currentQueue=queue,queue=[];++queueIndex<n;)currentQueue[queueIndex].run();queueIndex=-1,n=queue.length}currentQueue=null,draining=!1,clearTimeout(e)}}function Item(e,n){this.fun=e,this.array=n}function noop(){}var process=module.exports={},queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];queue.push(new Item(e,n)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};

},{}],13:[function(require,module,exports){
module.exports=require("./lib/_stream_duplex.js");

},{"./lib/_stream_duplex.js":14}],14:[function(require,module,exports){
(function (process){
function Duplex(e){return this instanceof Duplex?(Readable.call(this,e),Writable.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",onend)):new Duplex(e)}function onend(){this.allowHalfOpen||this._writableState.ended||process.nextTick(this.end.bind(this))}function forEach(e,t){for(var i=0,r=e.length;r>i;i++)t(e[i],i)}module.exports=Duplex;var objectKeys=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t},util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable),forEach(objectKeys(Writable.prototype),function(e){Duplex.prototype[e]||(Duplex.prototype[e]=Writable.prototype[e])});

}).call(this,require('_process'))
},{"./_stream_readable":16,"./_stream_writable":18,"_process":12,"core-util-is":19,"inherits":10}],15:[function(require,module,exports){
function PassThrough(r){return this instanceof PassThrough?void Transform.call(this,r):new PassThrough(r)}module.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(r,s,i){i(null,r)};

},{"./_stream_transform":17,"core-util-is":19,"inherits":10}],16:[function(require,module,exports){
(function (process){
function ReadableState(e,t){var n=require("./_stream_duplex");e=e||{};var r=e.highWaterMark,i=e.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,t instanceof n&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(e.encoding),this.encoding=e.encoding)}function Readable(e){require("./_stream_duplex");return this instanceof Readable?(this._readableState=new ReadableState(e,this),this.readable=!0,void Stream.call(this)):new Readable(e)}function readableAddChunk(e,t,n,r,i){var a=chunkInvalid(t,n);if(a)e.emit("error",a);else if(util.isNullOrUndefined(n))t.reading=!1,t.ended||onEofChunk(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var d=new Error("stream.push() after EOF");e.emit("error",d)}else if(t.endEmitted&&i){var d=new Error("stream.unshift() after end event");e.emit("error",d)}else!t.decoder||i||r||(n=t.decoder.write(n)),i||(t.reading=!1),t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&emitReadable(e)),maybeReadMore(e,t);else i||(t.reading=!1);return needMoreData(t)}function needMoreData(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function roundUpToNextPowerOf2(e){if(e>=MAX_HWM)e=MAX_HWM;else{e--;for(var t=1;32>t;t<<=1)e|=e>>t;e++}return e}function howMuchToRead(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:isNaN(e)||util.isNull(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:0>=e?0:(e>t.highWaterMark&&(t.highWaterMark=roundUpToNextPowerOf2(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function chunkInvalid(e,t){var n=null;return util.isBuffer(t)||util.isString(t)||util.isNullOrUndefined(t)||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function onEofChunk(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,emitReadable(e)}function emitReadable(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(debug("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?process.nextTick(function(){emitReadable_(e)}):emitReadable_(e))}function emitReadable_(e){debug("emit readable"),e.emit("readable"),flow(e)}function maybeReadMore(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(function(){maybeReadMore_(e,t)}))}function maybeReadMore_(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(debug("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function pipeOnDrain(e){return function(){var t=e._readableState;debug("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&EE.listenerCount(e,"data")&&(t.flowing=!0,flow(e))}}function resume(e,t){t.resumeScheduled||(t.resumeScheduled=!0,process.nextTick(function(){resume_(e,t)}))}function resume_(e,t){t.resumeScheduled=!1,e.emit("resume"),flow(e),t.flowing&&!t.reading&&e.read(0)}function flow(e){var t=e._readableState;if(debug("flow",t.flowing),t.flowing)do var n=e.read();while(null!==n&&t.flowing)}function fromList(e,t){var n,r=t.buffer,i=t.length,a=!!t.decoder,d=!!t.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(d)n=r.shift();else if(!e||e>=i)n=a?r.join(""):Buffer.concat(r,i),r.length=0;else if(e<r[0].length){var o=r[0];n=o.slice(0,e),r[0]=o.slice(e)}else if(e===r[0].length)n=r.shift();else{n=a?"":new Buffer(e);for(var l=0,u=0,s=r.length;s>u&&e>l;u++){var o=r[0],h=Math.min(e-l,o.length);a?n+=o.slice(0,h):o.copy(n,l,0,h),h<o.length?r[0]=o.slice(h):r.shift(),l+=h}}return n}function endReadable(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,process.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function forEach(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n],n)}function indexOf(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}module.exports=Readable;var isArray=require("isarray"),Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;EE.listenerCount||(EE.listenerCount=function(e,t){return e.listeners(t).length});var Stream=require("stream"),util=require("core-util-is");util.inherits=require("inherits");var StringDecoder,debug=require("util");debug=debug&&debug.debuglog?debug.debuglog("stream"):function(){},util.inherits(Readable,Stream),Readable.prototype.push=function(e,t){var n=this._readableState;return util.isString(e)&&!n.objectMode&&(t=t||n.defaultEncoding,t!==n.encoding&&(e=new Buffer(e,t),t="")),readableAddChunk(this,n,e,t,!1)},Readable.prototype.unshift=function(e){var t=this._readableState;return readableAddChunk(this,t,e,"",!0)},Readable.prototype.setEncoding=function(e){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(e),this._readableState.encoding=e,this};var MAX_HWM=8388608;Readable.prototype.read=function(e){debug("read",e);var t=this._readableState,n=e;if((!util.isNumber(e)||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return debug("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?endReadable(this):emitReadable(this),null;if(e=howMuchToRead(e,t),0===e&&t.ended)return 0===t.length&&endReadable(this),null;var r=t.needReadable;debug("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,debug("length less than watermark",r)),(t.ended||t.reading)&&(r=!1,debug("reading or ended",r)),r&&(debug("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),r&&!t.reading&&(e=howMuchToRead(n,t));var i;return i=e>0?fromList(e,t):null,util.isNull(i)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),n!==e&&t.ended&&0===t.length&&endReadable(this),util.isNull(i)||this.emit("data",i),i},Readable.prototype._read=function(e){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(e,t){function n(e){debug("onunpipe"),e===s&&i()}function r(){debug("onend"),e.end()}function i(){debug("cleanup"),e.removeListener("close",o),e.removeListener("finish",l),e.removeListener("drain",g),e.removeListener("error",d),e.removeListener("unpipe",n),s.removeListener("end",r),s.removeListener("end",i),s.removeListener("data",a),!h.awaitDrain||e._writableState&&!e._writableState.needDrain||g()}function a(t){debug("ondata");var n=e.write(t);!1===n&&(debug("false write response, pause",s._readableState.awaitDrain),s._readableState.awaitDrain++,s.pause())}function d(t){debug("onerror",t),u(),e.removeListener("error",d),0===EE.listenerCount(e,"error")&&e.emit("error",t)}function o(){e.removeListener("finish",l),u()}function l(){debug("onfinish"),e.removeListener("close",o),u()}function u(){debug("unpipe"),s.unpipe(e)}var s=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1,debug("pipe count=%d opts=%j",h.pipesCount,t);var f=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,b=f?r:i;h.endEmitted?process.nextTick(b):s.once("end",b),e.on("unpipe",n);var g=pipeOnDrain(s);return e.on("drain",g),s.on("data",a),e._events&&e._events.error?isArray(e._events.error)?e._events.error.unshift(d):e._events.error=[d,e._events.error]:e.on("error",d),e.once("close",o),e.once("finish",l),e.emit("pipe",s),h.flowing||(debug("pipe resume"),s.resume()),e},Readable.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;r>i;i++)n[i].emit("unpipe",this);return this}var i=indexOf(t.pipes,e);return-1===i?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},Readable.prototype.on=function(e,t){var n=Stream.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&this.readable){var r=this._readableState;if(!r.readableListening)if(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading)r.length&&emitReadable(this,r);else{var i=this;process.nextTick(function(){debug("readable nexttick read 0"),i.read(0)})}}return n},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var e=this._readableState;return e.flowing||(debug("resume"),e.flowing=!0,e.reading||(debug("resume read 0"),this.read(0)),resume(this,e)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(debug("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(debug("wrapped data"),t.decoder&&(i=t.decoder.write(i)),i&&(t.objectMode||i.length)){var a=r.push(i);a||(n=!0,e.pause())}});for(var i in e)util.isFunction(e[i])&&util.isUndefined(this[i])&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var a=["error","close","destroy","pause","resume"];return forEach(a,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){debug("wrapped _read",t),n&&(n=!1,e.resume())},r},Readable._fromList=fromList;

}).call(this,require('_process'))
},{"./_stream_duplex":14,"_process":12,"buffer":5,"core-util-is":19,"events":9,"inherits":10,"isarray":11,"stream":24,"string_decoder/":25,"util":4}],17:[function(require,module,exports){
function TransformState(r,t){this.afterTransform=function(r,n){return afterTransform(t,r,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform(r,t,n){var e=r._transformState;e.transforming=!1;var i=e.writecb;if(!i)return r.emit("error",new Error("no writecb in Transform class"));e.writechunk=null,e.writecb=null,util.isNullOrUndefined(n)||r.push(n),i&&i(t);var a=r._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&r._read(a.highWaterMark)}function Transform(r){if(!(this instanceof Transform))return new Transform(r);Duplex.call(this,r),this._transformState=new TransformState(r,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("prefinish",function(){util.isFunction(this._flush)?this._flush(function(r){done(t,r)}):done(t)})}function done(r,t){if(t)return r.emit("error",t);var n=r._writableState,e=r._transformState;if(n.length)throw new Error("calling transform done when ws.length != 0");if(e.transforming)throw new Error("calling transform done when still transforming");return r.push(null)}module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(r,t){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,r,t)},Transform.prototype._transform=function(r,t,n){throw new Error("not implemented")},Transform.prototype._write=function(r,t,n){var e=this._transformState;if(e.writecb=n,e.writechunk=r,e.writeencoding=t,!e.transforming){var i=this._readableState;(e.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Transform.prototype._read=function(r){var t=this._transformState;util.isNull(t.writechunk)||!t.writecb||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))};

},{"./_stream_duplex":14,"core-util-is":19,"inherits":10}],18:[function(require,module,exports){
(function (process){
function WriteReq(e,i,t){this.chunk=e,this.encoding=i,this.callback=t}function WritableState(e,i){var t=require("./_stream_duplex");e=e||{};var r=e.highWaterMark,n=e.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.objectMode=!!e.objectMode,i instanceof t&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=e.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){onwrite(i,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function Writable(e){var i=require("./_stream_duplex");return this instanceof Writable||this instanceof i?(this._writableState=new WritableState(e,this),this.writable=!0,void Stream.call(this)):new Writable(e)}function writeAfterEnd(e,i,t){var r=new Error("write after end");e.emit("error",r),process.nextTick(function(){t(r)})}function validChunk(e,i,t,r){var n=!0;if(!(util.isBuffer(t)||util.isString(t)||util.isNullOrUndefined(t)||i.objectMode)){var o=new TypeError("Invalid non-string/buffer chunk");e.emit("error",o),process.nextTick(function(){r(o)}),n=!1}return n}function decodeChunk(e,i,t){return!e.objectMode&&e.decodeStrings!==!1&&util.isString(i)&&(i=new Buffer(i,t)),i}function writeOrBuffer(e,i,t,r,n){t=decodeChunk(i,t,r),util.isBuffer(t)&&(r="buffer");var o=i.objectMode?1:t.length;i.length+=o;var f=i.length<i.highWaterMark;return f||(i.needDrain=!0),i.writing||i.corked?i.buffer.push(new WriteReq(t,r,n)):doWrite(e,i,!1,o,t,r,n),f}function doWrite(e,i,t,r,n,o,f){i.writelen=r,i.writecb=f,i.writing=!0,i.sync=!0,t?e._writev(n,i.onwrite):e._write(n,o,i.onwrite),i.sync=!1}function onwriteError(e,i,t,r,n){t?process.nextTick(function(){i.pendingcb--,n(r)}):(i.pendingcb--,n(r)),e._writableState.errorEmitted=!0,e.emit("error",r)}function onwriteStateUpdate(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function onwrite(e,i){var t=e._writableState,r=t.sync,n=t.writecb;if(onwriteStateUpdate(t),i)onwriteError(e,t,r,i,n);else{var o=needFinish(e,t);o||t.corked||t.bufferProcessing||!t.buffer.length||clearBuffer(e,t),r?process.nextTick(function(){afterWrite(e,t,o,n)}):afterWrite(e,t,o,n)}}function afterWrite(e,i,t,r){t||onwriteDrain(e,i),i.pendingcb--,r(),finishMaybe(e,i)}function onwriteDrain(e,i){0===i.length&&i.needDrain&&(i.needDrain=!1,e.emit("drain"))}function clearBuffer(e,i){if(i.bufferProcessing=!0,e._writev&&i.buffer.length>1){for(var t=[],r=0;r<i.buffer.length;r++)t.push(i.buffer[r].callback);i.pendingcb++,doWrite(e,i,!0,i.length,i.buffer,"",function(e){for(var r=0;r<t.length;r++)i.pendingcb--,t[r](e)}),i.buffer=[]}else{for(var r=0;r<i.buffer.length;r++){var n=i.buffer[r],o=n.chunk,f=n.encoding,u=n.callback,s=i.objectMode?1:o.length;if(doWrite(e,i,!1,s,o,f,u),i.writing){r++;break}}r<i.buffer.length?i.buffer=i.buffer.slice(r):i.buffer.length=0}i.bufferProcessing=!1}function needFinish(e,i){return i.ending&&0===i.length&&!i.finished&&!i.writing}function prefinish(e,i){i.prefinished||(i.prefinished=!0,e.emit("prefinish"))}function finishMaybe(e,i){var t=needFinish(e,i);return t&&(0===i.pendingcb?(prefinish(e,i),i.finished=!0,e.emit("finish")):prefinish(e,i)),t}function endWritable(e,i,t){i.ending=!0,finishMaybe(e,i),t&&(i.finished?process.nextTick(t):e.once("finish",t)),i.ended=!0}module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(e,i,t){var r=this._writableState,n=!1;return util.isFunction(i)&&(t=i,i=null),util.isBuffer(e)?i="buffer":i||(i=r.defaultEncoding),util.isFunction(t)||(t=function(){}),r.ended?writeAfterEnd(this,r,t):validChunk(this,r,e,t)&&(r.pendingcb++,n=writeOrBuffer(this,r,e,i,t)),n},Writable.prototype.cork=function(){var e=this._writableState;e.corked++},Writable.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.buffer.length||clearBuffer(this,e))},Writable.prototype._write=function(e,i,t){t(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(e,i,t){var r=this._writableState;util.isFunction(e)?(t=e,e=null,i=null):util.isFunction(i)&&(t=i,i=null),util.isNullOrUndefined(e)||this.write(e,i),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||endWritable(this,r,t)};

}).call(this,require('_process'))
},{"./_stream_duplex":14,"_process":12,"buffer":5,"core-util-is":19,"inherits":10,"stream":24}],19:[function(require,module,exports){
(function (Buffer){
function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function isBuffer(e){return Buffer.isBuffer(e)}function objectToString(e){return Object.prototype.toString.call(e)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=isBuffer;

}).call(this,require("buffer").Buffer)
},{"buffer":5}],20:[function(require,module,exports){
module.exports=require("./lib/_stream_passthrough.js");

},{"./lib/_stream_passthrough.js":15}],21:[function(require,module,exports){
exports=module.exports=require("./lib/_stream_readable.js"),exports.Stream=require("stream"),exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js");

},{"./lib/_stream_duplex.js":14,"./lib/_stream_passthrough.js":15,"./lib/_stream_readable.js":16,"./lib/_stream_transform.js":17,"./lib/_stream_writable.js":18,"stream":24}],22:[function(require,module,exports){
module.exports=require("./lib/_stream_transform.js");

},{"./lib/_stream_transform.js":17}],23:[function(require,module,exports){
module.exports=require("./lib/_stream_writable.js");

},{"./lib/_stream_writable.js":18}],24:[function(require,module,exports){
function Stream(){EE.call(this)}module.exports=Stream;var EE=require("events").EventEmitter,inherits=require("inherits");inherits(Stream,EE),Stream.Readable=require("readable-stream/readable.js"),Stream.Writable=require("readable-stream/writable.js"),Stream.Duplex=require("readable-stream/duplex.js"),Stream.Transform=require("readable-stream/transform.js"),Stream.PassThrough=require("readable-stream/passthrough.js"),Stream.Stream=Stream,Stream.prototype.pipe=function(e,r){function t(r){e.writable&&!1===e.write(r)&&m.pause&&m.pause()}function n(){m.readable&&m.resume&&m.resume()}function a(){u||(u=!0,e.end())}function o(){u||(u=!0,"function"==typeof e.destroy&&e.destroy())}function i(e){if(s(),0===EE.listenerCount(this,"error"))throw e}function s(){m.removeListener("data",t),e.removeListener("drain",n),m.removeListener("end",a),m.removeListener("close",o),m.removeListener("error",i),e.removeListener("error",i),m.removeListener("end",s),m.removeListener("close",s),e.removeListener("close",s)}var m=this;m.on("data",t),e.on("drain",n),e._isStdio||r&&r.end===!1||(m.on("end",a),m.on("close",o));var u=!1;return m.on("error",i),e.on("error",i),m.on("end",s),m.on("close",s),e.on("close",s),e.emit("pipe",m),e};

},{"events":9,"inherits":10,"readable-stream/duplex.js":13,"readable-stream/passthrough.js":20,"readable-stream/readable.js":21,"readable-stream/transform.js":22,"readable-stream/writable.js":23}],25:[function(require,module,exports){
function assertEncoding(e){if(e&&!isBufferEncoding(e))throw new Error("Unknown encoding: "+e)}function passThroughWrite(e){return e.toString(this.encoding)}function utf16DetectIncompleteChar(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var Buffer=require("buffer").Buffer,isBufferEncoding=Buffer.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},StringDecoder=exports.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";e=e.slice(r,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var h=t.charCodeAt(t.length-1);if(!(h>=55296&&56319>=h)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,h=t.charCodeAt(i);if(h>=55296&&56319>=h){var c=this.surrogateSize;return this.charLength+=c,this.charReceived+=c,this.charBuffer.copy(this.charBuffer,c,0,c),e.copy(this.charBuffer,0,0,c),t.substring(0,i)}return t},StringDecoder.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(2>=t&&r>>4==14){this.charLength=3;break}if(3>=t&&r>>3==30){this.charLength=4;break}}this.charReceived=t},StringDecoder.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,h=this.charBuffer,i=this.encoding;t+=h.slice(0,r).toString(i)}return t};

},{"buffer":5}],26:[function(require,module,exports){
module.exports=function(o){return o&&"object"==typeof o&&"function"==typeof o.copy&&"function"==typeof o.fill&&"function"==typeof o.readUInt8};

},{}],27:[function(require,module,exports){
(function (process,global){
function inspect(e,r){var t={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),isBoolean(r)?t.showHidden=r:r&&exports._extend(t,r),isUndefined(t.showHidden)&&(t.showHidden=!1),isUndefined(t.depth)&&(t.depth=2),isUndefined(t.colors)&&(t.colors=!1),isUndefined(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=stylizeWithColor),formatValue(t,e,t.depth)}function stylizeWithColor(e,r){var t=inspect.styles[r];return t?"["+inspect.colors[t][0]+"m"+e+"["+inspect.colors[t][1]+"m":e}function stylizeNoColor(e,r){return e}function arrayToHash(e){var r={};return e.forEach(function(e,t){r[e]=!0}),r}function formatValue(e,r,t){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==exports.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(t,e);return isString(n)||(n=formatValue(e,n,t)),n}var i=formatPrimitive(e,r);if(i)return i;var o=Object.keys(r),s=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),isError(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(r);if(0===o.length){if(isFunction(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var a="",c=!1,l=["{","}"];if(isArray(r)&&(c=!0,l=["[","]"]),isFunction(r)){var p=r.name?": "+r.name:"";a=" [Function"+p+"]"}if(isRegExp(r)&&(a=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(a=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(a=" "+formatError(r)),0===o.length&&(!c||0==r.length))return l[0]+a+l[1];if(0>t)return isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special");e.seen.push(r);var f;return f=c?formatArray(e,r,t,s,o):o.map(function(n){return formatProperty(e,r,t,s,n,c)}),e.seen.pop(),reduceToSingleString(f,a,l)}function formatPrimitive(e,r){if(isUndefined(r))return e.stylize("undefined","undefined");if(isString(r)){var t="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}return isNumber(r)?e.stylize(""+r,"number"):isBoolean(r)?e.stylize(""+r,"boolean"):isNull(r)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,r,t,n,i){for(var o=[],s=0,u=r.length;u>s;++s)hasOwnProperty(r,String(s))?o.push(formatProperty(e,r,t,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(formatProperty(e,r,t,n,i,!0))}),o}function formatProperty(e,r,t,n,i,o){var s,u,a;if(a=Object.getOwnPropertyDescriptor(r,i)||{value:r[i]},a.get?u=a.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):a.set&&(u=e.stylize("[Setter]","special")),hasOwnProperty(n,i)||(s="["+i+"]"),u||(e.seen.indexOf(a.value)<0?(u=isNull(t)?formatValue(e,a.value,null):formatValue(e,a.value,t-1),u.indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return u;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function reduceToSingleString(e,r,t){var n=0,i=e.reduce(function(e,r){return n++,r.indexOf("\n")>=0&&n++,e+r.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?t[0]+(""===r?"":r+"\n ")+" "+e.join(",\n  ")+" "+t[1]:t[0]+r+" "+e.join(", ")+" "+t[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return 10>e?"0"+e.toString(10):e.toString(10)}function timestamp(){var e=new Date,r=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],r].join(" ")}function hasOwnProperty(e,r){return Object.prototype.hasOwnProperty.call(e,r)}var formatRegExp=/%[sdj%]/g;exports.format=function(e){if(!isString(e)){for(var r=[],t=0;t<arguments.length;t++)r.push(inspect(arguments[t]));return r.join(" ")}for(var t=1,n=arguments,i=n.length,o=String(e).replace(formatRegExp,function(e){if("%%"===e)return"%";if(t>=i)return e;switch(e){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(r){return"[Circular]"}default:return e}}),s=n[t];i>t;s=n[++t])o+=isNull(s)||!isObject(s)?" "+s:" "+inspect(s);return o},exports.deprecate=function(e,r){function t(){if(!n){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),n=!0}return e.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(e,r).apply(this,arguments)};if(process.noDeprecation===!0)return e;var n=!1;return t};var debugs={},debugEnviron;exports.debuglog=function(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){var r=process.pid;debugs[e]=function(){var t=exports.format.apply(exports,arguments);console.error("%s %d: %s",e,r,t)}}else debugs[e]=function(){};return debugs[e]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(e,r){if(!r||!isObject(r))return e;for(var t=Object.keys(r),n=t.length;n--;)e[t[n]]=r[t[n]];return e};

}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./support/isBuffer":26,"_process":12,"inherits":10}],28:[function(require,module,exports){
module.exports=function(){for(var r=0;r<arguments.length;r++)if(void 0!==arguments[r])return arguments[r]};

},{}],29:[function(require,module,exports){
var createShader=require("gl-shader"),vertSrc="#define GLSLIFY 1\nprecision mediump float;\n\nattribute vec3 position, nextPosition;\nattribute float arcLength, lineWidth;\nattribute vec4 color;\n\nuniform vec2 screenShape;\nuniform float pixelRatio;\nuniform mat4 model, view, projection;\n\nvarying vec4 fragColor;\nvarying vec3 worldPosition;\nvarying float pixelArcLength;\n\nvoid main() {\n  vec4 projected = projection * view * model * vec4(position, 1.0);\n  vec4 tangentClip = projection * view * model * vec4(nextPosition - position, 0.0);\n  vec2 tangent = normalize(screenShape * tangentClip.xy);\n  vec2 offset = 0.5 * pixelRatio * lineWidth * vec2(tangent.y, -tangent.x) / screenShape;\n\n  gl_Position = vec4(projected.xy + projected.w * offset, projected.zw);\n\n  worldPosition = position;\n  pixelArcLength = arcLength;\n  fragColor = color;\n}\n",forwardFrag="#define GLSLIFY 1\nprecision mediump float;\n\nuniform vec3      clipBounds[2];\nuniform sampler2D dashTexture;\nuniform float     dashScale;\nuniform float     opacity;\n\nvarying vec3    worldPosition;\nvarying float   pixelArcLength;\nvarying vec4    fragColor;\n\nvoid main() {\n  if(any(lessThan(worldPosition, clipBounds[0])) || any(greaterThan(worldPosition, clipBounds[1]))) {\n    discard;\n  }\n  float dashWeight = texture2D(dashTexture, vec2(dashScale * pixelArcLength, 0)).r;\n  if(dashWeight < 0.5) {\n    discard;\n  }\n  gl_FragColor = fragColor * opacity;\n}\n",pickFrag="#define GLSLIFY 1\nprecision mediump float;\n\n#define FLOAT_MAX  1.70141184e38\n#define FLOAT_MIN  1.17549435e-38\n\nlowp vec4 encode_float_1_0(highp float v) {\n  highp float av = abs(v);\n\n  //Handle special cases\n  if(av < FLOAT_MIN) {\n    return vec4(0.0, 0.0, 0.0, 0.0);\n  } else if(v > FLOAT_MAX) {\n    return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\n  } else if(v < -FLOAT_MAX) {\n    return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\n  }\n\n  highp vec4 c = vec4(0,0,0,0);\n\n  //Compute exponent and mantissa\n  highp float e = floor(log2(av));\n  highp float m = av * pow(2.0, -e) - 1.0;\n  \n  //Unpack mantissa\n  c[1] = floor(128.0 * m);\n  m -= c[1] / 128.0;\n  c[2] = floor(32768.0 * m);\n  m -= c[2] / 32768.0;\n  c[3] = floor(8388608.0 * m);\n  \n  //Unpack exponent\n  highp float ebias = e + 127.0;\n  c[0] = floor(ebias / 2.0);\n  ebias -= c[0] * 2.0;\n  c[1] += floor(ebias) * 128.0; \n\n  //Unpack sign bit\n  c[0] += 128.0 * step(0.0, -v);\n\n  //Scale back to range\n  return c / 255.0;\n}\n\n\n\nuniform float pickId;\nuniform vec3 clipBounds[2];\n\nvarying vec3 worldPosition;\nvarying float pixelArcLength;\nvarying vec4 fragColor;\n\nvoid main() {\n  if(any(lessThan(worldPosition, clipBounds[0])) || any(greaterThan(worldPosition, clipBounds[1]))) {\n    discard;\n  }\n  gl_FragColor = vec4(pickId/255.0, encode_float_1_0(pixelArcLength).xyz);\n}",ATTRIBUTES=[{name:"position",type:"vec3"},{name:"nextPosition",type:"vec3"},{name:"arcLength",type:"float"},{name:"lineWidth",type:"float"},{name:"color",type:"vec4"}];exports.createShader=function(n){return createShader(n,vertSrc,forwardFrag,null,ATTRIBUTES)},exports.createPickShader=function(n){return createShader(n,vertSrc,pickFrag,null,ATTRIBUTES)};

},{"gl-shader":41}],30:[function(require,module,exports){
"use strict";function distance(t,i){for(var e=0,r=0;3>r;++r){var s=t[r]-i[r];e+=s*s}return Math.sqrt(e)}function filterClipBounds(t){for(var i=[[-1e6,-1e6,-1e6],[1e6,1e6,1e6]],e=0;3>e;++e)i[0][e]=Math.max(t[0][e],i[0][e]),i[1][e]=Math.min(t[1][e],i[1][e]);return i}function PickResult(t,i,e,r){this.arcLength=t,this.position=i,this.index=e,this.dataCoordinate=r}function LinePlot(t,i,e,r,s,a){this.gl=t,this.shader=i,this.pickShader=e,this.buffer=r,this.vao=s,this.clipBounds=[[-(1/0),-(1/0),-(1/0)],[1/0,1/0,1/0]],this.points=[],this.arcLength=[],this.vertexCount=0,this.bounds=[[0,0,0],[0,0,0]],this.pickId=0,this.lineWidth=1,this.texture=a,this.dashScale=1,this.opacity=1,this.dirty=!0,this.pixelRatio=1}function createLinePlot(t){var i=t.gl||t.scene&&t.scene.gl,e=createShader(i);e.attributes.position.location=0,e.attributes.nextPosition.location=1,e.attributes.arcLength.location=2,e.attributes.lineWidth.location=3,e.attributes.color.location=4;var r=createPickShader(i);r.attributes.position.location=0,r.attributes.nextPosition.location=1,r.attributes.arcLength.location=2,r.attributes.lineWidth.location=3,r.attributes.color.location=4;for(var s=createBuffer(i),a=createVAO(i,[{buffer:s,size:3,offset:0,stride:48},{buffer:s,size:3,offset:12,stride:48},{buffer:s,size:1,offset:24,stride:48},{buffer:s,size:1,offset:28,stride:48},{buffer:s,size:4,offset:32,stride:48}]),n=ndarray(new Array(1024),[256,1,4]),o=0;1024>o;++o)n.data[o]=255;var h=createTexture(i,n);h.wrap=i.REPEAT;var c=new LinePlot(i,e,r,s,a,h);return c.update(t),c}module.exports=createLinePlot;var createBuffer=require("gl-buffer"),createVAO=require("gl-vao"),createTexture=require("gl-texture2d"),unpackFloat=require("glsl-read-float"),bsearch=require("binary-search-bounds"),ndarray=require("ndarray"),shaders=require("./lib/shaders"),createShader=shaders.createShader,createPickShader=shaders.createPickShader,identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],proto=LinePlot.prototype;proto.isTransparent=function(){return this.opacity<1},proto.isOpaque=function(){return this.opacity>=1},proto.pickSlots=1,proto.setPickBase=function(t){this.pickId=t},proto.drawTransparent=proto.draw=function(t){var i=this.gl,e=this.shader,r=this.vao;e.bind(),e.uniforms={model:t.model||identity,view:t.view||identity,projection:t.projection||identity,clipBounds:filterClipBounds(this.clipBounds),dashTexture:this.texture.bind(),dashScale:this.dashScale/this.arcLength[this.arcLength.length-1],opacity:this.opacity,screenShape:[i.drawingBufferWidth,i.drawingBufferHeight],pixelRatio:this.pixelRatio},r.bind(),r.draw(i.TRIANGLE_STRIP,this.vertexCount)},proto.drawPick=function(t){var i=this.gl,e=this.pickShader,r=this.vao;e.bind(),e.uniforms={model:t.model||identity,view:t.view||identity,projection:t.projection||identity,pickId:this.pickId,clipBounds:filterClipBounds(this.clipBounds),screenShape:[i.drawingBufferWidth,i.drawingBufferHeight],pixelRatio:this.pixelRatio},r.bind(),r.draw(i.TRIANGLE_STRIP,this.vertexCount)},proto.update=function(t){this.dirty=!0,"dashScale"in t&&(this.dashScale=t.dashScale),"opacity"in t&&(this.opacity=+t.opacity);var i=t.position||t.positions;if(i){var e=t.color||t.colors||[0,0,0,1],r=t.lineWidth||1,s=[],a=[],n=[],o=0,h=0,c=[[1/0,1/0,1/0],[-(1/0),-(1/0),-(1/0)]];t:for(var u=1;u<i.length;++u){var d=i[u-1],l=i[u];a.push(o),n.push(d.slice());for(var p=0;3>p;++p){if(isNaN(d[p])||isNaN(l[p])||!isFinite(d[p])||!isFinite(l[p]))continue t;c[0][p]=Math.min(c[0][p],d[p],l[p]),c[1][p]=Math.max(c[1][p],d[p],l[p])}var f,v;Array.isArray(e[0])?(f=e[u-1],v=e[u]):f=v=e,3===f.length&&(f=[f[0],f[1],f[2],1]),3===v.length&&(v=[v[0],v[1],v[2],1]);var g,b;Array.isArray(r)?(g=r[u-1],b=lineWidht[u]):g=b=r;var y=o;o+=distance(d,l),s.push(d[0],d[1],d[2],l[0],l[1],l[2],y,g,f[0],f[1],f[2],f[3],d[0],d[1],d[2],l[0],l[1],l[2],y,-g,f[0],f[1],f[2],f[3],l[0],l[1],l[2],d[0],d[1],d[2],o,-g,v[0],v[1],v[2],v[3],l[0],l[1],l[2],d[0],d[1],d[2],o,g,v[0],v[1],v[2],v[3]),h+=4}if(this.buffer.update(s),a.push(o),n.push(i[i.length-1].slice()),this.bounds=c,this.vertexCount=h,this.points=n,this.arcLength=a,"dashes"in t){var x=t.dashes,L=x.slice();L.unshift(0);for(var u=1;u<L.length;++u)L[u]=L[u-1]+L[u];for(var k=ndarray(new Array(1024),[256,1,4]),u=0;256>u;++u){for(var p=0;4>p;++p)k.set(u,0,p,0);1&bsearch.le(L,L[L.length-1]*u/255)?k.set(u,0,0,0):k.set(u,0,0,255)}this.texture.setPixels(k)}}},proto.dispose=function(){this.shader.dispose(),this.vao.dispose(),this.buffer.dispose()},proto.pick=function(t){if(!t)return null;if(t.id!==this.pickId)return null;var i=unpackFloat(t.value[0],t.value[1],t.value[2],0),e=bsearch.le(this.arcLength,i);if(0>e)return null;if(e===this.arcLength.length-1)return new PickResult(this.arcLength[this.arcLength.length-1],this.points[this.points.length-1].slice(),e);for(var r=this.points[e],s=this.points[Math.min(e+1,this.points.length-1)],a=(i-this.arcLength[e])/(this.arcLength[e+1]-this.arcLength[e]),n=1-a,o=[0,0,0],h=0;3>h;++h)o[h]=n*r[h]+a*s[h];var c=Math.min(.5>a?e:e+1,this.points.length-1);return new PickResult(i,o,c,this.points[c])};

},{"./lib/shaders":29,"binary-search-bounds":31,"gl-buffer":32,"gl-texture2d":58,"gl-vao":62,"glsl-read-float":63,"ndarray":296}],31:[function(require,module,exports){
"use strict";function compileSearch(e,n,c,i,r,u){var h=["function ",e,"(a,l,h,",i.join(","),"){",u?"":"var i=",c?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",r?".get(m)":"[m]"];return u?n.indexOf("c")<0?h.push(";if(x===y){return m}else if(x<=y){"):h.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):h.push(";if(",n,"){i=m;"),c?h.push("l=m+1}else{h=m-1}"):h.push("h=m-1}else{l=m+1}"),h.push("}"),u?h.push("return -1};"):h.push("return i};"),h.join("")}function compileBoundsSearch(e,n,c,i){var r=new Function([compileSearch("A","x"+e+"y",n,["y"],!1,i),compileSearch("B","x"+e+"y",n,["y"],!0,i),compileSearch("P","c(x,y)"+e+"0",n,["y","c"],!1,i),compileSearch("Q","c(x,y)"+e+"0",n,["y","c"],!0,i),"function dispatchBsearch",c,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",c].join(""));return r()}module.exports={ge:compileBoundsSearch(">=",!1,"GE"),gt:compileBoundsSearch(">",!1,"GT"),lt:compileBoundsSearch("<",!0,"LT"),le:compileBoundsSearch("<=",!0,"LE"),eq:compileBoundsSearch("-",!0,"EQ",!0)};

},{}],32:[function(require,module,exports){
"use strict";function GLBuffer(e,t,r,i,s){this.gl=e,this.type=t,this.handle=r,this.length=i,this.usage=s}function updateTypeArray(e,t,r,i,s,a){var n=s.length*s.BYTES_PER_ELEMENT;if(0>a)return e.bufferData(t,s,i),n;if(n+a>r)throw new Error("gl-buffer: If resizing buffer, must not specify offset");return e.bufferSubData(t,a,s),r}function makeScratchTypeArray(e,t){for(var r=pool.malloc(e.length,t),i=e.length,s=0;i>s;++s)r[s]=e[s];return r}function isPacked(e,t){for(var r=1,i=t.length-1;i>=0;--i){if(t[i]!==r)return!1;r*=e[i]}return!0}function createBuffer(e,t,r,i){if(r=r||e.ARRAY_BUFFER,i=i||e.DYNAMIC_DRAW,r!==e.ARRAY_BUFFER&&r!==e.ELEMENT_ARRAY_BUFFER)throw new Error("gl-buffer: Invalid type for webgl buffer, must be either gl.ARRAY_BUFFER or gl.ELEMENT_ARRAY_BUFFER");if(i!==e.DYNAMIC_DRAW&&i!==e.STATIC_DRAW&&i!==e.STREAM_DRAW)throw new Error("gl-buffer: Invalid usage for buffer, must be either gl.DYNAMIC_DRAW, gl.STATIC_DRAW or gl.STREAM_DRAW");var s=e.createBuffer(),a=new GLBuffer(e,r,s,0,i);return a.update(t),a}var pool=require("typedarray-pool"),ops=require("ndarray-ops"),ndarray=require("ndarray"),SUPPORTED_TYPES=["uint8","uint8_clamped","uint16","uint32","int8","int16","int32","float32"],proto=GLBuffer.prototype;proto.bind=function(){this.gl.bindBuffer(this.type,this.handle)},proto.unbind=function(){this.gl.bindBuffer(this.type,null)},proto.dispose=function(){this.gl.deleteBuffer(this.handle)},proto.update=function(e,t){if("number"!=typeof t&&(t=-1),this.bind(),"object"==typeof e&&"undefined"!=typeof e.shape){var r=e.dtype;if(SUPPORTED_TYPES.indexOf(r)<0&&(r="float32"),this.type===this.gl.ELEMENT_ARRAY_BUFFER){var i=gl.getExtension("OES_element_index_uint");r=i&&"uint16"!==r?"uint32":"uint16"}if(r===e.dtype&&isPacked(e.shape,e.stride))0===e.offset&&e.data.length===e.shape[0]?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e.data,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e.data.subarray(e.offset,e.shape[0]),t);else{var s=pool.malloc(e.size,r),a=ndarray(s,e.shape);ops.assign(a,e),0>t?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,s,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,s.subarray(0,e.size),t),pool.free(s)}}else if(Array.isArray(e)){var n;n=this.type===this.gl.ELEMENT_ARRAY_BUFFER?makeScratchTypeArray(e,"uint16"):makeScratchTypeArray(e,"float32"),0>t?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,n,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,n.subarray(0,e.length),t),pool.free(n)}else if("object"==typeof e&&"number"==typeof e.length)this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e,t);else{if("number"!=typeof e&&void 0!==e)throw new Error("gl-buffer: Invalid data type");if(t>=0)throw new Error("gl-buffer: Cannot specify offset when resizing buffer");e=0|e,0>=e&&(e=1),this.gl.bufferData(this.type,0|e,this.usage),this.length=e}},module.exports=createBuffer;

},{"ndarray":296,"ndarray-ops":33,"typedarray-pool":40}],33:[function(require,module,exports){
"use strict";function fixup(a){if(!a)return EmptyProc;for(var r=0;r<a.args.length;++r){var s=a.args[r];0===r?a.args[r]={name:s,lvalue:!0,rvalue:!!a.rvalue,count:a.count||1}:a.args[r]={name:s,lvalue:!1,rvalue:!0,count:1}}return a.thisVars||(a.thisVars=[]),a.localVars||(a.localVars=[]),a}function pcompile(a){return compile({args:a.args,pre:fixup(a.pre),body:fixup(a.body),post:fixup(a.proc),funcName:a.funcName})}function makeOp(a){for(var r=[],s=0;s<a.args.length;++s)r.push("a"+s);var i=new Function("P",["return function ",a.funcName,"_ndarrayops(",r.join(","),") {P(",r.join(","),");return a0}"].join(""));return i(pcompile(a))}var compile=require("cwise-compiler"),EmptyProc={body:"",args:[],thisVars:[],localVars:[]},assign_ops={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var a in assign_ops){var r=assign_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:a+"eq"}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:a+"seq"})}}();var unary_ops={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var a in unary_ops){var r=unary_ops[a];exports[a]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:a}),exports[a+"eq"]=makeOp({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:a+"eq"})}}();var binary_ops={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var a in binary_ops){var r=binary_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:a+"eq"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:a+"seq"})}}();var math_unary=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var a=0;a<math_unary.length;++a){var r=math_unary[a];exports[r]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),exports[r+"eq"]=makeOp({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var math_comm=["max","min","atan2","pow"];!function(){for(var a=0;a<math_comm.length;++a){var r=math_comm[a];exports[r]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),exports[r+"s"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),exports[r+"eq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),exports[r+"seq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var math_noncomm=["atan2","pow"];!function(){for(var a=0;a<math_noncomm.length;++a){var r=math_noncomm[a];exports[r+"op"]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),exports[r+"ops"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),exports[r+"opeq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),exports[r+"opseq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),exports.any=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),exports.all=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),exports.sum=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),exports.prod=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),exports.norm2squared=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),exports.norm2=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),exports.norminf=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),exports.norm1=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),exports.sup=compile({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.inf=compile({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.argmin=compile({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.argmax=compile({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.random=makeOp({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),exports.assign=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),exports.assigns=makeOp({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),exports.equals=compile({args:["array","array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"});

},{"cwise-compiler":34}],34:[function(require,module,exports){
"use strict";function Procedure(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function compileCwise(r){var e=new Procedure;e.pre=r.pre,e.body=r.body,e.post=r.post;var s=r.args.slice(0);e.argTypes=s;for(var o=0;o<s.length;++o){var a=s[o];if("array"===a||"object"==typeof a&&a.blockIndices){if(e.argTypes[o]="array",e.arrayArgs.push(o),e.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),e.shimArgs.push("array"+o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===a)e.scalarArgs.push(o),e.shimArgs.push("scalar"+o);else if("index"===a){if(e.indexArgs.push(o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===a){if(e.shapeArgs.push(o),o<e.pre.args.length&&e.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<e.post.args.length&&e.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof a||!a.offset)throw new Error("cwise: Unknown argument type "+s[o]);e.argTypes[o]="offset",e.offsetArgs.push({array:a.array,offset:a.offset}),e.offsetArgIndex.push(o)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>s.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>s.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>s.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!r.printCode||!!r.debug,e.funcName=r.funcName||"cwise",e.blockSize=r.blockSize||64,createThunk(e)}var createThunk=require("./lib/thunk.js");module.exports=compileCwise;

},{"./lib/thunk.js":36}],35:[function(require,module,exports){
"use strict";function innerFill(r,n,e){var s,a,o=r.length,i=n.arrayArgs.length,t=n.indexArgs.length>0,p=[],h=[],u=0,c=0;for(s=0;o>s;++s)h.push(["i",s,"=0"].join(""));for(a=0;i>a;++a)for(s=0;o>s;++s)c=u,u=r[s],0===s?h.push(["d",a,"s",s,"=t",a,"p",u].join("")):h.push(["d",a,"s",s,"=(t",a,"p",u,"-s",c,"*t",a,"p",c,")"].join(""));for(p.push("var "+h.join(",")),s=o-1;s>=0;--s)u=r[s],p.push(["for(i",s,"=0;i",s,"<s",u,";++i",s,"){"].join(""));for(p.push(e),s=0;o>s;++s){for(c=u,u=r[s],a=0;i>a;++a)p.push(["p",a,"+=d",a,"s",s].join(""));t&&(s>0&&p.push(["index[",c,"]-=s",c].join("")),p.push(["++index[",u,"]"].join(""))),p.push("}")}return p.join("\n")}function outerFill(r,n,e,s){for(var a=n.length,o=e.arrayArgs.length,i=e.blockSize,t=e.indexArgs.length>0,p=[],h=0;o>h;++h)p.push(["var offset",h,"=p",h].join(""));for(var h=r;a>h;++h)p.push(["for(var j"+h+"=SS[",n[h],"]|0;j",h,">0;){"].join("")),p.push(["if(j",h,"<",i,"){"].join("")),p.push(["s",n[h],"=j",h].join("")),p.push(["j",h,"=0"].join("")),p.push(["}else{s",n[h],"=",i].join("")),p.push(["j",h,"-=",i,"}"].join("")),t&&p.push(["index[",n[h],"]=j",h].join(""));for(var h=0;o>h;++h){for(var u=["offset"+h],c=r;a>c;++c)u.push(["j",c,"*t",h,"p",n[c]].join(""));p.push(["p",h,"=(",u.join("+"),")"].join(""))}p.push(innerFill(n,e,s));for(var h=r;a>h;++h)p.push("}");return p.join("\n")}function countMatches(r){for(var n=0,e=r[0].length;e>n;){for(var s=1;s<r.length;++s)if(r[s][n]!==r[0][n])return n;++n}return n}function processBlock(r,n,e){for(var s=r.body,a=[],o=[],i=0;i<r.args.length;++i){var t=r.args[i];if(!(t.count<=0)){var p=new RegExp(t.name,"g"),h="",u=n.arrayArgs.indexOf(i);switch(n.argTypes[i]){case"offset":var c=n.offsetArgIndex.indexOf(i),l=n.offsetArgs[c];u=l.array,h="+q"+c;case"array":h="p"+u+h;var f="l"+i,g="a"+u;if(0===n.arrayBlockIndices[u])1===t.count?"generic"===e[u]?t.lvalue?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),o.push([g,".set(",h,",",f,")"].join(""))):s=s.replace(p,[g,".get(",h,")"].join("")):s=s.replace(p,[g,"[",h,"]"].join("")):"generic"===e[u]?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,".set(",h,",",f,")"].join(""))):(a.push(["var ",f,"=",g,"[",h,"]"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,"[",h,"]=",f].join("")));else{for(var j=[t.name],v=[h],y=0;y<Math.abs(n.arrayBlockIndices[u]);y++)j.push("\\s*\\[([^\\]]+)\\]"),v.push("$"+(y+1)+"*t"+u+"b"+y);if(p=new RegExp(j.join(""),"g"),h=v.join("+"),"generic"===e[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");s=s.replace(p,[g,"[",h,"]"].join(""))}break;case"scalar":s=s.replace(p,"Y"+n.scalarArgs.indexOf(i));break;case"index":s=s.replace(p,"index");break;case"shape":s=s.replace(p,"shape")}}}return[a.join("\n"),s,o.join("\n")].join("\n").trim()}function typeSummary(r){for(var n=new Array(r.length),e=!0,s=0;s<r.length;++s){var a=r[s],o=a.match(/\d+/);o=o?o[0]:"",0===a.charAt(0)?n[s]="u"+a.charAt(1)+o:n[s]=a.charAt(0)+o,s>0&&(e=e&&n[s]===n[s-1])}return e?n[0]:n.join("")}function generateCWiseOp(r,n){for(var e=n[1].length-Math.abs(r.arrayBlockIndices[0])|0,s=new Array(r.arrayArgs.length),a=new Array(r.arrayArgs.length),o=0;o<r.arrayArgs.length;++o)a[o]=n[2*o],s[o]=n[2*o+1];for(var i=[],t=[],p=[],h=[],u=[],o=0;o<r.arrayArgs.length;++o){r.arrayBlockIndices[o]<0?(p.push(0),h.push(e),i.push(e),t.push(e+r.arrayBlockIndices[o])):(p.push(r.arrayBlockIndices[o]),h.push(r.arrayBlockIndices[o]+e),i.push(0),t.push(r.arrayBlockIndices[o]));for(var c=[],l=0;l<s[o].length;l++)p[o]<=s[o][l]&&s[o][l]<h[o]&&c.push(s[o][l]-p[o]);u.push(c)}for(var f=["SS"],g=["'use strict'"],j=[],l=0;e>l;++l)j.push(["s",l,"=SS[",l,"]"].join(""));for(var o=0;o<r.arrayArgs.length;++o){f.push("a"+o),f.push("t"+o),f.push("p"+o);for(var l=0;e>l;++l)j.push(["t",o,"p",l,"=t",o,"[",p[o]+l,"]"].join(""));for(var l=0;l<Math.abs(r.arrayBlockIndices[o]);++l)j.push(["t",o,"b",l,"=t",o,"[",i[o]+l,"]"].join(""))}for(var o=0;o<r.scalarArgs.length;++o)f.push("Y"+o);if(r.shapeArgs.length>0&&j.push("shape=SS.slice(0)"),r.indexArgs.length>0){for(var v=new Array(e),o=0;e>o;++o)v[o]="0";j.push(["index=[",v.join(","),"]"].join(""))}for(var o=0;o<r.offsetArgs.length;++o){for(var y=r.offsetArgs[o],d=[],l=0;l<y.offset.length;++l)0!==y.offset[l]&&(1===y.offset[l]?d.push(["t",y.array,"p",l].join("")):d.push([y.offset[l],"*t",y.array,"p",l].join("")));0===d.length?j.push("q"+o+"=0"):j.push(["q",o,"=",d.join("+")].join(""))}var A=uniq([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));j=j.concat(A),g.push("var "+j.join(","));for(var o=0;o<r.arrayArgs.length;++o)g.push("p"+o+"|=0");r.pre.body.length>3&&g.push(processBlock(r.pre,r,a));var k=processBlock(r.body,r,a),b=countMatches(u);e>b?g.push(outerFill(b,u[0],r,k)):g.push(innerFill(u[0],r,k)),r.post.body.length>3&&g.push(processBlock(r.post,r,a)),r.debug&&console.log("-----Generated cwise routine for ",n,":\n"+g.join("\n")+"\n----------");var x=[r.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",b,typeSummary(a)].join(""),w=new Function(["function ",x,"(",f.join(","),"){",g.join("\n"),"} return ",x].join(""));return w()}var uniq=require("uniq");module.exports=generateCWiseOp;

},{"uniq":37}],36:[function(require,module,exports){
"use strict";function createThunk(r){var a=["'use strict'","var CACHED={}"],e=[],s=r.funcName+"_cwise_thunk";a.push(["return function ",s,"(",r.shimArgs.join(","),"){"].join(""));for(var n=[],o=[],h=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],i=[],p=[],t=0;t<r.arrayArgs.length;++t){var c=r.arrayArgs[t];e.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),n.push("t"+c),n.push("r"+c),o.push("t"+c),o.push("r"+c+".join()"),h.push("array"+c+".data"),h.push("array"+c+".stride"),h.push("array"+c+".offset|0"),t>0&&(i.push("array"+r.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[t]))),p.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[t])+"]"))}r.arrayArgs.length>1&&(a.push("if (!("+i.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),a.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),a.push("if (!("+p.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),a.push("}"));for(var t=0;t<r.scalarArgs.length;++t)h.push("scalar"+r.scalarArgs[t]);e.push(["type=[",o.join(","),"].join()"].join("")),e.push("proc=CACHED[type]"),a.push("var "+e.join(",")),a.push(["if(!proc){","CACHED[type]=proc=compile([",n.join(","),"])}","return proc(",h.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+a.join("\n")+"\n----------");var u=new Function("compile",a.join("\n"));return u(compile.bind(void 0,r))}var compile=require("./compile.js");module.exports=createThunk;

},{"./compile.js":35}],37:[function(require,module,exports){
"use strict";function unique_pred(n,e){for(var u=1,t=n.length,i=n[0],r=n[0],o=1;t>o;++o)if(r=i,i=n[o],e(i,r)){if(o===u){u++;continue}n[u++]=i}return n.length=u,n}function unique_eq(n){for(var e=1,u=n.length,t=n[0],i=n[0],r=1;u>r;++r,i=t)if(i=t,t=n[r],t!==i){if(r===e){e++;continue}n[e++]=t}return n.length=e,n}function unique(n,e,u){return 0===n.length?n:e?(u||n.sort(e),unique_pred(n,e)):(u||n.sort(),unique_eq(n))}module.exports=unique;

},{}],38:[function(require,module,exports){
"use strict";"use restrict";function countTrailingZeros(r){var n=32;return r&=-r,r&&n--,65535&r&&(n-=16),16711935&r&&(n-=8),252645135&r&&(n-=4),858993459&r&&(n-=2),1431655765&r&&(n-=1),n}var INT_BITS=32;exports.INT_BITS=INT_BITS,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<INT_BITS-1,exports.sign=function(r){return(r>0)-(0>r)},exports.abs=function(r){var n=r>>INT_BITS-1;return(r^n)-n},exports.min=function(r,n){return n^(r^n)&-(n>r)},exports.max=function(r,n){return r^(r^n)&-(n>r)},exports.isPow2=function(r){return!(r&r-1||!r)},exports.log2=function(r){var n,t;return n=(r>65535)<<4,r>>>=n,t=(r>255)<<3,r>>>=t,n|=t,t=(r>15)<<2,r>>>=t,n|=t,t=(r>3)<<1,r>>>=t,n|=t,n|r>>1},exports.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},exports.popCount=function(r){return r-=r>>>1&1431655765,r=(858993459&r)+(r>>>2&858993459),16843009*(r+(r>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1},exports.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r-(r>>>1)},exports.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,r&=15,27030>>>r&1};var REVERSE_TABLE=new Array(256);!function(r){for(var n=0;256>n;++n){var t=n,e=n,o=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--o;r[n]=e<<o&255}}(REVERSE_TABLE),exports.reverse=function(r){return REVERSE_TABLE[255&r]<<24|REVERSE_TABLE[r>>>8&255]<<16|REVERSE_TABLE[r>>>16&255]<<8|REVERSE_TABLE[r>>>24&255]},exports.interleave2=function(r,n){return r&=65535,r=16711935&(r|r<<8),r=252645135&(r|r<<4),r=858993459&(r|r<<2),r=1431655765&(r|r<<1),n&=65535,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),r|n<<1},exports.deinterleave2=function(r,n){return r=r>>>n&1431655765,r=858993459&(r|r>>>1),r=252645135&(r|r>>>2),r=16711935&(r|r>>>4),r=65535&(r|r>>>16),r<<16>>16},exports.interleave3=function(r,n,t){return r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),n&=1023,n=4278190335&(n|n<<16),n=251719695&(n|n<<8),n=3272356035&(n|n<<4),n=1227133513&(n|n<<2),r|=n<<1,t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),r|t<<2},exports.deinterleave3=function(r,n){return r=r>>>n&1227133513,r=3272356035&(r|r>>>2),r=251719695&(r|r>>>4),r=4278190335&(r|r>>>8),r=1023&(r|r>>>16),r<<22>>22},exports.nextCombination=function(r){var n=r|r-1;return n+1|(~n&-~n)-1>>>countTrailingZeros(r)+1};

},{}],39:[function(require,module,exports){
"use strict";function dupe_array(e,r,u){var n=0|e[u];if(0>=n)return[];var t,a=new Array(n);if(u===e.length-1)for(t=0;n>t;++t)a[t]=r;else for(t=0;n>t;++t)a[t]=dupe_array(e,r,u+1);return a}function dupe_number(e,r){var u,n;for(u=new Array(e),n=0;e>n;++n)u[n]=r;return u}function dupe(e,r){switch("undefined"==typeof r&&(r=0),typeof e){case"number":if(e>0)return dupe_number(0|e,r);break;case"object":if("number"==typeof e.length)return dupe_array(e,r,0)}return[]}module.exports=dupe;

},{}],40:[function(require,module,exports){
(function (global,Buffer){
"use strict";function freeArrayBuffer(r){if(r){var e=r.length||r.byteLength,t=bits.log2(e);DATA[t].push(r)}}function freeTypedArray(r){freeArrayBuffer(r.buffer)}function mallocArrayBuffer(r){var r=bits.nextPow2(r),e=bits.log2(r),t=DATA[e];return t.length>0?t.pop():new ArrayBuffer(r)}function mallocUint8(r){return new Uint8Array(mallocArrayBuffer(r),0,r)}function mallocUint16(r){return new Uint16Array(mallocArrayBuffer(2*r),0,r)}function mallocUint32(r){return new Uint32Array(mallocArrayBuffer(4*r),0,r)}function mallocInt8(r){return new Int8Array(mallocArrayBuffer(r),0,r)}function mallocInt16(r){return new Int16Array(mallocArrayBuffer(2*r),0,r)}function mallocInt32(r){return new Int32Array(mallocArrayBuffer(4*r),0,r)}function mallocFloat(r){return new Float32Array(mallocArrayBuffer(4*r),0,r)}function mallocDouble(r){return new Float64Array(mallocArrayBuffer(8*r),0,r)}function mallocUint8Clamped(r){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(r),0,r):mallocUint8(r)}function mallocDataView(r){return new DataView(mallocArrayBuffer(r),0,r)}function mallocBuffer(r){r=bits.nextPow2(r);var e=bits.log2(r),t=BUFFER[e];return t.length>0?t.pop():new Buffer(r)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(r){if(Buffer.isBuffer(r))BUFFER[bits.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var e=r.length||r.byteLength,t=0|bits.log2(e);DATA[t].push(r)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(r){BUFFER[bits.log2(r.length)].push(r)},exports.malloc=function(r,e){if(void 0===e||"arraybuffer"===e)return mallocArrayBuffer(r);switch(e){case"uint8":return mallocUint8(r);case"uint16":return mallocUint16(r);case"uint32":return mallocUint32(r);case"int8":return mallocInt8(r);case"int16":return mallocInt16(r);case"int32":return mallocInt32(r);case"float":case"float32":return mallocFloat(r);case"double":case"float64":return mallocDouble(r);case"uint8_clamped":return mallocUint8Clamped(r);case"buffer":return mallocBuffer(r);case"data":case"dataview":return mallocDataView(r);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var r=0;32>r;++r)POOL.UINT8[r].length=0,POOL.UINT16[r].length=0,POOL.UINT32[r].length=0,POOL.INT8[r].length=0,POOL.INT16[r].length=0,POOL.INT32[r].length=0,POOL.FLOAT[r].length=0,POOL.DOUBLE[r].length=0,POOL.UINT8C[r].length=0,DATA[r].length=0,BUFFER[r].length=0};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"bit-twiddle":38,"buffer":5,"dup":39}],41:[function(require,module,exports){
"use strict";function Shader(r){this.gl=r,this._vref=this._fref=this._relink=this.vertShader=this.fragShader=this.program=this.attributes=this.uniforms=this.types=null}function compareAttributes(r,e){return r.name<e.name?-1:1}function createShader(r,e,t,a,i){var o=new Shader(r);return o.update(e,t,a,i),o}var createUniformWrapper=require("./lib/create-uniforms"),createAttributeWrapper=require("./lib/create-attributes"),makeReflect=require("./lib/reflect"),shaderCache=require("./lib/shader-cache"),runtime=require("./lib/runtime-reflect"),proto=Shader.prototype;proto.bind=function(){this.program||this._relink(),this.gl.useProgram(this.program)},proto.dispose=function(){this._fref&&this._fref.dispose(),this._vref&&this._vref.dispose(),this.attributes=this.types=this.vertShader=this.fragShader=this.program=this._relink=this._fref=this._vref=null},proto.update=function(r,e,t,a){function i(){s.program=shaderCache.program(n,s._vref,s._fref,m,c);for(var r=0;r<t.length;++r)S[r]=n.getUniformLocation(s.program,t[r].name)}if(!e||1===arguments.length){var o=r;r=o.vertex,e=o.fragment,t=o.uniforms,a=o.attributes}var s=this,n=s.gl,h=s._vref;s._vref=shaderCache.shader(n,n.VERTEX_SHADER,r),h&&h.dispose(),s.vertShader=s._vref.shader;var f=this._fref;if(s._fref=shaderCache.shader(n,n.FRAGMENT_SHADER,e),f&&f.dispose(),s.fragShader=s._fref.shader,!t||!a){var p=n.createProgram();if(n.attachShader(p,s.fragShader),n.attachShader(p,s.vertShader),n.linkProgram(p),!n.getProgramParameter(p,n.LINK_STATUS)){var u=n.getProgramInfoLog(p);throw console.error("gl-shader: Error linking program:",u),new Error("gl-shader: Error linking program:"+u)}t=t||runtime.uniforms(n,p),a=a||runtime.attributes(n,p),n.deleteProgram(p)}a=a.slice(),a.sort(compareAttributes);for(var l=[],m=[],c=[],g=0;g<a.length;++g){var d=a[g];if(d.type.indexOf("mat")>=0){for(var v=0|d.type.charAt(d.type.length-1),_=new Array(v),b=0;v>b;++b)_[b]=c.length,m.push(d.name+"["+b+"]"),"number"==typeof d.location?c.push(d.location+b):Array.isArray(d.location)&&d.location.length===v&&"number"==typeof d.location[b]?c.push(0|d.location[b]):c.push(-1);l.push({name:d.name,type:d.type,locations:_})}else l.push({name:d.name,type:d.type,locations:[c.length]}),m.push(d.name),"number"==typeof d.location?c.push(0|d.location):c.push(-1)}for(var y=0,g=0;g<c.length;++g)if(c[g]<0){for(;c.indexOf(y)>=0;)y+=1;c[g]=y}var S=new Array(t.length);i(),s._relink=i,s.types={uniforms:makeReflect(t),attributes:makeReflect(a)},s.attributes=createAttributeWrapper(n,s,l,c),Object.defineProperty(s,"uniforms",createUniformWrapper(n,s,t,S))},module.exports=createShader;

},{"./lib/create-attributes":42,"./lib/create-uniforms":43,"./lib/reflect":44,"./lib/runtime-reflect":45,"./lib/shader-cache":46}],42:[function(require,module,exports){
"use strict";function ShaderAttribute(t,r,e,i,n,a){this._gl=t,this._wrapper=r,this._index=e,this._locations=i,this._dimension=n,this._constFunc=a}function addVectorAttribute(t,r,e,i,n,a,o){for(var u=["gl","v"],s=[],c=0;n>c;++c)u.push("x"+c),s.push("x"+c);u.push("if(x0.length===void 0){return gl.vertexAttrib"+n+"f(v,"+s.join()+")}else{return gl.vertexAttrib"+n+"fv(v,x0)}");var l=Function.apply(null,u),f=new ShaderAttribute(t,r,e,i,n,l);Object.defineProperty(a,o,{set:function(r){return t.disableVertexAttribArray(i[e]),l(t,i[e],r),r},get:function(){return f},enumerable:!0})}function addMatrixAttribute(t,r,e,i,n,a,o){for(var u=new Array(n),s=new Array(n),c=0;n>c;++c)addVectorAttribute(t,r,e[c],i,n,u,c),s[c]=u[c];Object.defineProperty(u,"location",{set:function(t){if(Array.isArray)for(var r=0;n>r;++r)s[r].location=t[r];else for(var r=0;n>r;++r)result[r]=s[r].location=t+r;return t},get:function(){for(var t=new Array(n),r=0;n>r;++r)t[r]=i[e[r]];return t},enumerable:!0}),u.pointer=function(r,a,o,u){r=r||t.FLOAT,a=!!a,o=o||n*n,u=u||0;for(var s=0;n>s;++s){var c=i[e[s]];t.vertexAttribPointer(c,n,r,a,o,u+s*n),t.enableVertexAttribArray(c)}};var l=new Array(n),f=t["vertexAttrib"+n+"fv"];Object.defineProperty(a,o,{set:function(r){for(var a=0;n>a;++a){var o=i[e[a]];if(t.disableVertexAttribArray(o),Array.isArray(r[0]))f.call(t,o,r[a]);else{for(var u=0;n>u;++u)l[u]=r[n*a+u];f.call(t,o,l)}}return r},get:function(){return u},enumerable:!0})}function createAttributeWrapper(t,r,e,i){for(var n={},a=0,o=e.length;o>a;++a){var u=e[a],s=u.name,c=u.type,l=u.locations;switch(c){case"bool":case"int":case"float":addVectorAttribute(t,r,l[0],i,1,n,s);break;default:if(c.indexOf("vec")>=0){var f=c.charCodeAt(c.length-1)-48;if(2>f||f>4)throw new Error("gl-shader: Invalid data type for attribute "+s+": "+c);addVectorAttribute(t,r,l[0],i,f,n,s)}else{if(!(c.indexOf("mat")>=0))throw new Error("gl-shader: Unknown data type for attribute "+s+": "+c);var f=c.charCodeAt(c.length-1)-48;if(2>f||f>4)throw new Error("gl-shader: Invalid data type for attribute "+s+": "+c);addMatrixAttribute(t,r,l,i,f,n,s)}}}return n}module.exports=createAttributeWrapper;var proto=ShaderAttribute.prototype;proto.pointer=function(t,r,e,i){var n=this,a=n._gl,o=n._locations[n._index];a.vertexAttribPointer(o,n._dimension,t||a.FLOAT,!!r,e||0,i||0),a.enableVertexAttribArray(o)},proto.set=function(t,r,e,i){return this._constFunc(this._locations[this._index],t,r,e,i)},Object.defineProperty(proto,"location",{get:function(){return this._locations[this._index]},set:function(t){return t!==this._locations[this._index]&&(this._locations[this._index]=0|t,this._wrapper.program=null),0|t}});

},{}],43:[function(require,module,exports){
"use strict";function identity(r){var e=new Function("y","return function(){return y}");return e(r)}function makeVector(r,e){for(var n=new Array(r),t=0;r>t;++t)n[t]=e;return n}function createUniformWrapper(r,e,n,t){function a(n){var a=new Function("gl","wrapper","locations","return function(){return gl.getUniform(wrapper.program,locations["+n+"])}");return a(r,e,t)}function o(r,e,n){switch(n){case"bool":case"int":case"sampler2D":case"samplerCube":return"gl.uniform1i(locations["+e+"],obj"+r+")";case"float":return"gl.uniform1f(locations["+e+"],obj"+r+")";default:var t=n.indexOf("vec");if(!(t>=0&&1>=t&&n.length===4+t)){if(0===n.indexOf("mat")&&4===n.length){var a=n.charCodeAt(n.length-1)-48;if(2>a||a>4)throw new Error("gl-shader: Invalid uniform dimension type for matrix "+name+": "+n);return"gl.uniformMatrix"+a+"fv(locations["+e+"],false,obj"+r+")"}throw new Error("gl-shader: Unknown uniform data type for "+name+": "+n)}var a=n.charCodeAt(n.length-1)-48;if(2>a||a>4)throw new Error("gl-shader: Invalid data type");switch(n.charAt(0)){case"b":case"i":return"gl.uniform"+a+"iv(locations["+e+"],obj"+r+")";case"v":return"gl.uniform"+a+"fv(locations["+e+"],obj"+r+")";default:throw new Error("gl-shader: Unrecognized data type for vector "+name+": "+n)}}}function i(r,e){if("object"!=typeof e)return[[r,e]];var n=[];for(var t in e){var a=e[t],o=r;o+=parseInt(t)+""===t?"["+t+"]":"."+t,"object"==typeof a?n.push.apply(n,i(o,a)):n.push([o,a])}return n}function c(e){for(var a=["return function updateProperty(obj){"],c=i("",e),f=0;f<c.length;++f){var u=c[f],l=u[0],s=u[1];t[s]&&a.push(o(l,s,n[s].type))}a.push("return obj}");var h=new Function("gl","locations",a.join("\n"));return h(r,t)}function f(r){switch(r){case"bool":return!1;case"int":case"sampler2D":case"samplerCube":return 0;case"float":return 0;default:var e=r.indexOf("vec");if(e>=0&&1>=e&&r.length===4+e){var n=r.charCodeAt(r.length-1)-48;if(2>n||n>4)throw new Error("gl-shader: Invalid data type");return"b"===r.charAt(0)?makeVector(n,!1):makeVector(n,0)}if(0===r.indexOf("mat")&&4===r.length){var n=r.charCodeAt(r.length-1)-48;if(2>n||n>4)throw new Error("gl-shader: Invalid uniform dimension type for matrix "+name+": "+r);return makeVector(n*n,0)}throw new Error("gl-shader: Unknown uniform data type for "+name+": "+r)}}function u(r,e,o){if("object"==typeof o){var i=l(o);Object.defineProperty(r,e,{get:identity(i),set:c(o),enumerable:!0,configurable:!1})}else t[o]?Object.defineProperty(r,e,{get:a(o),set:c(o),enumerable:!0,configurable:!1}):r[e]=f(n[o].type)}function l(r){var e;if(Array.isArray(r)){e=new Array(r.length);for(var n=0;n<r.length;++n)u(e,n,r[n])}else{e={};for(var t in r)u(e,t,r[t])}return e}var s=coallesceUniforms(n,!0);return{get:identity(l(s)),set:c(s),enumerable:!0,configurable:!0}}var coallesceUniforms=require("./reflect");module.exports=createUniformWrapper;

},{"./reflect":44}],44:[function(require,module,exports){
"use strict";function makeReflectTypes(e,t){for(var n={},l=0;l<e.length;++l)for(var r=e[l].name,a=r.split("."),s=n,g=0;g<a.length;++g){var h=a[g].split("[");if(h.length>1){h[0]in s||(s[h[0]]=[]),s=s[h[0]];for(var i=1;i<h.length;++i){var p=parseInt(h[i]);i<h.length-1||g<a.length-1?(p in s||(i<h.length-1?s[p]=[]:s[p]={}),s=s[p]):t?s[p]=l:s[p]=e[l].type}}else g<a.length-1?(h[0]in s||(s[h[0]]={}),s=s[h[0]]):t?s[h[0]]=l:s[h[0]]=e[l].type}return n}module.exports=makeReflectTypes;

},{}],45:[function(require,module,exports){
"use strict";function getType(e,t){if(!GL_TABLE){var r=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var T=0;T<r.length;++T){var L=r[T];GL_TABLE[e[L]]=GL_TO_GLSL_TYPES[L]}}return GL_TABLE[t]}function runtimeUniforms(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),T=[],L=0;r>L;++L){var a=e.getActiveUniform(t,L);if(a){var _=getType(e,a.type);if(a.size>1)for(var i=0;i<a.size;++i)T.push({name:a.name.replace("[0]","["+i+"]"),type:_});else T.push({name:a.name,type:_})}}return T}function runtimeAttributes(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),T=[],L=0;r>L;++L){var a=e.getActiveAttrib(t,L);a&&T.push({name:a.name,type:getType(e,a.type)})}return T}exports.uniforms=runtimeUniforms,exports.attributes=runtimeAttributes;var GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"},GL_TABLE=null;

},{}],46:[function(require,module,exports){
"use strict";function ShaderReference(r,e,a,t,o,h,s){this.id=r,this.src=e,this.type=a,this.shader=t,this.count=h,this.programs=[],this.cache=s}function ContextCache(r){this.gl=r,this.shaders=[{},{}],this.programs={}}function compileShader(r,e,a){var t=r.createShader(e);if(r.shaderSource(t,a),r.compileShader(t),!r.getShaderParameter(t,r.COMPILE_STATUS)){var o=r.getShaderInfoLog(t);throw console.error("gl-shader: Error compiling shader:",o),new Error("gl-shader: Error compiling shader:"+o)}return t}function linkProgram(r,e,a,t,o){var h=r.createProgram();r.attachShader(h,e),r.attachShader(h,a);for(var s=0;s<t.length;++s)r.bindAttribLocation(h,o[s],t[s]);if(r.linkProgram(h),!r.getProgramParameter(h,r.LINK_STATUS)){var i=r.getProgramInfoLog(h);throw console.error("gl-shader: Error linking program:",i),new Error("gl-shader: Error linking program:"+i)}return h}function getCache(r){var e=CACHE.get(r);return e||(e=new ContextCache(r),CACHE.set(r,e)),e}function getShaderReference(r,e,a){return getCache(r).getShaderReference(e,a)}function createProgram(r,e,a,t,o){return getCache(r).getProgram(e,a,t,o)}exports.shader=getShaderReference,exports.program=createProgram;var weakMap="undefined"==typeof WeakMap?require("weakmap-shim"):WeakMap,CACHE=new weakMap,SHADER_COUNTER=0;ShaderReference.prototype.dispose=function(){if(0===--this.count){for(var r=this.cache,e=r.gl,a=this.programs,t=0,o=a.length;o>t;++t){var h=r.programs[a[t]];h&&(delete r.programs[t],e.deleteProgram(h))}e.deleteShader(this.shader),delete r.shaders[this.type===e.FRAGMENT_SHADER|0][this.src]}};var proto=ContextCache.prototype;proto.getShaderReference=function(r,e){var a=this.gl,t=this.shaders[r===a.FRAGMENT_SHADER|0],o=t[e];if(o&&a.isShader(o.shader))o.count+=1;else{var h=compileShader(a,r,e);o=t[e]=new ShaderReference(SHADER_COUNTER++,e,r,h,[],1,this)}return o},proto.getProgram=function(r,e,a,t){var o=[r.id,e.id,a.join(":"),t.join(":")].join("@"),h=this.programs[o];return h&&this.gl.isProgram(h)||(this.programs[o]=h=linkProgram(this.gl,r.shader,e.shader,a,t),r.programs.push(o),e.programs.push(o)),h};

},{"weakmap-shim":49}],47:[function(require,module,exports){
function createStore(){var e={};return function(r){if(("object"!=typeof r||null===r)&&"function"!=typeof r)throw new Error("Weakmap-shim: Key must be object");var t=r.valueOf(e);return t&&t.identity===e?t:hiddenStore(r,e)}}var hiddenStore=require("./hidden-store.js");module.exports=createStore;

},{"./hidden-store.js":48}],48:[function(require,module,exports){
function hiddenStore(e,t){var r={identity:t},n=e.valueOf;return Object.defineProperty(e,"valueOf",{value:function(e){return e!==t?n.apply(this,arguments):r},writable:!0}),r}module.exports=hiddenStore;

},{}],49:[function(require,module,exports){
function weakMap(){var e=createStore();return{get:function(r,t){var a=e(r);return a.hasOwnProperty("value")?a.value:t},set:function(r,t){e(r).value=t},has:function(r){return"value"in e(r)},"delete":function(r){return delete e(r).value}}}var createStore=require("./create-store.js");module.exports=weakMap;

},{"./create-store.js":47}],50:[function(require,module,exports){
"use strict";function fixup(a){if(!a)return EmptyProc;for(var r=0;r<a.args.length;++r){var s=a.args[r];0===r?a.args[r]={name:s,lvalue:!0,rvalue:!!a.rvalue,count:a.count||1}:a.args[r]={name:s,lvalue:!1,rvalue:!0,count:1}}return a.thisVars||(a.thisVars=[]),a.localVars||(a.localVars=[]),a}function pcompile(a){return compile({args:a.args,pre:fixup(a.pre),body:fixup(a.body),post:fixup(a.proc),funcName:a.funcName})}function makeOp(a){for(var r=[],s=0;s<a.args.length;++s)r.push("a"+s);var i=new Function("P",["return function ",a.funcName,"_ndarrayops(",r.join(","),") {P(",r.join(","),");return a0}"].join(""));return i(pcompile(a))}var compile=require("cwise-compiler"),EmptyProc={body:"",args:[],thisVars:[],localVars:[]},assign_ops={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var a in assign_ops){var r=assign_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:a+"eq"}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:a+"seq"})}}();var unary_ops={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var a in unary_ops){var r=unary_ops[a];exports[a]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:a}),exports[a+"eq"]=makeOp({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:a+"eq"})}}();var binary_ops={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var a in binary_ops){var r=binary_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:a+"eq"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:a+"seq"})}}();var math_unary=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var a=0;a<math_unary.length;++a){var r=math_unary[a];exports[r]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),exports[r+"eq"]=makeOp({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var math_comm=["max","min","atan2","pow"];!function(){for(var a=0;a<math_comm.length;++a){var r=math_comm[a];exports[r]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),exports[r+"s"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),exports[r+"eq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),exports[r+"seq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var math_noncomm=["atan2","pow"];!function(){for(var a=0;a<math_noncomm.length;++a){var r=math_noncomm[a];exports[r+"op"]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),exports[r+"ops"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),exports[r+"opeq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),exports[r+"opseq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),exports.any=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),exports.all=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),exports.sum=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),exports.prod=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),exports.norm2squared=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),exports.norm2=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),exports.norminf=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),exports.norm1=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),exports.sup=compile({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.inf=compile({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.argmin=compile({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.argmax=compile({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.random=makeOp({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),exports.assign=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),exports.assigns=makeOp({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),exports.equals=compile({args:["array","array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"});

},{"cwise-compiler":51}],51:[function(require,module,exports){
"use strict";function Procedure(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function compileCwise(r){var e=new Procedure;e.pre=r.pre,e.body=r.body,e.post=r.post;var s=r.args.slice(0);e.argTypes=s;for(var o=0;o<s.length;++o){var a=s[o];if("array"===a||"object"==typeof a&&a.blockIndices){if(e.argTypes[o]="array",e.arrayArgs.push(o),e.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),e.shimArgs.push("array"+o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===a)e.scalarArgs.push(o),e.shimArgs.push("scalar"+o);else if("index"===a){if(e.indexArgs.push(o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===a){if(e.shapeArgs.push(o),o<e.pre.args.length&&e.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<e.post.args.length&&e.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof a||!a.offset)throw new Error("cwise: Unknown argument type "+s[o]);e.argTypes[o]="offset",e.offsetArgs.push({array:a.array,offset:a.offset}),e.offsetArgIndex.push(o)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>s.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>s.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>s.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!r.printCode||!!r.debug,e.funcName=r.funcName||"cwise",e.blockSize=r.blockSize||64,createThunk(e)}var createThunk=require("./lib/thunk.js");module.exports=compileCwise;

},{"./lib/thunk.js":53}],52:[function(require,module,exports){
"use strict";function innerFill(r,n,e){var s,a,o=r.length,i=n.arrayArgs.length,t=n.indexArgs.length>0,p=[],h=[],u=0,c=0;for(s=0;o>s;++s)h.push(["i",s,"=0"].join(""));for(a=0;i>a;++a)for(s=0;o>s;++s)c=u,u=r[s],0===s?h.push(["d",a,"s",s,"=t",a,"p",u].join("")):h.push(["d",a,"s",s,"=(t",a,"p",u,"-s",c,"*t",a,"p",c,")"].join(""));for(p.push("var "+h.join(",")),s=o-1;s>=0;--s)u=r[s],p.push(["for(i",s,"=0;i",s,"<s",u,";++i",s,"){"].join(""));for(p.push(e),s=0;o>s;++s){for(c=u,u=r[s],a=0;i>a;++a)p.push(["p",a,"+=d",a,"s",s].join(""));t&&(s>0&&p.push(["index[",c,"]-=s",c].join("")),p.push(["++index[",u,"]"].join(""))),p.push("}")}return p.join("\n")}function outerFill(r,n,e,s){for(var a=n.length,o=e.arrayArgs.length,i=e.blockSize,t=e.indexArgs.length>0,p=[],h=0;o>h;++h)p.push(["var offset",h,"=p",h].join(""));for(var h=r;a>h;++h)p.push(["for(var j"+h+"=SS[",n[h],"]|0;j",h,">0;){"].join("")),p.push(["if(j",h,"<",i,"){"].join("")),p.push(["s",n[h],"=j",h].join("")),p.push(["j",h,"=0"].join("")),p.push(["}else{s",n[h],"=",i].join("")),p.push(["j",h,"-=",i,"}"].join("")),t&&p.push(["index[",n[h],"]=j",h].join(""));for(var h=0;o>h;++h){for(var u=["offset"+h],c=r;a>c;++c)u.push(["j",c,"*t",h,"p",n[c]].join(""));p.push(["p",h,"=(",u.join("+"),")"].join(""))}p.push(innerFill(n,e,s));for(var h=r;a>h;++h)p.push("}");return p.join("\n")}function countMatches(r){for(var n=0,e=r[0].length;e>n;){for(var s=1;s<r.length;++s)if(r[s][n]!==r[0][n])return n;++n}return n}function processBlock(r,n,e){for(var s=r.body,a=[],o=[],i=0;i<r.args.length;++i){var t=r.args[i];if(!(t.count<=0)){var p=new RegExp(t.name,"g"),h="",u=n.arrayArgs.indexOf(i);switch(n.argTypes[i]){case"offset":var c=n.offsetArgIndex.indexOf(i),l=n.offsetArgs[c];u=l.array,h="+q"+c;case"array":h="p"+u+h;var f="l"+i,g="a"+u;if(0===n.arrayBlockIndices[u])1===t.count?"generic"===e[u]?t.lvalue?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),o.push([g,".set(",h,",",f,")"].join(""))):s=s.replace(p,[g,".get(",h,")"].join("")):s=s.replace(p,[g,"[",h,"]"].join("")):"generic"===e[u]?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,".set(",h,",",f,")"].join(""))):(a.push(["var ",f,"=",g,"[",h,"]"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,"[",h,"]=",f].join("")));else{for(var j=[t.name],v=[h],y=0;y<Math.abs(n.arrayBlockIndices[u]);y++)j.push("\\s*\\[([^\\]]+)\\]"),v.push("$"+(y+1)+"*t"+u+"b"+y);if(p=new RegExp(j.join(""),"g"),h=v.join("+"),"generic"===e[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");s=s.replace(p,[g,"[",h,"]"].join(""))}break;case"scalar":s=s.replace(p,"Y"+n.scalarArgs.indexOf(i));break;case"index":s=s.replace(p,"index");break;case"shape":s=s.replace(p,"shape")}}}return[a.join("\n"),s,o.join("\n")].join("\n").trim()}function typeSummary(r){for(var n=new Array(r.length),e=!0,s=0;s<r.length;++s){var a=r[s],o=a.match(/\d+/);o=o?o[0]:"",0===a.charAt(0)?n[s]="u"+a.charAt(1)+o:n[s]=a.charAt(0)+o,s>0&&(e=e&&n[s]===n[s-1])}return e?n[0]:n.join("")}function generateCWiseOp(r,n){for(var e=n[1].length-Math.abs(r.arrayBlockIndices[0])|0,s=new Array(r.arrayArgs.length),a=new Array(r.arrayArgs.length),o=0;o<r.arrayArgs.length;++o)a[o]=n[2*o],s[o]=n[2*o+1];for(var i=[],t=[],p=[],h=[],u=[],o=0;o<r.arrayArgs.length;++o){r.arrayBlockIndices[o]<0?(p.push(0),h.push(e),i.push(e),t.push(e+r.arrayBlockIndices[o])):(p.push(r.arrayBlockIndices[o]),h.push(r.arrayBlockIndices[o]+e),i.push(0),t.push(r.arrayBlockIndices[o]));for(var c=[],l=0;l<s[o].length;l++)p[o]<=s[o][l]&&s[o][l]<h[o]&&c.push(s[o][l]-p[o]);u.push(c)}for(var f=["SS"],g=["'use strict'"],j=[],l=0;e>l;++l)j.push(["s",l,"=SS[",l,"]"].join(""));for(var o=0;o<r.arrayArgs.length;++o){f.push("a"+o),f.push("t"+o),f.push("p"+o);for(var l=0;e>l;++l)j.push(["t",o,"p",l,"=t",o,"[",p[o]+l,"]"].join(""));for(var l=0;l<Math.abs(r.arrayBlockIndices[o]);++l)j.push(["t",o,"b",l,"=t",o,"[",i[o]+l,"]"].join(""))}for(var o=0;o<r.scalarArgs.length;++o)f.push("Y"+o);if(r.shapeArgs.length>0&&j.push("shape=SS.slice(0)"),r.indexArgs.length>0){for(var v=new Array(e),o=0;e>o;++o)v[o]="0";j.push(["index=[",v.join(","),"]"].join(""))}for(var o=0;o<r.offsetArgs.length;++o){for(var y=r.offsetArgs[o],d=[],l=0;l<y.offset.length;++l)0!==y.offset[l]&&(1===y.offset[l]?d.push(["t",y.array,"p",l].join("")):d.push([y.offset[l],"*t",y.array,"p",l].join("")));0===d.length?j.push("q"+o+"=0"):j.push(["q",o,"=",d.join("+")].join(""))}var A=uniq([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));j=j.concat(A),g.push("var "+j.join(","));for(var o=0;o<r.arrayArgs.length;++o)g.push("p"+o+"|=0");r.pre.body.length>3&&g.push(processBlock(r.pre,r,a));var k=processBlock(r.body,r,a),b=countMatches(u);e>b?g.push(outerFill(b,u[0],r,k)):g.push(innerFill(u[0],r,k)),r.post.body.length>3&&g.push(processBlock(r.post,r,a)),r.debug&&console.log("-----Generated cwise routine for ",n,":\n"+g.join("\n")+"\n----------");var x=[r.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",b,typeSummary(a)].join(""),w=new Function(["function ",x,"(",f.join(","),"){",g.join("\n"),"} return ",x].join(""));return w()}var uniq=require("uniq");module.exports=generateCWiseOp;

},{"uniq":54}],53:[function(require,module,exports){
"use strict";function createThunk(r){var a=["'use strict'","var CACHED={}"],e=[],s=r.funcName+"_cwise_thunk";a.push(["return function ",s,"(",r.shimArgs.join(","),"){"].join(""));for(var n=[],o=[],h=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],i=[],p=[],t=0;t<r.arrayArgs.length;++t){var c=r.arrayArgs[t];e.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),n.push("t"+c),n.push("r"+c),o.push("t"+c),o.push("r"+c+".join()"),h.push("array"+c+".data"),h.push("array"+c+".stride"),h.push("array"+c+".offset|0"),t>0&&(i.push("array"+r.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[t]))),p.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[t])+"]"))}r.arrayArgs.length>1&&(a.push("if (!("+i.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),a.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),a.push("if (!("+p.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),a.push("}"));for(var t=0;t<r.scalarArgs.length;++t)h.push("scalar"+r.scalarArgs[t]);e.push(["type=[",o.join(","),"].join()"].join("")),e.push("proc=CACHED[type]"),a.push("var "+e.join(",")),a.push(["if(!proc){","CACHED[type]=proc=compile([",n.join(","),"])}","return proc(",h.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+a.join("\n")+"\n----------");var u=new Function("compile",a.join("\n"));return u(compile.bind(void 0,r))}var compile=require("./compile.js");module.exports=createThunk;

},{"./compile.js":52}],54:[function(require,module,exports){
"use strict";function unique_pred(n,e){for(var u=1,t=n.length,i=n[0],r=n[0],o=1;t>o;++o)if(r=i,i=n[o],e(i,r)){if(o===u){u++;continue}n[u++]=i}return n.length=u,n}function unique_eq(n){for(var e=1,u=n.length,t=n[0],i=n[0],r=1;u>r;++r,i=t)if(i=t,t=n[r],t!==i){if(r===e){e++;continue}n[e++]=t}return n.length=e,n}function unique(n,e,u){return 0===n.length?n:e?(u||n.sort(e),unique_pred(n,e)):(u||n.sort(),unique_eq(n))}module.exports=unique;

},{}],55:[function(require,module,exports){
"use strict";"use restrict";function countTrailingZeros(r){var n=32;return r&=-r,r&&n--,65535&r&&(n-=16),16711935&r&&(n-=8),252645135&r&&(n-=4),858993459&r&&(n-=2),1431655765&r&&(n-=1),n}var INT_BITS=32;exports.INT_BITS=INT_BITS,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<INT_BITS-1,exports.sign=function(r){return(r>0)-(0>r)},exports.abs=function(r){var n=r>>INT_BITS-1;return(r^n)-n},exports.min=function(r,n){return n^(r^n)&-(n>r)},exports.max=function(r,n){return r^(r^n)&-(n>r)},exports.isPow2=function(r){return!(r&r-1||!r)},exports.log2=function(r){var n,t;return n=(r>65535)<<4,r>>>=n,t=(r>255)<<3,r>>>=t,n|=t,t=(r>15)<<2,r>>>=t,n|=t,t=(r>3)<<1,r>>>=t,n|=t,n|r>>1},exports.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},exports.popCount=function(r){return r-=r>>>1&1431655765,r=(858993459&r)+(r>>>2&858993459),16843009*(r+(r>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1},exports.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r-(r>>>1)},exports.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,r&=15,27030>>>r&1};var REVERSE_TABLE=new Array(256);!function(r){for(var n=0;256>n;++n){var t=n,e=n,o=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--o;r[n]=e<<o&255}}(REVERSE_TABLE),exports.reverse=function(r){return REVERSE_TABLE[255&r]<<24|REVERSE_TABLE[r>>>8&255]<<16|REVERSE_TABLE[r>>>16&255]<<8|REVERSE_TABLE[r>>>24&255]},exports.interleave2=function(r,n){return r&=65535,r=16711935&(r|r<<8),r=252645135&(r|r<<4),r=858993459&(r|r<<2),r=1431655765&(r|r<<1),n&=65535,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),r|n<<1},exports.deinterleave2=function(r,n){return r=r>>>n&1431655765,r=858993459&(r|r>>>1),r=252645135&(r|r>>>2),r=16711935&(r|r>>>4),r=65535&(r|r>>>16),r<<16>>16},exports.interleave3=function(r,n,t){return r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),n&=1023,n=4278190335&(n|n<<16),n=251719695&(n|n<<8),n=3272356035&(n|n<<4),n=1227133513&(n|n<<2),r|=n<<1,t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),r|t<<2},exports.deinterleave3=function(r,n){return r=r>>>n&1227133513,r=3272356035&(r|r>>>2),r=251719695&(r|r>>>4),r=4278190335&(r|r>>>8),r=1023&(r|r>>>16),r<<22>>22},exports.nextCombination=function(r){var n=r|r-1;return n+1|(~n&-~n)-1>>>countTrailingZeros(r)+1};

},{}],56:[function(require,module,exports){
"use strict";function dupe_array(e,r,u){var n=0|e[u];if(0>=n)return[];var t,a=new Array(n);if(u===e.length-1)for(t=0;n>t;++t)a[t]=r;else for(t=0;n>t;++t)a[t]=dupe_array(e,r,u+1);return a}function dupe_number(e,r){var u,n;for(u=new Array(e),n=0;e>n;++n)u[n]=r;return u}function dupe(e,r){switch("undefined"==typeof r&&(r=0),typeof e){case"number":if(e>0)return dupe_number(0|e,r);break;case"object":if("number"==typeof e.length)return dupe_array(e,r,0)}return[]}module.exports=dupe;

},{}],57:[function(require,module,exports){
(function (global,Buffer){
"use strict";function freeArrayBuffer(r){if(r){var e=r.length||r.byteLength,t=bits.log2(e);DATA[t].push(r)}}function freeTypedArray(r){freeArrayBuffer(r.buffer)}function mallocArrayBuffer(r){var r=bits.nextPow2(r),e=bits.log2(r),t=DATA[e];return t.length>0?t.pop():new ArrayBuffer(r)}function mallocUint8(r){return new Uint8Array(mallocArrayBuffer(r),0,r)}function mallocUint16(r){return new Uint16Array(mallocArrayBuffer(2*r),0,r)}function mallocUint32(r){return new Uint32Array(mallocArrayBuffer(4*r),0,r)}function mallocInt8(r){return new Int8Array(mallocArrayBuffer(r),0,r)}function mallocInt16(r){return new Int16Array(mallocArrayBuffer(2*r),0,r)}function mallocInt32(r){return new Int32Array(mallocArrayBuffer(4*r),0,r)}function mallocFloat(r){return new Float32Array(mallocArrayBuffer(4*r),0,r)}function mallocDouble(r){return new Float64Array(mallocArrayBuffer(8*r),0,r)}function mallocUint8Clamped(r){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(r),0,r):mallocUint8(r)}function mallocDataView(r){return new DataView(mallocArrayBuffer(r),0,r)}function mallocBuffer(r){r=bits.nextPow2(r);var e=bits.log2(r),t=BUFFER[e];return t.length>0?t.pop():new Buffer(r)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(r){if(Buffer.isBuffer(r))BUFFER[bits.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var e=r.length||r.byteLength,t=0|bits.log2(e);DATA[t].push(r)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(r){BUFFER[bits.log2(r.length)].push(r)},exports.malloc=function(r,e){if(void 0===e||"arraybuffer"===e)return mallocArrayBuffer(r);switch(e){case"uint8":return mallocUint8(r);case"uint16":return mallocUint16(r);case"uint32":return mallocUint32(r);case"int8":return mallocInt8(r);case"int16":return mallocInt16(r);case"int32":return mallocInt32(r);case"float":case"float32":return mallocFloat(r);case"double":case"float64":return mallocDouble(r);case"uint8_clamped":return mallocUint8Clamped(r);case"buffer":return mallocBuffer(r);case"data":case"dataview":return mallocDataView(r);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var r=0;32>r;++r)POOL.UINT8[r].length=0,POOL.UINT16[r].length=0,POOL.UINT32[r].length=0,POOL.INT8[r].length=0,POOL.INT16[r].length=0,POOL.INT32[r].length=0,POOL.FLOAT[r].length=0,POOL.DOUBLE[r].length=0,POOL.UINT8C[r].length=0,DATA[r].length=0,BUFFER[r].length=0};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"bit-twiddle":55,"buffer":5,"dup":56}],58:[function(require,module,exports){
"use strict";function lazyInitLinearTypes(e){linearTypes=[e.LINEAR,e.NEAREST_MIPMAP_LINEAR,e.LINEAR_MIPMAP_NEAREST,e.LINEAR_MIPMAP_NEAREST],filterTypes=[e.NEAREST,e.LINEAR,e.NEAREST_MIPMAP_NEAREST,e.NEAREST_MIPMAP_LINEAR,e.LINEAR_MIPMAP_NEAREST,e.LINEAR_MIPMAP_LINEAR],wrapTypes=[e.REPEAT,e.CLAMP_TO_EDGE,e.MIRRORED_REPEAT]}function reshapeTexture(e,t,r){var a=e.gl,i=a.getParameter(a.MAX_TEXTURE_SIZE);if(0>t||t>i||0>r||r>i)throw new Error("gl-texture2d: Invalid texture size");return e._shape=[t,r],e.bind(),a.texImage2D(a.TEXTURE_2D,0,e.format,t,r,0,e.format,e.type,null),e._mipLevels=[0],e}function Texture2D(e,t,r,a,i,n){this.gl=e,this.handle=t,this.format=i,this.type=n,this._shape=[r,a],this._mipLevels=[0],this._magFilter=e.NEAREST,this._minFilter=e.NEAREST,this._wrapS=e.CLAMP_TO_EDGE,this._wrapT=e.CLAMP_TO_EDGE,this._anisoSamples=1;var s=this,o=[this._wrapS,this._wrapT];Object.defineProperties(o,[{get:function(){return s._wrapS},set:function(e){return s.wrapS=e}},{get:function(){return s._wrapT},set:function(e){return s.wrapT=e}}]),this._wrapVector=o;var E=[this._shape[0],this._shape[1]];Object.defineProperties(E,[{get:function(){return s._shape[0]},set:function(e){return s.width=e}},{get:function(){return s._shape[1]},set:function(e){return s.height=e}}]),this._shapeVector=E}function isPacked(e,t){return 3===e.length?1===t[2]&&t[1]===e[0]*e[2]&&t[0]===e[2]:1===t[0]&&t[1]===e[0]}function texSubImageArray(e,t,r,a,i,n,s,o){var E=o.dtype,T=o.shape.slice();if(T.length<2||T.length>3)throw new Error("gl-texture2d: Invalid ndarray, must be 2d or 3d");var u=0,l=0,h=isPacked(T,o.stride.slice());"float32"===E?u=e.FLOAT:"float64"===E?(u=e.FLOAT,h=!1,E="float32"):"uint8"===E?u=e.UNSIGNED_BYTE:(u=e.UNSIGNED_BYTE,h=!1,E="uint8");var f=1;if(2===T.length)l=e.LUMINANCE,T=[T[0],T[1],1],o=ndarray(o.data,T,[o.stride[0],o.stride[1],1],o.offset);else{if(3!==T.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===T[2])l=e.ALPHA;else if(2===T[2])l=e.LUMINANCE_ALPHA;else if(3===T[2])l=e.RGB;else{if(4!==T[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");l=e.RGBA}f=T[2]}if(l!==e.LUMINANCE&&l!==e.ALPHA||i!==e.LUMINANCE&&i!==e.ALPHA||(l=i),l!==i)throw new Error("gl-texture2d: Incompatible texture format for setPixels");var _=o.size,p=s.indexOf(a)<0;if(p&&s.push(a),u===n&&h)0===o.offset&&o.data.length===_?p?e.texImage2D(e.TEXTURE_2D,a,i,T[0],T[1],0,i,n,o.data):e.texSubImage2D(e.TEXTURE_2D,a,t,r,T[0],T[1],i,n,o.data):p?e.texImage2D(e.TEXTURE_2D,a,i,T[0],T[1],0,i,n,o.data.subarray(o.offset,o.offset+_)):e.texSubImage2D(e.TEXTURE_2D,a,t,r,T[0],T[1],i,n,o.data.subarray(o.offset,o.offset+_));else{var g;g=n===e.FLOAT?pool.mallocFloat32(_):pool.mallocUint8(_);var d=ndarray(g,T,[T[2],T[2]*T[0],1]);u===e.FLOAT&&n===e.UNSIGNED_BYTE?convertFloatToUint8(d,o):ops.assign(d,o),p?e.texImage2D(e.TEXTURE_2D,a,i,T[0],T[1],0,i,n,g.subarray(0,_)):e.texSubImage2D(e.TEXTURE_2D,a,t,r,T[0],T[1],i,n,g.subarray(0,_)),n===e.FLOAT?pool.freeFloat32(g):pool.freeUint8(g)}}function initTexture(e){var t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t}function createTextureShape(e,t,r,a,i){var n=e.getParameter(e.MAX_TEXTURE_SIZE);if(0>t||t>n||0>r||r>n)throw new Error("gl-texture2d: Invalid texture shape");if(i===e.FLOAT&&!e.getExtension("OES_texture_float"))throw new Error("gl-texture2d: Floating point textures not supported on this platform");var s=initTexture(e);return e.texImage2D(e.TEXTURE_2D,0,a,t,r,0,a,i,null),new Texture2D(e,s,t,r,a,i)}function createTextureDOM(e,t,r,a){var i=initTexture(e);return e.texImage2D(e.TEXTURE_2D,0,r,r,a,t),new Texture2D(e,i,0|t.width,0|t.height,r,a)}function createTextureArray(e,t){var r=t.dtype,a=t.shape.slice(),i=e.getParameter(e.MAX_TEXTURE_SIZE);if(a[0]<0||a[0]>i||a[1]<0||a[1]>i)throw new Error("gl-texture2d: Invalid texture size");var n=isPacked(a,t.stride.slice()),s=0;"float32"===r?s=e.FLOAT:"float64"===r?(s=e.FLOAT,n=!1,r="float32"):"uint8"===r?s=e.UNSIGNED_BYTE:(s=e.UNSIGNED_BYTE,n=!1,r="uint8");var o=0;if(2===a.length)o=e.LUMINANCE,a=[a[0],a[1],1],t=ndarray(t.data,a,[t.stride[0],t.stride[1],1],t.offset);else{if(3!==a.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===a[2])o=e.ALPHA;else if(2===a[2])o=e.LUMINANCE_ALPHA;else if(3===a[2])o=e.RGB;else{if(4!==a[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");o=e.RGBA}}s!==e.FLOAT||e.getExtension("OES_texture_float")||(s=e.UNSIGNED_BYTE,n=!1);var E,T,u=t.size;if(n)E=0===t.offset&&t.data.length===u?t.data:t.data.subarray(t.offset,t.offset+u);else{var l=[a[2],a[2]*a[0],1];T=pool.malloc(u,r);var h=ndarray(T,a,l,0);"float32"!==r&&"float64"!==r||s!==e.UNSIGNED_BYTE?ops.assign(h,t):convertFloatToUint8(h,t),E=T.subarray(0,u)}var f=initTexture(e);return e.texImage2D(e.TEXTURE_2D,0,o,a[0],a[1],0,o,s,E),n||pool.free(T),new Texture2D(e,f,a[0],a[1],o,s)}function createTexture2D(e){if(arguments.length<=1)throw new Error("gl-texture2d: Missing arguments for texture2d constructor");if(linearTypes||lazyInitLinearTypes(e),"number"==typeof arguments[1])return createTextureShape(e,arguments[1],arguments[2],arguments[3]||e.RGBA,arguments[4]||e.UNSIGNED_BYTE);if(Array.isArray(arguments[1]))return createTextureShape(e,0|arguments[1][0],0|arguments[1][1],arguments[2]||e.RGBA,arguments[3]||e.UNSIGNED_BYTE);if("object"==typeof arguments[1]){var t=arguments[1];if(t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof ImageData)return createTextureDOM(e,t,arguments[2]||e.RGBA,arguments[3]||e.UNSIGNED_BYTE);if(t.shape&&t.data&&t.stride)return createTextureArray(e,t)}throw new Error("gl-texture2d: Invalid arguments for texture2d constructor")}var ndarray=require("ndarray"),ops=require("ndarray-ops"),pool=require("typedarray-pool");module.exports=createTexture2D;var linearTypes=null,filterTypes=null,wrapTypes=null,convertFloatToUint8=function(e,t){ops.muls(e,t,255)},proto=Texture2D.prototype;Object.defineProperties(proto,{minFilter:{get:function(){return this._minFilter},set:function(e){this.bind();var t=this.gl;if(this.type===t.FLOAT&&linearTypes.indexOf(e)>=0&&(t.getExtension("OES_texture_float_linear")||(e=t.NEAREST)),filterTypes.indexOf(e)<0)throw new Error("gl-texture2d: Unknown filter mode "+e);return t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),this._minFilter=e}},magFilter:{get:function(){return this._magFilter},set:function(e){this.bind();var t=this.gl;if(this.type===t.FLOAT&&linearTypes.indexOf(e)>=0&&(t.getExtension("OES_texture_float_linear")||(e=t.NEAREST)),filterTypes.indexOf(e)<0)throw new Error("gl-texture2d: Unknown filter mode "+e);return t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),this._magFilter=e}},mipSamples:{get:function(){return this._anisoSamples},set:function(e){var t=this._anisoSamples;if(this._anisoSamples=0|Math.max(e,1),t!==this._anisoSamples){var r=gl.getExtension("EXT_texture_filter_anisotropic");r&&this.gl.texParameterf(this.gl.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY_EXT,this._anisoSamples)}return this._anisoSamples}},wrapS:{get:function(){return this._wrapS},set:function(e){if(this.bind(),wrapTypes.indexOf(e)<0)throw new Error("gl-texture2d: Unknown wrap mode "+e);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,e),this._wrapS=e}},wrapT:{get:function(){return this._wrapT},set:function(e){if(this.bind(),wrapTypes.indexOf(e)<0)throw new Error("gl-texture2d: Unknown wrap mode "+e);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,e),this._wrapT=e}},wrap:{get:function(){return this._wrapVector},set:function(e){if(Array.isArray(e)||(e=[e,e]),2!==e.length)throw new Error("gl-texture2d: Must specify wrap mode for rows and columns");for(var t=0;2>t;++t)if(wrapTypes.indexOf(e[t])<0)throw new Error("gl-texture2d: Unknown wrap mode "+e);this._wrapS=e[0],this._wrapT=e[1];var r=this.gl;return this.bind(),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,this._wrapS),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,this._wrapT),e}},shape:{get:function(){return this._shapeVector},set:function(e){if(Array.isArray(e)){if(2!==e.length)throw new Error("gl-texture2d: Invalid texture shape")}else e=[0|e,0|e];return reshapeTexture(this,0|e[0],0|e[1]),[0|e[0],0|e[1]]}},width:{get:function(){return this._shape[0]},set:function(e){return e=0|e,reshapeTexture(this,e,this._shape[1]),e}},height:{get:function(){return this._shape[1]},set:function(e){return e=0|e,reshapeTexture(this,this._shape[0],e),e}}}),proto.bind=function(e){var t=this.gl;return void 0!==e&&t.activeTexture(t.TEXTURE0+(0|e)),t.bindTexture(t.TEXTURE_2D,this.handle),void 0!==e?0|e:t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0},proto.dispose=function(){this.gl.deleteTexture(this.handle)},proto.generateMipmap=function(){this.bind(),this.gl.generateMipmap(this.gl.TEXTURE_2D);for(var e=Math.min(this._shape[0],this._shape[1]),t=0;e>0;++t,e>>>=1)this._mipLevels.indexOf(t)<0&&this._mipLevels.push(t)},proto.setPixels=function(e,t,r,a){var i=this.gl;if(this.bind(),Array.isArray(t)?(a=r,r=0|t[1],t=0|t[0]):(t=t||0,r=r||0),a=a||0,e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLVideoElement){var n=this._mipLevels.indexOf(a)<0;n?(i.texImage2D(i.TEXTURE_2D,0,this.format,this.format,this.type,e),this._mipLevels.push(a)):i.texSubImage2D(i.TEXTURE_2D,a,t,r,this.format,this.type,e)}else{if(!(e.shape&&e.stride&&e.data))throw new Error("gl-texture2d: Unsupported data type");if(e.shape.length<2||t+e.shape[1]>this._shape[1]>>>a||r+e.shape[0]>this._shape[0]>>>a||0>t||0>r)throw new Error("gl-texture2d: Texture dimensions are out of bounds");texSubImageArray(i,t,r,a,this.format,this.type,this._mipLevels,e)}};

},{"ndarray":296,"ndarray-ops":50,"typedarray-pool":57}],59:[function(require,module,exports){
"use strict";function doBind(e,r,t){r?r.bind():e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);var i=0|e.getParameter(e.MAX_VERTEX_ATTRIBS);if(t){if(t.length>i)throw new Error("gl-vao: Too many vertex attributes");for(var f=0;f<t.length;++f){var l=t[f];if(l.buffer){var n=l.buffer,b=l.size||4,a=l.type||e.FLOAT,A=!!l.normalized,o=l.stride||0,s=l.offset||0;n.bind(),e.enableVertexAttribArray(f),e.vertexAttribPointer(f,b,a,A,o,s)}else{if("number"==typeof l)e.vertexAttrib1f(f,l);else if(1===l.length)e.vertexAttrib1f(f,l[0]);else if(2===l.length)e.vertexAttrib2f(f,l[0],l[1]);else if(3===l.length)e.vertexAttrib3f(f,l[0],l[1],l[2]);else{if(4!==l.length)throw new Error("gl-vao: Invalid vertex attribute");e.vertexAttrib4f(f,l[0],l[1],l[2],l[3])}e.disableVertexAttribArray(f)}}for(;i>f;++f)e.disableVertexAttribArray(f)}else{e.bindBuffer(e.ARRAY_BUFFER,null);for(var f=0;i>f;++f)e.disableVertexAttribArray(f)}}module.exports=doBind;

},{}],60:[function(require,module,exports){
"use strict";function VAOEmulated(t){this.gl=t,this._elements=null,this._attributes=null,this._elementsType=t.UNSIGNED_SHORT}function createVAOEmulated(t){return new VAOEmulated(t)}var bindAttribs=require("./do-bind.js");VAOEmulated.prototype.bind=function(){bindAttribs(this.gl,this._elements,this._attributes)},VAOEmulated.prototype.update=function(t,e,i){this._elements=e,this._attributes=t,this._elementsType=i||this.gl.UNSIGNED_SHORT},VAOEmulated.prototype.dispose=function(){},VAOEmulated.prototype.unbind=function(){},VAOEmulated.prototype.draw=function(t,e,i){i=i||0;var s=this.gl;this._elements?s.drawElements(t,e,this._elementsType,i):s.drawArrays(t,i,e)},module.exports=createVAOEmulated;

},{"./do-bind.js":59}],61:[function(require,module,exports){
"use strict";function VertexAttribute(t,e,i,s,r,n){this.location=t,this.dimension=e,this.a=i,this.b=s,this.c=r,this.d=n}function VAONative(t,e,i){this.gl=t,this._ext=e,this.handle=i,this._attribs=[],this._useElements=!1,this._elementsType=t.UNSIGNED_SHORT}function createVAONative(t,e){return new VAONative(t,e,e.createVertexArrayOES())}var bindAttribs=require("./do-bind.js");VertexAttribute.prototype.bind=function(t){switch(this.dimension){case 1:t.vertexAttrib1f(this.location,this.a);break;case 2:t.vertexAttrib2f(this.location,this.a,this.b);break;case 3:t.vertexAttrib3f(this.location,this.a,this.b,this.c);break;case 4:t.vertexAttrib4f(this.location,this.a,this.b,this.c,this.d)}},VAONative.prototype.bind=function(){this._ext.bindVertexArrayOES(this.handle);for(var t=0;t<this._attribs.length;++t)this._attribs[t].bind(this.gl)},VAONative.prototype.unbind=function(){this._ext.bindVertexArrayOES(null)},VAONative.prototype.dispose=function(){this._ext.deleteVertexArrayOES(this.handle)},VAONative.prototype.update=function(t,e,i){if(this.bind(),bindAttribs(this.gl,e,t),this.unbind(),this._attribs.length=0,t)for(var s=0;s<t.length;++s){var r=t[s];"number"==typeof r?this._attribs.push(new VertexAttribute(s,1,r)):Array.isArray(r)&&this._attribs.push(new VertexAttribute(s,r.length,r[0],r[1],r[2],r[3]))}this._useElements=!!e,this._elementsType=i||this.gl.UNSIGNED_SHORT},VAONative.prototype.draw=function(t,e,i){i=i||0;var s=this.gl;this._useElements?s.drawElements(t,e,this._elementsType,i):s.drawArrays(t,i,e)},module.exports=createVAONative;

},{"./do-bind.js":59}],62:[function(require,module,exports){
"use strict";function createVAO(e,t,a,r){var i,u=e.getExtension("OES_vertex_array_object");return i=u?createVAONative(e,u):createVAOEmulated(e),i.update(t,a,r),i}var createVAONative=require("./lib/vao-native.js"),createVAOEmulated=require("./lib/vao-emulated.js");module.exports=createVAO;

},{"./lib/vao-emulated.js":60,"./lib/vao-native.js":61}],63:[function(require,module,exports){
function decodeFloat(I,e,r,o){return UINT8_VIEW[0]=o,UINT8_VIEW[1]=r,UINT8_VIEW[2]=e,UINT8_VIEW[3]=I,FLOAT_VIEW[0]}module.exports=decodeFloat;var UINT8_VIEW=new Uint8Array(4),FLOAT_VIEW=new Float32Array(UINT8_VIEW.buffer);

},{}],64:[function(require,module,exports){
var createShader=require("gl-shader"),vertSrc="#define GLSLIFY 1\nprecision mediump float;\nattribute vec2 position;\nvarying vec2 uv;\nvoid main() {\n  uv = position;\n  gl_Position = vec4(position, 0, 1);\n}",fragSrc="#define GLSLIFY 1\nprecision mediump float;\n\nuniform sampler2D accumBuffer;\nvarying vec2 uv;\n\nvoid main() {\n  vec4 accum = texture2D(accumBuffer, 0.5 * (uv + 1.0));\n  gl_FragColor = min(vec4(1,1,1,1), accum);\n}";module.exports=function(e){return createShader(e,vertSrc,fragSrc,null,[{name:"position",type:"vec2"}])};

},{"gl-shader":269}],65:[function(require,module,exports){
"use strict";function createCamera(e,t){e=e||document.body,t=t||{};var n=[.01,1/0];"distanceLimits"in t&&(n[0]=t.distanceLimits[0],n[1]=t.distanceLimits[1]),"zoomMin"in t&&(n[0]=t.zoomMin),"zoomMax"in t&&(n[1]=t.zoomMax);var i=createView({center:t.center||[0,0,0],up:t.up||[0,1,0],eye:t.eye||[0,0,10],mode:t.mode||"orbit",distanceLimits:n}),r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0,o=e.clientWidth,u=e.clientHeight,s={view:i,element:e,delay:t.delay||16,rotateSpeed:t.rotateSpeed||1,zoomSpeed:t.zoomSpeed||1,translateSpeed:t.translateSpeed||1,flipX:!!t.flipX,flipY:!!t.flipY,modes:i.modes,tick:function(){var t=now(),n=this.delay;i.idle(t-n),i.flush(t-(100+2*n));var s=t-2*n;i.recalcMatrix(s);for(var l=!0,c=i.computedMatrix,d=0;16>d;++d)l=l&&r[d]===c[d],r[d]=c[d];var m=e.clientWidth===o&&e.clientHeight===u;return o=e.clientWidth,u=e.clientHeight,l?!m:(a=Math.exp(i.computedRadius[0]),!0)},lookAt:function(e,t,n){i.lookAt(i.lastT(),e,t,n)},rotate:function(e,t,n){i.rotate(i.lastT(),e,t,n)},pan:function(e,t,n){i.pan(i.lastT(),e,t,n)},translate:function(e,t,n){i.translate(i.lastT(),e,t,n)}};Object.defineProperties(s,{matrix:{get:function(){return i.computedMatrix},set:function(e){return i.setMatrix(i.lastT(),e),i.computedMatrix},enumerable:!0},mode:{get:function(){return i.getMode()},set:function(e){return i.setMode(e),i.getMode()},enumerable:!0},center:{get:function(){return i.computedCenter},set:function(e){return i.lookAt(i.lastT(),e),i.computedCenter},enumerable:!0},eye:{get:function(){return i.computedEye},set:function(e){return i.lookAt(i.lastT(),null,e),i.computedEye},enumerable:!0},up:{get:function(){return i.computedUp},set:function(e){return i.lookAt(i.lastT(),null,null,e),i.computedUp},enumerable:!0},distance:{get:function(){return a},set:function(e){return i.setDistance(i.lastT(),e),e},enumerable:!0},distanceLimits:{get:function(){return i.getDistanceLimits(n)},set:function(e){return i.setDistanceLimits(e),e},enumerable:!0}}),e.addEventListener("contextmenu",function(e){return e.preventDefault(),!1});var l=0,c=0;return mouseChange(e,function(t,n,r,o){var u=1/e.clientHeight,d=u*(n-l),m=u*(r-c),p=s.flipX?1:-1,f=s.flipY?1:-1,h=Math.PI*s.rotateSpeed,g=now();if(1&t)o.shift?i.rotate(g,0,0,-d*h):i.rotate(g,p*h*d,-f*h*m,0);else if(2&t)i.pan(g,-s.translateSpeed*d*a,s.translateSpeed*m*a,0);else if(4&t){var M=s.zoomSpeed*m/window.innerHeight*(g-i.lastT())*50;i.pan(g,0,0,a*(Math.exp(M)-1))}l=n,c=r}),mouseWheel(e,function(e,t,n){var r=s.flipX?1:-1,o=s.flipY?1:-1,u=now();if(Math.abs(e)>Math.abs(t))i.rotate(u,0,0,-e*r*Math.PI*s.rotateSpeed/window.innerWidth);else{var l=s.zoomSpeed*o*t/window.innerHeight*(u-i.lastT())/100;i.pan(u,0,0,a*(Math.exp(l)-1))}},!0),s}module.exports=createCamera;var now=require("right-now"),createView=require("3d-view"),mouseChange=require("mouse-change"),mouseWheel=require("mouse-wheel");

},{"3d-view":91,"mouse-change":293,"mouse-wheel":94,"right-now":95}],66:[function(require,module,exports){
"use strict";function MatrixCameraController(t){this._components=t.slice(),this._time=[0],this.prevMatrix=t.slice(),this.nextMatrix=t.slice(),this.computedMatrix=t.slice(),this.computedInverse=t.slice(),this.computedEye=[0,0,0],this.computedUp=[0,0,0],this.computedCenter=[0,0,0],this.computedRadius=[0],this._limits=[-(1/0),1/0]}function createMatrixCameraController(t){t=t||{};var e=t.matrix||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return new MatrixCameraController(e)}var bsearch=require("binary-search-bounds"),m4interp=require("mat4-interpolate"),invert44=require("gl-mat4/invert"),rotateX=require("gl-mat4/rotateX"),rotateY=require("gl-mat4/rotateY"),rotateZ=require("gl-mat4/rotateZ"),lookAt=require("gl-mat4/lookAt"),translate=require("gl-mat4/translate"),scale=require("gl-mat4/scale"),normalize=require("gl-vec3/normalize"),DEFAULT_CENTER=[0,0,0];module.exports=createMatrixCameraController;var proto=MatrixCameraController.prototype;proto.recalcMatrix=function(t){var e=this._time,r=bsearch.le(e,t),i=this.computedMatrix;if(!(0>r)){var a=this._components;if(r===e.length-1)for(var o=16*r,s=0;16>s;++s)i[s]=a[o++];else{for(var n=e[r+1]-e[r],o=16*r,c=this.prevMatrix,h=!0,s=0;16>s;++s)c[s]=a[o++];for(var l=this.nextMatrix,s=0;16>s;++s)l[s]=a[o++],h=h&&c[s]===l[s];if(1e-6>n||h)for(var s=0;16>s;++s)i[s]=c[s];else m4interp(i,c,l,(t-e[r])/n)}var u=this.computedUp;u[0]=i[1],u[1]=i[5],u[2]=i[6],normalize(u,u);var m=this.computedInverse;invert44(m,i);var p=this.computedEye,v=m[15];p[0]=m[12]/v,p[1]=m[13]/v,p[2]=m[14]/v;for(var x=this.computedCenter,d=Math.exp(this.computedRadius[0]),s=0;3>s;++s)x[s]=p[s]-i[2+4*s]*d}},proto.idle=function(t){if(!(t<this.lastT())){for(var e=this._components,r=e.length-16,i=0;16>i;++i)e.push(e[r++]);this._time.push(t)}},proto.flush=function(t){var e=bsearch.gt(this._time,t)-2;0>e||(this._time.slice(0,e),this._components.slice(0,16*e))},proto.lastT=function(){return this._time[this._time.length-1]},proto.lookAt=function(t,e,r,i){this.recalcMatrix(t),e=e||this.computedEye,r=r||DEFAULT_CENTER,i=i||this.computedUp,this.setMatrix(t,lookAt(this.computedMatrix,e,r,i));for(var a=0,o=0;3>o;++o)a+=Math.pow(r[o]-e[o],2);a=Math.log(Math.sqrt(a)),this.computedRadius[0]=a},proto.rotate=function(t,e,r,i){this.recalcMatrix(t);var a=this.computedInverse;e&&rotateY(a,a,e),r&&rotateX(a,a,r),i&&rotateZ(a,a,i),this.setMatrix(t,invert44(this.computedMatrix,a))};var tvec=[0,0,0];proto.pan=function(t,e,r,i){tvec[0]=-(e||0),tvec[1]=-(r||0),tvec[2]=-(i||0),this.recalcMatrix(t);var a=this.computedInverse;translate(a,a,tvec),this.setMatrix(t,invert44(a,a))},proto.translate=function(t,e,r,i){tvec[0]=e||0,tvec[1]=r||0,tvec[2]=i||0,this.recalcMatrix(t);var a=this.computedMatrix;translate(a,a,tvec),this.setMatrix(t,a)},proto.setMatrix=function(t,e){if(!(t<this.lastT())){this._time.push(t);for(var r=0;16>r;++r)this._components.push(e[r])}},proto.setDistance=function(t,e){this.computedRadius[0]=e},proto.setDistanceLimits=function(t,e){var r=this._limits;r[0]=t,r[1]=e},proto.getDistanceLimits=function(t){var e=this._limits;return t?(t[0]=e[0],t[1]=e[1],t):e};

},{"binary-search-bounds":67,"gl-mat4/invert":249,"gl-mat4/lookAt":250,"gl-mat4/rotateX":254,"gl-mat4/rotateY":255,"gl-mat4/rotateZ":256,"gl-mat4/scale":257,"gl-mat4/translate":258,"gl-vec3/normalize":72,"mat4-interpolate":73}],67:[function(require,module,exports){
"use strict";function compileSearch(e,n,c,i,r,u){var h=["function ",e,"(a,l,h,",i.join(","),"){",u?"":"var i=",c?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",r?".get(m)":"[m]"];return u?n.indexOf("c")<0?h.push(";if(x===y){return m}else if(x<=y){"):h.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):h.push(";if(",n,"){i=m;"),c?h.push("l=m+1}else{h=m-1}"):h.push("h=m-1}else{l=m+1}"),h.push("}"),u?h.push("return -1};"):h.push("return i};"),h.join("")}function compileBoundsSearch(e,n,c,i){var r=new Function([compileSearch("A","x"+e+"y",n,["y"],!1,i),compileSearch("B","x"+e+"y",n,["y"],!0,i),compileSearch("P","c(x,y)"+e+"0",n,["y","c"],!1,i),compileSearch("Q","c(x,y)"+e+"0",n,["y","c"],!0,i),"function dispatchBsearch",c,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",c].join(""));return r()}module.exports={ge:compileBoundsSearch(">=",!1,"GE"),gt:compileBoundsSearch(">",!1,"GT"),lt:compileBoundsSearch("<",!0,"LT"),le:compileBoundsSearch("<=",!0,"LE"),eq:compileBoundsSearch("-",!0,"EQ",!0)};

},{}],68:[function(require,module,exports){
function cross(r,o,s){var c=o[0],e=o[1],n=o[2],t=s[0],u=s[1],a=s[2];return r[0]=e*a-n*u,r[1]=n*t-c*a,r[2]=c*u-e*t,r}module.exports=cross;

},{}],69:[function(require,module,exports){
function dot(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]}module.exports=dot;

},{}],70:[function(require,module,exports){
function length(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}module.exports=length;

},{}],71:[function(require,module,exports){
function lerp(r,e,l,n){var o=e[0],p=e[1],t=e[2];return r[0]=o+n*(l[0]-o),r[1]=p+n*(l[1]-p),r[2]=t+n*(l[2]-t),r}module.exports=lerp;

},{}],72:[function(require,module,exports){
function normalize(r,e){var n=e[0],o=e[1],t=e[2],a=n*n+o*o+t*t;return a>0&&(a=1/Math.sqrt(a),r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a),r}module.exports=normalize;

},{}],73:[function(require,module,exports){
function interpolate(e,t,a,s){if(0===determinant(t)||0===determinant(a))return!1;var r=decompose(t,state0.translate,state0.scale,state0.skew,state0.perspective,state0.quaternion),n=decompose(a,state1.translate,state1.scale,state1.skew,state1.perspective,state1.quaternion);return r&&n?(lerp(tmp.translate,state0.translate,state1.translate,s),lerp(tmp.skew,state0.skew,state1.skew,s),lerp(tmp.scale,state0.scale,state1.scale,s),lerp(tmp.perspective,state0.perspective,state1.perspective,s),slerp(tmp.quaternion,state0.quaternion,state1.quaternion,s),recompose(e,tmp.translate,tmp.scale,tmp.skew,tmp.perspective,tmp.quaternion),!0):!1}function state(){return{translate:vec3(),scale:vec3(1),skew:vec3(),perspective:vec4(),quaternion:vec4()}}function vec3(e){return[e||0,e||0,e||0]}function vec4(){return[0,0,0,1]}var lerp=require("gl-vec3/lerp"),recompose=require("mat4-recompose"),decompose=require("mat4-decompose"),determinant=require("gl-mat4/determinant"),slerp=require("quat-slerp"),state0=state(),state1=state(),tmp=state();module.exports=interpolate;

},{"gl-mat4/determinant":245,"gl-vec3/lerp":71,"mat4-decompose":74,"mat4-recompose":76,"quat-slerp":77}],74:[function(require,module,exports){
function vec4multMat4(r,e,t){var o=e[0],i=e[1],a=e[2],c=e[3];return r[0]=t[0]*o+t[4]*i+t[8]*a+t[12]*c,r[1]=t[1]*o+t[5]*i+t[9]*a+t[13]*c,r[2]=t[2]*o+t[6]*i+t[10]*a+t[14]*c,r[3]=t[3]*o+t[7]*i+t[11]*a+t[15]*c,r}function mat3from4(r,e){r[0][0]=e[0],r[0][1]=e[1],r[0][2]=e[2],r[1][0]=e[4],r[1][1]=e[5],r[1][2]=e[6],r[2][0]=e[8],r[2][1]=e[9],r[2][2]=e[10]}function combine(r,e,t,o,i){r[0]=e[0]*o+t[0]*i,r[1]=e[1]*o+t[1]*i,r[2]=e[2]*o+t[2]*i}var normalize=require("./normalize"),create=require("gl-mat4/create"),clone=require("gl-mat4/clone"),determinant=require("gl-mat4/determinant"),invert=require("gl-mat4/invert"),transpose=require("gl-mat4/transpose"),vec3={length:require("gl-vec3/length"),normalize:require("gl-vec3/normalize"),dot:require("gl-vec3/dot"),cross:require("gl-vec3/cross")},tmp=create(),perspectiveMatrix=create(),tmpVec4=[0,0,0,0],row=[[0,0,0],[0,0,0],[0,0,0]],pdum3=[0,0,0];module.exports=function(r,e,t,o,i,a){if(e||(e=[0,0,0]),t||(t=[0,0,0]),o||(o=[0,0,0]),i||(i=[0,0,0,1]),a||(a=[0,0,0,1]),!normalize(tmp,r))return!1;if(clone(perspectiveMatrix,tmp),perspectiveMatrix[3]=0,perspectiveMatrix[7]=0,perspectiveMatrix[11]=0,perspectiveMatrix[15]=1,Math.abs(determinant(perspectiveMatrix)<1e-8))return!1;var c=tmp[3],m=tmp[7],w=tmp[11],p=tmp[12],n=tmp[13],v=tmp[14],s=tmp[15];if(0!==c||0!==m||0!==w){tmpVec4[0]=c,tmpVec4[1]=m,tmpVec4[2]=w,tmpVec4[3]=s;var l=invert(perspectiveMatrix,perspectiveMatrix);if(!l)return!1;transpose(perspectiveMatrix,perspectiveMatrix),vec4multMat4(i,tmpVec4,perspectiveMatrix)}else i[0]=i[1]=i[2]=0,i[3]=1;if(e[0]=p,e[1]=n,e[2]=v,mat3from4(row,tmp),t[0]=vec3.length(row[0]),vec3.normalize(row[0],row[0]),o[0]=vec3.dot(row[0],row[1]),combine(row[1],row[1],row[0],1,-o[0]),t[1]=vec3.length(row[1]),vec3.normalize(row[1],row[1]),o[0]/=t[1],o[1]=vec3.dot(row[0],row[2]),combine(row[2],row[2],row[0],1,-o[1]),o[2]=vec3.dot(row[1],row[2]),combine(row[2],row[2],row[1],1,-o[2]),t[2]=vec3.length(row[2]),vec3.normalize(row[2],row[2]),o[1]/=t[2],o[2]/=t[2],vec3.cross(pdum3,row[1],row[2]),vec3.dot(row[0],pdum3)<0)for(var u=0;3>u;u++)t[u]*=-1,row[u][0]*=-1,row[u][1]*=-1,row[u][2]*=-1;return a[0]=.5*Math.sqrt(Math.max(1+row[0][0]-row[1][1]-row[2][2],0)),a[1]=.5*Math.sqrt(Math.max(1-row[0][0]+row[1][1]-row[2][2],0)),a[2]=.5*Math.sqrt(Math.max(1-row[0][0]-row[1][1]+row[2][2],0)),a[3]=.5*Math.sqrt(Math.max(1+row[0][0]+row[1][1]+row[2][2],0)),row[2][1]>row[1][2]&&(a[0]=-a[0]),row[0][2]>row[2][0]&&(a[1]=-a[1]),row[1][0]>row[0][1]&&(a[2]=-a[2]),!0};

},{"./normalize":75,"gl-mat4/clone":243,"gl-mat4/create":244,"gl-mat4/determinant":245,"gl-mat4/invert":249,"gl-mat4/transpose":259,"gl-vec3/cross":68,"gl-vec3/dot":69,"gl-vec3/length":70,"gl-vec3/normalize":72}],75:[function(require,module,exports){
module.exports=function(r,e){var n=e[15];if(0===n)return!1;for(var o=1/n,t=0;16>t;t++)r[t]=e[t]*o;return!0};

},{}],76:[function(require,module,exports){
var mat4={identity:require("gl-mat4/identity"),translate:require("gl-mat4/translate"),multiply:require("gl-mat4/multiply"),create:require("gl-mat4/create"),scale:require("gl-mat4/scale"),fromRotationTranslation:require("gl-mat4/fromRotationTranslation")},rotationMatrix=mat4.create(),temp=mat4.create();module.exports=function(t,e,a,m,r,i){return mat4.identity(t),mat4.fromRotationTranslation(t,i,e),t[3]=r[0],t[7]=r[1],t[11]=r[2],t[15]=r[3],mat4.identity(temp),0!==m[2]&&(temp[9]=m[2],mat4.multiply(t,t,temp)),0!==m[1]&&(temp[9]=0,temp[8]=m[1],mat4.multiply(t,t,temp)),0!==m[0]&&(temp[8]=0,temp[4]=m[0],mat4.multiply(t,t,temp)),mat4.scale(t,t,a),t};

},{"gl-mat4/create":244,"gl-mat4/fromRotationTranslation":247,"gl-mat4/identity":248,"gl-mat4/multiply":251,"gl-mat4/scale":257,"gl-mat4/translate":258}],77:[function(require,module,exports){
module.exports=require("gl-quat/slerp");

},{"gl-quat/slerp":78}],78:[function(require,module,exports){
function slerp(s,t,a,e){var n,r,h,i,o,M=t[0],l=t[1],p=t[2],u=t[3],c=a[0],d=a[1],f=a[2],m=a[3];return r=M*c+l*d+p*f+u*m,0>r&&(r=-r,c=-c,d=-d,f=-f,m=-m),1-r>1e-6?(n=Math.acos(r),h=Math.sin(n),i=Math.sin((1-e)*n)/h,o=Math.sin(e*n)/h):(i=1-e,o=e),s[0]=i*M+o*c,s[1]=i*l+o*d,s[2]=i*p+o*f,s[3]=i*u+o*m,s}module.exports=slerp;

},{}],79:[function(require,module,exports){
"use strict";function quatFromFrame(r,t,a,e,m,s,u,o,q,F){var h=t+s+F;if(i>0){var i=Math.sqrt(h+1);r[0]=.5*(u-q)/i,r[1]=.5*(o-e)/i,r[2]=.5*(a-s)/i,r[3]=.5*i}else{var n=Math.max(t,s,F),i=Math.sqrt(2*n-h+1);t>=n?(r[0]=.5*i,r[1]=.5*(m+a)/i,r[2]=.5*(o+e)/i,r[3]=.5*(u-q)/i):s>=n?(r[0]=.5*(a+m)/i,r[1]=.5*i,r[2]=.5*(q+u)/i,r[3]=.5*(o-e)/i):(r[0]=.5*(e+o)/i,r[1]=.5*(u+q)/i,r[2]=.5*i,r[3]=.5*(a-m)/i)}return r}module.exports=quatFromFrame;

},{}],80:[function(require,module,exports){
"use strict";function clamp(t,e,i){return Math.min(e,Math.max(t,i))}function FilteredVector(t,e,i){this.dimension=t.length,this.bounds=[new Array(this.dimension),new Array(this.dimension)];for(var s=0;s<this.dimension;++s)this.bounds[0][s]=-(1/0),this.bounds[1][s]=1/0;this._state=t.slice().reverse(),this._velocity=e.slice().reverse(),this._time=[i],this._scratch=[t.slice(),t.slice(),t.slice(),t.slice(),t.slice()]}function getZero(t){for(var e=new Array(t),i=0;t>i;++i)e[i]=0;return e}function createFilteredVector(t,e,i){switch(arguments.length){case 0:return new FilteredVector([0],[0],0);case 1:if("number"==typeof t){var s=getZero(t);return new FilteredVector(s,s,0)}return new FilteredVector(t,getZero(t.length),0);case 2:if("number"==typeof e){var s=getZero(t.length);return new FilteredVector(t,s,+e)}i=0;case 3:if(t.length!==e.length)throw new Error("state and velocity lengths must match");return new FilteredVector(t,e,i)}}module.exports=createFilteredVector;var cubicHermite=require("cubic-hermite"),bsearch=require("binary-search-bounds"),proto=FilteredVector.prototype;proto.flush=function(t){var e=bsearch.gt(this._time,t)-1;0>=e||(this._time.splice(0,e),this._state.splice(0,e*this.dimension),this._velocity.splice(0,e*this.dimension))},proto.curve=function(t){var e=this._time,i=e.length,s=bsearch.le(e,t),r=this._scratch[0],h=this._state,n=this._velocity,o=this.dimension,a=this.bounds;if(0>s)for(var c=o-1,u=0;o>u;++u,--c)r[u]=h[c];else if(s>=i-1)for(var c=h.length-1,l=t-e[i-1],u=0;o>u;++u,--c)r[u]=h[c]+l*n[c];else{for(var c=o*(s+1)-1,m=e[s],v=e[s+1],f=v-m||1,p=this._scratch[1],_=this._scratch[2],d=this._scratch[3],g=this._scratch[4],b=!0,u=0;o>u;++u,--c)p[u]=h[c],d[u]=n[c]*f,_[u]=h[c+o],g[u]=n[c+o]*f,b=b&&p[u]===_[u]&&d[u]===g[u]&&0===d[u];if(b)for(var u=0;o>u;++u)r[u]=p[u];else cubicHermite(p,d,_,g,(t-m)/f,r)}for(var y=a[0],w=a[1],u=0;o>u;++u)r[u]=clamp(y[u],w[u],r[u]);return r},proto.dcurve=function(t){var e=this._time,i=e.length,s=bsearch.le(e,t),r=this._scratch[0],h=this._state,n=this._velocity,o=this.dimension;if(s>=i-1)for(var a=h.length-1,c=(t-e[i-1],0);o>c;++c,--a)r[c]=n[a];else{for(var a=o*(s+1)-1,u=e[s],l=e[s+1],m=l-u||1,v=this._scratch[1],f=this._scratch[2],p=this._scratch[3],_=this._scratch[4],d=!0,c=0;o>c;++c,--a)v[c]=h[a],p[c]=n[a]*m,f[c]=h[a+o],_[c]=n[a+o]*m,d=d&&v[c]===f[c]&&p[c]===_[c]&&0===p[c];if(d)for(var c=0;o>c;++c)r[c]=0;else{cubicHermite.derivative(v,p,f,_,(t-u)/m,r);for(var c=0;o>c;++c)r[c]/=m}}return r},proto.lastT=function(){var t=this._time;return t[t.length-1]},proto.stable=function(){for(var t=this._velocity,e=t.length,i=this.dimension-1;i>=0;--i)if(t[--e])return!1;return!0},proto.jump=function(t){var e=this.lastT(),i=this.dimension;if(!(e>t||arguments.length!==i+1)){var s=this._state,r=this._velocity,h=s.length-this.dimension,n=this.bounds,o=n[0],a=n[1];this._time.push(e,t);for(var c=0;2>c;++c)for(var u=0;i>u;++u)s.push(s[h++]),r.push(0);this._time.push(t);for(var u=i;u>0;--u)s.push(clamp(o[u-1],a[u-1],arguments[u])),r.push(0)}},proto.push=function(t){var e=this.lastT(),i=this.dimension;if(!(e>t||arguments.length!==i+1)){var s=this._state,r=this._velocity,h=s.length-this.dimension,n=t-e,o=this.bounds,a=o[0],c=o[1],u=n>1e-6?1/n:0;this._time.push(t);for(var l=i;l>0;--l){var m=clamp(a[l-1],c[l-1],arguments[l]);s.push(m),r.push((m-s[h++])*u)}}},proto.set=function(t){var e=this.dimension;if(!(t<this.lastT()||arguments.length!==e+1)){var i=this._state,s=this._velocity,r=this.bounds,h=r[0],n=r[1];this._time.push(t);for(var o=e;o>0;--o)i.push(clamp(h[o-1],n[o-1],arguments[o])),s.push(0)}},proto.move=function(t){var e=this.lastT(),i=this.dimension;if(!(e>=t||arguments.length!==i+1)){var s=this._state,r=this._velocity,h=s.length-this.dimension,n=this.bounds,o=n[0],a=n[1],c=t-e,u=c>1e-6?1/c:0;this._time.push(t);for(var l=i;l>0;--l){var m=arguments[l];s.push(clamp(o[l-1],a[l-1],s[h++]+m)),r.push(m*u)}}},proto.idle=function(t){var e=this.lastT();if(!(e>t)){var i=this.dimension,s=this._state,r=this._velocity,h=s.length-i,n=this.bounds,o=n[0],a=n[1],c=t-e;this._time.push(t);for(var u=i-1;u>=0;--u)s.push(clamp(o[u],a[u],s[h]+c*r[h])),r.push(0),h+=1}};

},{"binary-search-bounds":81,"cubic-hermite":82}],81:[function(require,module,exports){
"use strict";function compileSearch(e,n,c,i,r,u){var h=["function ",e,"(a,l,h,",i.join(","),"){",u?"":"var i=",c?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",r?".get(m)":"[m]"];return u?n.indexOf("c")<0?h.push(";if(x===y){return m}else if(x<=y){"):h.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):h.push(";if(",n,"){i=m;"),c?h.push("l=m+1}else{h=m-1}"):h.push("h=m-1}else{l=m+1}"),h.push("}"),u?h.push("return -1};"):h.push("return i};"),h.join("")}function compileBoundsSearch(e,n,c,i){var r=new Function([compileSearch("A","x"+e+"y",n,["y"],!1,i),compileSearch("B","x"+e+"y",n,["y"],!0,i),compileSearch("P","c(x,y)"+e+"0",n,["y","c"],!1,i),compileSearch("Q","c(x,y)"+e+"0",n,["y","c"],!0,i),"function dispatchBsearch",c,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",c].join(""));return r()}module.exports={ge:compileBoundsSearch(">=",!1,"GE"),gt:compileBoundsSearch(">",!1,"GT"),lt:compileBoundsSearch("<",!0,"LT"),le:compileBoundsSearch("<=",!0,"LE"),eq:compileBoundsSearch("-",!0,"EQ",!0)};

},{}],82:[function(require,module,exports){
"use strict";function dcubicHermite(e,r,t,n,i,u){var c=6*i*i-6*i,l=3*i*i-4*i+1,o=-6*i*i+6*i,a=3*i*i-2*i;if(e.length){u||(u=new Array(e.length));for(var f=e.length-1;f>=0;--f)u[f]=c*e[f]+l*r[f]+o*t[f]+a*n[f];return u}return c*e+l*r+o*t[f]+a*n}function cubicHermite(e,r,t,n,i,u){var c=i-1,l=i*i,o=c*c,a=(1+2*i)*o,f=i*o,g=l*(3-2*i),h=l*c;if(e.length){u||(u=new Array(e.length));for(var m=e.length-1;m>=0;--m)u[m]=a*e[m]+f*r[m]+g*t[m]+h*n[m];return u}return a*e+f*r+g*t+h*n}module.exports=cubicHermite,module.exports.derivative=dcubicHermite;

},{}],83:[function(require,module,exports){
"use strict";function len3(t,r,i){return Math.sqrt(Math.pow(t,2)+Math.pow(r,2)+Math.pow(i,2))}function len4(t,r,i,e){return Math.sqrt(Math.pow(t,2)+Math.pow(r,2)+Math.pow(i,2)+Math.pow(e,2))}function normalize4(t,r){var i=r[0],e=r[1],o=r[2],a=r[3],s=len4(i,e,o,a);s>1e-6?(t[0]=i/s,t[1]=e/s,t[2]=o/s,t[3]=a/s):(t[0]=t[1]=t[2]=0,t[3]=1)}function OrbitCameraController(t,r,i){this.radius=filterVector([i]),this.center=filterVector(r),this.rotation=filterVector(t),this.computedRadius=this.radius.curve(0),this.computedCenter=this.center.curve(0),this.computedRotation=this.rotation.curve(0),this.computedUp=[.1,0,0],this.computedEye=[.1,0,0],this.computedMatrix=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.recalcMatrix(0)}function createOrbitController(t){t=t||{};var r=t.center||[0,0,0],i=t.rotation||[0,0,0,1],e=t.radius||1;r=[].slice.call(r,0,3),i=[].slice.call(i,0,4),normalize4(i,i);var o=new OrbitCameraController(i,r,Math.log(e));return o.setDistanceLimits(t.zoomMin,t.zoomMax),("eye"in t||"up"in t)&&o.lookAt(0,t.eye,t.center,t.up),o}module.exports=createOrbitController;var filterVector=require("filtered-vector"),lookAt=require("gl-mat4/lookAt"),mat4FromQuat=require("gl-mat4/fromQuat"),invert44=require("gl-mat4/invert"),quatFromFrame=require("./lib/quatFromFrame"),proto=OrbitCameraController.prototype;proto.lastT=function(){return Math.max(this.radius.lastT(),this.center.lastT(),this.rotation.lastT())},proto.recalcMatrix=function(t){this.radius.curve(t),this.center.curve(t),this.rotation.curve(t);var r=this.computedRotation;normalize4(r,r);var i=this.computedMatrix;mat4FromQuat(i,r);var e=this.computedCenter,o=this.computedEye,a=this.computedUp,s=Math.exp(this.computedRadius[0]);o[0]=e[0]+s*i[2],o[1]=e[1]+s*i[6],o[2]=e[2]+s*i[10],a[0]=i[1],a[1]=i[5],a[2]=i[9];for(var n=0;3>n;++n){for(var h=0,u=0;3>u;++u)h+=i[n+4*u]*o[u];i[12+n]=-h}},proto.getMatrix=function(t,r){this.recalcMatrix(t);var i=this.computedMatrix;if(r){for(var e=0;16>e;++e)r[e]=i[e];return r}return i},proto.idle=function(t){this.center.idle(t),this.radius.idle(t),this.rotation.idle(t)},proto.flush=function(t){this.center.flush(t),this.radius.flush(t),this.rotation.flush(t)},proto.pan=function(t,r,i,e){r=r||0,i=i||0,e=e||0,this.recalcMatrix(t);var o=this.computedMatrix,a=o[1],s=o[5],n=o[9],h=len3(a,s,n);a/=h,s/=h,n/=h;var u=o[0],c=o[4],l=o[8],m=u*a+c*s+l*n;u-=a*m,c-=s*m,l-=n*m;var p=len3(u,c,l);u/=p,c/=p,l/=p;var d=o[2],M=o[6],v=o[10],f=d*a+M*s+v*n,x=d*u+M*c+v*l;d-=f*a+x*u,M-=f*s+x*c,v-=f*n+x*l;var g=len3(d,M,v);d/=g,M/=g,v/=g;var b=u*r+a*i,q=c*r+s*i,w=l*r+n*i;this.center.move(t,b,q,w);var C=Math.exp(this.computedRadius[0]);C=Math.max(1e-4,C+e),this.radius.set(t,Math.log(C))},proto.rotate=function(t,r,i,e){this.recalcMatrix(t),r=r||0,i=i||0;var o=this.computedMatrix,a=o[0],s=o[4],n=o[8],h=o[1],u=o[5],c=o[9],l=o[2],m=o[6],p=o[10],d=r*a+i*h,M=r*s+i*u,v=r*n+i*c,f=-(m*v-p*M),x=-(p*d-l*v),g=-(l*M-m*d),b=Math.sqrt(Math.max(0,1-Math.pow(f,2)-Math.pow(x,2)-Math.pow(g,2))),q=len4(f,x,g,b);q>1e-6?(f/=q,x/=q,g/=q,b/=q):(f=x=g=0,b=1);var w=this.computedRotation,C=w[0],z=w[1],R=w[2],F=w[3],O=C*b+F*f+z*g-R*x,y=z*b+F*x+R*f-C*g,T=R*b+F*g+C*x-z*f,k=F*b-C*f-z*x-R*g;if(e){f=l,x=m,g=p;var A=Math.sin(e)/len3(f,x,g);f*=A,x*=A,g*=A,b=Math.cos(r),O=O*b+k*f+y*g-T*x,y=y*b+k*x+T*f-O*g,T=T*b+k*g+O*x-y*f,k=k*b-O*f-y*x-T*g}var D=len4(O,y,T,k);D>1e-6?(O/=D,y/=D,T/=D,k/=D):(O=y=T=0,k=1),this.rotation.set(t,O,y,T,k)},proto.lookAt=function(t,r,i,e){this.recalcMatrix(t),i=i||this.computedCenter,r=r||this.computedEye,e=e||this.computedUp;var o=this.computedMatrix;lookAt(o,r,i,e);var a=this.computedRotation;quatFromFrame(a,o[0],o[1],o[2],o[4],o[5],o[6],o[8],o[9],o[10]),normalize4(a,a),this.rotation.set(t,a[0],a[1],a[2],a[3]);for(var s=0,n=0;3>n;++n)s+=Math.pow(i[n]-r[n],2);this.radius.set(t,.5*Math.log(Math.max(s,1e-6))),this.center.set(t,i[0],i[1],i[2])},proto.translate=function(t,r,i,e){this.center.move(t,r||0,i||0,e||0)},proto.setMatrix=function(t,r){var i=this.computedRotation;quatFromFrame(i,r[0],r[1],r[2],r[4],r[5],r[6],r[8],r[9],r[10]),normalize4(i,i),this.rotation.set(t,i[0],i[1],i[2],i[3]);var e=this.computedMatrix;invert44(e,r);var o=e[15];if(Math.abs(o)>1e-6){var a=e[12]/o,s=e[13]/o,n=e[14]/o;this.recalcMatrix(t);var h=Math.exp(this.computedRadius[0]);this.center.set(t,a-e[2]*h,s-e[6]*h,n-e[10]*h),this.radius.idle(t)}else this.center.idle(t),this.radius.idle(t)},proto.setDistance=function(t,r){r>0&&this.radius.set(t,Math.log(r))},proto.setDistanceLimits=function(t,r){t=t>0?Math.log(t):-(1/0),r=r>0?Math.log(r):1/0,r=Math.max(r,t),this.radius.bounds[0][0]=t,this.radius.bounds[1][0]=r},proto.getDistanceLimits=function(t){var r=this.radius.bounds;return t?(t[0]=Math.exp(r[0][0]),t[1]=Math.exp(r[1][0]),t):[Math.exp(r[0][0]),Math.exp(r[1][0])]},proto.toJSON=function(){return this.recalcMatrix(this.lastT()),{center:this.computedCenter.slice(),rotation:this.computedRotation.slice(),distance:Math.log(this.computedRadius[0]),zoomMin:this.radius.bounds[0][0],zoomMax:this.radius.bounds[1][0]}},proto.fromJSON=function(t){var r=this.lastT(),i=t.center;i&&this.center.set(r,i[0],i[1],i[2]);var e=t.rotation;e&&this.rotation.set(r,e[0],e[1],e[2],e[3]);var o=t.distance;o&&o>0&&this.radius.set(r,Math.log(o)),this.setDistanceLimits(t.zoomMin,t.zoomMax)};

},{"./lib/quatFromFrame":79,"filtered-vector":80,"gl-mat4/fromQuat":246,"gl-mat4/invert":249,"gl-mat4/lookAt":250}],84:[function(require,module,exports){
"use strict";function clamp(t,e,i){return Math.min(e,Math.max(t,i))}function FilteredVector(t,e,i){this.dimension=t.length,this.bounds=[new Array(this.dimension),new Array(this.dimension)];for(var s=0;s<this.dimension;++s)this.bounds[0][s]=-(1/0),this.bounds[1][s]=1/0;this._state=t.slice().reverse(),this._velocity=e.slice().reverse(),this._time=[i],this._scratch=[t.slice(),t.slice(),t.slice(),t.slice(),t.slice()]}function getZero(t){for(var e=new Array(t),i=0;t>i;++i)e[i]=0;return e}function createFilteredVector(t,e,i){switch(arguments.length){case 0:return new FilteredVector([0],[0],0);case 1:if("number"==typeof t){var s=getZero(t);return new FilteredVector(s,s,0)}return new FilteredVector(t,getZero(t.length),0);case 2:if("number"==typeof e){var s=getZero(t.length);return new FilteredVector(t,s,+e)}i=0;case 3:if(t.length!==e.length)throw new Error("state and velocity lengths must match");return new FilteredVector(t,e,i)}}module.exports=createFilteredVector;var cubicHermite=require("cubic-hermite"),bsearch=require("binary-search-bounds"),proto=FilteredVector.prototype;proto.flush=function(t){var e=bsearch.gt(this._time,t)-1;0>=e||(this._time.splice(0,e),this._state.splice(0,e*this.dimension),this._velocity.splice(0,e*this.dimension))},proto.curve=function(t){var e=this._time,i=e.length,s=bsearch.le(e,t),r=this._scratch[0],h=this._state,n=this._velocity,o=this.dimension,a=this.bounds;if(0>s)for(var c=o-1,u=0;o>u;++u,--c)r[u]=h[c];else if(s>=i-1)for(var c=h.length-1,l=t-e[i-1],u=0;o>u;++u,--c)r[u]=h[c]+l*n[c];else{for(var c=o*(s+1)-1,m=e[s],v=e[s+1],f=v-m||1,p=this._scratch[1],_=this._scratch[2],d=this._scratch[3],g=this._scratch[4],b=!0,u=0;o>u;++u,--c)p[u]=h[c],d[u]=n[c]*f,_[u]=h[c+o],g[u]=n[c+o]*f,b=b&&p[u]===_[u]&&d[u]===g[u]&&0===d[u];if(b)for(var u=0;o>u;++u)r[u]=p[u];else cubicHermite(p,d,_,g,(t-m)/f,r)}for(var y=a[0],w=a[1],u=0;o>u;++u)r[u]=clamp(y[u],w[u],r[u]);return r},proto.dcurve=function(t){var e=this._time,i=e.length,s=bsearch.le(e,t),r=this._scratch[0],h=this._state,n=this._velocity,o=this.dimension;if(s>=i-1)for(var a=h.length-1,c=(t-e[i-1],0);o>c;++c,--a)r[c]=n[a];else{for(var a=o*(s+1)-1,u=e[s],l=e[s+1],m=l-u||1,v=this._scratch[1],f=this._scratch[2],p=this._scratch[3],_=this._scratch[4],d=!0,c=0;o>c;++c,--a)v[c]=h[a],p[c]=n[a]*m,f[c]=h[a+o],_[c]=n[a+o]*m,d=d&&v[c]===f[c]&&p[c]===_[c]&&0===p[c];if(d)for(var c=0;o>c;++c)r[c]=0;else{cubicHermite.derivative(v,p,f,_,(t-u)/m,r);for(var c=0;o>c;++c)r[c]/=m}}return r},proto.lastT=function(){var t=this._time;return t[t.length-1]},proto.stable=function(){for(var t=this._velocity,e=t.length,i=this.dimension-1;i>=0;--i)if(t[--e])return!1;return!0},proto.jump=function(t){var e=this.lastT(),i=this.dimension;if(!(e>t||arguments.length!==i+1)){var s=this._state,r=this._velocity,h=s.length-this.dimension,n=this.bounds,o=n[0],a=n[1];this._time.push(e,t);for(var c=0;2>c;++c)for(var u=0;i>u;++u)s.push(s[h++]),r.push(0);this._time.push(t);for(var u=i;u>0;--u)s.push(clamp(o[u-1],a[u-1],arguments[u])),r.push(0)}},proto.push=function(t){var e=this.lastT(),i=this.dimension;if(!(e>t||arguments.length!==i+1)){var s=this._state,r=this._velocity,h=s.length-this.dimension,n=t-e,o=this.bounds,a=o[0],c=o[1],u=n>1e-6?1/n:0;this._time.push(t);for(var l=i;l>0;--l){var m=clamp(a[l-1],c[l-1],arguments[l]);s.push(m),r.push((m-s[h++])*u)}}},proto.set=function(t){var e=this.dimension;if(!(t<this.lastT()||arguments.length!==e+1)){var i=this._state,s=this._velocity,r=this.bounds,h=r[0],n=r[1];this._time.push(t);for(var o=e;o>0;--o)i.push(clamp(h[o-1],n[o-1],arguments[o])),s.push(0)}},proto.move=function(t){var e=this.lastT(),i=this.dimension;if(!(e>=t||arguments.length!==i+1)){var s=this._state,r=this._velocity,h=s.length-this.dimension,n=this.bounds,o=n[0],a=n[1],c=t-e,u=c>1e-6?1/c:0;this._time.push(t);for(var l=i;l>0;--l){var m=arguments[l];s.push(clamp(o[l-1],a[l-1],s[h++]+m)),r.push(m*u)}}},proto.idle=function(t){var e=this.lastT();if(!(e>t)){var i=this.dimension,s=this._state,r=this._velocity,h=s.length-i,n=this.bounds,o=n[0],a=n[1],c=t-e;this._time.push(t);for(var u=i-1;u>=0;--u)s.push(clamp(o[u],a[u],s[h]+c*r[h])),r.push(0),h+=1}};

},{"binary-search-bounds":85,"cubic-hermite":86}],85:[function(require,module,exports){
"use strict";function compileSearch(e,n,c,i,r,u){var h=["function ",e,"(a,l,h,",i.join(","),"){",u?"":"var i=",c?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",r?".get(m)":"[m]"];return u?n.indexOf("c")<0?h.push(";if(x===y){return m}else if(x<=y){"):h.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):h.push(";if(",n,"){i=m;"),c?h.push("l=m+1}else{h=m-1}"):h.push("h=m-1}else{l=m+1}"),h.push("}"),u?h.push("return -1};"):h.push("return i};"),h.join("")}function compileBoundsSearch(e,n,c,i){var r=new Function([compileSearch("A","x"+e+"y",n,["y"],!1,i),compileSearch("B","x"+e+"y",n,["y"],!0,i),compileSearch("P","c(x,y)"+e+"0",n,["y","c"],!1,i),compileSearch("Q","c(x,y)"+e+"0",n,["y","c"],!0,i),"function dispatchBsearch",c,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",c].join(""));return r()}module.exports={ge:compileBoundsSearch(">=",!1,"GE"),gt:compileBoundsSearch(">",!1,"GT"),lt:compileBoundsSearch("<",!0,"LT"),le:compileBoundsSearch("<=",!0,"LE"),eq:compileBoundsSearch("-",!0,"EQ",!0)};

},{}],86:[function(require,module,exports){
"use strict";function dcubicHermite(e,r,t,n,i,u){var c=6*i*i-6*i,l=3*i*i-4*i+1,o=-6*i*i+6*i,a=3*i*i-2*i;if(e.length){u||(u=new Array(e.length));for(var f=e.length-1;f>=0;--f)u[f]=c*e[f]+l*r[f]+o*t[f]+a*n[f];return u}return c*e+l*r+o*t[f]+a*n}function cubicHermite(e,r,t,n,i,u){var c=i-1,l=i*i,o=c*c,a=(1+2*i)*o,f=i*o,g=l*(3-2*i),h=l*c;if(e.length){u||(u=new Array(e.length));for(var m=e.length-1;m>=0;--m)u[m]=a*e[m]+f*r[m]+g*t[m]+h*n[m];return u}return a*e+f*r+g*t+h*n}module.exports=cubicHermite,module.exports.derivative=dcubicHermite;

},{}],87:[function(require,module,exports){
function cross(r,o,s){var c=o[0],e=o[1],n=o[2],t=s[0],u=s[1],a=s[2];return r[0]=e*a-n*u,r[1]=n*t-c*a,r[2]=c*u-e*t,r}module.exports=cross;

},{}],88:[function(require,module,exports){
function dot(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]}module.exports=dot;

},{}],89:[function(require,module,exports){
function normalize(r,e){var n=e[0],o=e[1],t=e[2],a=n*n+o*o+t*t;return a>0&&(a=1/Math.sqrt(a),r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a),r}module.exports=normalize;

},{}],90:[function(require,module,exports){
"use strict";function len3(t,r,e){return Math.sqrt(Math.pow(t,2)+Math.pow(r,2)+Math.pow(e,2))}function clamp1(t){return Math.min(1,Math.max(-1,t))}function findOrthoPair(t){var r=Math.abs(t[0]),e=Math.abs(t[1]),a=Math.abs(t[2]),i=[0,0,0];r>Math.max(e,a)?i[2]=1:e>Math.max(r,a)?i[0]=1:i[1]=1;for(var s=0,h=0,o=0;3>o;++o)s+=t[o]*t[o],h+=i[o]*t[o];for(var o=0;3>o;++o)i[o]-=h/s*t[o];return normalize3(i,i),i}function TurntableController(t,r,e,a,i,s,h,o){this.center=filterVector(e),this.up=filterVector(a),this.right=filterVector(i),this.radius=filterVector([s]),this.angle=filterVector([h,o]),this.angle.bounds=[[-(1/0),-Math.PI/2],[1/0,Math.PI/2]],this.setDistanceLimits(t,r),this.computedCenter=this.center.curve(0),this.computedUp=this.up.curve(0),this.computedRight=this.right.curve(0),this.computedRadius=this.radius.curve(0),this.computedAngle=this.angle.curve(0),this.computedToward=[0,0,0],this.computedEye=[0,0,0],this.computedMatrix=new Array(16);for(var n=0;16>n;++n)this.computedMatrix[n]=.5;this.recalcMatrix(0)}function createTurntableController(t){t=t||{};var r=t.center||[0,0,0],e=t.up||[0,1,0],a=t.right||findOrthoPair(e),i=t.radius||1,s=t.theta||0,h=t.phi||0;if(r=[].slice.call(r,0,3),e=[].slice.call(e,0,3),normalize3(e,e),a=[].slice.call(a,0,3),normalize3(a,a),"eye"in t){var o=t.eye,n=[o[0]-r[0],o[1]-r[1],o[2]-r[2]];cross(a,n,e),len3(a[0],a[1],a[2])<1e-6?a=findOrthoPair(e):normalize3(a,a),i=len3(n[0],n[1],n[2]);var u=dot3(e,n)/i,c=dot3(a,n)/i;h=Math.acos(u),s=Math.acos(c)}return i=Math.log(i),new TurntableController(t.zoomMin,t.zoomMax,r,e,a,i,s,h)}module.exports=createTurntableController;var filterVector=require("filtered-vector"),invert44=require("gl-mat4/invert"),rotateM=require("gl-mat4/rotate"),cross=require("gl-vec3/cross"),normalize3=require("gl-vec3/normalize"),dot3=require("gl-vec3/dot"),proto=TurntableController.prototype;proto.setDistanceLimits=function(t,r){t=t>0?Math.log(t):-(1/0),r=r>0?Math.log(r):1/0,r=Math.max(r,t),this.radius.bounds[0][0]=t,this.radius.bounds[1][0]=r},proto.getDistanceLimits=function(t){var r=this.radius.bounds[0];return t?(t[0]=Math.exp(r[0][0]),t[1]=Math.exp(r[1][0]),t):[Math.exp(r[0][0]),Math.exp(r[1][0])]},proto.recalcMatrix=function(t){this.center.curve(t),this.up.curve(t),this.right.curve(t),this.radius.curve(t),this.angle.curve(t);for(var r=this.computedUp,e=this.computedRight,a=0,i=0,s=0;3>s;++s)i+=r[s]*e[s],a+=r[s]*r[s];for(var h=Math.sqrt(a),o=0,s=0;3>s;++s)e[s]-=r[s]*i/a,o+=e[s]*e[s],r[s]/=h;for(var n=Math.sqrt(o),s=0;3>s;++s)e[s]/=n;var u=this.computedToward;cross(u,r,e),normalize3(u,u);for(var c=Math.exp(this.computedRadius[0]),l=this.computedAngle[0],p=this.computedAngle[1],M=Math.cos(l),d=Math.sin(l),v=Math.cos(p),m=Math.sin(p),f=this.computedCenter,g=M*v,x=d*v,b=m,T=-M*m,z=-d*m,P=v,A=this.computedEye,q=this.computedMatrix,s=0;3>s;++s){var I=g*e[s]+x*u[s]+b*r[s];q[4*s+1]=T*e[s]+z*u[s]+P*r[s],q[4*s+2]=I,q[4*s+3]=0}var R=q[1],w=q[5],y=q[9],C=q[2],j=q[6],V=q[10],D=w*V-y*j,U=y*C-R*V,E=R*j-w*C,L=len3(D,U,E);D/=L,U/=L,E/=L,q[0]=D,q[4]=U,q[8]=E;for(var s=0;3>s;++s)A[s]=f[s]+q[2+4*s]*c;for(var s=0;3>s;++s){for(var o=0,O=0;3>O;++O)o+=q[s+4*O]*A[O];q[12+s]=-o}q[15]=1},proto.getMatrix=function(t,r){this.recalcMatrix(t);var e=this.computedMatrix;if(r){for(var a=0;16>a;++a)r[a]=e[a];return r}return e};var zAxis=[0,0,0];proto.rotate=function(t,r,e,a){if(this.angle.move(t,r,e),a){this.recalcMatrix(t);var i=this.computedMatrix;zAxis[0]=i[2],zAxis[1]=i[6],zAxis[2]=i[10];for(var s=this.computedUp,h=this.computedRight,o=this.computedToward,n=0;3>n;++n)i[4*n]=s[n],i[4*n+1]=h[n],i[4*n+2]=o[n];rotateM(i,i,a,zAxis);for(var n=0;3>n;++n)s[n]=i[4*n],h[n]=i[4*n+1];this.up.set(t,s[0],s[1],s[2]),this.right.set(t,h[0],h[1],h[2])}},proto.pan=function(t,r,e,a){r=r||0,e=e||0,a=a||0,this.recalcMatrix(t);var i=this.computedMatrix,s=(Math.exp(this.computedRadius[0]),i[1]),h=i[5],o=i[9],n=len3(s,h,o);s/=n,h/=n,o/=n;var u=i[0],c=i[4],l=i[8],p=u*s+c*h+l*o;u-=s*p,c-=h*p,l-=o*p;var M=len3(u,c,l);u/=M,c/=M,l/=M;var d=u*r+s*e,v=c*r+h*e,m=l*r+o*e;this.center.move(t,d,v,m);var f=Math.exp(this.computedRadius[0]);f=Math.max(1e-4,f+a),this.radius.set(t,Math.log(f))},proto.translate=function(t,r,e,a){this.center.move(t,r||0,e||0,a||0)},proto.setMatrix=function(t,r,e,a){var i=1;"number"==typeof e&&(i=0|e),(0>i||i>3)&&(i=1);var s=(i+2)%3;r||(this.recalcMatrix(t),r=this.computedMatrix);var h=r[i],o=r[i+4],n=r[i+8];if(a){var u=Math.abs(h),c=Math.abs(o),l=Math.abs(n),p=Math.max(u,c,l);u===p?(h=0>h?-1:1,o=n=0):l===p?(n=0>n?-1:1,h=o=0):(o=0>o?-1:1,h=n=0)}else{var M=len3(h,o,n);h/=M,o/=M,n/=M}var d=r[s],v=r[s+4],m=r[s+8],f=d*h+v*o+m*n;d-=h*f,v-=o*f,m-=n*f;var g=len3(d,v,m);d/=g,v/=g,m/=g;var x=o*m-n*v,b=n*d-h*m,T=h*v-o*d,z=len3(x,b,T);x/=z,b/=z,T/=z,this.center.jump(t,F,G,H),this.radius.idle(t),this.up.jump(t,h,o,n),this.right.jump(t,d,v,m);var P,A;if(2===i){var q=r[1],I=r[5],R=r[9],w=q*d+I*v+R*m,y=q*x+I*b+R*T;P=0>D?-Math.PI/2:Math.PI/2,A=Math.atan2(y,w)}else{var C=r[2],j=r[6],V=r[10],D=C*h+j*o+V*n,U=C*d+j*v+V*m,E=C*x+j*b+V*T;P=Math.asin(clamp1(D)),A=Math.atan2(E,U)}this.angle.jump(t,A,P),this.recalcMatrix(t);var L=r[2],O=r[6],k=r[10],_=this.computedMatrix;invert44(_,r);var B=_[15],F=_[12]/B,G=_[13]/B,H=_[14]/B,J=Math.exp(this.computedRadius[0]);this.center.jump(t,F-L*J,G-O*J,H-k*J)},proto.lastT=function(){return Math.max(this.center.lastT(),this.up.lastT(),this.right.lastT(),this.radius.lastT(),this.angle.lastT())},proto.idle=function(t){this.center.idle(t),this.up.idle(t),this.right.idle(t),this.radius.idle(t),this.angle.idle(t)},proto.flush=function(t){this.center.flush(t),this.up.flush(t),this.right.flush(t),this.radius.flush(t),this.angle.flush(t)},proto.setDistance=function(t,r){r>0&&this.radius.set(t,Math.log(r))},proto.lookAt=function(t,r,e,a){this.recalcMatrix(t),r=r||this.computedEye,e=e||this.computedCenter,a=a||this.computedUp;var i=a[0],s=a[1],h=a[2],o=len3(i,s,h);if(!(1e-6>o)){i/=o,s/=o,h/=o;var n=r[0]-e[0],u=r[1]-e[1],c=r[2]-e[2],l=len3(n,u,c);if(!(1e-6>l)){n/=l,u/=l,c/=l;var p=this.computedRight,M=p[0],d=p[1],v=p[2],m=i*M+s*d+h*v;M-=m*i,d-=m*s,v-=m*h;var f=len3(M,d,v);if(!(.01>f&&(M=s*c-h*u,d=h*n-i*c,v=i*u-s*n,f=len3(M,d,v),1e-6>f))){M/=f,d/=f,v/=f,this.up.set(t,i,s,h),this.right.set(t,M,d,v),this.center.set(t,e[0],e[1],e[2]),this.radius.set(t,Math.log(l));var g=s*v-h*d,x=h*M-i*v,b=i*d-s*M,T=len3(g,x,b);g/=T,x/=T,b/=T;var z=i*n+s*u+h*c,P=M*n+d*u+v*c,A=g*n+x*u+b*c,q=Math.asin(clamp1(z)),I=Math.atan2(A,P),R=this.angle._state,w=R[R.length-1],y=R[R.length-2];w%=2*Math.PI;var C=Math.abs(w+2*Math.PI-I),j=Math.abs(w-I),V=Math.abs(w-2*Math.PI-I);j>C&&(w+=2*Math.PI),j>V&&(w-=2*Math.PI),this.angle.jump(this.angle.lastT(),w,y),this.angle.set(t,I,q)}}}};

},{"filtered-vector":84,"gl-mat4/invert":249,"gl-mat4/rotate":253,"gl-vec3/cross":87,"gl-vec3/dot":88,"gl-vec3/normalize":89}],91:[function(require,module,exports){
"use strict";function ViewController(t,e){this._controllerNames=Object.keys(t),this._controllerList=this._controllerNames.map(function(e){return t[e]}),this._mode=e,this._active=t[e],this._active||(this._mode="turntable",this._active=t.turntable),this.modes=this._controllerNames,this.computedMatrix=this._active.computedMatrix,this.computedEye=this._active.computedEye,this.computedUp=this._active.computedUp,this.computedCenter=this._active.computedCenter,this.computedRadius=this._active.computedRadius}function createViewController(t){t=t||{};var e=t.eye||[0,0,1],i=t.center||[0,0,0],r=t.up||[0,1,0],o=t.distanceLimits||[0,1/0],c=t.mode||"turntable",a=createTurntable(),s=createOrbit(),n=createMatrix();return a.setDistanceLimits(o[0],o[1]),a.lookAt(0,e,i,r),s.setDistanceLimits(o[0],o[1]),s.lookAt(0,e,i,r),n.setDistanceLimits(o[0],o[1]),n.lookAt(0,e,i,r),new ViewController({turntable:a,orbit:s,matrix:n},c)}module.exports=createViewController;var createTurntable=require("turntable-camera-controller"),createOrbit=require("orbit-camera-controller"),createMatrix=require("matrix-camera-controller"),proto=ViewController.prototype,COMMON_METHODS=[["flush",1],["idle",1],["lookAt",4],["rotate",4],["pan",4],["translate",4],["setMatrix",2],["setDistanceLimits",2],["setDistance",2]];COMMON_METHODS.forEach(function(t){for(var e=t[0],i=[],r=0;r<t[1];++r)i.push("a"+r);var o="var cc=this._controllerList;for(var i=0;i<cc.length;++i){cc[i]."+t[0]+"("+i.join()+")}";proto[e]=Function.apply(null,i.concat(o))}),proto.recalcMatrix=function(t){this._active.recalcMatrix(t)},proto.getDistance=function(t){return this._active.getDistance(t)},proto.getDistanceLimits=function(t){return this._active.getDistanceLimits(t)},proto.lastT=function(){return this._active.lastT()},proto.setMode=function(t){if(t!==this._mode){var e=this._controllerNames.indexOf(t);if(!(0>e)){var i=this._active,r=this._controllerList[e],o=Math.max(i.lastT(),r.lastT());i.recalcMatrix(o),r.setMatrix(o,i.computedMatrix),this._active=r,this._mode=t,this.computedMatrix=this._active.computedMatrix,this.computedEye=this._active.computedEye,this.computedUp=this._active.computedUp,this.computedCenter=this._active.computedCenter,this.computedRadius=this._active.computedRadius}}},proto.getMode=function(){return this._mode};

},{"matrix-camera-controller":66,"orbit-camera-controller":83,"turntable-camera-controller":90}],92:[function(require,module,exports){
module.exports=function(r,t){t||(t=[0,""]),r=String(r);var a=parseFloat(r,10);return t[0]=a,t[1]=r.match(/[\d.\-\+]*\s*(.*)/)[1]||"",t};

},{}],93:[function(require,module,exports){
"use strict";function getPropertyInPX(e,t){var r=parseUnit(getComputedStyle(e).getPropertyValue(t));return r[0]*toPX(r[1],e)}function getSizeBrutal(e,t){var r=document.createElement("div");r.style["font-size"]="128"+e,t.appendChild(r);var n=getPropertyInPX(r,"font-size")/128;return t.removeChild(r),n}function toPX(e,t){switch(t=t||document.body,e=(e||"px").trim().toLowerCase(),(t===window||t===document)&&(t=document.body),e){case"%":return t.clientHeight/100;case"ch":case"ex":return getSizeBrutal(e,t);case"em":return getPropertyInPX(t,"font-size");case"rem":return getPropertyInPX(document.body,"font-size");case"vw":return window.innerWidth/100;case"vh":return window.innerHeight/100;case"vmin":return Math.min(window.innerWidth,window.innerHeight)/100;case"vmax":return Math.max(window.innerWidth,window.innerHeight)/100;case"in":return PIXELS_PER_INCH;case"cm":return PIXELS_PER_INCH/2.54;case"mm":return PIXELS_PER_INCH/25.4;case"pt":return PIXELS_PER_INCH/72;case"pc":return PIXELS_PER_INCH/6}return 1}var parseUnit=require("parse-unit");module.exports=toPX;var PIXELS_PER_INCH=96;

},{"parse-unit":92}],94:[function(require,module,exports){
"use strict";function mouseWheelListen(e,t,n){"function"==typeof e&&(n=!!t,t=e,e=window);var o=toPX("ex",e);e.addEventListener("wheel",function(e){n&&e.preventDefault();var i=e.deltaX||0,r=e.deltaY||0,a=e.deltaZ||0,d=e.deltaMode,s=1;switch(d){case 1:s=o;break;case 2:s=window.innerHeight}return i*=s,r*=s,a*=s,i||r||a?t(i,r,a):void 0})}var toPX=require("to-px");module.exports=mouseWheelListen;

},{"to-px":93}],95:[function(require,module,exports){
(function (global){
module.exports=global.performance&&global.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],96:[function(require,module,exports){
"use strict";function GLBuffer(e,t,r,i,s){this.gl=e,this.type=t,this.handle=r,this.length=i,this.usage=s}function updateTypeArray(e,t,r,i,s,a){var n=s.length*s.BYTES_PER_ELEMENT;if(0>a)return e.bufferData(t,s,i),n;if(n+a>r)throw new Error("gl-buffer: If resizing buffer, must not specify offset");return e.bufferSubData(t,a,s),r}function makeScratchTypeArray(e,t){for(var r=pool.malloc(e.length,t),i=e.length,s=0;i>s;++s)r[s]=e[s];return r}function isPacked(e,t){for(var r=1,i=t.length-1;i>=0;--i){if(t[i]!==r)return!1;r*=e[i]}return!0}function createBuffer(e,t,r,i){if(r=r||e.ARRAY_BUFFER,i=i||e.DYNAMIC_DRAW,r!==e.ARRAY_BUFFER&&r!==e.ELEMENT_ARRAY_BUFFER)throw new Error("gl-buffer: Invalid type for webgl buffer, must be either gl.ARRAY_BUFFER or gl.ELEMENT_ARRAY_BUFFER");if(i!==e.DYNAMIC_DRAW&&i!==e.STATIC_DRAW&&i!==e.STREAM_DRAW)throw new Error("gl-buffer: Invalid usage for buffer, must be either gl.DYNAMIC_DRAW, gl.STATIC_DRAW or gl.STREAM_DRAW");var s=e.createBuffer(),a=new GLBuffer(e,r,s,0,i);return a.update(t),a}var pool=require("typedarray-pool"),ops=require("ndarray-ops"),ndarray=require("ndarray"),SUPPORTED_TYPES=["uint8","uint8_clamped","uint16","uint32","int8","int16","int32","float32"],proto=GLBuffer.prototype;proto.bind=function(){this.gl.bindBuffer(this.type,this.handle)},proto.unbind=function(){this.gl.bindBuffer(this.type,null)},proto.dispose=function(){this.gl.deleteBuffer(this.handle)},proto.update=function(e,t){if("number"!=typeof t&&(t=-1),this.bind(),"object"==typeof e&&"undefined"!=typeof e.shape){var r=e.dtype;if(SUPPORTED_TYPES.indexOf(r)<0&&(r="float32"),this.type===this.gl.ELEMENT_ARRAY_BUFFER){var i=gl.getExtension("OES_element_index_uint");r=i&&"uint16"!==r?"uint32":"uint16"}if(r===e.dtype&&isPacked(e.shape,e.stride))0===e.offset&&e.data.length===e.shape[0]?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e.data,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e.data.subarray(e.offset,e.shape[0]),t);else{var s=pool.malloc(e.size,r),a=ndarray(s,e.shape);ops.assign(a,e),0>t?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,s,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,s.subarray(0,e.size),t),pool.free(s)}}else if(Array.isArray(e)){var n;n=this.type===this.gl.ELEMENT_ARRAY_BUFFER?makeScratchTypeArray(e,"uint16"):makeScratchTypeArray(e,"float32"),0>t?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,n,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,n.subarray(0,e.length),t),pool.free(n)}else if("object"==typeof e&&"number"==typeof e.length)this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e,t);else{if("number"!=typeof e&&void 0!==e)throw new Error("gl-buffer: Invalid data type");if(t>=0)throw new Error("gl-buffer: Cannot specify offset when resizing buffer");e=0|e,0>=e&&(e=1),this.gl.bufferData(this.type,0|e,this.usage),this.length=e}},module.exports=createBuffer;

},{"ndarray":296,"ndarray-ops":97,"typedarray-pool":104}],97:[function(require,module,exports){
"use strict";function fixup(a){if(!a)return EmptyProc;for(var r=0;r<a.args.length;++r){var s=a.args[r];0===r?a.args[r]={name:s,lvalue:!0,rvalue:!!a.rvalue,count:a.count||1}:a.args[r]={name:s,lvalue:!1,rvalue:!0,count:1}}return a.thisVars||(a.thisVars=[]),a.localVars||(a.localVars=[]),a}function pcompile(a){return compile({args:a.args,pre:fixup(a.pre),body:fixup(a.body),post:fixup(a.proc),funcName:a.funcName})}function makeOp(a){for(var r=[],s=0;s<a.args.length;++s)r.push("a"+s);var i=new Function("P",["return function ",a.funcName,"_ndarrayops(",r.join(","),") {P(",r.join(","),");return a0}"].join(""));return i(pcompile(a))}var compile=require("cwise-compiler"),EmptyProc={body:"",args:[],thisVars:[],localVars:[]},assign_ops={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var a in assign_ops){var r=assign_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:a+"eq"}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:a+"seq"})}}();var unary_ops={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var a in unary_ops){var r=unary_ops[a];exports[a]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:a}),exports[a+"eq"]=makeOp({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:a+"eq"})}}();var binary_ops={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var a in binary_ops){var r=binary_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:a+"eq"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:a+"seq"})}}();var math_unary=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var a=0;a<math_unary.length;++a){var r=math_unary[a];exports[r]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),exports[r+"eq"]=makeOp({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var math_comm=["max","min","atan2","pow"];!function(){for(var a=0;a<math_comm.length;++a){var r=math_comm[a];exports[r]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),exports[r+"s"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),exports[r+"eq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),exports[r+"seq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var math_noncomm=["atan2","pow"];!function(){for(var a=0;a<math_noncomm.length;++a){var r=math_noncomm[a];exports[r+"op"]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),exports[r+"ops"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),exports[r+"opeq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),exports[r+"opseq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),exports.any=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),exports.all=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),exports.sum=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),exports.prod=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),exports.norm2squared=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),exports.norm2=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),exports.norminf=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),exports.norm1=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),exports.sup=compile({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.inf=compile({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.argmin=compile({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.argmax=compile({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.random=makeOp({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),exports.assign=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),exports.assigns=makeOp({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),exports.equals=compile({args:["array","array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"});

},{"cwise-compiler":98}],98:[function(require,module,exports){
"use strict";function Procedure(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function compileCwise(r){var e=new Procedure;e.pre=r.pre,e.body=r.body,e.post=r.post;var s=r.args.slice(0);e.argTypes=s;for(var o=0;o<s.length;++o){var a=s[o];if("array"===a||"object"==typeof a&&a.blockIndices){if(e.argTypes[o]="array",e.arrayArgs.push(o),e.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),e.shimArgs.push("array"+o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===a)e.scalarArgs.push(o),e.shimArgs.push("scalar"+o);else if("index"===a){if(e.indexArgs.push(o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===a){if(e.shapeArgs.push(o),o<e.pre.args.length&&e.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<e.post.args.length&&e.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof a||!a.offset)throw new Error("cwise: Unknown argument type "+s[o]);e.argTypes[o]="offset",e.offsetArgs.push({array:a.array,offset:a.offset}),e.offsetArgIndex.push(o)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>s.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>s.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>s.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!r.printCode||!!r.debug,e.funcName=r.funcName||"cwise",e.blockSize=r.blockSize||64,createThunk(e)}var createThunk=require("./lib/thunk.js");module.exports=compileCwise;

},{"./lib/thunk.js":100}],99:[function(require,module,exports){
"use strict";function innerFill(r,n,e){var s,a,o=r.length,i=n.arrayArgs.length,t=n.indexArgs.length>0,p=[],h=[],u=0,c=0;for(s=0;o>s;++s)h.push(["i",s,"=0"].join(""));for(a=0;i>a;++a)for(s=0;o>s;++s)c=u,u=r[s],0===s?h.push(["d",a,"s",s,"=t",a,"p",u].join("")):h.push(["d",a,"s",s,"=(t",a,"p",u,"-s",c,"*t",a,"p",c,")"].join(""));for(p.push("var "+h.join(",")),s=o-1;s>=0;--s)u=r[s],p.push(["for(i",s,"=0;i",s,"<s",u,";++i",s,"){"].join(""));for(p.push(e),s=0;o>s;++s){for(c=u,u=r[s],a=0;i>a;++a)p.push(["p",a,"+=d",a,"s",s].join(""));t&&(s>0&&p.push(["index[",c,"]-=s",c].join("")),p.push(["++index[",u,"]"].join(""))),p.push("}")}return p.join("\n")}function outerFill(r,n,e,s){for(var a=n.length,o=e.arrayArgs.length,i=e.blockSize,t=e.indexArgs.length>0,p=[],h=0;o>h;++h)p.push(["var offset",h,"=p",h].join(""));for(var h=r;a>h;++h)p.push(["for(var j"+h+"=SS[",n[h],"]|0;j",h,">0;){"].join("")),p.push(["if(j",h,"<",i,"){"].join("")),p.push(["s",n[h],"=j",h].join("")),p.push(["j",h,"=0"].join("")),p.push(["}else{s",n[h],"=",i].join("")),p.push(["j",h,"-=",i,"}"].join("")),t&&p.push(["index[",n[h],"]=j",h].join(""));for(var h=0;o>h;++h){for(var u=["offset"+h],c=r;a>c;++c)u.push(["j",c,"*t",h,"p",n[c]].join(""));p.push(["p",h,"=(",u.join("+"),")"].join(""))}p.push(innerFill(n,e,s));for(var h=r;a>h;++h)p.push("}");return p.join("\n")}function countMatches(r){for(var n=0,e=r[0].length;e>n;){for(var s=1;s<r.length;++s)if(r[s][n]!==r[0][n])return n;++n}return n}function processBlock(r,n,e){for(var s=r.body,a=[],o=[],i=0;i<r.args.length;++i){var t=r.args[i];if(!(t.count<=0)){var p=new RegExp(t.name,"g"),h="",u=n.arrayArgs.indexOf(i);switch(n.argTypes[i]){case"offset":var c=n.offsetArgIndex.indexOf(i),l=n.offsetArgs[c];u=l.array,h="+q"+c;case"array":h="p"+u+h;var f="l"+i,g="a"+u;if(0===n.arrayBlockIndices[u])1===t.count?"generic"===e[u]?t.lvalue?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),o.push([g,".set(",h,",",f,")"].join(""))):s=s.replace(p,[g,".get(",h,")"].join("")):s=s.replace(p,[g,"[",h,"]"].join("")):"generic"===e[u]?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,".set(",h,",",f,")"].join(""))):(a.push(["var ",f,"=",g,"[",h,"]"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,"[",h,"]=",f].join("")));else{for(var j=[t.name],v=[h],y=0;y<Math.abs(n.arrayBlockIndices[u]);y++)j.push("\\s*\\[([^\\]]+)\\]"),v.push("$"+(y+1)+"*t"+u+"b"+y);if(p=new RegExp(j.join(""),"g"),h=v.join("+"),"generic"===e[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");s=s.replace(p,[g,"[",h,"]"].join(""))}break;case"scalar":s=s.replace(p,"Y"+n.scalarArgs.indexOf(i));break;case"index":s=s.replace(p,"index");break;case"shape":s=s.replace(p,"shape")}}}return[a.join("\n"),s,o.join("\n")].join("\n").trim()}function typeSummary(r){for(var n=new Array(r.length),e=!0,s=0;s<r.length;++s){var a=r[s],o=a.match(/\d+/);o=o?o[0]:"",0===a.charAt(0)?n[s]="u"+a.charAt(1)+o:n[s]=a.charAt(0)+o,s>0&&(e=e&&n[s]===n[s-1])}return e?n[0]:n.join("")}function generateCWiseOp(r,n){for(var e=n[1].length-Math.abs(r.arrayBlockIndices[0])|0,s=new Array(r.arrayArgs.length),a=new Array(r.arrayArgs.length),o=0;o<r.arrayArgs.length;++o)a[o]=n[2*o],s[o]=n[2*o+1];for(var i=[],t=[],p=[],h=[],u=[],o=0;o<r.arrayArgs.length;++o){r.arrayBlockIndices[o]<0?(p.push(0),h.push(e),i.push(e),t.push(e+r.arrayBlockIndices[o])):(p.push(r.arrayBlockIndices[o]),h.push(r.arrayBlockIndices[o]+e),i.push(0),t.push(r.arrayBlockIndices[o]));for(var c=[],l=0;l<s[o].length;l++)p[o]<=s[o][l]&&s[o][l]<h[o]&&c.push(s[o][l]-p[o]);u.push(c)}for(var f=["SS"],g=["'use strict'"],j=[],l=0;e>l;++l)j.push(["s",l,"=SS[",l,"]"].join(""));for(var o=0;o<r.arrayArgs.length;++o){f.push("a"+o),f.push("t"+o),f.push("p"+o);for(var l=0;e>l;++l)j.push(["t",o,"p",l,"=t",o,"[",p[o]+l,"]"].join(""));for(var l=0;l<Math.abs(r.arrayBlockIndices[o]);++l)j.push(["t",o,"b",l,"=t",o,"[",i[o]+l,"]"].join(""))}for(var o=0;o<r.scalarArgs.length;++o)f.push("Y"+o);if(r.shapeArgs.length>0&&j.push("shape=SS.slice(0)"),r.indexArgs.length>0){for(var v=new Array(e),o=0;e>o;++o)v[o]="0";j.push(["index=[",v.join(","),"]"].join(""))}for(var o=0;o<r.offsetArgs.length;++o){for(var y=r.offsetArgs[o],d=[],l=0;l<y.offset.length;++l)0!==y.offset[l]&&(1===y.offset[l]?d.push(["t",y.array,"p",l].join("")):d.push([y.offset[l],"*t",y.array,"p",l].join("")));0===d.length?j.push("q"+o+"=0"):j.push(["q",o,"=",d.join("+")].join(""))}var A=uniq([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));j=j.concat(A),g.push("var "+j.join(","));for(var o=0;o<r.arrayArgs.length;++o)g.push("p"+o+"|=0");r.pre.body.length>3&&g.push(processBlock(r.pre,r,a));var k=processBlock(r.body,r,a),b=countMatches(u);e>b?g.push(outerFill(b,u[0],r,k)):g.push(innerFill(u[0],r,k)),r.post.body.length>3&&g.push(processBlock(r.post,r,a)),r.debug&&console.log("-----Generated cwise routine for ",n,":\n"+g.join("\n")+"\n----------");var x=[r.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",b,typeSummary(a)].join(""),w=new Function(["function ",x,"(",f.join(","),"){",g.join("\n"),"} return ",x].join(""));return w()}var uniq=require("uniq");module.exports=generateCWiseOp;

},{"uniq":101}],100:[function(require,module,exports){
"use strict";function createThunk(r){var a=["'use strict'","var CACHED={}"],e=[],s=r.funcName+"_cwise_thunk";a.push(["return function ",s,"(",r.shimArgs.join(","),"){"].join(""));for(var n=[],o=[],h=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],i=[],p=[],t=0;t<r.arrayArgs.length;++t){var c=r.arrayArgs[t];e.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),n.push("t"+c),n.push("r"+c),o.push("t"+c),o.push("r"+c+".join()"),h.push("array"+c+".data"),h.push("array"+c+".stride"),h.push("array"+c+".offset|0"),t>0&&(i.push("array"+r.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[t]))),p.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[t])+"]"))}r.arrayArgs.length>1&&(a.push("if (!("+i.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),a.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),a.push("if (!("+p.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),a.push("}"));for(var t=0;t<r.scalarArgs.length;++t)h.push("scalar"+r.scalarArgs[t]);e.push(["type=[",o.join(","),"].join()"].join("")),e.push("proc=CACHED[type]"),a.push("var "+e.join(",")),a.push(["if(!proc){","CACHED[type]=proc=compile([",n.join(","),"])}","return proc(",h.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+a.join("\n")+"\n----------");var u=new Function("compile",a.join("\n"));return u(compile.bind(void 0,r))}var compile=require("./compile.js");module.exports=createThunk;

},{"./compile.js":99}],101:[function(require,module,exports){
"use strict";function unique_pred(n,e){for(var u=1,t=n.length,i=n[0],r=n[0],o=1;t>o;++o)if(r=i,i=n[o],e(i,r)){if(o===u){u++;continue}n[u++]=i}return n.length=u,n}function unique_eq(n){for(var e=1,u=n.length,t=n[0],i=n[0],r=1;u>r;++r,i=t)if(i=t,t=n[r],t!==i){if(r===e){e++;continue}n[e++]=t}return n.length=e,n}function unique(n,e,u){return 0===n.length?n:e?(u||n.sort(e),unique_pred(n,e)):(u||n.sort(),unique_eq(n))}module.exports=unique;

},{}],102:[function(require,module,exports){
"use strict";"use restrict";function countTrailingZeros(r){var n=32;return r&=-r,r&&n--,65535&r&&(n-=16),16711935&r&&(n-=8),252645135&r&&(n-=4),858993459&r&&(n-=2),1431655765&r&&(n-=1),n}var INT_BITS=32;exports.INT_BITS=INT_BITS,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<INT_BITS-1,exports.sign=function(r){return(r>0)-(0>r)},exports.abs=function(r){var n=r>>INT_BITS-1;return(r^n)-n},exports.min=function(r,n){return n^(r^n)&-(n>r)},exports.max=function(r,n){return r^(r^n)&-(n>r)},exports.isPow2=function(r){return!(r&r-1||!r)},exports.log2=function(r){var n,t;return n=(r>65535)<<4,r>>>=n,t=(r>255)<<3,r>>>=t,n|=t,t=(r>15)<<2,r>>>=t,n|=t,t=(r>3)<<1,r>>>=t,n|=t,n|r>>1},exports.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},exports.popCount=function(r){return r-=r>>>1&1431655765,r=(858993459&r)+(r>>>2&858993459),16843009*(r+(r>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1},exports.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r-(r>>>1)},exports.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,r&=15,27030>>>r&1};var REVERSE_TABLE=new Array(256);!function(r){for(var n=0;256>n;++n){var t=n,e=n,o=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--o;r[n]=e<<o&255}}(REVERSE_TABLE),exports.reverse=function(r){return REVERSE_TABLE[255&r]<<24|REVERSE_TABLE[r>>>8&255]<<16|REVERSE_TABLE[r>>>16&255]<<8|REVERSE_TABLE[r>>>24&255]},exports.interleave2=function(r,n){return r&=65535,r=16711935&(r|r<<8),r=252645135&(r|r<<4),r=858993459&(r|r<<2),r=1431655765&(r|r<<1),n&=65535,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),r|n<<1},exports.deinterleave2=function(r,n){return r=r>>>n&1431655765,r=858993459&(r|r>>>1),r=252645135&(r|r>>>2),r=16711935&(r|r>>>4),r=65535&(r|r>>>16),r<<16>>16},exports.interleave3=function(r,n,t){return r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),n&=1023,n=4278190335&(n|n<<16),n=251719695&(n|n<<8),n=3272356035&(n|n<<4),n=1227133513&(n|n<<2),r|=n<<1,t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),r|t<<2},exports.deinterleave3=function(r,n){return r=r>>>n&1227133513,r=3272356035&(r|r>>>2),r=251719695&(r|r>>>4),r=4278190335&(r|r>>>8),r=1023&(r|r>>>16),r<<22>>22},exports.nextCombination=function(r){var n=r|r-1;return n+1|(~n&-~n)-1>>>countTrailingZeros(r)+1};

},{}],103:[function(require,module,exports){
"use strict";function dupe_array(e,r,u){var n=0|e[u];if(0>=n)return[];var t,a=new Array(n);if(u===e.length-1)for(t=0;n>t;++t)a[t]=r;else for(t=0;n>t;++t)a[t]=dupe_array(e,r,u+1);return a}function dupe_number(e,r){var u,n;for(u=new Array(e),n=0;e>n;++n)u[n]=r;return u}function dupe(e,r){switch("undefined"==typeof r&&(r=0),typeof e){case"number":if(e>0)return dupe_number(0|e,r);break;case"object":if("number"==typeof e.length)return dupe_array(e,r,0)}return[]}module.exports=dupe;

},{}],104:[function(require,module,exports){
(function (global,Buffer){
"use strict";function freeArrayBuffer(r){if(r){var e=r.length||r.byteLength,t=bits.log2(e);DATA[t].push(r)}}function freeTypedArray(r){freeArrayBuffer(r.buffer)}function mallocArrayBuffer(r){var r=bits.nextPow2(r),e=bits.log2(r),t=DATA[e];return t.length>0?t.pop():new ArrayBuffer(r)}function mallocUint8(r){return new Uint8Array(mallocArrayBuffer(r),0,r)}function mallocUint16(r){return new Uint16Array(mallocArrayBuffer(2*r),0,r)}function mallocUint32(r){return new Uint32Array(mallocArrayBuffer(4*r),0,r)}function mallocInt8(r){return new Int8Array(mallocArrayBuffer(r),0,r)}function mallocInt16(r){return new Int16Array(mallocArrayBuffer(2*r),0,r)}function mallocInt32(r){return new Int32Array(mallocArrayBuffer(4*r),0,r)}function mallocFloat(r){return new Float32Array(mallocArrayBuffer(4*r),0,r)}function mallocDouble(r){return new Float64Array(mallocArrayBuffer(8*r),0,r)}function mallocUint8Clamped(r){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(r),0,r):mallocUint8(r)}function mallocDataView(r){return new DataView(mallocArrayBuffer(r),0,r)}function mallocBuffer(r){r=bits.nextPow2(r);var e=bits.log2(r),t=BUFFER[e];return t.length>0?t.pop():new Buffer(r)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(r){if(Buffer.isBuffer(r))BUFFER[bits.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var e=r.length||r.byteLength,t=0|bits.log2(e);DATA[t].push(r)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(r){BUFFER[bits.log2(r.length)].push(r)},exports.malloc=function(r,e){if(void 0===e||"arraybuffer"===e)return mallocArrayBuffer(r);switch(e){case"uint8":return mallocUint8(r);case"uint16":return mallocUint16(r);case"uint32":return mallocUint32(r);case"int8":return mallocInt8(r);case"int16":return mallocInt16(r);case"int32":return mallocInt32(r);case"float":case"float32":return mallocFloat(r);case"double":case"float64":return mallocDouble(r);case"uint8_clamped":return mallocUint8Clamped(r);case"buffer":return mallocBuffer(r);case"data":case"dataview":return mallocDataView(r);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var r=0;32>r;++r)POOL.UINT8[r].length=0,POOL.UINT16[r].length=0,POOL.UINT32[r].length=0,POOL.INT8[r].length=0,POOL.INT16[r].length=0,POOL.INT32[r].length=0,POOL.FLOAT[r].length=0,POOL.DOUBLE[r].length=0,POOL.UINT8C[r].length=0,DATA[r].length=0,BUFFER[r].length=0};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"bit-twiddle":102,"buffer":5,"dup":103}],105:[function(require,module,exports){
"use strict";function doBind(e,r,t){r?r.bind():e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);var i=0|e.getParameter(e.MAX_VERTEX_ATTRIBS);if(t){if(t.length>i)throw new Error("gl-vao: Too many vertex attributes");for(var f=0;f<t.length;++f){var l=t[f];if(l.buffer){var n=l.buffer,b=l.size||4,a=l.type||e.FLOAT,A=!!l.normalized,o=l.stride||0,s=l.offset||0;n.bind(),e.enableVertexAttribArray(f),e.vertexAttribPointer(f,b,a,A,o,s)}else{if("number"==typeof l)e.vertexAttrib1f(f,l);else if(1===l.length)e.vertexAttrib1f(f,l[0]);else if(2===l.length)e.vertexAttrib2f(f,l[0],l[1]);else if(3===l.length)e.vertexAttrib3f(f,l[0],l[1],l[2]);else{if(4!==l.length)throw new Error("gl-vao: Invalid vertex attribute");e.vertexAttrib4f(f,l[0],l[1],l[2],l[3])}e.disableVertexAttribArray(f)}}for(;i>f;++f)e.disableVertexAttribArray(f)}else{e.bindBuffer(e.ARRAY_BUFFER,null);for(var f=0;i>f;++f)e.disableVertexAttribArray(f)}}module.exports=doBind;

},{}],106:[function(require,module,exports){
"use strict";function VAOEmulated(t){this.gl=t,this._elements=null,this._attributes=null,this._elementsType=t.UNSIGNED_SHORT}function createVAOEmulated(t){return new VAOEmulated(t)}var bindAttribs=require("./do-bind.js");VAOEmulated.prototype.bind=function(){bindAttribs(this.gl,this._elements,this._attributes)},VAOEmulated.prototype.update=function(t,e,i){this._elements=e,this._attributes=t,this._elementsType=i||this.gl.UNSIGNED_SHORT},VAOEmulated.prototype.dispose=function(){},VAOEmulated.prototype.unbind=function(){},VAOEmulated.prototype.draw=function(t,e,i){i=i||0;var s=this.gl;this._elements?s.drawElements(t,e,this._elementsType,i):s.drawArrays(t,i,e)},module.exports=createVAOEmulated;

},{"./do-bind.js":105}],107:[function(require,module,exports){
"use strict";function VertexAttribute(t,e,i,s,r,n){this.location=t,this.dimension=e,this.a=i,this.b=s,this.c=r,this.d=n}function VAONative(t,e,i){this.gl=t,this._ext=e,this.handle=i,this._attribs=[],this._useElements=!1,this._elementsType=t.UNSIGNED_SHORT}function createVAONative(t,e){return new VAONative(t,e,e.createVertexArrayOES())}var bindAttribs=require("./do-bind.js");VertexAttribute.prototype.bind=function(t){switch(this.dimension){case 1:t.vertexAttrib1f(this.location,this.a);break;case 2:t.vertexAttrib2f(this.location,this.a,this.b);break;case 3:t.vertexAttrib3f(this.location,this.a,this.b,this.c);break;case 4:t.vertexAttrib4f(this.location,this.a,this.b,this.c,this.d)}},VAONative.prototype.bind=function(){this._ext.bindVertexArrayOES(this.handle);for(var t=0;t<this._attribs.length;++t)this._attribs[t].bind(this.gl)},VAONative.prototype.unbind=function(){this._ext.bindVertexArrayOES(null)},VAONative.prototype.dispose=function(){this._ext.deleteVertexArrayOES(this.handle)},VAONative.prototype.update=function(t,e,i){if(this.bind(),bindAttribs(this.gl,e,t),this.unbind(),this._attribs.length=0,t)for(var s=0;s<t.length;++s){var r=t[s];"number"==typeof r?this._attribs.push(new VertexAttribute(s,1,r)):Array.isArray(r)&&this._attribs.push(new VertexAttribute(s,r.length,r[0],r[1],r[2],r[3]))}this._useElements=!!e,this._elementsType=i||this.gl.UNSIGNED_SHORT},VAONative.prototype.draw=function(t,e,i){i=i||0;var s=this.gl;this._useElements?s.drawElements(t,e,this._elementsType,i):s.drawArrays(t,i,e)},module.exports=createVAONative;

},{"./do-bind.js":105}],108:[function(require,module,exports){
"use strict";function createVAO(e,t,a,r){var i,u=e.getExtension("OES_vertex_array_object");return i=u?createVAONative(e,u):createVAOEmulated(e),i.update(t,a,r),i}var createVAONative=require("./lib/vao-native.js"),createVAOEmulated=require("./lib/vao-emulated.js");module.exports=createVAO;

},{"./lib/vao-emulated.js":106,"./lib/vao-native.js":107}],109:[function(require,module,exports){
!function(){"use strict";function e(t){t.permitHostObjects___&&t.permitHostObjects___(e)}function t(e){return!(e.substr(0,_.length)==_&&"___"===e.substr(e.length-3))}function n(e){if(e!==Object(e))throw new TypeError("Not an object: "+e);var t=e[p];if(t&&t.key===e)return t;if(!l(e))return void 0;t={key:e};try{return s(e,p,{value:t,writable:!1,enumerable:!1,configurable:!1}),t}catch(n){return void 0}}function r(e){return e.prototype=null,Object.freeze(e)}function o(){d||"undefined"==typeof console||(d=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}if("undefined"==typeof ses||!ses.ok||ses.ok()){"undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=e);var a=!1;if("function"==typeof WeakMap){var i=WeakMap;if("undefined"!=typeof navigator&&/Firefox/.test(navigator.userAgent));else{var u=new i,f=Object.freeze({});if(u.set(f,1),1===u.get(f))return void(module.exports=WeakMap);a=!0}}var c=(Object.prototype.hasOwnProperty,Object.getOwnPropertyNames),s=Object.defineProperty,l=Object.isExtensible,_="weakmap:",p=_+"ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var v=new ArrayBuffer(25),b=new Uint8Array(v);crypto.getRandomValues(b),p=_+"rand:"+Array.prototype.map.call(b,function(e){return(e%36).toString(36)}).join("")+"___"}if(s(Object,"getOwnPropertyNames",{value:function(e){return c(e).filter(t)}}),"getPropertyNames"in Object){var y=Object.getPropertyNames;s(Object,"getPropertyNames",{value:function(e){return y(e).filter(t)}})}!function(){var e=Object.freeze;s(Object,"freeze",{value:function(t){return n(t),e(t)}});var t=Object.seal;s(Object,"seal",{value:function(e){return n(e),t(e)}});var r=Object.preventExtensions;s(Object,"preventExtensions",{value:function(e){return n(e),r(e)}})}();var d=!1,O=0,g=function(){function e(e,t){var r,o=n(e);return o?c in o?o[c]:t:(r=u.indexOf(e),r>=0?f[r]:t)}function t(e){var t=n(e);return t?c in t:u.indexOf(e)>=0}function a(e,t){var r,o=n(e);return o?o[c]=t:(r=u.indexOf(e),r>=0?f[r]=t:(r=u.length,f[r]=t,u[r]=e)),this}function i(e){var t,r,o=n(e);return o?c in o&&delete o[c]:(t=u.indexOf(e),0>t?!1:(r=u.length-1,u[t]=void 0,f[t]=f[r],u[t]=u[r],u.length=r,f.length=r,!0))}this instanceof g||o();var u=[],f=[],c=O++;return Object.create(g.prototype,{get___:{value:r(e)},has___:{value:r(t)},set___:{value:r(a)},delete___:{value:r(i)}})};g.prototype=Object.create(Object.prototype,{get:{value:function(e,t){return this.get___(e,t)},writable:!0,configurable:!0},has:{value:function(e){return this.has___(e)},writable:!0,configurable:!0},set:{value:function(e,t){return this.set___(e,t)},writable:!0,configurable:!0},"delete":{value:function(e){return this.delete___(e)},writable:!0,configurable:!0}}),"function"==typeof i?!function(){function t(){function t(e,t){return s?c.has(e)?c.get(e):s.get___(e,t):c.get(e,t)}function n(e){return c.has(e)||(s?s.has___(e):!1)}function u(e){var t=!!c["delete"](e);return s?s.delete___(e)||t:t}this instanceof g||o();var f,c=new i,s=void 0,l=!1;return f=a?function(e,t){return c.set(e,t),c.has(e)||(s||(s=new g),s.set(e,t)),this}:function(e,t){if(l)try{c.set(e,t)}catch(n){s||(s=new g),s.set___(e,t)}else c.set(e,t);return this},Object.create(g.prototype,{get___:{value:r(t)},has___:{value:r(n)},set___:{value:r(f)},delete___:{value:r(u)},permitHostObjects___:{value:r(function(t){if(t!==e)throw new Error("bogus call to permitHostObjects___");l=!0})}})}a&&"undefined"!=typeof Proxy&&(Proxy=void 0),t.prototype=g.prototype,module.exports=t,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),module.exports=g)}}();

},{}],110:[function(require,module,exports){
"use strict";function createABigTriangle(e){var r=TriangleCache.get(e);if(!r||!e.isBuffer(r._triangleBuffer.buffer)){var a=createBuffer(e,new Float32Array([-1,-1,-1,4,4,-1]));r=createVAO(e,[{buffer:a,type:e.FLOAT,size:2}]),r._triangleBuffer=a,TriangleCache.set(e,r)}r.bind(),e.drawArrays(e.TRIANGLES,0,3),r.unbind()}var weakMap="undefined"==typeof WeakMap?require("weak-map"):WeakMap,createBuffer=require("gl-buffer"),createVAO=require("gl-vao"),TriangleCache=new weakMap;module.exports=createABigTriangle;

},{"gl-buffer":96,"gl-vao":108,"weak-map":109}],111:[function(require,module,exports){
"use strict";function copyVec3(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i}function Axes(i){this.gl=i,this.pixelRatio=1,this.bounds=[[-10,-10,-10],[10,10,10]],this.ticks=[[],[],[]],this.autoTicks=!0,this.tickSpacing=[1,1,1],this.tickEnable=[!0,!0,!0],this.tickFont=["sans-serif","sans-serif","sans-serif"],this.tickSize=[12,12,12],this.tickAngle=[0,0,0],this.tickColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.tickPad=[10,10,10],this.lastCubeProps={cubeEdges:[0,0,0],axis:[0,0,0]},this.labels=["x","y","z"],this.labelEnable=[!0,!0,!0],this.labelFont="sans-serif",this.labelSize=[20,20,20],this.labelAngle=[0,0,0],this.labelColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.labelPad=[10,10,10],this.lineEnable=[!0,!0,!0],this.lineMirror=[!1,!1,!1],this.lineWidth=[1,1,1],this.lineColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.lineTickEnable=[!0,!0,!0],this.lineTickMirror=[!1,!1,!1],this.lineTickLength=[0,0,0],this.lineTickWidth=[1,1,1],this.lineTickColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.gridEnable=[!0,!0,!0],this.gridWidth=[1,1,1],this.gridColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.zeroEnable=[!0,!0,!0],this.zeroLineColor=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.zeroLineWidth=[2,2,2],this.backgroundEnable=[!1,!1,!1],this.backgroundColor=[[.8,.8,.8,.5],[.8,.8,.8,.5],[.8,.8,.8,.5]],this._firstInit=!0,this._text=null,this._lines=null,this._background=createBackground(i)}function OffsetInfo(){this.primalOffset=[0,0,0],this.primalMinor=[0,0,0],this.mirrorOffset=[0,0,0],this.mirrorMinor=[0,0,0]}function computeLineOffset(i,t,s,e,r){for(var n=i.primalOffset,o=i.primalMinor,l=i.mirrorOffset,h=i.mirrorMinor,a=e[t],c=0;3>c;++c)if(t!==c){var d=n,b=l,u=o,f=h;a&1<<c&&(d=l,b=n,u=h,f=o),d[c]=s[0][c],b[c]=s[1][c],r[c]>0?(u[c]=-1,f[c]=0):(u[c]=0,f[c]=1)}}function createAxes(i,t){var s=new Axes(i);return s.update(t),s}module.exports=createAxes;var createText=require("./lib/text.js"),createLines=require("./lib/lines.js"),createBackground=require("./lib/background.js"),getCubeProperties=require("./lib/cube.js"),Ticks=require("./lib/ticks.js"),identity=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),proto=Axes.prototype;proto.update=function(i){function t(t,s,e){if(e in i){var r,n=i[e],o=this[e];(t?Array.isArray(n)&&Array.isArray(n[0]):Array.isArray(n))?this[e]=r=[s(n[0]),s(n[1]),s(n[2])]:this[e]=r=[s(n),s(n),s(n)];for(var l=0;3>l;++l)if(r[l]!==o[l])return!0}return!1}i=i||{};var s,e=t.bind(this,!1,Number),r=t.bind(this,!1,Boolean),n=t.bind(this,!1,String),o=t.bind(this,!0,function(i){if(Array.isArray(i)){if(3===i.length)return[+i[0],+i[1],+i[2],1];if(4===i.length)return[+i[0],+i[1],+i[2],+i[3]]}return[0,0,0,1]}),l=!1,h=!1;if("bounds"in i)for(var a=i.bounds,c=0;2>c;++c)for(var d=0;3>d;++d)a[c][d]!==this.bounds[c][d]&&(h=!0),this.bounds[c][d]=a[c][d];if("ticks"in i){s=i.ticks,l=!0,this.autoTicks=!1;for(var c=0;3>c;++c)this.tickSpacing[c]=0}else e("tickSpacing")&&(this.autoTicks=!0,h=!0);if(this._firstInit&&("ticks"in i||"tickSpacing"in i||(this.autoTicks=!0),h=!0,l=!0,this._firstInit=!1),h&&this.autoTicks&&(s=Ticks.create(this.bounds,this.tickSpacing),l=!0),l){for(var c=0;3>c;++c)s[c].sort(function(i,t){return i.x-t.x});Ticks.equal(s,this.ticks)?l=!1:this.ticks=s}r("tickEnable"),n("tickFont")&&(l=!0),e("tickSize"),e("tickAngle"),e("tickPad"),o("tickColor");var b=n("labels");n("labelFont")&&(b=!0),r("labelEnable"),e("labelSize"),e("labelPad"),o("labelColor"),r("lineEnable"),r("lineMirror"),e("lineWidth"),o("lineColor"),r("lineTickEnable"),r("lineTickMirror"),e("lineTickLength"),e("lineTickWidth"),o("lineTickColor"),r("gridEnable"),e("gridWidth"),o("gridColor"),r("zeroEnable"),o("zeroLineColor"),e("zeroLineWidth"),r("backgroundEnable"),o("backgroundColor"),this._text?this._text&&(b||l)&&this._text.update(this.bounds,this.labels,this.labelFont,this.ticks,this.tickFont):this._text=createText(this.gl,this.bounds,this.labels,this.labelFont,this.ticks,this.tickFont),this._lines&&l&&(this._lines.dispose(),this._lines=null),this._lines||(this._lines=createLines(this.gl,this.bounds,this.ticks))};var LINE_OFFSET=[new OffsetInfo,new OffsetInfo,new OffsetInfo],CUBE_ENABLE=[0,0,0],DEFAULT_PARAMS={model:identity,view:identity,projection:identity};proto.isOpaque=function(){return!0},proto.isTransparent=function(){return!1},proto.drawTransparent=function(i){};var PRIMAL_MINOR=[0,0,0],MIRROR_MINOR=[0,0,0],PRIMAL_OFFSET=[0,0,0];proto.draw=function(i){i=i||DEFAULT_PARAMS;for(var t=this.gl,s=i.model||identity,e=i.view||identity,r=i.projection||identity,n=this.bounds,o=getCubeProperties(s,e,r,n),l=o.cubeEdges,h=o.axis,a=e[12],c=e[13],d=e[14],b=e[15],u=this.pixelRatio*(r[3]*a+r[7]*c+r[11]*d+r[15]*b)/t.drawingBufferHeight,f=0;3>f;++f)this.lastCubeProps.cubeEdges[f]=l[f],this.lastCubeProps.axis[f]=h[f];for(var k=LINE_OFFSET,f=0;3>f;++f)computeLineOffset(LINE_OFFSET[f],f,this.bounds,l,h);for(var t=this.gl,p=CUBE_ENABLE,f=0;3>f;++f)this.backgroundEnable[f]?p[f]=h[f]:p[f]=0;this._background.draw(s,e,r,n,p,this.backgroundColor),this._lines.bind(s,e,r,this);for(var f=0;3>f;++f){var g=[0,0,0];h[f]>0?g[f]=n[1][f]:g[f]=n[0][f];for(var _=0;2>_;++_){var E=(f+1+_)%3,T=(f+1+(1^_))%3;this.gridEnable[E]&&this._lines.drawGrid(E,T,this.bounds,g,this.gridColor[E],this.gridWidth[E]*this.pixelRatio)}for(var _=0;2>_;++_){var E=(f+1+_)%3,T=(f+1+(1^_))%3;this.zeroEnable[T]&&n[0][T]<=0&&n[1][T]>=0&&this._lines.drawZero(E,T,this.bounds,g,this.zeroLineColor[T],this.zeroLineWidth[T]*this.pixelRatio)}}for(var f=0;3>f;++f){this.lineEnable[f]&&this._lines.drawAxisLine(f,this.bounds,k[f].primalOffset,this.lineColor[f],this.lineWidth[f]*this.pixelRatio),this.lineMirror[f]&&this._lines.drawAxisLine(f,this.bounds,k[f].mirrorOffset,this.lineColor[f],this.lineWidth[f]*this.pixelRatio);for(var x=copyVec3(PRIMAL_MINOR,k[f].primalMinor),A=copyVec3(MIRROR_MINOR,k[f].mirrorMinor),v=this.lineTickLength,_=0;3>_;++_){var C=u/s[5*_];x[_]*=v[_]*C,A[_]*=v[_]*C}this.lineTickEnable[f]&&this._lines.drawAxisTicks(f,k[f].primalOffset,x,this.lineTickColor[f],this.lineTickWidth[f]*this.pixelRatio),this.lineTickMirror[f]&&this._lines.drawAxisTicks(f,k[f].mirrorOffset,A,this.lineTickColor[f],this.lineTickWidth[f]*this.pixelRatio)}this._text.bind(s,e,r,this.pixelRatio);for(var f=0;3>f;++f){for(var L=k[f].primalMinor,O=copyVec3(PRIMAL_OFFSET,k[f].primalOffset),_=0;3>_;++_)this.lineTickEnable[f]&&(O[_]+=u*L[_]*Math.max(this.lineTickLength[_],0)/s[5*_]);if(this.tickEnable[f]){for(var _=0;3>_;++_)O[_]+=u*L[_]*this.tickPad[_]/s[5*_];this._text.drawTicks(f,this.tickSize[f],this.tickAngle[f],O,this.tickColor[f])}if(this.labelEnable[f]){for(var _=0;3>_;++_)O[_]+=u*L[_]*this.labelPad[_]/s[5*_];O[f]+=.5*(n[0][f]+n[1][f]),this._text.drawLabel(f,this.labelSize[f],this.labelAngle[f],O,this.labelColor[f])}}},proto.dispose=function(){this._text.dispose(),this._lines.dispose(),this._background.dispose(),this._lines=null,this._text=null,this._background=null,this.gl=null};

},{"./lib/background.js":112,"./lib/cube.js":113,"./lib/lines.js":114,"./lib/text.js":116,"./lib/ticks.js":117}],112:[function(require,module,exports){
"use strict";function BackgroundCube(e,r,t,o){this.gl=e,this.buffer=r,this.vao=t,this.shader=o}function createBackgroundCube(e){for(var r=[],t=[],o=0,a=0;3>a;++a)for(var s=(a+1)%3,i=(a+2)%3,u=[0,0,0],f=[0,0,0],n=-1;1>=n;n+=2){t.push(o,o+2,o+1,o+1,o+2,o+3),u[a]=n,f[a]=n;for(var d=-1;1>=d;d+=2){u[s]=d;for(var c=-1;1>=c;c+=2)u[i]=c,r.push(u[0],u[1],u[2],f[0],f[1],f[2]),o+=1}var h=s;s=i,i=h}var b=createBuffer(e,new Float32Array(r)),p=createBuffer(e,new Uint16Array(t),e.ELEMENT_ARRAY_BUFFER),l=createVAO(e,[{buffer:b,type:e.FLOAT,size:3,offset:0,stride:24},{buffer:b,type:e.FLOAT,size:3,offset:12,stride:24}],p),v=createShader(e);return v.attributes.position.location=0,v.attributes.normal.location=1,new BackgroundCube(e,b,l,v)}module.exports=createBackgroundCube;var createBuffer=require("gl-buffer"),createVAO=require("gl-vao"),createShader=require("./shaders").bg,proto=BackgroundCube.prototype;proto.draw=function(e,r,t,o,a,s){for(var i=!1,u=0;3>u;++u)i=i||a[u];if(i){var f=this.gl;f.enable(f.POLYGON_OFFSET_FILL),f.polygonOffset(1,2),this.shader.bind(),this.shader.uniforms={model:e,view:r,projection:t,bounds:o,enable:a,colors:s},this.vao.bind(),this.vao.draw(this.gl.TRIANGLES,36),f.disable(f.POLYGON_OFFSET_FILL)}},proto.dispose=function(){this.vao.dispose(),this.buffer.dispose(),this.shader.dispose()};

},{"./shaders":115,"gl-buffer":121,"gl-vao":131}],113:[function(require,module,exports){
"use strict";function transformHg(r,e,t){for(var o=0;4>o;++o){r[o]=t[12+o];for(var u=0;3>u;++u)r[o]+=e[u]*t[4*u+o]}}function polygonArea(r){for(var e=0;e<FRUSTUM_PLANES.length;++e)if(r=splitPoly.positive(r,FRUSTUM_PLANES[e]),r.length<3)return 0;for(var t=r[0],o=t[0]/t[3],u=t[1]/t[3],s=0,e=1;e+1<r.length;++e){var a=r[e],i=r[e+1],v=a[0]/a[3],b=a[1]/a[3],n=i[0]/i[3],f=i[1]/i[3],l=v-o,p=b-u,V=n-o,E=f-u;s+=Math.abs(l*E-p*V)}return s}function getCubeEdges(r,e,t,o){multiply(mvp,e,r),multiply(mvp,t,mvp);for(var u=0,s=0;2>s;++s){x[2]=o[s][2];for(var a=0;2>a;++a){x[1]=o[a][1];for(var i=0;2>i;++i)x[0]=o[i][0],transformHg(pCubeVerts[u],x,mvp),u+=1}}for(var v=-1,s=0;8>s;++s){for(var b=pCubeVerts[s][3],n=0;3>n;++n)cubeVerts[s][n]=pCubeVerts[s][n]/b;0>b&&(0>v?v=s:cubeVerts[s][2]<cubeVerts[v][2]&&(v=s))}if(0>v){v=0;for(var f=0;3>f;++f){for(var l=(f+2)%3,p=(f+1)%3,V=-1,E=-1,c=0;2>c;++c){var g=c<<f,C=g+(c<<l)+(1-c<<p),U=g+(1-c<<l)+(c<<p);orient(cubeVerts[g],cubeVerts[C],cubeVerts[U],zero3)<0||(c?V=1:E=1)}if(0>V||0>E)E>V&&(v|=1<<f);else{for(var c=0;2>c;++c){var g=c<<f,C=g+(c<<l)+(1-c<<p),U=g+(1-c<<l)+(c<<p),m=polygonArea([pCubeVerts[g],pCubeVerts[C],pCubeVerts[U],pCubeVerts[g+(1<<l)+(1<<p)]]);c?V=m:E=m}E>V&&(v|=1<<f)}}}for(var y=7^v,S=-1,s=0;8>s;++s)s!==v&&s!==y&&(0>S?S=s:cubeVerts[S][1]>cubeVerts[s][1]&&(S=s));for(var A=-1,s=0;3>s;++s){var _=S^1<<s;if(_!==v&&_!==y){0>A&&(A=_);var p=cubeVerts[_];p[0]<cubeVerts[A][0]&&(A=_)}}for(var B=-1,s=0;3>s;++s){var _=S^1<<s;if(_!==v&&_!==y&&_!==A){0>B&&(B=_);var p=cubeVerts[_];p[0]>cubeVerts[B][0]&&(B=_)}}var d=CUBE_EDGES;d[0]=d[1]=d[2]=0,d[bits.log2(A^S)]=S&A,d[bits.log2(S^B)]=S&B;var w=7^B;w===v||w===y?(w=7^A,d[bits.log2(B^w)]=w&B):d[bits.log2(A^w)]=w&A;for(var q=CUBE_AXIS,L=v,f=0;3>f;++f)L&1<<f?q[f]=-1:q[f]=1;return CUBE_RESULT}module.exports=getCubeEdges;var bits=require("bit-twiddle"),multiply=require("gl-mat4/multiply"),invert=require("gl-mat4/invert"),splitPoly=require("split-polygon"),orient=require("robust-orientation"),mvp=new Array(16),imvp=new Array(16),pCubeVerts=new Array(8),cubeVerts=new Array(8),x=new Array(3),zero3=[0,0,0];!function(){for(var r=0;8>r;++r)pCubeVerts[r]=[1,1,1,1],cubeVerts[r]=[1,1,1]}();var FRUSTUM_PLANES=[[0,0,1,0,0],[0,0,-1,1,0],[0,-1,0,1,0],[0,1,0,1,0],[-1,0,0,1,0],[1,0,0,1,0]],CUBE_EDGES=[1,1,1],CUBE_AXIS=[0,0,0],CUBE_RESULT={cubeEdges:CUBE_EDGES,axis:CUBE_AXIS};

},{"bit-twiddle":118,"gl-mat4/invert":249,"gl-mat4/multiply":251,"robust-orientation":138,"split-polygon":139}],114:[function(require,module,exports){
"use strict";function zeroVec(r){return r[0]=r[1]=r[2]=0,r}function copyVec(r,s){return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function Lines(r,s,i,e,t,o,h,a){this.gl=r,this.vertBuffer=s,this.vao=i,this.shader=e,this.tickCount=t,this.tickOffset=o,this.gridCount=h,this.gridOffset=a}function createLines(r,s,i){var e=[],t=[0,0,0],o=[0,0,0],h=[0,0,0],a=[0,0,0];e.push(0,0,1,0,1,1,0,0,-1,0,0,-1,0,1,1,0,1,-1);for(var n=0;3>n;++n){for(var f=e.length/3|0,d=0;d<i[n].length;++d){var u=+i[n][d].x;e.push(u,0,1,u,1,1,u,0,-1,u,0,-1,u,1,1,u,1,-1)}var c=e.length/3|0;t[n]=f,o[n]=c-f;for(var f=e.length/3|0,A=0;A<i[n].length;++A){var u=+i[n][A].x;e.push(u,0,1,u,1,1,u,0,-1,u,0,-1,u,1,1,u,1,-1)}var c=e.length/3|0;h[n]=f,a[n]=c-f}var m=createBuffer(r,new Float32Array(e)),S=createVAO(r,[{buffer:m,type:r.FLOAT,size:3,stride:0,offset:0}]),v=createShader(r);return v.attributes.position.location=0,new Lines(r,m,S,v,o,t,a,h)}module.exports=createLines;var createBuffer=require("gl-buffer"),createVAO=require("gl-vao"),createShader=require("./shaders").line,MAJOR_AXIS=[0,0,0],MINOR_AXIS=[0,0,0],SCREEN_AXIS=[0,0,0],OFFSET_VEC=[0,0,0],SHAPE=[1,1],proto=Lines.prototype;proto.bind=function(r,s,i){this.shader.bind(),this.shader.uniforms.model=r,this.shader.uniforms.view=s,this.shader.uniforms.projection=i,SHAPE[0]=this.gl.drawingBufferWidth,SHAPE[1]=this.gl.drawingBufferHeight,this.shader.uniforms.screenShape=SHAPE,this.vao.bind()},proto.drawAxisLine=function(r,s,i,e,t){var o=zeroVec(MINOR_AXIS);this.shader.uniforms.majorAxis=MINOR_AXIS,o[r]=s[1][r]-s[0][r],this.shader.uniforms.minorAxis=o;var h=copyVec(OFFSET_VEC,i);h[r]+=s[0][r],this.shader.uniforms.offset=h,this.shader.uniforms.lineWidth=t,this.shader.uniforms.color=e;var a=zeroVec(SCREEN_AXIS);a[(r+2)%3]=1,this.shader.uniforms.screenAxis=a,this.vao.draw(this.gl.TRIANGLES,6);var a=zeroVec(SCREEN_AXIS);a[(r+1)%3]=1,this.shader.uniforms.screenAxis=a,this.vao.draw(this.gl.TRIANGLES,6)},proto.drawAxisTicks=function(r,s,i,e,t){var o=zeroVec(MAJOR_AXIS);o[r]=1,this.shader.uniforms.majorAxis=o,this.shader.uniforms.offset=s,this.shader.uniforms.minorAxis=i,this.shader.uniforms.color=e,this.shader.uniforms.lineWidth=t;var h=zeroVec(SCREEN_AXIS);h[r]=1,this.shader.uniforms.screenAxis=h,this.vao.draw(this.gl.TRIANGLES,this.tickCount[r],this.tickOffset[r])},proto.drawGrid=function(r,s,i,e,t,o){var h=zeroVec(MINOR_AXIS);h[s]=i[1][s]-i[0][s],this.shader.uniforms.minorAxis=h;var a=copyVec(OFFSET_VEC,e);a[s]+=i[0][s],this.shader.uniforms.offset=a;var n=zeroVec(MAJOR_AXIS);n[r]=1,this.shader.uniforms.majorAxis=n;var f=zeroVec(SCREEN_AXIS);f[r]=1,this.shader.uniforms.screenAxis=f,this.shader.uniforms.lineWidth=o,this.shader.uniforms.color=t,this.vao.draw(this.gl.TRIANGLES,this.gridCount[r],this.gridOffset[r])},proto.drawZero=function(r,s,i,e,t,o){var h=zeroVec(MINOR_AXIS);this.shader.uniforms.majorAxis=h,h[r]=i[1][r]-i[0][r],this.shader.uniforms.minorAxis=h;var a=copyVec(OFFSET_VEC,e);a[r]+=i[0][r],this.shader.uniforms.offset=a;var n=zeroVec(SCREEN_AXIS);n[s]=1,this.shader.uniforms.screenAxis=n,this.shader.uniforms.lineWidth=o,this.shader.uniforms.color=t,this.vao.draw(this.gl.TRIANGLES,6)},proto.dispose=function(){this.vao.dispose(),this.vertBuffer.dispose(),this.shader.dispose()};

},{"./shaders":115,"gl-buffer":121,"gl-vao":131}],115:[function(require,module,exports){
"use strict";var createShader=require("gl-shader"),lineVert="#define GLSLIFY 1\nattribute vec3 position;\n\nuniform mat4 model, view, projection;\nuniform vec3 offset, majorAxis, minorAxis, screenAxis;\nuniform float lineWidth;\nuniform vec2 screenShape;\n\nvec3 project(vec3 p) {\n  vec4 pp = projection * view * model * vec4(p, 1.0);\n  return pp.xyz / max(pp.w, 0.0001);\n}\n\nvoid main() {\n  vec3 major = position.x * majorAxis;\n  vec3 minor = position.y * minorAxis;\n\n  vec3 vPosition = major + minor + offset;\n  vec3 pPosition = project(vPosition);\n  vec3 offset = project(vPosition + screenAxis * position.z);\n\n  vec2 screen = normalize((offset - pPosition).xy * screenShape) / screenShape;\n\n  gl_Position = vec4(pPosition + vec3(0.5 * screen * lineWidth, 0), 1.0);\n}\n",lineFrag="#define GLSLIFY 1\nprecision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}";exports.line=function(n){return createShader(n,lineVert,lineFrag,null,[{name:"position",type:"vec3"}])};var textVert="#define GLSLIFY 1\nattribute vec3 position;\n\nuniform mat4 model, view, projection;\nuniform vec3 offset, axis;\nuniform float scale, angle, pixelScale;\nuniform vec2 resolution;\n\nvoid main() {  \n  //Compute plane offset\n  vec2 planeCoord = position.xy * pixelScale;\n  mat2 planeXform = scale * mat2(cos(angle), sin(angle),\n                                -sin(angle), cos(angle));\n  vec2 viewOffset = 2.0 * planeXform * planeCoord / resolution;\n\n  //Compute world offset\n  float axisDistance = position.z;\n  vec3 dataPosition = axisDistance * axis + offset;\n  vec4 worldPosition = model * vec4(dataPosition, 1);\n  \n  //Compute clip position\n  vec4 viewPosition = view * worldPosition;\n  vec4 clipPosition = projection * viewPosition;\n  clipPosition /= clipPosition.w;\n\n  //Apply text offset in clip coordinates\n  clipPosition += vec4(viewOffset, 0, 0);\n\n  //Done\n  gl_Position = clipPosition;\n}",textFrag="#define GLSLIFY 1\nprecision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}";exports.text=function(n){return createShader(n,textVert,textFrag,null,[{name:"position",type:"vec3"}])};var bgVert="#define GLSLIFY 1\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 model, view, projection;\nuniform vec3 enable;\nuniform vec3 bounds[2];\n\nvarying vec3 colorChannel;\n\nvoid main() {\n  if(dot(normal, enable) > 0.0) {\n    vec3 nPosition = mix(bounds[0], bounds[1], 0.5 * (position + 1.0));\n    gl_Position = projection * view * model * vec4(nPosition, 1.0);\n  } else {\n    gl_Position = vec4(0,0,0,0);\n  }\n  colorChannel = abs(normal);\n}",bgFrag="#define GLSLIFY 1\nprecision mediump float;\n\nuniform vec4 colors[3];\n\nvarying vec3 colorChannel;\n\nvoid main() {\n  gl_FragColor = colorChannel.x * colors[0] + \n                 colorChannel.y * colors[1] +\n                 colorChannel.z * colors[2];\n}";exports.bg=function(n){return createShader(n,bgVert,bgFrag,null,[{name:"position",type:"vec3"},{name:"normal",type:"vec3"}])};

},{"gl-shader":269}],116:[function(require,module,exports){
(function (process){
"use strict";function TextSprites(t,e,r,i){this.gl=t,this.shader=e,this.buffer=r,this.vao=i,this.tickOffset=this.tickCount=this.labelOffset=this.labelCount=null}function tryVectorizeText(t,e){try{return vectorizeText(t,e)}catch(r){return console.warn("error vectorizing text:",r),{cells:[],positions:[]}}}function createTextSprites(t,e,r,i,s,o){var a=createBuffer(t),n=createVAO(t,[{buffer:a,size:3}]),h=createShader(t);h.attributes.position.location=0;var f=new TextSprites(t,h,a,n);return f.update(e,r,i,s,o),f}module.exports=createTextSprites;var createBuffer=require("gl-buffer"),createVAO=require("gl-vao"),vectorizeText=require("vectorize-text"),createShader=require("./shaders").text,globals=window||process.global||{},__TEXT_CACHE=globals.__TEXT_CACHE||{};globals.__TEXT_CACHE={};var VERTEX_SIZE=3,VERTEX_STRIDE=4*VERTEX_SIZE,proto=TextSprites.prototype,SHAPE=[0,0];proto.bind=function(t,e,r,i){this.vao.bind(),this.shader.bind();var s=this.shader.uniforms;s.model=t,s.view=e,s.projection=r,s.pixelScale=i,SHAPE[0]=this.gl.drawingBufferWidth,SHAPE[1]=this.gl.drawingBufferHeight,this.shader.uniforms.resolution=SHAPE},proto.update=function(t,e,r,i,s){function o(t,e,r,i){var s=__TEXT_CACHE[r];s||(s=__TEXT_CACHE[r]={});var o=s[e];o||(o=s[e]=tryVectorizeText(e,{triangles:!0,font:r,textAlign:"center",textBaseline:"middle"}));for(var n=(i||12)/12,h=o.positions,f=o.cells,l=0,u=f.length;u>l;++l)for(var c=f[l],d=2;d>=0;--d){var E=h[c[d]];a.push(n*E[0],-n*E[1],t)}}for(var a=(this.gl,[]),n=[0,0,0],h=[0,0,0],f=[0,0,0],l=[0,0,0],u=0;3>u;++u){f[u]=a.length/VERTEX_SIZE|0,o(.5*(t[0][u]+t[1][u]),e[u],r),l[u]=(a.length/VERTEX_SIZE|0)-f[u],n[u]=a.length/VERTEX_SIZE|0;for(var c=0;c<i[u].length;++c)i[u][c].text&&o(i[u][c].x,i[u][c].text,i[u][c].font||s,i[u][c].fontSize||12);h[u]=(a.length/VERTEX_SIZE|0)-n[u]}this.buffer.update(a),this.tickOffset=n,this.tickCount=h,this.labelOffset=f,this.labelCount=l};var AXIS=[0,0,0];proto.drawTicks=function(t,e,r,i,s){var o=AXIS;o[0]=o[1]=o[2]=0,o[t]=1,this.shader.uniforms.axis=o,this.shader.uniforms.color=s,this.shader.uniforms.angle=r,this.shader.uniforms.scale=e,this.shader.uniforms.offset=i,this.vao.draw(this.gl.TRIANGLES,this.tickCount[t],this.tickOffset[t])};var ZERO=[0,0,0];proto.drawLabel=function(t,e,r,i,s){this.shader.uniforms.axis=ZERO,this.shader.uniforms.color=s,this.shader.uniforms.angle=r,this.shader.uniforms.scale=e,this.shader.uniforms.offset=i,this.vao.draw(this.gl.TRIANGLES,this.labelCount[t],this.labelOffset[t])},proto.dispose=function(){this.shader.dispose(),this.vao.dispose(),this.buffer.dispose()};

}).call(this,require('_process'))
},{"./shaders":115,"_process":12,"gl-buffer":121,"gl-vao":131,"vectorize-text":143}],117:[function(require,module,exports){
"use strict";function prettyPrint(t,r){var e=t+"",n=e.indexOf("."),a=0;n>=0&&(a=e.length-n-1);var u=Math.pow(10,a),f=Math.round(t*r*u),i=f+"";if(i.indexOf("e")>=0)return i;var o=f/u,h=f%u;0>f?(o=0|-Math.ceil(o),h=0|-h):(o=0|Math.floor(o),h=0|h);var l=""+o;if(0>f&&(l="-"+l),a){for(var x=""+h;x.length<a;)x="0"+x;return l+"."+x}return l}function defaultTicks(t,r){for(var e=[],n=0;3>n;++n){for(var a=[],u=(.5*(t[0][n]+t[1][n]),0);u*r[n]<=t[1][n];++u)a.push({x:u*r[n],text:prettyPrint(r[n],u)});for(var u=-1;u*r[n]>=t[0][n];--u)a.push({x:u*r[n],text:prettyPrint(r[n],u)});e.push(a)}return e}function ticksEqual(t,r){for(var e=0;3>e;++e){if(t[e].length!==r[e].length)return!1;for(var n=0;n<t[e].length;++n){var a=t[e][n],u=r[e][n];if(a.x!==u.x||a.text!==u.text)return!1}}return!0}exports.create=defaultTicks,exports.equal=ticksEqual;

},{}],118:[function(require,module,exports){
"use strict";"use restrict";function countTrailingZeros(r){var n=32;return r&=-r,r&&n--,65535&r&&(n-=16),16711935&r&&(n-=8),252645135&r&&(n-=4),858993459&r&&(n-=2),1431655765&r&&(n-=1),n}var INT_BITS=32;exports.INT_BITS=INT_BITS,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<INT_BITS-1,exports.sign=function(r){return(r>0)-(0>r)},exports.abs=function(r){var n=r>>INT_BITS-1;return(r^n)-n},exports.min=function(r,n){return n^(r^n)&-(n>r)},exports.max=function(r,n){return r^(r^n)&-(n>r)},exports.isPow2=function(r){return!(r&r-1||!r)},exports.log2=function(r){var n,t;return n=(r>65535)<<4,r>>>=n,t=(r>255)<<3,r>>>=t,n|=t,t=(r>15)<<2,r>>>=t,n|=t,t=(r>3)<<1,r>>>=t,n|=t,n|r>>1},exports.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},exports.popCount=function(r){return r-=r>>>1&1431655765,r=(858993459&r)+(r>>>2&858993459),16843009*(r+(r>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1},exports.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r-(r>>>1)},exports.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,r&=15,27030>>>r&1};var REVERSE_TABLE=new Array(256);!function(r){for(var n=0;256>n;++n){var t=n,e=n,o=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--o;r[n]=e<<o&255}}(REVERSE_TABLE),exports.reverse=function(r){return REVERSE_TABLE[255&r]<<24|REVERSE_TABLE[r>>>8&255]<<16|REVERSE_TABLE[r>>>16&255]<<8|REVERSE_TABLE[r>>>24&255]},exports.interleave2=function(r,n){return r&=65535,r=16711935&(r|r<<8),r=252645135&(r|r<<4),r=858993459&(r|r<<2),r=1431655765&(r|r<<1),n&=65535,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),r|n<<1},exports.deinterleave2=function(r,n){return r=r>>>n&1431655765,r=858993459&(r|r>>>1),r=252645135&(r|r>>>2),r=16711935&(r|r>>>4),r=65535&(r|r>>>16),r<<16>>16},exports.interleave3=function(r,n,t){return r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),n&=1023,n=4278190335&(n|n<<16),n=251719695&(n|n<<8),n=3272356035&(n|n<<4),n=1227133513&(n|n<<2),r|=n<<1,t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),r|t<<2},exports.deinterleave3=function(r,n){return r=r>>>n&1227133513,r=3272356035&(r|r>>>2),r=251719695&(r|r>>>4),r=4278190335&(r|r>>>8),r=1023&(r|r>>>16),r<<22>>22},exports.nextCombination=function(r){var n=r|r-1;return n+1|(~n&-~n)-1>>>countTrailingZeros(r)+1};

},{}],119:[function(require,module,exports){
"use strict";function dupe_array(e,r,u){var n=0|e[u];if(0>=n)return[];var t,a=new Array(n);if(u===e.length-1)for(t=0;n>t;++t)a[t]=r;else for(t=0;n>t;++t)a[t]=dupe_array(e,r,u+1);return a}function dupe_number(e,r){var u,n;for(u=new Array(e),n=0;e>n;++n)u[n]=r;return u}function dupe(e,r){switch("undefined"==typeof r&&(r=0),typeof e){case"number":if(e>0)return dupe_number(0|e,r);break;case"object":if("number"==typeof e.length)return dupe_array(e,r,0)}return[]}module.exports=dupe;

},{}],120:[function(require,module,exports){
"use strict";function extractPlanes(t,e,r){var a=e||0,n=r||1;return[[t[12]+t[0],t[13]+t[1],t[14]+t[2],t[15]+t[3]],[t[12]-t[0],t[13]-t[1],t[14]-t[2],t[15]-t[3]],[t[12]+t[4],t[13]+t[5],t[14]+t[6],t[15]+t[7]],[t[12]-t[4],t[13]-t[5],t[14]-t[6],t[15]-t[7]],[a*t[12]+t[8],a*t[13]+t[9],a*t[14]+t[10],a*t[15]+t[11]],[n*t[12]-t[8],n*t[13]-t[9],n*t[14]-t[10],n*t[15]-t[11]]]}module.exports=extractPlanes;

},{}],121:[function(require,module,exports){
"use strict";function GLBuffer(e,t,r,i,s){this.gl=e,this.type=t,this.handle=r,this.length=i,this.usage=s}function updateTypeArray(e,t,r,i,s,a){var n=s.length*s.BYTES_PER_ELEMENT;if(0>a)return e.bufferData(t,s,i),n;if(n+a>r)throw new Error("gl-buffer: If resizing buffer, must not specify offset");return e.bufferSubData(t,a,s),r}function makeScratchTypeArray(e,t){for(var r=pool.malloc(e.length,t),i=e.length,s=0;i>s;++s)r[s]=e[s];return r}function isPacked(e,t){for(var r=1,i=t.length-1;i>=0;--i){if(t[i]!==r)return!1;r*=e[i]}return!0}function createBuffer(e,t,r,i){if(r=r||e.ARRAY_BUFFER,i=i||e.DYNAMIC_DRAW,r!==e.ARRAY_BUFFER&&r!==e.ELEMENT_ARRAY_BUFFER)throw new Error("gl-buffer: Invalid type for webgl buffer, must be either gl.ARRAY_BUFFER or gl.ELEMENT_ARRAY_BUFFER");if(i!==e.DYNAMIC_DRAW&&i!==e.STATIC_DRAW&&i!==e.STREAM_DRAW)throw new Error("gl-buffer: Invalid usage for buffer, must be either gl.DYNAMIC_DRAW, gl.STATIC_DRAW or gl.STREAM_DRAW");var s=e.createBuffer(),a=new GLBuffer(e,r,s,0,i);return a.update(t),a}var pool=require("typedarray-pool"),ops=require("ndarray-ops"),ndarray=require("ndarray"),SUPPORTED_TYPES=["uint8","uint8_clamped","uint16","uint32","int8","int16","int32","float32"],proto=GLBuffer.prototype;proto.bind=function(){this.gl.bindBuffer(this.type,this.handle)},proto.unbind=function(){this.gl.bindBuffer(this.type,null)},proto.dispose=function(){this.gl.deleteBuffer(this.handle)},proto.update=function(e,t){if("number"!=typeof t&&(t=-1),this.bind(),"object"==typeof e&&"undefined"!=typeof e.shape){var r=e.dtype;if(SUPPORTED_TYPES.indexOf(r)<0&&(r="float32"),this.type===this.gl.ELEMENT_ARRAY_BUFFER){var i=gl.getExtension("OES_element_index_uint");r=i&&"uint16"!==r?"uint32":"uint16"}if(r===e.dtype&&isPacked(e.shape,e.stride))0===e.offset&&e.data.length===e.shape[0]?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e.data,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e.data.subarray(e.offset,e.shape[0]),t);else{var s=pool.malloc(e.size,r),a=ndarray(s,e.shape);ops.assign(a,e),0>t?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,s,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,s.subarray(0,e.size),t),pool.free(s)}}else if(Array.isArray(e)){var n;n=this.type===this.gl.ELEMENT_ARRAY_BUFFER?makeScratchTypeArray(e,"uint16"):makeScratchTypeArray(e,"float32"),0>t?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,n,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,n.subarray(0,e.length),t),pool.free(n)}else if("object"==typeof e&&"number"==typeof e.length)this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e,t);else{if("number"!=typeof e&&void 0!==e)throw new Error("gl-buffer: Invalid data type");if(t>=0)throw new Error("gl-buffer: Cannot specify offset when resizing buffer");e=0|e,0>=e&&(e=1),this.gl.bufferData(this.type,0|e,this.usage),this.length=e}},module.exports=createBuffer;

},{"ndarray":296,"ndarray-ops":122,"typedarray-pool":127}],122:[function(require,module,exports){
"use strict";function fixup(a){if(!a)return EmptyProc;for(var r=0;r<a.args.length;++r){var s=a.args[r];0===r?a.args[r]={name:s,lvalue:!0,rvalue:!!a.rvalue,count:a.count||1}:a.args[r]={name:s,lvalue:!1,rvalue:!0,count:1}}return a.thisVars||(a.thisVars=[]),a.localVars||(a.localVars=[]),a}function pcompile(a){return compile({args:a.args,pre:fixup(a.pre),body:fixup(a.body),post:fixup(a.proc),funcName:a.funcName})}function makeOp(a){for(var r=[],s=0;s<a.args.length;++s)r.push("a"+s);var i=new Function("P",["return function ",a.funcName,"_ndarrayops(",r.join(","),") {P(",r.join(","),");return a0}"].join(""));return i(pcompile(a))}var compile=require("cwise-compiler"),EmptyProc={body:"",args:[],thisVars:[],localVars:[]},assign_ops={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var a in assign_ops){var r=assign_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:a+"eq"}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:a+"seq"})}}();var unary_ops={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var a in unary_ops){var r=unary_ops[a];exports[a]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:a}),exports[a+"eq"]=makeOp({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:a+"eq"})}}();var binary_ops={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var a in binary_ops){var r=binary_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:a+"eq"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:a+"seq"})}}();var math_unary=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var a=0;a<math_unary.length;++a){var r=math_unary[a];exports[r]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),exports[r+"eq"]=makeOp({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var math_comm=["max","min","atan2","pow"];!function(){for(var a=0;a<math_comm.length;++a){var r=math_comm[a];exports[r]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),exports[r+"s"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),exports[r+"eq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),exports[r+"seq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var math_noncomm=["atan2","pow"];!function(){for(var a=0;a<math_noncomm.length;++a){var r=math_noncomm[a];exports[r+"op"]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),exports[r+"ops"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),exports[r+"opeq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),exports[r+"opseq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),exports.any=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),exports.all=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),exports.sum=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),exports.prod=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),exports.norm2squared=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),exports.norm2=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),exports.norminf=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),exports.norm1=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),exports.sup=compile({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.inf=compile({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.argmin=compile({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.argmax=compile({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.random=makeOp({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),exports.assign=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),exports.assigns=makeOp({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),exports.equals=compile({args:["array","array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"});

},{"cwise-compiler":123}],123:[function(require,module,exports){
"use strict";function Procedure(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function compileCwise(r){var e=new Procedure;e.pre=r.pre,e.body=r.body,e.post=r.post;var s=r.args.slice(0);e.argTypes=s;for(var o=0;o<s.length;++o){var a=s[o];if("array"===a||"object"==typeof a&&a.blockIndices){if(e.argTypes[o]="array",e.arrayArgs.push(o),e.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),e.shimArgs.push("array"+o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===a)e.scalarArgs.push(o),e.shimArgs.push("scalar"+o);else if("index"===a){if(e.indexArgs.push(o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===a){if(e.shapeArgs.push(o),o<e.pre.args.length&&e.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<e.post.args.length&&e.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof a||!a.offset)throw new Error("cwise: Unknown argument type "+s[o]);e.argTypes[o]="offset",e.offsetArgs.push({array:a.array,offset:a.offset}),e.offsetArgIndex.push(o)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>s.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>s.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>s.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!r.printCode||!!r.debug,e.funcName=r.funcName||"cwise",e.blockSize=r.blockSize||64,createThunk(e)}var createThunk=require("./lib/thunk.js");module.exports=compileCwise;

},{"./lib/thunk.js":125}],124:[function(require,module,exports){
"use strict";function innerFill(r,n,e){var s,a,o=r.length,i=n.arrayArgs.length,t=n.indexArgs.length>0,p=[],h=[],u=0,c=0;for(s=0;o>s;++s)h.push(["i",s,"=0"].join(""));for(a=0;i>a;++a)for(s=0;o>s;++s)c=u,u=r[s],0===s?h.push(["d",a,"s",s,"=t",a,"p",u].join("")):h.push(["d",a,"s",s,"=(t",a,"p",u,"-s",c,"*t",a,"p",c,")"].join(""));for(p.push("var "+h.join(",")),s=o-1;s>=0;--s)u=r[s],p.push(["for(i",s,"=0;i",s,"<s",u,";++i",s,"){"].join(""));for(p.push(e),s=0;o>s;++s){for(c=u,u=r[s],a=0;i>a;++a)p.push(["p",a,"+=d",a,"s",s].join(""));t&&(s>0&&p.push(["index[",c,"]-=s",c].join("")),p.push(["++index[",u,"]"].join(""))),p.push("}")}return p.join("\n")}function outerFill(r,n,e,s){for(var a=n.length,o=e.arrayArgs.length,i=e.blockSize,t=e.indexArgs.length>0,p=[],h=0;o>h;++h)p.push(["var offset",h,"=p",h].join(""));for(var h=r;a>h;++h)p.push(["for(var j"+h+"=SS[",n[h],"]|0;j",h,">0;){"].join("")),p.push(["if(j",h,"<",i,"){"].join("")),p.push(["s",n[h],"=j",h].join("")),p.push(["j",h,"=0"].join("")),p.push(["}else{s",n[h],"=",i].join("")),p.push(["j",h,"-=",i,"}"].join("")),t&&p.push(["index[",n[h],"]=j",h].join(""));for(var h=0;o>h;++h){for(var u=["offset"+h],c=r;a>c;++c)u.push(["j",c,"*t",h,"p",n[c]].join(""));p.push(["p",h,"=(",u.join("+"),")"].join(""))}p.push(innerFill(n,e,s));for(var h=r;a>h;++h)p.push("}");return p.join("\n")}function countMatches(r){for(var n=0,e=r[0].length;e>n;){for(var s=1;s<r.length;++s)if(r[s][n]!==r[0][n])return n;++n}return n}function processBlock(r,n,e){for(var s=r.body,a=[],o=[],i=0;i<r.args.length;++i){var t=r.args[i];if(!(t.count<=0)){var p=new RegExp(t.name,"g"),h="",u=n.arrayArgs.indexOf(i);switch(n.argTypes[i]){case"offset":var c=n.offsetArgIndex.indexOf(i),l=n.offsetArgs[c];u=l.array,h="+q"+c;case"array":h="p"+u+h;var f="l"+i,g="a"+u;if(0===n.arrayBlockIndices[u])1===t.count?"generic"===e[u]?t.lvalue?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),o.push([g,".set(",h,",",f,")"].join(""))):s=s.replace(p,[g,".get(",h,")"].join("")):s=s.replace(p,[g,"[",h,"]"].join("")):"generic"===e[u]?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,".set(",h,",",f,")"].join(""))):(a.push(["var ",f,"=",g,"[",h,"]"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,"[",h,"]=",f].join("")));else{for(var j=[t.name],v=[h],y=0;y<Math.abs(n.arrayBlockIndices[u]);y++)j.push("\\s*\\[([^\\]]+)\\]"),v.push("$"+(y+1)+"*t"+u+"b"+y);if(p=new RegExp(j.join(""),"g"),h=v.join("+"),"generic"===e[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");s=s.replace(p,[g,"[",h,"]"].join(""))}break;case"scalar":s=s.replace(p,"Y"+n.scalarArgs.indexOf(i));break;case"index":s=s.replace(p,"index");break;case"shape":s=s.replace(p,"shape")}}}return[a.join("\n"),s,o.join("\n")].join("\n").trim()}function typeSummary(r){for(var n=new Array(r.length),e=!0,s=0;s<r.length;++s){var a=r[s],o=a.match(/\d+/);o=o?o[0]:"",0===a.charAt(0)?n[s]="u"+a.charAt(1)+o:n[s]=a.charAt(0)+o,s>0&&(e=e&&n[s]===n[s-1])}return e?n[0]:n.join("")}function generateCWiseOp(r,n){for(var e=n[1].length-Math.abs(r.arrayBlockIndices[0])|0,s=new Array(r.arrayArgs.length),a=new Array(r.arrayArgs.length),o=0;o<r.arrayArgs.length;++o)a[o]=n[2*o],s[o]=n[2*o+1];for(var i=[],t=[],p=[],h=[],u=[],o=0;o<r.arrayArgs.length;++o){r.arrayBlockIndices[o]<0?(p.push(0),h.push(e),i.push(e),t.push(e+r.arrayBlockIndices[o])):(p.push(r.arrayBlockIndices[o]),h.push(r.arrayBlockIndices[o]+e),i.push(0),t.push(r.arrayBlockIndices[o]));for(var c=[],l=0;l<s[o].length;l++)p[o]<=s[o][l]&&s[o][l]<h[o]&&c.push(s[o][l]-p[o]);u.push(c)}for(var f=["SS"],g=["'use strict'"],j=[],l=0;e>l;++l)j.push(["s",l,"=SS[",l,"]"].join(""));for(var o=0;o<r.arrayArgs.length;++o){f.push("a"+o),f.push("t"+o),f.push("p"+o);for(var l=0;e>l;++l)j.push(["t",o,"p",l,"=t",o,"[",p[o]+l,"]"].join(""));for(var l=0;l<Math.abs(r.arrayBlockIndices[o]);++l)j.push(["t",o,"b",l,"=t",o,"[",i[o]+l,"]"].join(""))}for(var o=0;o<r.scalarArgs.length;++o)f.push("Y"+o);if(r.shapeArgs.length>0&&j.push("shape=SS.slice(0)"),r.indexArgs.length>0){for(var v=new Array(e),o=0;e>o;++o)v[o]="0";j.push(["index=[",v.join(","),"]"].join(""))}for(var o=0;o<r.offsetArgs.length;++o){for(var y=r.offsetArgs[o],d=[],l=0;l<y.offset.length;++l)0!==y.offset[l]&&(1===y.offset[l]?d.push(["t",y.array,"p",l].join("")):d.push([y.offset[l],"*t",y.array,"p",l].join("")));0===d.length?j.push("q"+o+"=0"):j.push(["q",o,"=",d.join("+")].join(""))}var A=uniq([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));j=j.concat(A),g.push("var "+j.join(","));for(var o=0;o<r.arrayArgs.length;++o)g.push("p"+o+"|=0");r.pre.body.length>3&&g.push(processBlock(r.pre,r,a));var k=processBlock(r.body,r,a),b=countMatches(u);e>b?g.push(outerFill(b,u[0],r,k)):g.push(innerFill(u[0],r,k)),r.post.body.length>3&&g.push(processBlock(r.post,r,a)),r.debug&&console.log("-----Generated cwise routine for ",n,":\n"+g.join("\n")+"\n----------");var x=[r.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",b,typeSummary(a)].join(""),w=new Function(["function ",x,"(",f.join(","),"){",g.join("\n"),"} return ",x].join(""));return w()}var uniq=require("uniq");module.exports=generateCWiseOp;

},{"uniq":126}],125:[function(require,module,exports){
"use strict";function createThunk(r){var a=["'use strict'","var CACHED={}"],e=[],s=r.funcName+"_cwise_thunk";a.push(["return function ",s,"(",r.shimArgs.join(","),"){"].join(""));for(var n=[],o=[],h=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],i=[],p=[],t=0;t<r.arrayArgs.length;++t){var c=r.arrayArgs[t];e.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),n.push("t"+c),n.push("r"+c),o.push("t"+c),o.push("r"+c+".join()"),h.push("array"+c+".data"),h.push("array"+c+".stride"),h.push("array"+c+".offset|0"),t>0&&(i.push("array"+r.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[t]))),p.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[t])+"]"))}r.arrayArgs.length>1&&(a.push("if (!("+i.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),a.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),a.push("if (!("+p.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),a.push("}"));for(var t=0;t<r.scalarArgs.length;++t)h.push("scalar"+r.scalarArgs[t]);e.push(["type=[",o.join(","),"].join()"].join("")),e.push("proc=CACHED[type]"),a.push("var "+e.join(",")),a.push(["if(!proc){","CACHED[type]=proc=compile([",n.join(","),"])}","return proc(",h.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+a.join("\n")+"\n----------");var u=new Function("compile",a.join("\n"));return u(compile.bind(void 0,r))}var compile=require("./compile.js");module.exports=createThunk;

},{"./compile.js":124}],126:[function(require,module,exports){
"use strict";function unique_pred(n,e){for(var u=1,t=n.length,i=n[0],r=n[0],o=1;t>o;++o)if(r=i,i=n[o],e(i,r)){if(o===u){u++;continue}n[u++]=i}return n.length=u,n}function unique_eq(n){for(var e=1,u=n.length,t=n[0],i=n[0],r=1;u>r;++r,i=t)if(i=t,t=n[r],t!==i){if(r===e){e++;continue}n[e++]=t}return n.length=e,n}function unique(n,e,u){return 0===n.length?n:e?(u||n.sort(e),unique_pred(n,e)):(u||n.sort(),unique_eq(n))}module.exports=unique;

},{}],127:[function(require,module,exports){
(function (global,Buffer){
"use strict";function freeArrayBuffer(r){if(r){var e=r.length||r.byteLength,t=bits.log2(e);DATA[t].push(r)}}function freeTypedArray(r){freeArrayBuffer(r.buffer)}function mallocArrayBuffer(r){var r=bits.nextPow2(r),e=bits.log2(r),t=DATA[e];return t.length>0?t.pop():new ArrayBuffer(r)}function mallocUint8(r){return new Uint8Array(mallocArrayBuffer(r),0,r)}function mallocUint16(r){return new Uint16Array(mallocArrayBuffer(2*r),0,r)}function mallocUint32(r){return new Uint32Array(mallocArrayBuffer(4*r),0,r)}function mallocInt8(r){return new Int8Array(mallocArrayBuffer(r),0,r)}function mallocInt16(r){return new Int16Array(mallocArrayBuffer(2*r),0,r)}function mallocInt32(r){return new Int32Array(mallocArrayBuffer(4*r),0,r)}function mallocFloat(r){return new Float32Array(mallocArrayBuffer(4*r),0,r)}function mallocDouble(r){return new Float64Array(mallocArrayBuffer(8*r),0,r)}function mallocUint8Clamped(r){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(r),0,r):mallocUint8(r)}function mallocDataView(r){return new DataView(mallocArrayBuffer(r),0,r)}function mallocBuffer(r){r=bits.nextPow2(r);var e=bits.log2(r),t=BUFFER[e];return t.length>0?t.pop():new Buffer(r)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(r){if(Buffer.isBuffer(r))BUFFER[bits.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var e=r.length||r.byteLength,t=0|bits.log2(e);DATA[t].push(r)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(r){BUFFER[bits.log2(r.length)].push(r)},exports.malloc=function(r,e){if(void 0===e||"arraybuffer"===e)return mallocArrayBuffer(r);switch(e){case"uint8":return mallocUint8(r);case"uint16":return mallocUint16(r);case"uint32":return mallocUint32(r);case"int8":return mallocInt8(r);case"int16":return mallocInt16(r);case"int32":return mallocInt32(r);case"float":case"float32":return mallocFloat(r);case"double":case"float64":return mallocDouble(r);case"uint8_clamped":return mallocUint8Clamped(r);case"buffer":return mallocBuffer(r);case"data":case"dataview":return mallocDataView(r);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var r=0;32>r;++r)POOL.UINT8[r].length=0,POOL.UINT16[r].length=0,POOL.UINT32[r].length=0,POOL.INT8[r].length=0,POOL.INT16[r].length=0,POOL.INT32[r].length=0,POOL.FLOAT[r].length=0,POOL.DOUBLE[r].length=0,POOL.UINT8C[r].length=0,DATA[r].length=0,BUFFER[r].length=0};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"bit-twiddle":118,"buffer":5,"dup":119}],128:[function(require,module,exports){
"use strict";function doBind(e,r,t){r?r.bind():e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);var i=0|e.getParameter(e.MAX_VERTEX_ATTRIBS);if(t){if(t.length>i)throw new Error("gl-vao: Too many vertex attributes");for(var f=0;f<t.length;++f){var l=t[f];if(l.buffer){var n=l.buffer,b=l.size||4,a=l.type||e.FLOAT,A=!!l.normalized,o=l.stride||0,s=l.offset||0;n.bind(),e.enableVertexAttribArray(f),e.vertexAttribPointer(f,b,a,A,o,s)}else{if("number"==typeof l)e.vertexAttrib1f(f,l);else if(1===l.length)e.vertexAttrib1f(f,l[0]);else if(2===l.length)e.vertexAttrib2f(f,l[0],l[1]);else if(3===l.length)e.vertexAttrib3f(f,l[0],l[1],l[2]);else{if(4!==l.length)throw new Error("gl-vao: Invalid vertex attribute");e.vertexAttrib4f(f,l[0],l[1],l[2],l[3])}e.disableVertexAttribArray(f)}}for(;i>f;++f)e.disableVertexAttribArray(f)}else{e.bindBuffer(e.ARRAY_BUFFER,null);for(var f=0;i>f;++f)e.disableVertexAttribArray(f)}}module.exports=doBind;

},{}],129:[function(require,module,exports){
"use strict";function VAOEmulated(t){this.gl=t,this._elements=null,this._attributes=null,this._elementsType=t.UNSIGNED_SHORT}function createVAOEmulated(t){return new VAOEmulated(t)}var bindAttribs=require("./do-bind.js");VAOEmulated.prototype.bind=function(){bindAttribs(this.gl,this._elements,this._attributes)},VAOEmulated.prototype.update=function(t,e,i){this._elements=e,this._attributes=t,this._elementsType=i||this.gl.UNSIGNED_SHORT},VAOEmulated.prototype.dispose=function(){},VAOEmulated.prototype.unbind=function(){},VAOEmulated.prototype.draw=function(t,e,i){i=i||0;var s=this.gl;this._elements?s.drawElements(t,e,this._elementsType,i):s.drawArrays(t,i,e)},module.exports=createVAOEmulated;

},{"./do-bind.js":128}],130:[function(require,module,exports){
"use strict";function VertexAttribute(t,e,i,s,r,n){this.location=t,this.dimension=e,this.a=i,this.b=s,this.c=r,this.d=n}function VAONative(t,e,i){this.gl=t,this._ext=e,this.handle=i,this._attribs=[],this._useElements=!1,this._elementsType=t.UNSIGNED_SHORT}function createVAONative(t,e){return new VAONative(t,e,e.createVertexArrayOES())}var bindAttribs=require("./do-bind.js");VertexAttribute.prototype.bind=function(t){switch(this.dimension){case 1:t.vertexAttrib1f(this.location,this.a);break;case 2:t.vertexAttrib2f(this.location,this.a,this.b);break;case 3:t.vertexAttrib3f(this.location,this.a,this.b,this.c);break;case 4:t.vertexAttrib4f(this.location,this.a,this.b,this.c,this.d)}},VAONative.prototype.bind=function(){this._ext.bindVertexArrayOES(this.handle);for(var t=0;t<this._attribs.length;++t)this._attribs[t].bind(this.gl)},VAONative.prototype.unbind=function(){this._ext.bindVertexArrayOES(null)},VAONative.prototype.dispose=function(){this._ext.deleteVertexArrayOES(this.handle)},VAONative.prototype.update=function(t,e,i){if(this.bind(),bindAttribs(this.gl,e,t),this.unbind(),this._attribs.length=0,t)for(var s=0;s<t.length;++s){var r=t[s];"number"==typeof r?this._attribs.push(new VertexAttribute(s,1,r)):Array.isArray(r)&&this._attribs.push(new VertexAttribute(s,r.length,r[0],r[1],r[2],r[3]))}this._useElements=!!e,this._elementsType=i||this.gl.UNSIGNED_SHORT},VAONative.prototype.draw=function(t,e,i){i=i||0;var s=this.gl;this._useElements?s.drawElements(t,e,this._elementsType,i):s.drawArrays(t,i,e)},module.exports=createVAONative;

},{"./do-bind.js":128}],131:[function(require,module,exports){
"use strict";function createVAO(e,t,a,r){var i,u=e.getExtension("OES_vertex_array_object");return i=u?createVAONative(e,u):createVAOEmulated(e),i.update(t,a,r),i}var createVAONative=require("./lib/vao-native.js"),createVAOEmulated=require("./lib/vao-emulated.js");module.exports=createVAO;

},{"./lib/vao-emulated.js":129,"./lib/vao-native.js":130}],132:[function(require,module,exports){
function transformMat4(r,t,a){var n=t[0],o=t[1],e=t[2],f=t[3];return r[0]=a[0]*n+a[4]*o+a[8]*e+a[12]*f,r[1]=a[1]*n+a[5]*o+a[9]*e+a[13]*f,r[2]=a[2]*n+a[6]*o+a[10]*e+a[14]*f,r[3]=a[3]*n+a[7]*o+a[11]*e+a[15]*f,r}module.exports=transformMat4;

},{}],133:[function(require,module,exports){
"use strict";function fastTwoSum(t,u,o){var r=t+u,s=r-t,e=r-s,a=u-s,f=t-e;return o?(o[0]=f+a,o[1]=r,o):[f+a,r]}module.exports=fastTwoSum;

},{}],134:[function(require,module,exports){
"use strict";function scaleLinearExpansion(r,t){var o=r.length;if(1===o){var e=twoProduct(r[0],t);return e[0]?e:[e[1]]}var u=new Array(2*o),a=[.1,.1],n=[.1,.1],c=0;twoProduct(r[0],t,a),a[0]&&(u[c++]=a[0]);for(var i=1;o>i;++i){twoProduct(r[i],t,n);var w=a[1];twoSum(w,n[0],a),a[0]&&(u[c++]=a[0]);var s=n[1],v=a[1],d=s+v,l=d-s,m=v-l;a[1]=d,m&&(u[c++]=m)}return a[1]&&(u[c++]=a[1]),0===c&&(u[c++]=0),u.length=c,u}var twoProduct=require("two-product"),twoSum=require("two-sum");module.exports=scaleLinearExpansion;

},{"two-product":137,"two-sum":133}],135:[function(require,module,exports){
"use strict";function scalarScalar(r,t){var a=r+t,n=a-r,u=a-n,e=t-n,c=r-u,o=c+e;return o?[o,a]:[a]}function robustSubtract(r,t){var a=0|r.length,n=0|t.length;if(1===a&&1===n)return scalarScalar(r[0],-t[0]);var u,e,c=a+n,o=new Array(c),l=0,s=0,f=0,b=Math.abs,h=r[s],i=b(h),v=-t[f],S=b(v);S>i?(e=h,s+=1,a>s&&(h=r[s],i=b(h))):(e=v,f+=1,n>f&&(v=-t[f],S=b(v))),a>s&&S>i||f>=n?(u=h,s+=1,a>s&&(h=r[s],i=b(h))):(u=v,f+=1,n>f&&(v=-t[f],S=b(v)));for(var g,d,m,p,w,x=u+e,y=x-u,A=e-y,M=A,j=x;a>s&&n>f;)S>i?(u=h,s+=1,a>s&&(h=r[s],i=b(h))):(u=v,f+=1,n>f&&(v=-t[f],S=b(v))),e=M,x=u+e,y=x-u,A=e-y,A&&(o[l++]=A),g=j+x,d=g-j,m=g-d,p=x-d,w=j-m,M=w+p,j=g;for(;a>s;)u=h,e=M,x=u+e,y=x-u,A=e-y,A&&(o[l++]=A),g=j+x,d=g-j,m=g-d,p=x-d,w=j-m,M=w+p,j=g,s+=1,a>s&&(h=r[s]);for(;n>f;)u=v,e=M,x=u+e,y=x-u,A=e-y,A&&(o[l++]=A),g=j+x,d=g-j,m=g-d,p=x-d,w=j-m,M=w+p,j=g,f+=1,n>f&&(v=-t[f]);return M&&(o[l++]=M),j&&(o[l++]=j),l||(o[l++]=0),o.length=l,o}module.exports=robustSubtract;

},{}],136:[function(require,module,exports){
"use strict";function scalarScalar(r,a){var n=r+a,e=n-r,t=n-e,l=a-e,o=r-t,u=o+l;return u?[u,n]:[n]}function linearExpansionSum(r,a){var n=0|r.length,e=0|a.length;if(1===n&&1===e)return scalarScalar(r[0],a[0]);var t,l,o=n+e,u=new Array(o),i=0,s=0,c=0,f=Math.abs,h=r[s],v=f(h),S=a[c],g=f(S);g>v?(l=h,s+=1,n>s&&(h=r[s],v=f(h))):(l=S,c+=1,e>c&&(S=a[c],g=f(S))),n>s&&g>v||c>=e?(t=h,s+=1,n>s&&(h=r[s],v=f(h))):(t=S,c+=1,e>c&&(S=a[c],g=f(S)));for(var m,p,x,E,b,d=t+l,w=d-t,y=l-w,A=y,M=d;n>s&&e>c;)g>v?(t=h,s+=1,n>s&&(h=r[s],v=f(h))):(t=S,c+=1,e>c&&(S=a[c],g=f(S))),l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m;for(;n>s;)t=h,l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m,s+=1,n>s&&(h=r[s]);for(;e>c;)t=S,l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m,c+=1,e>c&&(S=a[c]);return A&&(u[i++]=A),M&&(u[i++]=M),i||(u[i++]=0),u.length=i,u}module.exports=linearExpansionSum;

},{}],137:[function(require,module,exports){
"use strict";function twoProduct(t,o,r){var u=t*o,T=SPLITTER*t,P=T-t,c=T-P,e=t-c,a=SPLITTER*o,d=a-o,n=a-d,s=o-n,w=u-c*n,E=w-e*n,I=E-c*s,L=e*s-I;return r?(r[0]=L,r[1]=u,r):[L,u]}module.exports=twoProduct;var SPLITTER=+(Math.pow(2,27)+1);

},{}],138:[function(require,module,exports){
"use strict";function cofactor(r,t){for(var n=new Array(r.length-1),e=1;e<r.length;++e)for(var o=n[e-1]=new Array(r.length-1),a=0,u=0;a<r.length;++a)a!==t&&(o[u++]=r[e][a]);return n}function matrix(r){for(var t=new Array(r),n=0;r>n;++n){t[n]=new Array(r);for(var e=0;r>e;++e)t[n][e]=["m",e,"[",r-n-1,"]"].join("")}return t}function sign(r){return 1&r?"-":""}function generateSum(r){if(1===r.length)return r[0];if(2===r.length)return["sum(",r[0],",",r[1],")"].join("");var t=r.length>>1;return["sum(",generateSum(r.slice(0,t)),",",generateSum(r.slice(t)),")"].join("")}function determinant(r){if(2===r.length)return[["sum(prod(",r[0][0],",",r[1][1],"),prod(-",r[0][1],",",r[1][0],"))"].join("")];for(var t=[],n=0;n<r.length;++n)t.push(["scale(",generateSum(determinant(cofactor(r,n))),",",sign(n),r[0][n],")"].join(""));return t}function orientation(r){for(var t=[],n=[],e=matrix(r),o=[],a=0;r>a;++a)0===(1&a)?t.push.apply(t,determinant(cofactor(e,a))):n.push.apply(n,determinant(cofactor(e,a))),o.push("m"+a);var u=generateSum(t),i=generateSum(n),s="orientation"+r+"Exact",c=["function ",s,"(",o.join(),"){var p=",u,",n=",i,",d=sub(p,n);return d[d.length-1];};return ",s].join(""),h=new Function("sum","prod","scale","sub",c);return h(robustSum,twoProduct,robustScale,robustSubtract)}function slowOrient(r){var t=CACHED[r.length];return t||(t=CACHED[r.length]=orientation(r.length)),t.apply(void 0,r)}function generateOrientationProc(){for(;CACHED.length<=NUM_EXPAND;)CACHED.push(orientation(CACHED.length));for(var r=[],t=["slow"],n=0;NUM_EXPAND>=n;++n)r.push("a"+n),t.push("o"+n);for(var e=["function getOrientation(",r.join(),"){switch(arguments.length){case 0:case 1:return 0;"],n=2;NUM_EXPAND>=n;++n)e.push("case ",n,":return o",n,"(",r.slice(0,n).join(),");");e.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),t.push(e.join(""));var o=Function.apply(void 0,t);module.exports=o.apply(void 0,[slowOrient].concat(CACHED));for(var n=0;NUM_EXPAND>=n;++n)module.exports[n]=CACHED[n]}var twoProduct=require("two-product"),robustSum=require("robust-sum"),robustScale=require("robust-scale"),robustSubtract=require("robust-subtract"),NUM_EXPAND=5,EPSILON=1.1102230246251565e-16,ERRBOUND3=(3+16*EPSILON)*EPSILON,ERRBOUND4=(7+56*EPSILON)*EPSILON,orientation3Exact=orientation(3),orientation4Exact=orientation(4),CACHED=[function(){return 0},function(){return 0},function(r,t){return t[0]-r[0]},function(r,t,n){var e,o=(r[1]-n[1])*(t[0]-n[0]),a=(r[0]-n[0])*(t[1]-n[1]),u=o-a;if(o>0){if(0>=a)return u;e=o+a}else{if(!(0>o))return u;if(a>=0)return u;e=-(o+a)}var i=ERRBOUND3*e;return u>=i||-i>=u?u:orientation3Exact(r,t,n)},function(r,t,n,e){var o=r[0]-e[0],a=t[0]-e[0],u=n[0]-e[0],i=r[1]-e[1],s=t[1]-e[1],c=n[1]-e[1],h=r[2]-e[2],l=t[2]-e[2],f=n[2]-e[2],g=a*c,p=u*s,m=u*i,E=o*c,b=o*s,v=a*i,N=h*(g-p)+l*(m-E)+f*(b-v),d=(Math.abs(g)+Math.abs(p))*Math.abs(h)+(Math.abs(m)+Math.abs(E))*Math.abs(l)+(Math.abs(b)+Math.abs(v))*Math.abs(f),A=ERRBOUND4*d;return N>A||-N>A?N:orientation4Exact(r,t,n,e)}];generateOrientationProc();

},{"robust-scale":134,"robust-subtract":135,"robust-sum":136,"two-product":137}],139:[function(require,module,exports){
"use strict";function planeT(e,t){var r=robustSum(robustDot(e,t),[t[t.length-1]]);return r[r.length-1]}function lerpW(e,t,r,n){var l=n-t,u=-t/l;0>u?u=0:u>1&&(u=1);for(var s=1-u,o=e.length,p=new Array(o),i=0;o>i;++i)p[i]=u*e[i]+s*r[i];return p}function splitPolygon(e,t){for(var r=[],n=[],l=planeT(e[e.length-1],t),u=e[e.length-1],s=e[0],o=0;o<e.length;++o,u=s){s=e[o];var p=planeT(s,t);if(0>l&&p>0||l>0&&0>p){var i=lerpW(u,p,s,l);r.push(i),n.push(i.slice())}0>p?n.push(s.slice()):p>0?r.push(s.slice()):(r.push(s.slice()),n.push(s.slice())),l=p}return{positive:r,negative:n}}function positive(e,t){for(var r=[],n=planeT(e[e.length-1],t),l=e[e.length-1],u=e[0],s=0;s<e.length;++s,l=u){u=e[s];var o=planeT(u,t);(0>n&&o>0||n>0&&0>o)&&r.push(lerpW(l,o,u,n)),o>=0&&r.push(u.slice()),n=o}return r}function negative(e,t){for(var r=[],n=planeT(e[e.length-1],t),l=e[e.length-1],u=e[0],s=0;s<e.length;++s,l=u){u=e[s];var o=planeT(u,t);(0>n&&o>0||n>0&&0>o)&&r.push(lerpW(l,o,u,n)),0>=o&&r.push(u.slice()),n=o}return r}var robustDot=require("robust-dot-product"),robustSum=require("robust-sum");module.exports=splitPolygon,module.exports.positive=positive,module.exports.negative=negative;

},{"robust-dot-product":140,"robust-sum":142}],140:[function(require,module,exports){
"use strict";function robustDotProduct(t,r){for(var o=twoProduct(t[0],r[0]),u=1;u<t.length;++u)o=robustSum(o,twoProduct(t[u],r[u]));return o}var twoProduct=require("two-product"),robustSum=require("robust-sum");module.exports=robustDotProduct;

},{"robust-sum":142,"two-product":141}],141:[function(require,module,exports){
"use strict";function twoProduct(t,o,r){var u=t*o,T=SPLITTER*t,P=T-t,c=T-P,e=t-c,a=SPLITTER*o,d=a-o,n=a-d,s=o-n,w=u-c*n,E=w-e*n,I=E-c*s,L=e*s-I;return r?(r[0]=L,r[1]=u,r):[L,u]}module.exports=twoProduct;var SPLITTER=+(Math.pow(2,27)+1);

},{}],142:[function(require,module,exports){
"use strict";function scalarScalar(r,a){var n=r+a,e=n-r,t=n-e,l=a-e,o=r-t,u=o+l;return u?[u,n]:[n]}function linearExpansionSum(r,a){var n=0|r.length,e=0|a.length;if(1===n&&1===e)return scalarScalar(r[0],a[0]);var t,l,o=n+e,u=new Array(o),i=0,s=0,c=0,f=Math.abs,h=r[s],v=f(h),S=a[c],g=f(S);g>v?(l=h,s+=1,n>s&&(h=r[s],v=f(h))):(l=S,c+=1,e>c&&(S=a[c],g=f(S))),n>s&&g>v||c>=e?(t=h,s+=1,n>s&&(h=r[s],v=f(h))):(t=S,c+=1,e>c&&(S=a[c],g=f(S)));for(var m,p,x,E,b,d=t+l,w=d-t,y=l-w,A=y,M=d;n>s&&e>c;)g>v?(t=h,s+=1,n>s&&(h=r[s],v=f(h))):(t=S,c+=1,e>c&&(S=a[c],g=f(S))),l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m;for(;n>s;)t=h,l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m,s+=1,n>s&&(h=r[s]);for(;e>c;)t=S,l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m,c+=1,e>c&&(S=a[c]);return A&&(u[i++]=A),M&&(u[i++]=M),i||(u[i++]=0),u.length=i,u}module.exports=linearExpansionSum;

},{}],143:[function(require,module,exports){
"use strict";function createText(e,t){return("object"!=typeof t||null===t)&&(t={}),vectorizeText(e,t.canvas||defaultCanvas,t.context||defaultContext,t)}module.exports=createText;var vectorizeText=require("./lib/vtext"),defaultCanvas=null,defaultContext=null;"undefined"!=typeof document&&(defaultCanvas=document.createElement("canvas"),defaultCanvas.width=8192,defaultCanvas.height=1024,defaultContext=defaultCanvas.getContext("2d"));

},{"./lib/vtext":144}],144:[function(require,module,exports){
"use strict";function transformPositions(e,t,r){for(var i=t.textAlign||"start",n=t.textBaseline||"alphabetic",a=[1<<30,1<<30],o=[0,0],s=e.length,l=0;s>l;++l)for(var c=e[l],g=0;2>g;++g)a[g]=0|Math.min(a[g],c[g]),o[g]=0|Math.max(o[g],c[g]);var p=0;switch(i){case"center":p=-.5*(a[0]+o[0]);break;case"right":case"end":p=-o[0];break;case"left":case"start":p=-a[0];break;default:throw new Error("vectorize-text: Unrecognized textAlign: '"+i+"'")}var h=0;switch(n){case"hanging":case"top":h=-a[1];break;case"middle":h=-.5*(a[1]+o[1]);break;case"alphabetic":case"ideographic":h=-3*r;break;case"bottom":h=-o[1];break;default:throw new Error("vectorize-text: Unrecoginized textBaseline: '"+n+"'")}var u=1/r;return"lineHeight"in t?u*=+t.lineHeight:"width"in t?u=t.width/(o[0]-a[0]):"height"in t&&(u=t.height/(o[1]-a[1])),e.map(function(e){return[u*(e[0]+p),u*(e[1]+h)]})}function getPixels(e,t,r,i){var n=0|Math.ceil(t.measureText(r).width+2*i);if(n>8192)throw new Error("vectorize-text: String too long (sorry, this will get fixed later)");var a=3*i;e.height<a&&(e.height=a),t.fillStyle="#000",t.fillRect(0,0,e.width,e.height),t.fillStyle="#fff",t.fillText(r,i,2*i);var o=t.getImageData(0,0,n,a),s=ndarray(o.data,[a,n,4]);return s.pick(-1,-1,0).transpose(1,0)}function getContour(e,t){var r=surfaceNets(e,128);return t?simplify(r.cells,r.positions,.25):{edges:r.cells,positions:r.positions}}function processPixelsImpl(e,t,r,i){var n=getContour(e,i),a=transformPositions(n.positions,t,r),o=n.edges,s="ccw"===t.orientation;if(cleanPSLG(a,o),t.polygons||t.polygon||t.polyline){for(var l=toPolygonCrappy(o,a),c=new Array(l.length),g=0;g<l.length;++g){for(var p=l[g],h=new Array(p.length),u=0;u<p.length;++u){for(var f=p[u],d=new Array(f.length),x=0;x<f.length;++x)d[x]=a[f[x]].slice();s&&d.reverse(),h[u]=d}c[g]=h}return console.log(c),c}return t.triangles||t.triangulate||t.triangle?{cells:cdt2d(a,o,{delaunay:!1,exterior:!1,interior:!0}),positions:a}:{edges:o,positions:a}}function processPixels(e,t,r){try{return processPixelsImpl(e,t,r,!0)}catch(i){}try{return processPixelsImpl(e,t,r,!1)}catch(i){}return t.polygons||t.polyline||t.polygon?[]:t.triangles||t.triangulate||t.triangle?{cells:[],positions:[]}:{edges:[],positions:[]}}function vectorizeText(e,t,r,i){var n=i.size||64,a=i.font||"normal";r.font=n+"px "+a,r.textAlign="start",r.textBaseline="alphabetic",r.direction="ltr";var o=getPixels(t,r,e,n);return processPixels(o,i,n)}module.exports=vectorizeText,module.exports.processPixels=processPixels;var surfaceNets=require("surface-nets"),ndarray=require("ndarray"),simplify=require("simplify-planar-graph"),cleanPSLG=require("clean-pslg"),cdt2d=require("cdt2d"),toPolygonCrappy=require("planar-graph-to-polyline");

},{"cdt2d":145,"clean-pslg":157,"ndarray":296,"planar-graph-to-polyline":211,"simplify-planar-graph":215,"surface-nets":231}],145:[function(require,module,exports){
"use strict";function canonicalizeEdge(e){return[Math.min(e[0],e[1]),Math.max(e[0],e[1])]}function compareEdge(e,n){return e[0]-n[0]||e[1]-n[1]}function canonicalizeEdges(e){return e.map(canonicalizeEdge).sort(compareEdge)}function getDefault(e,n,r){return n in e?e[n]:r}function cdt2d(e,n,r){Array.isArray(n)?(r=r||{},n=n||[]):(r=n||{},n=[]);var i=!!getDefault(r,"delaunay",!0),a=!!getDefault(r,"interior",!0),t=!!getDefault(r,"exterior",!0),l=!!getDefault(r,"infinity",!1);if(!a&&!t||0===e.length)return[];var u=monotoneTriangulate(e,n);if(i||a!==t||l){for(var o=makeIndex(e.length,canonicalizeEdges(n)),g=0;g<u.length;++g){var c=u[g];o.addTriangle(c[0],c[1],c[2])}return i&&delaunayFlip(e,o),t?a?l?filterTriangulation(o,0,l):o.cells():filterTriangulation(o,1,l):filterTriangulation(o,-1)}return u}var monotoneTriangulate=require("./lib/monotone"),makeIndex=require("./lib/triangulation"),delaunayFlip=require("./lib/delaunay"),filterTriangulation=require("./lib/filter");module.exports=cdt2d;

},{"./lib/delaunay":146,"./lib/filter":147,"./lib/monotone":148,"./lib/triangulation":149}],146:[function(require,module,exports){
"use strict";function testFlip(e,r,i,t,n,s){var a=r.opposite(t,n);if(!(0>a)){if(t>n){var l=t;t=n,n=l,l=s,s=a,a=l}r.isConstraint(t,n)||inCircle(e[t],e[n],e[s],e[a])<0&&i.push(t,n)}}function delaunayRefine(e,r){for(var i=[],t=e.length,n=r.stars,s=0;t>s;++s)for(var a=n[s],l=1;l<a.length;l+=2){var o=a[l];if(!(s>o||r.isConstraint(s,o))){for(var p=a[l-1],f=-1,u=1;u<a.length;u+=2)if(a[u-1]===o){f=a[u];break}0>f||inCircle(e[s],e[o],e[p],e[f])<0&&i.push(s,o)}}for(;i.length>0;){for(var o=i.pop(),s=i.pop(),p=-1,f=-1,a=n[s],h=1;h<a.length;h+=2){var c=a[h-1],v=a[h];c===o?f=v:v===o&&(p=c)}0>p||0>f||inCircle(e[s],e[o],e[p],e[f])>=0||(r.flip(s,o),testFlip(e,r,i,p,s,f),testFlip(e,r,i,s,f,p),testFlip(e,r,i,f,o,p),testFlip(e,r,i,o,p,f))}}var inCircle=require("robust-in-sphere")[4],bsearch=require("binary-search-bounds");module.exports=delaunayRefine;

},{"binary-search-bounds":150,"robust-in-sphere":151}],147:[function(require,module,exports){
"use strict";function FaceIndex(r,e,n,t,a,l,s){this.cells=r,this.neighbor=e,this.flags=t,this.constraint=n,this.active=a,this.next=l,this.boundary=s}function compareCell(r,e){return r[0]-e[0]||r[1]-e[1]||r[2]-e[2]}function indexCells(r,e){for(var n=r.cells(),t=n.length,a=0;t>a;++a){var l=n[a],s=l[0],o=l[1],c=l[2];c>o?s>o&&(l[0]=o,l[1]=c,l[2]=s):s>c&&(l[0]=c,l[1]=s,l[2]=o)}n.sort(compareCell);for(var i=new Array(t),a=0;a<i.length;++a)i[a]=0;var u=[],h=[],f=new Array(3*t),v=new Array(3*t),p=null;e&&(p=[]);for(var g=new FaceIndex(n,f,v,i,u,h,p),a=0;t>a;++a)for(var l=n[a],d=0;3>d;++d){var s=l[d],o=l[(d+1)%3],y=f[3*a+d]=g.locate(o,s,r.opposite(o,s)),b=v[3*a+d]=r.isConstraint(s,o);0>y&&(b?h.push(a):(u.push(a),i[a]=1),e&&p.push([o,s,-1]))}return g}function filterCells(r,e,n){for(var t=0,a=0;a<r.length;++a)e[a]===n&&(r[t++]=r[a]);return r.length=t,r}function classifyFaces(r,e,n){var t=indexCells(r,n);if(0===e)return n?t.cells.concat(t.boundary):t.cells;for(var a=1,l=t.active,s=t.next,o=t.flags,c=t.cells,i=t.constraint,u=t.neighbor;l.length>0||s.length>0;){for(;l.length>0;){var h=l.pop();if(o[h]!==-a){o[h]=a;for(var f=(c[h],0);3>f;++f){var v=u[3*h+f];v>=0&&0===o[v]&&(i[3*h+f]?s.push(v):(l.push(v),o[v]=a))}}}var p=s;s=l,l=p,s.length=0,a=-a}var g=filterCells(c,o,e);return n?g.concat(t.boundary):g}var bsearch=require("binary-search-bounds");module.exports=classifyFaces;var proto=FaceIndex.prototype;proto.locate=function(){var r=[0,0,0];return function(e,n,t){var a=e,l=n,s=t;return t>n?e>n&&(a=n,l=t,s=e):e>t&&(a=t,l=e,s=n),0>a?-1:(r[0]=a,r[1]=l,r[2]=s,bsearch.eq(this.cells,r,compareCell))}}();

},{"binary-search-bounds":150}],148:[function(require,module,exports){
"use strict";function PartialHull(t,e,n,r,a){this.a=t,this.b=e,this.idx=n,this.lowerIds=r,this.upperIds=a}function Event(t,e,n,r){this.a=t,this.b=e,this.type=n,this.idx=r}function compareEvent(t,e){var n=t.a[0]-e.a[0]||t.a[1]-e.a[1]||t.type-e.type;return n?n:t.type!==EVENT_POINT&&(n=orient(t.a,t.b,e.b))?n:t.idx-e.idx}function testPoint(t,e){return orient(t.a,t.b,e)}function addPoint(t,e,n,r,a){for(var i=bsearch.lt(e,r,testPoint),s=bsearch.gt(e,r,testPoint),o=i;s>o;++o){for(var u=e[o],l=u.lowerIds,p=l.length;p>1&&orient(n[l[p-2]],n[l[p-1]],r)>0;)t.push([l[p-1],l[p-2],a]),p-=1;l.length=p,l.push(a);for(var E=u.upperIds,p=E.length;p>1&&orient(n[E[p-2]],n[E[p-1]],r)<0;)t.push([E[p-2],E[p-1],a]),p-=1;E.length=p,E.push(a)}}function findSplit(t,e){var n;return(n=t.a[0]<e.a[0]?orient(t.a,t.b,e.a):orient(e.b,e.a,t.a))?n:(n=e.b[0]<t.b[0]?orient(t.a,t.b,e.b):orient(e.b,e.a,t.b),n||t.idx-e.idx)}function splitHulls(t,e,n){var r=bsearch.le(t,n,findSplit),a=t[r],i=a.upperIds,s=i[i.length-1];a.upperIds=[s],t.splice(r+1,0,new PartialHull(n.a,n.b,n.idx,[s],i))}function mergeHulls(t,e,n){var r=n.a;n.a=n.b,n.b=r;var a=bsearch.eq(t,n,findSplit),i=t[a],s=t[a-1];s.upperIds=i.upperIds,t.splice(a,1)}function monotoneTriangulate(t,e){for(var n=t.length,r=e.length,a=[],i=0;n>i;++i)a.push(new Event(t[i],null,EVENT_POINT,i));for(var i=0;r>i;++i){var s=e[i],o=t[s[0]],u=t[s[1]];o[0]<u[0]?a.push(new Event(o,u,EVENT_START,i),new Event(u,o,EVENT_END,i)):o[0]>u[0]&&a.push(new Event(u,o,EVENT_START,i),new Event(o,u,EVENT_END,i))}a.sort(compareEvent);for(var l=a[0].a[0]-(1+Math.abs(a[0].a[0]))*Math.pow(2,-52),p=[new PartialHull([l,1],[l,0],-1,[],[],[],[])],E=[],i=0,h=a.length;h>i;++i){var b=a[i],d=b.type;d===EVENT_POINT?addPoint(E,p,t,b.a,b.idx):d===EVENT_START?splitHulls(p,t,b):mergeHulls(p,t,b)}return E}var bsearch=require("binary-search-bounds"),orient=require("robust-orientation")[3],EVENT_POINT=0,EVENT_END=1,EVENT_START=2;module.exports=monotoneTriangulate;

},{"binary-search-bounds":150,"robust-orientation":138}],149:[function(require,module,exports){
"use strict";function Triangulation(r,t){this.stars=r,this.edges=t}function removePair(r,t,n){for(var e=1,i=r.length;i>e;e+=2)if(r[e-1]===t&&r[e]===n)return r[e-1]=r[i-2],r[e]=r[i-1],void(r.length=i-2)}function createTriangulation(r,t){for(var n=new Array(r),e=0;r>e;++e)n[e]=[];return new Triangulation(n,t)}var bsearch=require("binary-search-bounds");module.exports=createTriangulation;var proto=Triangulation.prototype;proto.isConstraint=function(){function r(r,t){return r[0]-t[0]||r[1]-t[1]}var t=[0,0];return function(n,e){return t[0]=Math.min(n,e),t[1]=Math.max(n,e),bsearch.eq(this.edges,t,r)>=0}}(),proto.removeTriangle=function(r,t,n){var e=this.stars;removePair(e[r],t,n),removePair(e[t],n,r),removePair(e[n],r,t)},proto.addTriangle=function(r,t,n){var e=this.stars;e[r].push(t,n),e[t].push(n,r),e[n].push(r,t)},proto.opposite=function(r,t){for(var n=this.stars[t],e=1,i=n.length;i>e;e+=2)if(n[e]===r)return n[e-1];return-1},proto.flip=function(r,t){var n=this.opposite(r,t),e=this.opposite(t,r);this.removeTriangle(r,t,n),this.removeTriangle(t,r,e),this.addTriangle(r,e,n),this.addTriangle(t,n,e)},proto.edges=function(){for(var r=this.stars,t=[],n=0,e=r.length;e>n;++n)for(var i=r[n],o=0,a=i.length;a>o;o+=2)t.push([i[o],i[o+1]]);return t},proto.cells=function(){for(var r=this.stars,t=[],n=0,e=r.length;e>n;++n)for(var i=r[n],o=0,a=i.length;a>o;o+=2){var s=i[o],u=i[o+1];n<Math.min(s,u)&&t.push([n,s,u])}return t};

},{"binary-search-bounds":150}],150:[function(require,module,exports){
"use strict";function compileSearch(e,c,i,r,n){var h=["function ",e,"(a,l,h,",r.join(","),"){",n?"":"var i=",i?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a[m]"];return n?c.indexOf("c")<0?h.push(";if(x===y){return m}else if(x<=y){"):h.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):h.push(";if(",c,"){i=m;"),i?h.push("l=m+1}else{h=m-1}"):h.push("h=m-1}else{l=m+1}"),h.push("}"),n?h.push("return -1};"):h.push("return i};"),h.join("")}function compileBoundsSearch(e,c,i,r){var n=new Function([compileSearch("A","x"+e+"y",c,["y"],r),compileSearch("P","c(x,y)"+e+"0",c,["y","c"],r),"function dispatchBsearch",i,"(a,y,c,l,h){if(typeof(c)==='function'){return P(a,(l===void 0)?0:l|0,(h===void 0)?a.length-1:h|0,y,c)}else{return A(a,(c===void 0)?0:c|0,(l===void 0)?a.length-1:l|0,y)}}return dispatchBsearch",i].join(""));return n()}module.exports={ge:compileBoundsSearch(">=",!1,"GE"),gt:compileBoundsSearch(">",!1,"GT"),lt:compileBoundsSearch("<",!0,"LT"),le:compileBoundsSearch("<=",!0,"LE"),eq:compileBoundsSearch("-",!0,"EQ",!0)};

},{}],151:[function(require,module,exports){
"use strict";function cofactor(r,e){for(var n=new Array(r.length-1),t=1;t<r.length;++t)for(var u=n[t-1]=new Array(r.length-1),o=0,a=0;o<r.length;++o)o!==e&&(u[a++]=r[t][o]);return n}function matrix(r){for(var e=new Array(r),n=0;r>n;++n){e[n]=new Array(r);for(var t=0;r>t;++t)e[n][t]=["m",t,"[",r-n-2,"]"].join("")}return e}function generateSum(r){if(1===r.length)return r[0];if(2===r.length)return["sum(",r[0],",",r[1],")"].join("");var e=r.length>>1;return["sum(",generateSum(r.slice(0,e)),",",generateSum(r.slice(e)),")"].join("")}function makeProduct(r,e){if("m"===r.charAt(0)){if("w"===e.charAt(0)){var n=r.split("[");return["w",e.substr(1),"m",n[0].substr(1)].join("")}return["prod(",r,",",e,")"].join("")}return makeProduct(e,r)}function sign(r){return r&!0?"-":""}function determinant(r){if(2===r.length)return[["diff(",makeProduct(r[0][0],r[1][1]),",",makeProduct(r[1][0],r[0][1]),")"].join("")];for(var e=[],n=0;n<r.length;++n)e.push(["scale(",generateSum(determinant(cofactor(r,n))),",",sign(n),r[0][n],")"].join(""));return e}function makeSquare(r,e){for(var n=[],t=0;e-2>t;++t)n.push(["prod(m",r,"[",t,"],m",r,"[",t,"])"].join(""));return generateSum(n)}function orientation(r){for(var e=[],n=[],t=matrix(r),u=0;r>u;++u)t[0][u]="1",t[r-1][u]="w"+u;for(var u=0;r>u;++u)0===(1&u)?e.push.apply(e,determinant(cofactor(t,u))):n.push.apply(n,determinant(cofactor(t,u)));for(var o=generateSum(e),a=generateSum(n),i="exactInSphere"+r,s=[],u=0;r>u;++u)s.push("m"+u);for(var c=["function ",i,"(",s.join(),"){"],u=0;r>u;++u){c.push("var w",u,"=",makeSquare(u,r),";");for(var f=0;r>f;++f)f!==u&&c.push("var w",u,"m",f,"=scale(w",u,",m",f,"[0]);")}c.push("var p=",o,",n=",a,",d=diff(p,n);return d[d.length-1];}return ",i);var h=new Function("sum","diff","prod","scale",c.join(""));return h(robustSum,robustDiff,twoProduct,robustScale)}function inSphere0(){return 0}function inSphere1(){return 0}function inSphere2(){return 0}function slowInSphere(r){var e=CACHED[r.length];return e||(e=CACHED[r.length]=orientation(r.length)),e.apply(void 0,r)}function generateInSphereTest(){for(;CACHED.length<=NUM_EXPAND;)CACHED.push(orientation(CACHED.length));for(var r=[],e=["slow"],n=0;NUM_EXPAND>=n;++n)r.push("a"+n),e.push("o"+n);for(var t=["function testInSphere(",r.join(),"){switch(arguments.length){case 0:case 1:return 0;"],n=2;NUM_EXPAND>=n;++n)t.push("case ",n,":return o",n,"(",r.slice(0,n).join(),");");t.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return testInSphere"),e.push(t.join(""));var u=Function.apply(void 0,e);module.exports=u.apply(void 0,[slowInSphere].concat(CACHED));for(var n=0;NUM_EXPAND>=n;++n)module.exports[n]=CACHED[n]}var twoProduct=require("two-product"),robustSum=require("robust-sum"),robustDiff=require("robust-subtract"),robustScale=require("robust-scale"),NUM_EXPAND=6,CACHED=[inSphere0,inSphere1,inSphere2];generateInSphereTest();

},{"robust-scale":153,"robust-subtract":154,"robust-sum":155,"two-product":156}],152:[function(require,module,exports){
"use strict";function fastTwoSum(t,u,o){var r=t+u,s=r-t,e=r-s,a=u-s,f=t-e;return o?(o[0]=f+a,o[1]=r,o):[f+a,r]}module.exports=fastTwoSum;

},{}],153:[function(require,module,exports){
"use strict";function scaleLinearExpansion(r,t){var o=r.length;if(1===o){var e=twoProduct(r[0],t);return e[0]?e:[e[1]]}var u=new Array(2*o),a=[.1,.1],n=[.1,.1],c=0;twoProduct(r[0],t,a),a[0]&&(u[c++]=a[0]);for(var i=1;o>i;++i){twoProduct(r[i],t,n);var w=a[1];twoSum(w,n[0],a),a[0]&&(u[c++]=a[0]);var s=n[1],v=a[1],d=s+v,l=d-s,m=v-l;a[1]=d,m&&(u[c++]=m)}return a[1]&&(u[c++]=a[1]),0===c&&(u[c++]=0),u.length=c,u}var twoProduct=require("two-product"),twoSum=require("two-sum");module.exports=scaleLinearExpansion;

},{"two-product":156,"two-sum":152}],154:[function(require,module,exports){
"use strict";function scalarScalar(r,t){var a=r+t,n=a-r,u=a-n,e=t-n,c=r-u,o=c+e;return o?[o,a]:[a]}function robustSubtract(r,t){var a=0|r.length,n=0|t.length;if(1===a&&1===n)return scalarScalar(r[0],-t[0]);var u,e,c=a+n,o=new Array(c),l=0,s=0,f=0,b=Math.abs,h=r[s],i=b(h),v=-t[f],S=b(v);S>i?(e=h,s+=1,a>s&&(h=r[s],i=b(h))):(e=v,f+=1,n>f&&(v=-t[f],S=b(v))),a>s&&S>i||f>=n?(u=h,s+=1,a>s&&(h=r[s],i=b(h))):(u=v,f+=1,n>f&&(v=-t[f],S=b(v)));for(var g,d,m,p,w,x=u+e,y=x-u,A=e-y,M=A,j=x;a>s&&n>f;)S>i?(u=h,s+=1,a>s&&(h=r[s],i=b(h))):(u=v,f+=1,n>f&&(v=-t[f],S=b(v))),e=M,x=u+e,y=x-u,A=e-y,A&&(o[l++]=A),g=j+x,d=g-j,m=g-d,p=x-d,w=j-m,M=w+p,j=g;for(;a>s;)u=h,e=M,x=u+e,y=x-u,A=e-y,A&&(o[l++]=A),g=j+x,d=g-j,m=g-d,p=x-d,w=j-m,M=w+p,j=g,s+=1,a>s&&(h=r[s]);for(;n>f;)u=v,e=M,x=u+e,y=x-u,A=e-y,A&&(o[l++]=A),g=j+x,d=g-j,m=g-d,p=x-d,w=j-m,M=w+p,j=g,f+=1,n>f&&(v=-t[f]);return M&&(o[l++]=M),j&&(o[l++]=j),l||(o[l++]=0),o.length=l,o}module.exports=robustSubtract;

},{}],155:[function(require,module,exports){
"use strict";function scalarScalar(r,a){var n=r+a,e=n-r,t=n-e,l=a-e,o=r-t,u=o+l;return u?[u,n]:[n]}function linearExpansionSum(r,a){var n=0|r.length,e=0|a.length;if(1===n&&1===e)return scalarScalar(r[0],a[0]);var t,l,o=n+e,u=new Array(o),i=0,s=0,c=0,f=Math.abs,h=r[s],v=f(h),S=a[c],g=f(S);g>v?(l=h,s+=1,n>s&&(h=r[s],v=f(h))):(l=S,c+=1,e>c&&(S=a[c],g=f(S))),n>s&&g>v||c>=e?(t=h,s+=1,n>s&&(h=r[s],v=f(h))):(t=S,c+=1,e>c&&(S=a[c],g=f(S)));for(var m,p,x,E,b,d=t+l,w=d-t,y=l-w,A=y,M=d;n>s&&e>c;)g>v?(t=h,s+=1,n>s&&(h=r[s],v=f(h))):(t=S,c+=1,e>c&&(S=a[c],g=f(S))),l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m;for(;n>s;)t=h,l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m,s+=1,n>s&&(h=r[s]);for(;e>c;)t=S,l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m,c+=1,e>c&&(S=a[c]);return A&&(u[i++]=A),M&&(u[i++]=M),i||(u[i++]=0),u.length=i,u}module.exports=linearExpansionSum;

},{}],156:[function(require,module,exports){
"use strict";function twoProduct(t,o,r){var u=t*o,T=SPLITTER*t,P=T-t,c=T-P,e=t-c,a=SPLITTER*o,d=a-o,n=a-d,s=o-n,w=u-c*n,E=w-e*n,I=E-c*s,L=e*s-I;return r?(r[0]=L,r[1]=u,r):[L,u]}module.exports=twoProduct;var SPLITTER=+(Math.pow(2,27)+1);

},{}],157:[function(require,module,exports){
"use strict";function boundRat(r){var t=ratToFloat(r),e=ratCmp(rat(t),r);return 0>e?[t,nextafter(t,1/0)]:e>0?[nextafter(t,-(1/0)),t]:[t,t]}function boundEdges(r,t){for(var e=new Array(t.length),n=0;n<t.length;++n){var a=t[n],o=r[a[0]],u=r[a[1]];e[n]=[Math.min(o[0],u[0]),Math.min(o[1],u[1]),Math.max(o[0],u[0]),Math.max(o[1],u[1])]}return e}function boundPoints(r){for(var t=new Array(r.length),e=0;e<r.length;++e){var n=r[e];t[e]=[n[0],n[1],n[0],n[1]]}return t}function getCrossings(r,t,e){var n=[];return boxIntersect(e,function(e,a){var o=t[e],u=t[a];if(o[0]!==u[0]&&o[0]!==u[1]&&o[1]!==u[0]&&o[1]!==u[1]){var i=r[o[0]],s=r[o[1]],f=r[u[0]],g=r[u[1]];segseg(i,s,f,g)&&n.push([e,a])}}),n}function getTJunctions(r,t,e,n){var a=[];return boxIntersect(e,n,function(e,n){var o=t[e];if(o[0]!==n&&o[1]!==n){var u=r[n],i=r[o[0]],s=r[o[1]];segseg(i,s,u,u)&&a.push([e,n])}}),a}function cutEdges(r,t,e,n,a){function o(t){if(t>=r.length)return u[t-r.length];var e=r[t];return[rat(e[0]),rat(e[1])]}for(var u=[],i=0;i<e.length;++i){var s=e[i],f=s[0],g=s[1],c=t[f],h=t[g],l=solveIntersection(ratVec(r[c[0]]),ratVec(r[c[1]]),ratVec(r[h[0]]),ratVec(r[h[1]]));if(l){var v=u.length+r.length;u.push(l),n.push([f,v],[g,v])}}n.sort(function(r,t){if(r[0]!==t[0])return r[0]-t[0];var e=o(r[1]),n=o(t[1]);return ratCmp(e[0],n[0])||ratCmp(e[1],n[1])});for(var i=n.length-1;i>=0;--i){var p=n[i],f=p[0],d=t[f],m=d[0],x=d[1],b=r[m],q=r[x];if((b[0]-q[0]||b[1]-q[1])<0){var M=m;m=x,x=M}d[0]=m;var C,E=d[1]=p[1];for(a&&(C=d[2]);i>0&&n[i-1][0]===f;){var p=n[--i],F=p[1];a?t.push([E,F,C]):t.push([E,F]),E=F}a?t.push([E,x,C]):t.push([E,x])}return u}function dedupPoints(r,t,e){for(var n=r.length+t.length,a=new UnionFind(n),o=e,u=0;u<t.length;++u){var i=t[u],s=boundRat(i[0]),f=boundRat(i[1]);o.push([s[0],f[0],s[1],f[1]]),r.push([ratToFloat(i[0]),ratToFloat(i[1])])}boxIntersect(o,function(r,t){a.link(r,t)});for(var g=0,c=!0,h=new Array(n),u=0;n>u;++u){var l=a.find(u);l===u?(h[u]=g,r[g++]=r[u]):(c=!1,h[u]=-1)}if(r.length=g,c)return null;for(var u=0;n>u;++u)h[u]<0&&(h[u]=h[a.find(u)]);return h}function compareLex2(r,t){return r[0]-t[0]||r[1]-t[1]}function compareLex3(r,t){var e=r[0]-t[0]||r[1]-t[1];return e?e:r[2]<t[2]?-1:r[2]>t[2]?1:0}function dedupEdges(r,t,e){if(0!==r.length){if(t)for(var n=0;n<r.length;++n){var a=r[n],o=t[a[0]],u=t[a[1]];a[0]=Math.min(o,u),a[1]=Math.max(o,u)}else for(var n=0;n<r.length;++n){var a=r[n],o=a[0],u=a[1];a[0]=Math.min(o,u),a[1]=Math.max(o,u)}e?r.sort(compareLex3):r.sort(compareLex2);for(var i=1,n=1;n<r.length;++n){var s=r[n-1],f=r[n];(f[0]!==s[0]||f[1]!==s[1]||e&&f[2]!==s[2])&&(r[i++]=f)}r.length=i}}function snapRound(r,t,e){var n=boundEdges(r,t),a=getCrossings(r,t,n),o=boundPoints(r),u=getTJunctions(r,t,n,o),i=cutEdges(r,t,a,u,e),s=dedupPoints(r,i,o);return dedupEdges(t,s,e),s?!0:a.length>0||u.length>0}function cleanPSLG(r,t,e){var n,a=!1;if(e){n=t;for(var o=new Array(t.length),u=0;u<t.length;++u){var i=t[u];o[u]=[i[0],i[1],e[u]]}t=o}for(;snapRound(r,t,!!e);)a=!0;if(e&&a){n.length=0,e.length=0;for(var u=0;u<t.length;++u){var i=t[u];n.push([i[0],i[1]]),e.push(i[2])}}return a}module.exports=cleanPSLG;var UnionFind=require("union-find"),boxIntersect=require("box-intersect"),compareCell=require("compare-cell"),segseg=require("robust-segment-intersect"),rat=require("big-rat"),ratCmp=require("big-rat/cmp"),ratToFloat=require("big-rat/to-float"),ratVec=require("rat-vec"),nextafter=require("nextafter"),solveIntersection=require("./lib/rat-seg-intersect");

},{"./lib/rat-seg-intersect":158,"big-rat":162,"big-rat/cmp":160,"big-rat/to-float":176,"box-intersect":177,"compare-cell":185,"nextafter":186,"rat-vec":189,"robust-segment-intersect":192,"union-find":193}],158:[function(require,module,exports){
"use strict";function ratPerp(r,t){return ratSub(ratMul(r[0],t[1]),ratMul(r[1],t[0]))}function solveIntersection(r,t,e,u){var a=rvSub(t,r),i=rvSub(u,e),v=ratPerp(a,i);if(0===ratSign(v))return null;var n=rvSub(r,e),l=ratPerp(i,n),b=ratDiv(l,v);return rvAdd(r,rvMuls(a,b))}module.exports=solveIntersection;var ratMul=require("big-rat/mul"),ratDiv=require("big-rat/div"),ratSub=require("big-rat/sub"),ratSign=require("big-rat/sign"),rvSub=require("rat-vec/sub"),rvAdd=require("rat-vec/add"),rvMuls=require("rat-vec/muls"),toFloat=require("big-rat/to-float");

},{"big-rat/div":161,"big-rat/mul":171,"big-rat/sign":174,"big-rat/sub":175,"big-rat/to-float":176,"rat-vec/add":188,"rat-vec/muls":190,"rat-vec/sub":191}],159:[function(require,module,exports){
"use strict";function add(a,i){return rationalize(a[0].mul(i[1]).add(i[0].mul(a[1])),a[1].mul(i[1]))}var rationalize=require("./lib/rationalize");module.exports=add;

},{"./lib/rationalize":169}],160:[function(require,module,exports){
"use strict";function cmp(m,u){return m[0].mul(u[1]).cmp(u[0].mul(m[1]))}module.exports=cmp;

},{}],161:[function(require,module,exports){
"use strict";function div(i,r){return rationalize(i[0].mul(r[1]),i[1].mul(r[0]))}var rationalize=require("./lib/rationalize");module.exports=div;

},{"./lib/rationalize":169}],162:[function(require,module,exports){
"use strict";function makeRational(e,i){if(isRat(e))return i?div(e,makeRational(i)):[e[0].clone(),e[1].clone()];var n,r,t=0;if(isBN(e))n=e.clone();else if("string"==typeof e)n=str2bn(e);else{if(0===e)return[num2bn(0),num2bn(1)];if(e===Math.floor(e))n=num2bn(e);else{for(;e!==Math.floor(e);)e*=Math.pow(2,256),t-=256;n=num2bn(e)}}if(isRat(i))n.mul(i[1]),r=i[0].clone();else if(isBN(i))r=i.clone();else if("string"==typeof i)r=str2bn(i);else if(i)if(i===Math.floor(i))r=num2bn(i);else{for(;i!==Math.floor(i);)i*=Math.pow(2,256),t+=256;r=num2bn(i)}else r=num2bn(1);return t>0?n=n.shln(t):0>t&&(r=r.shln(-t)),rationalize(n,r)}var isRat=require("./is-rat"),isBN=require("./lib/is-bn"),num2bn=require("./lib/num-to-bn"),str2bn=require("./lib/str-to-bn"),rationalize=require("./lib/rationalize"),div=require("./div");module.exports=makeRational;

},{"./div":161,"./is-rat":163,"./lib/is-bn":167,"./lib/num-to-bn":168,"./lib/rationalize":169,"./lib/str-to-bn":170}],163:[function(require,module,exports){
"use strict";function isRat(i){return Array.isArray(i)&&2===i.length&&isBN(i[0])&&isBN(i[1])}var isBN=require("./lib/is-bn");module.exports=isRat;

},{"./lib/is-bn":167}],164:[function(require,module,exports){
"use strict";function sign(n){return n.cmp(new bn(0))}var bn=require("bn.js");module.exports=sign;

},{"bn.js":172}],165:[function(require,module,exports){
"use strict";function bn2num(e){var n=e.length,r=e.words,s=0;if(1===n)s=r[0];else if(2===n)s=r[0]+67108864*r[1];else for(var s=0,t=0;n>t;t++){var o=r[t];s+=o*Math.pow(67108864,t)}return e.sign?-s:s}module.exports=bn2num;

},{}],166:[function(require,module,exports){
"use strict";function ctzNumber(r){var t=ctz(db.lo(r));if(32>t)return t;var e=ctz(db.hi(r));return e>20?52:e+32}var db=require("double-bits"),ctz=require("bit-twiddle").countTrailingZeros;module.exports=ctzNumber;

},{"bit-twiddle":118,"double-bits":173}],167:[function(require,module,exports){
"use strict";function isBN(e){return e&&"object"==typeof e&&Boolean(e.words)}var BN=require("bn.js");module.exports=isBN;

},{"bn.js":172}],168:[function(require,module,exports){
"use strict";function num2bn(e){var n=db.exponent(e);return 52>n?new BN(e):new BN(e*Math.pow(2,52-n)).shln(n-52)}var BN=require("bn.js"),db=require("double-bits");module.exports=num2bn;

},{"bn.js":172,"double-bits":173}],169:[function(require,module,exports){
"use strict";function rationalize(n,r){var i=sign(n),e=sign(r);if(0===i)return[num2bn(0),num2bn(1)];if(0===e)return[num2bn(0),num2bn(0)];0>e&&(n=n.neg(),r=r.neg());var u=n.gcd(r);return u.cmpn(1)?[n.div(u),r.div(u)]:[n,r]}var num2bn=require("./num-to-bn"),sign=require("./bn-sign");module.exports=rationalize;

},{"./bn-sign":164,"./num-to-bn":168}],170:[function(require,module,exports){
"use strict";function str2BN(r){return new BN(r)}var BN=require("bn.js");module.exports=str2BN;

},{"bn.js":172}],171:[function(require,module,exports){
"use strict";function mul(i,r){return rationalize(i[0].mul(r[0]),i[1].mul(r[1]))}var rationalize=require("./lib/rationalize");module.exports=mul;

},{"./lib/rationalize":169}],172:[function(require,module,exports){
!function(t,i){"use strict";function r(t,i){if(!t)throw new Error(i||"Assertion failed")}function n(t,i){t.super_=i;var r=function(){};r.prototype=i.prototype,t.prototype=new r,t.prototype.constructor=t}function s(t,i,r){return null!==t&&"object"==typeof t&&Array.isArray(t.words)?t:(this.sign=!1,this.words=null,this.length=0,this.red=null,("le"===i||"be"===i)&&(r=i,i=10),void(null!==t&&this._init(t||0,i||10,r||"be")))}function h(t,i,r){for(var n=0,s=Math.min(t.length,r),h=i;s>h;h++){var e=t.charCodeAt(h)-48;n<<=4,n|=e>=49&&54>=e?e-49+10:e>=17&&22>=e?e-17+10:15&e}return n}function e(t,i,r,n){for(var s=0,h=Math.min(t.length,r),e=i;h>e;e++){var o=t.charCodeAt(e)-48;s*=n,s+=o>=49?o-49+10:o>=17?o-17+10:o}return s}function o(t,i){this.name=t,this.p=new s(i,16),this.n=this.p.bitLength(),this.k=new s(1).ishln(this.n).isub(this.p),this.tmp=this._tmp()}function f(){o.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function d(){o.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function u(){o.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function l(){o.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function p(t){if("string"==typeof t){var i=s._prime(t);this.m=i.p,this.prime=i}else this.m=t,this.prime=null}function g(t){p.call(this,t),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new s(1).ishln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv.sign=!0,this.minv=this.minv.mod(this.r)}"object"==typeof t?t.exports=s:i.BN=s,s.BN=s,s.wordSize=26,s.prototype._init=function(t,i,n){if("number"==typeof t)return this._initNumber(t,i,n);if("object"==typeof t)return this._initArray(t,i,n);"hex"===i&&(i=16),r(i===(0|i)&&i>=2&&36>=i),t=t.toString().replace(/\s+/g,"");var s=0;"-"===t[0]&&s++,16===i?this._parseHex(t,s):this._parseBase(t,i,s),"-"===t[0]&&(this.sign=!0),this.strip(),"le"===n&&this._initArray(this.toArray(),i,n)},s.prototype._initNumber=function(t,i,n){0>t&&(this.sign=!0,t=-t),67108864>t?(this.words=[67108863&t],this.length=1):4503599627370496>t?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(r(9007199254740992>t),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),i,n)},s.prototype._initArray=function(t,i,n){if(r("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var h=0;if("be"===n)for(var s=t.length-1,e=0;s>=0;s-=3){var o=t[s]|t[s-1]<<8|t[s-2]<<16;this.words[e]|=o<<h&67108863,this.words[e+1]=o>>>26-h&67108863,h+=24,h>=26&&(h-=26,e++)}else if("le"===n)for(var s=0,e=0;s<t.length;s+=3){var o=t[s]|t[s+1]<<8|t[s+2]<<16;this.words[e]|=o<<h&67108863,this.words[e+1]=o>>>26-h&67108863,h+=24,h>=26&&(h-=26,e++)}return this.strip()},s.prototype._parseHex=function(t,i){this.length=Math.ceil((t.length-i)/6),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;for(var n=0,r=t.length-6,s=0;r>=i;r-=6){var e=h(t,r,r+6);this.words[s]|=e<<n&67108863,this.words[s+1]|=e>>>26-n&4194303,n+=24,n>=26&&(n-=26,s++)}if(r+6!==i){var e=h(t,i,r+6);this.words[s]|=e<<n&67108863,this.words[s+1]|=e>>>26-n&4194303}this.strip()},s.prototype._parseBase=function(t,i,r){this.words=[0],this.length=1;for(var n=0,s=1;67108863>=s;s*=i)n++;n--,s=s/i|0;for(var h=t.length-r,o=h%n,f=Math.min(h,h-o)+r,d=0,u=r;f>u;u+=n)d=e(t,u,u+n,i),this.imuln(s),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d);if(0!==o){for(var l=1,d=e(t,u,t.length,i),u=0;o>u;u++)l*=i;this.imuln(l),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d)}},s.prototype.copy=function(t){t.words=new Array(this.length);for(var i=0;i<this.length;i++)t.words[i]=this.words[i];t.length=this.length,t.sign=this.sign,t.red=this.red},s.prototype.clone=function(){var t=new s(null);return this.copy(t),t},s.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.sign=!1),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var a=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],c=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],m=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];s.prototype.toString=function(t,i){if(t=t||10,16===t||"hex"===t){for(var n="",s=0,i=0|i||1,h=0,e=0;e<this.length;e++){var o=this.words[e],f=(16777215&(o<<s|h)).toString(16);h=o>>>24-s&16777215,n=0!==h||e!==this.length-1?a[6-f.length]+f+n:f+n,s+=2,s>=26&&(s-=26,e--)}for(0!==h&&(n=h.toString(16)+n);n.length%i!==0;)n="0"+n;return this.sign&&(n="-"+n),n}if(t===(0|t)&&t>=2&&36>=t){var d=c[t],u=m[t],n="",l=this.clone();for(l.sign=!1;0!==l.cmpn(0);){var p=l.modn(u).toString(t);l=l.idivn(u),n=0!==l.cmpn(0)?a[d-p.length]+p+n:p+n}return 0===this.cmpn(0)&&(n="0"+n),this.sign&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toArray=function(t){this.strip();var i=new Array(this.byteLength());i[0]=0;var r=this.clone();if("le"!==t)for(var n=0;0!==r.cmpn(0);n++){var s=r.andln(255);r.ishrn(8),i[i.length-n-1]=s}else for(var n=0;0!==r.cmpn(0);n++){var s=r.andln(255);r.ishrn(8),i[n]=s}return i},Math.clz32?s.prototype._countBits=function(t){return 32-Math.clz32(t)}:s.prototype._countBits=function(t){var i=t,r=0;return i>=4096&&(r+=13,i>>>=13),i>=64&&(r+=7,i>>>=7),i>=8&&(r+=4,i>>>=4),i>=2&&(r+=2,i>>>=2),r+i},s.prototype._zeroBits=function(t){if(0===t)return 26;var i=t,r=0;return 0===(8191&i)&&(r+=13,i>>>=13),0===(127&i)&&(r+=7,i>>>=7),0===(15&i)&&(r+=4,i>>>=4),0===(3&i)&&(r+=2,i>>>=2),0===(1&i)&&r++,r},s.prototype.bitLength=function(){var t=0,i=this.words[this.length-1],t=this._countBits(i);return 26*(this.length-1)+t},s.prototype.zeroBits=function(){if(0===this.cmpn(0))return 0;for(var t=0,i=0;i<this.length;i++){var r=this._zeroBits(this.words[i]);if(t+=r,26!==r)break}return t},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.neg=function(){if(0===this.cmpn(0))return this.clone();var t=this.clone();return t.sign=!this.sign,t},s.prototype.ior=function(t){for(this.sign=this.sign||t.sign;this.length<t.length;)this.words[this.length++]=0;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]|t.words[i];return this.strip()},s.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},s.prototype.iand=function(t){this.sign=this.sign&&t.sign;var i;i=this.length>t.length?t:this;for(var r=0;r<i.length;r++)this.words[r]=this.words[r]&t.words[r];return this.length=i.length,this.strip()},s.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},s.prototype.ixor=function(t){this.sign=this.sign||t.sign;var i,r;this.length>t.length?(i=this,r=t):(i=t,r=this);for(var n=0;n<r.length;n++)this.words[n]=i.words[n]^r.words[n];if(this!==i)for(;n<i.length;n++)this.words[n]=i.words[n];return this.length=i.length,this.strip()},s.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},s.prototype.setn=function(t,i){r("number"==typeof t&&t>=0);for(var n=t/26|0,s=t%26;this.length<=n;)this.words[this.length++]=0;return i?this.words[n]=this.words[n]|1<<s:this.words[n]=this.words[n]&~(1<<s),this.strip()},s.prototype.iadd=function(t){if(this.sign&&!t.sign){this.sign=!1;var i=this.isub(t);return this.sign=!this.sign,this._normSign()}if(!this.sign&&t.sign){t.sign=!1;var i=this.isub(t);return t.sign=!0,i._normSign()}var r,n;this.length>t.length?(r=this,n=t):(r=t,n=this);for(var s=0,h=0;h<n.length;h++){var i=r.words[h]+n.words[h]+s;this.words[h]=67108863&i,s=i>>>26}for(;0!==s&&h<r.length;h++){var i=r.words[h]+s;this.words[h]=67108863&i,s=i>>>26}if(this.length=r.length,0!==s)this.words[this.length]=s,this.length++;else if(r!==this)for(;h<r.length;h++)this.words[h]=r.words[h];return this},s.prototype.add=function(t){if(t.sign&&!this.sign){t.sign=!1;var i=this.sub(t);return t.sign=!0,i}if(!t.sign&&this.sign){this.sign=!1;var i=t.sub(this);return this.sign=!0,i}return this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},s.prototype.isub=function(t){if(t.sign){t.sign=!1;var i=this.iadd(t);return t.sign=!0,i._normSign()}if(this.sign)return this.sign=!1,this.iadd(t),this.sign=!0,this._normSign();var r=this.cmp(t);if(0===r)return this.sign=!1,this.length=1,this.words[0]=0,this;var n,s;r>0?(n=this,s=t):(n=t,s=this);for(var h=0,e=0;e<s.length;e++){var i=n.words[e]-s.words[e]+h;h=i>>26,this.words[e]=67108863&i}for(;0!==h&&e<n.length;e++){var i=n.words[e]+h;h=i>>26,this.words[e]=67108863&i}if(0===h&&e<n.length&&n!==this)for(;e<n.length;e++)this.words[e]=n.words[e];return this.length=Math.max(this.length,e),n!==this&&(this.sign=!0),this.strip()},s.prototype.sub=function(t){return this.clone().isub(t)},s.prototype._smallMulTo=function(t,i){i.sign=t.sign!==this.sign,i.length=this.length+t.length;for(var r=0,n=0;n<i.length-1;n++){for(var s=r>>>26,h=67108863&r,e=Math.min(n,t.length-1),o=Math.max(0,n-this.length+1);e>=o;o++){var f=n-o,d=0|this.words[f],u=0|t.words[o],l=d*u,p=67108863&l;s=s+(l/67108864|0)|0,p=p+h|0,h=67108863&p,s=s+(p>>>26)|0}i.words[n]=h,r=s}return 0!==r?i.words[n]=r:i.length--,i.strip()},s.prototype._bigMulTo=function(t,i){i.sign=t.sign!==this.sign,i.length=this.length+t.length;for(var r=0,n=0,s=0;s<i.length-1;s++){var h=n;n=0;for(var e=67108863&r,o=Math.min(s,t.length-1),f=Math.max(0,s-this.length+1);o>=f;f++){var d=s-f,u=0|this.words[d],l=0|t.words[f],p=u*l,g=67108863&p;h=h+(p/67108864|0)|0,g=g+e|0,e=67108863&g,h=h+(g>>>26)|0,n+=h>>>26,h&=67108863}i.words[s]=e,r=h,h=n}return 0!==r?i.words[s]=r:i.length--,i.strip()},s.prototype.mulTo=function(t,i){var r;return r=this.length+t.length<63?this._smallMulTo(t,i):this._bigMulTo(t,i)},s.prototype.mul=function(t){var i=new s(null);return i.words=new Array(this.length+t.length),this.mulTo(t,i)},s.prototype.imul=function(t){if(0===this.cmpn(0)||0===t.cmpn(0))return this.words[0]=0,this.length=1,this;var i=this.length,r=t.length;this.sign=t.sign!==this.sign,this.length=this.length+t.length,this.words[this.length-1]=0;for(var n=this.length-2;n>=0;n--){for(var s=0,h=0,e=Math.min(n,r-1),o=Math.max(0,n-i+1);e>=o;o++){var f=n-o,d=this.words[f],u=t.words[o],l=d*u,p=67108863&l;s+=l/67108864|0,p+=h,h=67108863&p,s+=p>>>26}this.words[n]=h,this.words[n+1]+=s,s=0}for(var s=0,f=1;f<this.length;f++){var g=this.words[f]+s;this.words[f]=67108863&g,s=g>>>26}return this.strip()},s.prototype.imuln=function(t){r("number"==typeof t);for(var i=0,n=0;n<this.length;n++){var s=this.words[n]*t,h=(67108863&s)+(67108863&i);i>>=26,i+=s/67108864|0,i+=h>>>26,this.words[n]=67108863&h}return 0!==i&&(this.words[n]=i,this.length++),this},s.prototype.muln=function(t){return this.clone().imuln(t)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.mul(this)},s.prototype.ishln=function(t){r("number"==typeof t&&t>=0);var i=t%26,n=(t-i)/26,s=67108863>>>26-i<<26-i;if(0!==i){for(var h=0,e=0;e<this.length;e++){var o=this.words[e]&s,f=this.words[e]-o<<i;this.words[e]=f|h,h=o>>>26-i}h&&(this.words[e]=h,this.length++)}if(0!==n){for(var e=this.length-1;e>=0;e--)this.words[e+n]=this.words[e];for(var e=0;n>e;e++)this.words[e]=0;this.length+=n}return this.strip()},s.prototype.ishrn=function(t,i,n){r("number"==typeof t&&t>=0);var s;s=i?(i-i%26)/26:0;var h=t%26,e=Math.min((t-h)/26,this.length),o=67108863^67108863>>>h<<h,f=n;if(s-=e,s=Math.max(0,s),f){for(var d=0;e>d;d++)f.words[d]=this.words[d];f.length=e}if(0===e);else if(this.length>e){this.length-=e;for(var d=0;d<this.length;d++)this.words[d]=this.words[d+e]}else this.words[0]=0,this.length=1;for(var u=0,d=this.length-1;d>=0&&(0!==u||d>=s);d--){var l=this.words[d];this.words[d]=u<<26-h|l>>>h,u=l&o}return f&&0!==u&&(f.words[f.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this.strip(),this},s.prototype.shln=function(t){return this.clone().ishln(t)},s.prototype.shrn=function(t){return this.clone().ishrn(t)},s.prototype.testn=function(t){r("number"==typeof t&&t>=0);var i=t%26,n=(t-i)/26,s=1<<i;if(this.length<=n)return!1;var h=this.words[n];return!!(h&s)},s.prototype.imaskn=function(t){r("number"==typeof t&&t>=0);var i=t%26,n=(t-i)/26;if(r(!this.sign,"imaskn works only with positive numbers"),0!==i&&n++,this.length=Math.min(n,this.length),0!==i){var s=67108863^67108863>>>i<<i;this.words[this.length-1]&=s}return this.strip()},s.prototype.maskn=function(t){return this.clone().imaskn(t)},s.prototype.iaddn=function(t){return r("number"==typeof t),0>t?this.isubn(-t):this.sign?1===this.length&&this.words[0]<t?(this.words[0]=t-this.words[0],this.sign=!1,this):(this.sign=!1,this.isubn(t),this.sign=!0,this):this._iaddn(t)},s.prototype._iaddn=function(t){this.words[0]+=t;for(var i=0;i<this.length&&this.words[i]>=67108864;i++)this.words[i]-=67108864,i===this.length-1?this.words[i+1]=1:this.words[i+1]++;return this.length=Math.max(this.length,i+1),this},s.prototype.isubn=function(t){if(r("number"==typeof t),0>t)return this.iaddn(-t);if(this.sign)return this.sign=!1,this.iaddn(t),this.sign=!0,this;this.words[0]-=t;for(var i=0;i<this.length&&this.words[i]<0;i++)this.words[i]+=67108864,this.words[i+1]-=1;return this.strip()},s.prototype.addn=function(t){return this.clone().iaddn(t)},s.prototype.subn=function(t){return this.clone().isubn(t)},s.prototype.iabs=function(){return this.sign=!1,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(t,i,n){var s,h=t.length+n;if(this.words.length<h){for(var e=new Array(h),s=0;s<this.length;s++)e[s]=this.words[s];this.words=e}else s=this.length;for(this.length=Math.max(this.length,h);s<this.length;s++)this.words[s]=0;for(var o=0,s=0;s<t.length;s++){var f=this.words[s+n]+o,d=t.words[s]*i;f-=67108863&d,o=(f>>26)-(d/67108864|0),this.words[s+n]=67108863&f}for(;s<this.length-n;s++){var f=this.words[s+n]+o;o=f>>26,this.words[s+n]=67108863&f}if(0===o)return this.strip();r(-1===o),o=0;for(var s=0;s<this.length;s++){var f=-this.words[s]+o;o=f>>26,this.words[s]=67108863&f}return this.sign=!0,this.strip()},s.prototype._wordDiv=function(t,i){var r=this.length-t.length,n=this.clone(),h=t,e=h.words[h.length-1],o=this._countBits(e);r=26-o,0!==r&&(h=h.shln(r),n.ishln(r),e=h.words[h.length-1]);var f,d=n.length-h.length;if("mod"!==i){f=new s(null),f.length=d+1,f.words=new Array(f.length);for(var u=0;u<f.length;u++)f.words[u]=0}var l=n.clone()._ishlnsubmul(h,1,d);l.sign||(n=l,f&&(f.words[d]=1));for(var p=d-1;p>=0;p--){var g=67108864*n.words[h.length+p]+n.words[h.length+p-1];for(g=Math.min(g/e|0,67108863),n._ishlnsubmul(h,g,p);n.sign;)g--,n.sign=!1,n._ishlnsubmul(h,1,p),0!==n.cmpn(0)&&(n.sign=!n.sign);f&&(f.words[p]=g)}return f&&f.strip(),n.strip(),"div"!==i&&0!==r&&n.ishrn(r),{div:f?f:null,mod:n}},s.prototype.divmod=function(t,i){if(r(0!==t.cmpn(0)),this.sign&&!t.sign){var n,h,e=this.neg().divmod(t,i);return"mod"!==i&&(n=e.div.neg()),"div"!==i&&(h=0===e.mod.cmpn(0)?e.mod:t.sub(e.mod)),{div:n,mod:h}}if(!this.sign&&t.sign){var n,e=this.divmod(t.neg(),i);return"mod"!==i&&(n=e.div.neg()),{div:n,mod:e.mod}}return this.sign&&t.sign?this.neg().divmod(t.neg(),i):t.length>this.length||this.cmp(t)<0?{div:new s(0),mod:this}:1===t.length?"div"===i?{div:this.divn(t.words[0]),mod:null}:"mod"===i?{div:null,mod:new s(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new s(this.modn(t.words[0]))}:this._wordDiv(t,i)},s.prototype.div=function(t){return this.divmod(t,"div").div},s.prototype.mod=function(t){return this.divmod(t,"mod").mod},s.prototype.divRound=function(t){var i=this.divmod(t);if(0===i.mod.cmpn(0))return i.div;var r=i.div.sign?i.mod.isub(t):i.mod,n=t.shrn(1),s=t.andln(1),h=r.cmp(n);return 0>h||1===s&&0===h?i.div:i.div.sign?i.div.isubn(1):i.div.iaddn(1)},s.prototype.modn=function(t){r(67108863>=t);for(var i=(1<<26)%t,n=0,s=this.length-1;s>=0;s--)n=(i*n+this.words[s])%t;return n},s.prototype.idivn=function(t){r(67108863>=t);for(var i=0,n=this.length-1;n>=0;n--){var s=this.words[n]+67108864*i;this.words[n]=s/t|0,i=s%t}return this.strip()},s.prototype.divn=function(t){return this.clone().idivn(t)},s.prototype.egcd=function(t){r(!t.sign),r(0!==t.cmpn(0));var i=this,n=t.clone();i=i.sign?i.mod(t):i.clone();for(var h=new s(1),e=new s(0),o=new s(0),f=new s(1),d=0;i.isEven()&&n.isEven();)i.ishrn(1),n.ishrn(1),++d;for(var u=n.clone(),l=i.clone();0!==i.cmpn(0);){for(;i.isEven();)i.ishrn(1),h.isEven()&&e.isEven()?(h.ishrn(1),e.ishrn(1)):(h.iadd(u).ishrn(1),e.isub(l).ishrn(1));for(;n.isEven();)n.ishrn(1),o.isEven()&&f.isEven()?(o.ishrn(1),f.ishrn(1)):(o.iadd(u).ishrn(1),f.isub(l).ishrn(1));i.cmp(n)>=0?(i.isub(n),h.isub(o),e.isub(f)):(n.isub(i),o.isub(h),f.isub(e))}return{a:o,b:f,gcd:n.ishln(d)}},s.prototype._invmp=function(t){r(!t.sign),r(0!==t.cmpn(0));var i=this,n=t.clone();i=i.sign?i.mod(t):i.clone();for(var h=new s(1),e=new s(0),o=n.clone();i.cmpn(1)>0&&n.cmpn(1)>0;){for(;i.isEven();)i.ishrn(1),h.isEven()?h.ishrn(1):h.iadd(o).ishrn(1);for(;n.isEven();)n.ishrn(1),e.isEven()?e.ishrn(1):e.iadd(o).ishrn(1);i.cmp(n)>=0?(i.isub(n),h.isub(e)):(n.isub(i),e.isub(h))}return 0===i.cmpn(1)?h:e},s.prototype.gcd=function(t){if(0===this.cmpn(0))return t.clone();if(0===t.cmpn(0))return this.clone();var i=this.clone(),r=t.clone();i.sign=!1,r.sign=!1;for(var n=0;i.isEven()&&r.isEven();n++)i.ishrn(1),r.ishrn(1);for(;;){for(;i.isEven();)i.ishrn(1);for(;r.isEven();)r.ishrn(1);var s=i.cmp(r);if(0>s){var h=i;i=r,r=h}else if(0===s||0===r.cmpn(1))break;i.isub(r)}return r.ishln(n)},s.prototype.invm=function(t){return this.egcd(t).a.mod(t)},s.prototype.isEven=function(){return 0===(1&this.words[0])},s.prototype.isOdd=function(){return 1===(1&this.words[0])},s.prototype.andln=function(t){return this.words[0]&t},s.prototype.bincn=function(t){r("number"==typeof t);var i=t%26,n=(t-i)/26,s=1<<i;if(this.length<=n){for(var h=this.length;n+1>h;h++)this.words[h]=0;return this.words[n]|=s,this.length=n+1,this}for(var e=s,h=n;0!==e&&h<this.length;h++){var o=this.words[h];o+=e,e=o>>>26,o&=67108863,this.words[h]=o}return 0!==e&&(this.words[h]=e,this.length++),this},s.prototype.cmpn=function(t){var i=0>t;if(i&&(t=-t),this.sign&&!i)return-1;if(!this.sign&&i)return 1;t&=67108863,this.strip();var r;if(this.length>1)r=1;else{var n=this.words[0];r=n===t?0:t>n?-1:1}return this.sign&&(r=-r),r},s.prototype.cmp=function(t){if(this.sign&&!t.sign)return-1;if(!this.sign&&t.sign)return 1;var i=this.ucmp(t);return this.sign?-i:i},s.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var i=0,r=this.length-1;r>=0;r--){var n=this.words[r],s=t.words[r];if(n!==s){s>n?i=-1:n>s&&(i=1);break}}return i},s.red=function(t){return new p(t)},s.prototype.toRed=function(t){return r(!this.red,"Already a number in reduction context"),r(!this.sign,"red works only with positives"),t.convertTo(this)._forceRed(t)},s.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(t){return this.red=t,this},s.prototype.forceRed=function(t){return r(!this.red,"Already a number in reduction context"),this._forceRed(t)},s.prototype.redAdd=function(t){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},s.prototype.redIAdd=function(t){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},s.prototype.redSub=function(t){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},s.prototype.redISub=function(t){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},s.prototype.redShl=function(t){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},s.prototype.redMul=function(t){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},s.prototype.redIMul=function(t){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},s.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(t){return r(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var v={k256:null,p224:null,p192:null,p25519:null};o.prototype._tmp=function(){var t=new s(null);return t.words=new Array(Math.ceil(this.n/13)),t},o.prototype.ireduce=function(t){var i,r=t;do this.split(r,this.tmp),r=this.imulK(r),r=r.iadd(this.tmp),i=r.bitLength();while(i>this.n);var n=i<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):r.strip(),r},o.prototype.split=function(t,i){t.ishrn(this.n,0,i)},o.prototype.imulK=function(t){return t.imul(this.k)},n(f,o),f.prototype.split=function(t,i){for(var r=4194303,n=Math.min(t.length,9),s=0;n>s;s++)i.words[s]=t.words[s];if(i.length=n,t.length<=9)return t.words[0]=0,void(t.length=1);var h=t.words[9];i.words[i.length++]=h&r;for(var s=10;s<t.length;s++){var e=t.words[s];t.words[s-10]=(e&r)<<4|h>>>22,h=e}t.words[s-10]=h>>>22,t.length-=9},f.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var i,r=0,n=0;n<t.length;n++){var s=t.words[n];i=64*s,r+=977*s,i+=r/67108864|0,r&=67108863,t.words[n]=r,r=i}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},n(d,o),n(u,o),n(l,o),l.prototype.imulK=function(t){for(var i=0,r=0;r<t.length;r++){var n=19*t.words[r]+i,s=67108863&n;n>>>=26,t.words[r]=s,i=n}return 0!==i&&(t.words[t.length++]=i),t},s._prime=function w(t){if(v[t])return v[t];var w;if("k256"===t)w=new f;else if("p224"===t)w=new d;else if("p192"===t)w=new u;else{if("p25519"!==t)throw new Error("Unknown prime "+t);w=new l}return v[t]=w,w},p.prototype._verify1=function(t){r(!t.sign,"red works only with positives"),r(t.red,"red works only with red numbers")},p.prototype._verify2=function(t,i){r(!t.sign&&!i.sign,"red works only with positives"),r(t.red&&t.red===i.red,"red works only with red numbers")},p.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.mod(this.m)._forceRed(this)},p.prototype.neg=function(t){var i=t.clone();return i.sign=!i.sign,i.iadd(this.m)._forceRed(this)},p.prototype.add=function(t,i){this._verify2(t,i);var r=t.add(i);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},p.prototype.iadd=function(t,i){this._verify2(t,i);var r=t.iadd(i);return r.cmp(this.m)>=0&&r.isub(this.m),r},p.prototype.sub=function(t,i){this._verify2(t,i);var r=t.sub(i);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},p.prototype.isub=function(t,i){this._verify2(t,i);var r=t.isub(i);return r.cmpn(0)<0&&r.iadd(this.m),r},p.prototype.shl=function(t,i){return this._verify1(t),this.imod(t.shln(i))},p.prototype.imul=function(t,i){return this._verify2(t,i),this.imod(t.imul(i))},p.prototype.mul=function(t,i){return this._verify2(t,i),this.imod(t.mul(i))},p.prototype.isqr=function(t){return this.imul(t,t)},p.prototype.sqr=function(t){return this.mul(t,t)},p.prototype.sqrt=function(t){if(0===t.cmpn(0))return t.clone();var i=this.m.andln(3);if(r(i%2===1),3===i){var n=this.m.add(new s(1)).ishrn(2),h=this.pow(t,n);return h}for(var e=this.m.subn(1),o=0;0!==e.cmpn(0)&&0===e.andln(1);)o++,e.ishrn(1);r(0!==e.cmpn(0));var f=new s(1).toRed(this),d=f.redNeg(),u=this.m.subn(1).ishrn(1),l=this.m.bitLength();for(l=new s(2*l*l).toRed(this);0!==this.pow(l,u).cmp(d);)l.redIAdd(d);for(var p=this.pow(l,e),h=this.pow(t,e.addn(1).ishrn(1)),g=this.pow(t,e),a=o;0!==g.cmp(f);){for(var c=g,m=0;0!==c.cmp(f);m++)c=c.redSqr();r(a>m);var v=this.pow(p,new s(1).ishln(a-m-1));h=h.redMul(v),p=v.redSqr(),g=g.redMul(p),a=m}return h},p.prototype.invm=function(t){var i=t._invmp(this.m);return i.sign?(i.sign=!1,this.imod(i).redNeg()):this.imod(i)},p.prototype.pow=function(t,i){var r=[];if(0===i.cmpn(0))return new s(1);for(var n=i.clone();0!==n.cmpn(0);)r.push(n.andln(1)),n.ishrn(1);for(var h=t,e=0;e<r.length&&0===r[e];e++,h=this.sqr(h));if(++e<r.length)for(var n=this.sqr(h);e<r.length;e++,n=this.sqr(n))0!==r[e]&&(h=this.mul(h,n));return h},p.prototype.convertTo=function(t){var i=t.mod(this.m);return i===t?i.clone():i},p.prototype.convertFrom=function(t){var i=t.clone();return i.red=null,i},s.mont=function(t){return new g(t)},n(g,p),g.prototype.convertTo=function(t){return this.imod(t.shln(this.shift))},g.prototype.convertFrom=function(t){var i=this.imod(t.mul(this.rinv));return i.red=null,i},g.prototype.imul=function(t,i){if(0===t.cmpn(0)||0===i.cmpn(0))return t.words[0]=0,t.length=1,t;var r=t.imul(i),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=r.isub(n).ishrn(this.shift),h=s;return s.cmp(this.m)>=0?h=s.isub(this.m):s.cmpn(0)<0&&(h=s.iadd(this.m)),h._forceRed(this)},g.prototype.mul=function(t,i){if(0===t.cmpn(0)||0===i.cmpn(0))return new s(0)._forceRed(this);var r=t.mul(i),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),h=r.isub(n).ishrn(this.shift),e=h;return h.cmp(this.m)>=0?e=h.isub(this.m):h.cmpn(0)<0&&(e=h.iadd(this.m)),e._forceRed(this)},g.prototype.invm=function(t){var i=this.imod(t._invmp(this.m).mul(this.r2));return i._forceRed(this)}}("undefined"==typeof module||module,this);

},{}],173:[function(require,module,exports){
(function (Buffer){
function toDoubleLE(e,r){return UINT_VIEW[0]=e,UINT_VIEW[1]=r,DOUBLE_VIEW[0]}function lowUintLE(e){return DOUBLE_VIEW[0]=e,UINT_VIEW[0]}function highUintLE(e){return DOUBLE_VIEW[0]=e,UINT_VIEW[1]}function toDoubleBE(e,r){return UINT_VIEW[1]=e,UINT_VIEW[0]=r,DOUBLE_VIEW[0]}function lowUintBE(e){return DOUBLE_VIEW[0]=e,UINT_VIEW[1]}function highUintBE(e){return DOUBLE_VIEW[0]=e,UINT_VIEW[0]}function toDouble(e,r){return buffer.writeUInt32LE(e,0,!0),buffer.writeUInt32LE(r,4,!0),buffer.readDoubleLE(0,!0)}function lowUint(e){return buffer.writeDoubleLE(e,0,!0),buffer.readUInt32LE(0,!0)}function highUint(e){return buffer.writeDoubleLE(e,0,!0),buffer.readUInt32LE(4,!0)}var hasTypedArrays=!1;if("undefined"!=typeof Float64Array){var DOUBLE_VIEW=new Float64Array(1),UINT_VIEW=new Uint32Array(DOUBLE_VIEW.buffer);DOUBLE_VIEW[0]=1,hasTypedArrays=!0,1072693248===UINT_VIEW[1]?(module.exports=function(e){return DOUBLE_VIEW[0]=e,[UINT_VIEW[0],UINT_VIEW[1]]},module.exports.pack=toDoubleLE,module.exports.lo=lowUintLE,module.exports.hi=highUintLE):1072693248===UINT_VIEW[0]?(module.exports=function(e){return DOUBLE_VIEW[0]=e,[UINT_VIEW[1],UINT_VIEW[0]]},module.exports.pack=toDoubleBE,module.exports.lo=lowUintBE,module.exports.hi=highUintBE):hasTypedArrays=!1}if(!hasTypedArrays){var buffer=new Buffer(8);module.exports=function(e){return buffer.writeDoubleLE(e,0,!0),[buffer.readUInt32LE(0,!0),buffer.readUInt32LE(4,!0)]},module.exports.pack=toDouble,module.exports.lo=lowUint,module.exports.hi=highUint}module.exports.sign=function(e){return module.exports.hi(e)>>>31},module.exports.exponent=function(e){var r=module.exports.hi(e);return(r<<1>>>21)-1023},module.exports.fraction=function(e){var r=module.exports.lo(e),o=module.exports.hi(e),t=1048575&o;return 2146435072&o&&(t+=1<<20),[r,t]},module.exports.denormalized=function(e){var r=module.exports.hi(e);return!(2146435072&r)};

}).call(this,require("buffer").Buffer)
},{"buffer":5}],174:[function(require,module,exports){
"use strict";function sign(n){return bnsign(n[0])*bnsign(n[1])}var bnsign=require("./lib/bn-sign");module.exports=sign;

},{"./lib/bn-sign":164}],175:[function(require,module,exports){
"use strict";function sub(u,i){return rationalize(u[0].mul(i[1]).sub(u[1].mul(i[0])),u[1].mul(i[1]))}var rationalize=require("./lib/rationalize");module.exports=sub;

},{"./lib/rationalize":169}],176:[function(require,module,exports){
"use strict";function roundRat(n){var t=n[0],r=n[1];if(0===t.cmpn(0))return 0;var u=t.divmod(r),i=u.div,o=bn2num(i),e=u.mod;if(0===e.cmpn(0))return o;if(o){var a=ctz(o)+4,d=bn2num(e.shln(a).divRound(r));return 0>o&&(d=-d),o+d*Math.pow(2,-a)}var m=r.bitLength()-e.bitLength()+53,d=bn2num(e.shln(m).divRound(r));return 1023>m?d*Math.pow(2,-m):(d*=Math.pow(2,-1023),d*Math.pow(2,1023-m))}var bn2num=require("./lib/bn-to-num"),ctz=require("./lib/ctz");module.exports=roundRat;

},{"./lib/bn-to-num":165,"./lib/ctz":166}],177:[function(require,module,exports){
"use strict";function boxEmpty(e,r){for(var t=0;e>t;++t)if(!(r[t]<=r[t+e]))return!0;return!1}function convertBoxes(e,r,t,o){for(var n=0,i=0,p=0,s=e.length;s>p;++p){var l=e[p];if(!boxEmpty(r,l)){for(var c=0;2*r>c;++c)t[n++]=l[c];o[i++]=p}}return i}function boxIntersect(e,r,t,o){var n=e.length,i=r.length;if(!(0>=n||0>=i)){var p=e[0].length>>>1;if(!(0>=p)){var s,l=pool.mallocDouble(2*p*n),c=pool.mallocInt32(n);if(n=convertBoxes(e,p,l,c),n>0){if(1===p&&o)sweep.init(n),s=sweep.sweepComplete(p,t,0,n,l,c,0,n,l,c);else{var a=pool.mallocDouble(2*p*i),u=pool.mallocInt32(i);i=convertBoxes(r,p,a,u),i>0&&(sweep.init(n+i),s=1===p?sweep.sweepBipartite(p,t,0,n,l,c,0,i,a,u):boxIntersectIter(p,t,o,n,l,c,i,a,u),pool.free(a),pool.free(u))}pool.free(l),pool.free(c)}return s}}}function appendItem(e,r){RESULT.push([e,r])}function intersectFullArray(e){return RESULT=[],boxIntersect(e,e,appendItem,!0),RESULT}function intersectBipartiteArray(e,r){return RESULT=[],boxIntersect(e,r,appendItem,!1),RESULT}function boxIntersectWrapper(e,r,t){switch(arguments.length){case 1:return intersectFullArray(e);case 2:return"function"==typeof r?boxIntersect(e,e,r,!0):intersectBipartiteArray(e,r);case 3:return boxIntersect(e,r,t,!1);default:throw new Error("box-intersect: Invalid arguments")}}module.exports=boxIntersectWrapper;var pool=require("typedarray-pool"),sweep=require("./lib/sweep"),boxIntersectIter=require("./lib/intersect"),RESULT;

},{"./lib/intersect":179,"./lib/sweep":183,"typedarray-pool":184}],178:[function(require,module,exports){
"use strict";function generateBruteForce(E,R,r){var _="bruteForce"+(E?"Red":"Blue")+(R?"Flip":"")+(r?"Full":""),e=["function ",_,"(",ARGS.join(),"){","var ",ELEM_SIZE,"=2*",DIMENSION,";"],S="for(var i="+RED_START+","+RED_PTR+"="+ELEM_SIZE+"*"+RED_START+";i<"+RED_END+";++i,"+RED_PTR+"+="+ELEM_SIZE+"){var x0="+RED_BOXES+"["+AXIS+"+"+RED_PTR+"],x1="+RED_BOXES+"["+AXIS+"+"+RED_PTR+"+"+DIMENSION+"],xi="+RED_INDEX+"[i];",I="for(var j="+BLUE_START+","+BLUE_PTR+"="+ELEM_SIZE+"*"+BLUE_START+";j<"+BLUE_END+";++j,"+BLUE_PTR+"+="+ELEM_SIZE+"){var y0="+BLUE_BOXES+"["+AXIS+"+"+BLUE_PTR+"],"+(r?"y1="+BLUE_BOXES+"["+AXIS+"+"+BLUE_PTR+"+"+DIMENSION+"],":"")+"yi="+BLUE_INDEX+"[j];";return E?e.push(S,INNER_LABEL,":",I):e.push(I,INNER_LABEL,":",S),r?e.push("if(y1<x0||x1<y0)continue;"):R?e.push("if(y0<=x0||x1<y0)continue;"):e.push("if(y0<x0||x1<y0)continue;"),e.push("for(var k="+AXIS+"+1;k<"+DIMENSION+";++k){var r0="+RED_BOXES+"[k+"+RED_PTR+"],r1="+RED_BOXES+"[k+"+DIMENSION+"+"+RED_PTR+"],b0="+BLUE_BOXES+"[k+"+BLUE_PTR+"],b1="+BLUE_BOXES+"[k+"+DIMENSION+"+"+BLUE_PTR+"];if(r1<b0||b1<r0)continue "+INNER_LABEL+";}var "+RETVAL+"="+VISIT+"("),R?e.push("yi,xi"):e.push("xi,yi"),e.push(");if("+RETVAL+"!==void 0)return "+RETVAL+";}}}"),{name:_,code:e.join("")}}function bruteForcePlanner(E){function R(R,r){var e=generateBruteForce(R,r,E);_.push(e.code),S.push("return "+e.name+"("+ARGS.join()+");")}var r="bruteForce"+(E?"Full":"Partial"),_=[],e=ARGS.slice();E||e.splice(3,0,FLIP);var S=["function "+r+"("+e.join()+"){"];S.push("if("+RED_END+"-"+RED_START+">"+BLUE_END+"-"+BLUE_START+"){"),E?(R(!0,!1),S.push("}else{"),R(!1,!1)):(S.push("if("+FLIP+"){"),R(!0,!0),S.push("}else{"),R(!0,!1),S.push("}}else{if("+FLIP+"){"),R(!1,!0),S.push("}else{"),R(!1,!1),S.push("}")),S.push("}}return "+r);var I=_.join("")+S.join(""),D=new Function(I);return D()}var DIMENSION="d",AXIS="ax",VISIT="vv",FLIP="fp",ELEM_SIZE="es",RED_START="rs",RED_END="re",RED_BOXES="rb",RED_INDEX="ri",RED_PTR="rp",BLUE_START="bs",BLUE_END="be",BLUE_BOXES="bb",BLUE_INDEX="bi",BLUE_PTR="bp",RETVAL="rv",INNER_LABEL="Q",ARGS=[DIMENSION,AXIS,VISIT,RED_START,RED_END,RED_BOXES,RED_INDEX,BLUE_START,BLUE_END,BLUE_BOXES,BLUE_INDEX];exports.partial=bruteForcePlanner(!1),exports.full=bruteForcePlanner(!0);

},{}],179:[function(require,module,exports){
"use strict";function iterInit(i,t){var e=8*bits.log2(t+1)*(i+1)|0,r=bits.nextPow2(IFRAME_SIZE*e);BOX_ISTACK.length<r&&(pool.free(BOX_ISTACK),BOX_ISTACK=pool.mallocInt32(r));var o=bits.nextPow2(DFRAME_SIZE*e);o>BOX_DSTACK&&(pool.free(BOX_DSTACK),BOX_DSTACK=pool.mallocDouble(o))}function iterPush(i,t,e,r,o,n,a,p,s){var u=IFRAME_SIZE*i;BOX_ISTACK[u]=t,BOX_ISTACK[u+1]=e,BOX_ISTACK[u+2]=r,BOX_ISTACK[u+3]=o,BOX_ISTACK[u+4]=n,BOX_ISTACK[u+5]=a;var l=DFRAME_SIZE*i;BOX_DSTACK[l]=p,BOX_DSTACK[l+1]=s}function onePointPartial(i,t,e,r,o,n,a,p,s,u,l){var C=2*i,I=s*C,_=u[I+t];i:for(var T=o,f=o*C;n>T;++T,f+=C){var A=a[f+t],P=a[f+t+i];if(!(A>_||_>P||r&&_===A)){for(var S=p[T],v=t+1;i>v;++v){var A=a[f+v],P=a[f+v+i],F=u[I+v],O=u[I+v+i];if(F>P||A>O)continue i}var B;if(B=r?e(l,S):e(S,l),void 0!==B)return B}}}function onePointFull(i,t,e,r,o,n,a,p,s,u){var l=2*i,C=p*l,I=s[C+t];i:for(var _=r,T=r*l;o>_;++_,T+=l){var f=a[_];if(f!==u){var A=n[T+t],P=n[T+t+i];if(!(A>I||I>P)){for(var S=t+1;i>S;++S){var A=n[T+S],P=n[T+S+i],v=s[C+S],F=s[C+S+i];if(v>P||A>F)continue i}var O=e(f,u);if(void 0!==O)return O}}}}function boxIntersectIter(i,t,e,r,o,n,a,p,s){iterInit(i,r+a);var u,l=0,C=2*i;for(iterPush(l++,0,0,r,0,a,e?16:0,-(1/0),1/0),e||iterPush(l++,0,0,a,0,r,1,-(1/0),1/0);l>0;){l-=1;var I=l*IFRAME_SIZE,_=BOX_ISTACK[I],T=BOX_ISTACK[I+1],f=BOX_ISTACK[I+2],A=BOX_ISTACK[I+3],P=BOX_ISTACK[I+4],S=BOX_ISTACK[I+5],v=l*DFRAME_SIZE,F=BOX_DSTACK[v],O=BOX_DSTACK[v+1],B=1&S,E=!!(16&S),c=o,K=n,X=p,h=s;if(B&&(c=p,K=s,X=o,h=n),!(2&S&&(f=partitionStartLessThan(i,_,T,f,c,K,O),T>=f)||4&S&&(T=partitionEndLessThanEqual(i,_,T,f,c,K,F),T>=f))){var d=f-T,w=P-A;if(E){if(SCAN_COMPLETE_CUTOFF>i*d*(d+w)){if(u=sweep.scanComplete(i,_,t,T,f,c,K,A,P,X,h),void 0!==u)return u;continue}}else{if(i*Math.min(d,w)<BRUTE_FORCE_CUTOFF){if(u=bruteForcePartial(i,_,t,B,T,f,c,K,A,P,X,h),void 0!==u)return u;continue}if(SCAN_CUTOFF>i*d*w){if(u=sweep.scanBipartite(i,_,t,B,T,f,c,K,A,P,X,h),void 0!==u)return u;continue}}var b=partitionInteriorContainsInterval(i,_,T,f,c,K,F,O);if(b>T)if(BRUTE_FORCE_CUTOFF>i*(b-T)){if(u=bruteForceFull(i,_+1,t,T,b,c,K,A,P,X,h),void 0!==u)return u}else if(_===i-2){if(u=B?sweep.sweepBipartite(i,t,A,P,X,h,T,b,c,K):sweep.sweepBipartite(i,t,T,b,c,K,A,P,X,h),void 0!==u)return u}else iterPush(l++,_+1,T,b,A,P,B,-(1/0),1/0),iterPush(l++,_+1,A,P,T,b,1^B,-(1/0),1/0);if(f>b){var D=findMedian(i,_,A,P,X,h),R=X[C*D+_],M=partitionStartEqual(i,_,D,P,X,h,R);if(P>M&&iterPush(l++,_,b,f,M,P,(4|B)+(E?16:0),R,O),D>A&&iterPush(l++,_,b,f,A,D,(2|B)+(E?16:0),F,R),D+1===M){if(u=E?onePointFull(i,_,t,b,f,c,K,D,X,h[D]):onePointPartial(i,_,t,B,b,f,c,K,D,X,h[D]),void 0!==u)return u}else if(M>D){var q;if(E){if(q=partitionContainsPoint(i,_,b,f,c,K,R),q>b){var U=partitionStartEqual(i,_,b,q,c,K,R);if(_===i-2){if(U>b&&(u=sweep.sweepComplete(i,t,b,U,c,K,D,M,X,h),void 0!==u))return u;if(q>U&&(u=sweep.sweepBipartite(i,t,U,q,c,K,D,M,X,h),void 0!==u))return u}else U>b&&iterPush(l++,_+1,b,U,D,M,16,-(1/0),1/0),q>U&&(iterPush(l++,_+1,U,q,D,M,0,-(1/0),1/0),iterPush(l++,_+1,D,M,U,q,1,-(1/0),1/0))}}else q=B?partitionContainsPointProper(i,_,b,f,c,K,R):partitionContainsPoint(i,_,b,f,c,K,R),q>b&&(_===i-2?u=B?sweep.sweepBipartite(i,t,D,M,X,h,b,q,c,K):sweep.sweepBipartite(i,t,b,q,c,K,D,M,X,h):(iterPush(l++,_+1,b,q,D,M,B,-(1/0),1/0),iterPush(l++,_+1,D,M,b,q,1^B,-(1/0),1/0)))}}}}}module.exports=boxIntersectIter;var pool=require("typedarray-pool"),bits=require("bit-twiddle"),bruteForce=require("./brute"),bruteForcePartial=bruteForce.partial,bruteForceFull=bruteForce.full,sweep=require("./sweep"),findMedian=require("./median"),genPartition=require("./partition"),BRUTE_FORCE_CUTOFF=128,SCAN_CUTOFF=1<<22,SCAN_COMPLETE_CUTOFF=1<<22,partitionInteriorContainsInterval=genPartition("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),partitionStartEqual=genPartition("lo===p0",["p0"]),partitionStartLessThan=genPartition("lo<p0",["p0"]),partitionEndLessThanEqual=genPartition("hi<=p0",["p0"]),partitionContainsPoint=genPartition("lo<=p0&&p0<=hi",["p0"]),partitionContainsPointProper=genPartition("lo<p0&&p0<=hi",["p0"]),IFRAME_SIZE=6,DFRAME_SIZE=2,INIT_CAPACITY=1024,BOX_ISTACK=pool.mallocInt32(INIT_CAPACITY),BOX_DSTACK=pool.mallocDouble(INIT_CAPACITY);

},{"./brute":178,"./median":180,"./partition":181,"./sweep":183,"bit-twiddle":118,"typedarray-pool":184}],180:[function(require,module,exports){
"use strict";function insertionSort(r,a,t,i,n,o){for(var e=2*r,f=e*(t+1)+a,v=t+1;i>v;++v,f+=e)for(var s=n[f],T=v,d=e*(v-1);T>t&&n[d+a]>s;--T,d-=e){for(var p=d,u=d+e,S=0;e>S;++S,++p,++u){var h=n[p];n[p]=n[u],n[u]=h}var L=o[T];o[T]=o[T-1],o[T-1]=L}}function findMedian(r,a,t,i,n,o){if(t+1>=i)return t;for(var e=t,f=i,v=i+t>>>1,s=2*r,T=v,d=n[s*v+a];f>e;){if(PARTITION_THRESHOLD>f-e){insertionSort(r,a,e,f,n,o),d=n[s*v+a];break}var p=f-e,u=Math.random()*p+e|0,S=n[s*u+a],h=Math.random()*p+e|0,L=n[s*h+a],M=Math.random()*p+e|0,m=n[s*M+a];L>=S?m>=L?(T=h,d=L):S>=m?(T=u,d=S):(T=M,d=m):L>=m?(T=h,d=L):m>=S?(T=u,d=S):(T=M,d=m);for(var H=s*(f-1),I=s*T,O=0;s>O;++O,++H,++I){var P=n[H];n[H]=n[I],n[I]=P}var R=o[f-1];o[f-1]=o[T],o[T]=R,T=partitionStartLessThan(r,a,e,f-1,n,o,d);for(var H=s*(f-1),I=s*T,O=0;s>O;++O,++H,++I){var P=n[H];n[H]=n[I],n[I]=P}var R=o[f-1];if(o[f-1]=o[T],o[T]=R,T>v){for(f=T-1;f>e&&n[s*(f-1)+a]===d;)f-=1;f+=1}else{if(!(v>T))break;for(e=T+1;f>e&&n[s*e+a]===d;)e+=1}}return partitionStartLessThan(r,a,t,v,n,o,n[s*v+a])}module.exports=findMedian;var genPartition=require("./partition"),partitionStartLessThan=genPartition("lo<p0",["p0"]),PARTITION_THRESHOLD=8;

},{"./partition":181}],181:[function(require,module,exports){
"use strict";function genPartition(e,r){var o="abcdef".split("").concat(r),a=[];return e.indexOf("lo")>=0&&a.push("lo=e[k+n]"),e.indexOf("hi")>=0&&a.push("hi=e[k+o]"),o.push(code.replace("_",a.join()).replace("$",e)),Function.apply(void 0,o)}module.exports=genPartition;var code="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m";

},{}],182:[function(require,module,exports){
"use strict";function wrapper(r,o){4*INSERT_SORT_CUTOFF>=o?insertionSort(0,o-1,r):quickSort(0,o-1,r)}function insertionSort(r,o,e){for(var t=2*(r+1),i=r+1;o>=i;++i){for(var a=e[t++],c=e[t++],n=i,f=t-2;n-->r;){var p=e[f-2],v=e[f-1];if(a>p)break;if(p===a&&c>v)break;e[f]=p,e[f+1]=v,f-=2}e[f]=a,e[f+1]=c}}function swap(r,o,e){r*=2,o*=2;var t=e[r],i=e[r+1];e[r]=e[o],e[r+1]=e[o+1],e[o]=t,e[o+1]=i}function move(r,o,e){r*=2,o*=2,e[r]=e[o],e[r+1]=e[o+1]}function rotate(r,o,e,t){r*=2,o*=2,e*=2;var i=t[r],a=t[r+1];t[r]=t[o],t[r+1]=t[o+1],t[o]=t[e],t[o+1]=t[e+1],t[e]=i,t[e+1]=a}function shufflePivot(r,o,e,t,i){r*=2,o*=2,i[r]=i[o],i[o]=e,i[r+1]=i[o+1],i[o+1]=t}function compare(r,o,e){r*=2,o*=2;var t=e[r],i=e[o];return i>t?!1:t===i?e[r+1]>e[o+1]:!0}function comparePivot(r,o,e,t){r*=2;var i=t[r];return o>i?!0:i===o?t[r+1]<e:!1}function quickSort(r,o,e){var t=(o-r+1)/6|0,i=r+t,a=o-t,c=r+o>>1,n=c-t,f=c+t,p=i,v=n,u=c,S=f,m=a,s=r+1,T=o-1,F=0;compare(p,v,e)&&(F=p,p=v,v=F),compare(S,m,e)&&(F=S,S=m,m=F),compare(p,u,e)&&(F=p,p=u,u=F),compare(v,u,e)&&(F=v,v=u,u=F),compare(p,S,e)&&(F=p,p=S,S=F),compare(u,S,e)&&(F=u,u=S,S=F),compare(v,m,e)&&(F=v,v=m,m=F),compare(v,u,e)&&(F=v,v=u,u=F),compare(S,m,e)&&(F=S,S=m,m=F);for(var O=e[2*v],R=e[2*v+1],_=e[2*S],k=e[2*S+1],P=2*p,l=2*u,q=2*m,w=2*i,C=2*c,E=2*a,I=0;2>I;++I){var N=e[P+I],U=e[l+I],b=e[q+I];e[w+I]=N,e[C+I]=U,e[E+I]=b}move(n,r,e),move(f,o,e);for(var h=s;T>=h;++h)if(comparePivot(h,O,R,e))h!==s&&swap(h,s,e),++s;else if(!comparePivot(h,_,k,e))for(;;){if(comparePivot(T,_,k,e)){comparePivot(T,O,R,e)?(rotate(h,s,T,e),++s,--T):(swap(h,T,e),--T);break}if(--T<h)break}shufflePivot(r,s-1,O,R,e),shufflePivot(o,T+1,_,k,e),INSERT_SORT_CUTOFF>=s-2-r?insertionSort(r,s-2,e):quickSort(r,s-2,e),INSERT_SORT_CUTOFF>=o-(T+2)?insertionSort(T+2,o,e):quickSort(T+2,o,e),INSERT_SORT_CUTOFF>=T-s?insertionSort(s,T,e):quickSort(s,T,e)}module.exports=wrapper;var INSERT_SORT_CUTOFF=32;

},{}],183:[function(require,module,exports){
"use strict";function sqInit(E){var _=bits.nextPow2(E);RED_SWEEP_QUEUE.length<_&&(pool.free(RED_SWEEP_QUEUE),RED_SWEEP_QUEUE=pool.mallocInt32(_)),RED_SWEEP_INDEX.length<_&&(pool.free(RED_SWEEP_INDEX),RED_SWEEP_INDEX=pool.mallocInt32(_)),BLUE_SWEEP_QUEUE.length<_&&(pool.free(BLUE_SWEEP_QUEUE),BLUE_SWEEP_QUEUE=pool.mallocInt32(_)),BLUE_SWEEP_INDEX.length<_&&(pool.free(BLUE_SWEEP_INDEX),BLUE_SWEEP_INDEX=pool.mallocInt32(_)),COMMON_SWEEP_QUEUE.length<_&&(pool.free(COMMON_SWEEP_QUEUE),COMMON_SWEEP_QUEUE=pool.mallocInt32(_)),COMMON_SWEEP_INDEX.length<_&&(pool.free(COMMON_SWEEP_INDEX),COMMON_SWEEP_INDEX=pool.mallocInt32(_));var S=8*_;SWEEP_EVENTS.length<S&&(pool.free(SWEEP_EVENTS),SWEEP_EVENTS=pool.mallocDouble(S))}function sqPop(E,_,S,r){var o=_[r],P=E[S-1];E[o]=P,_[P]=o}function sqPush(E,_,S,r){E[S]=r,_[r]=S}function sweepBipartite(E,_,S,r,o,P,U,W,e,a){for(var N=0,l=2*E,t=E-1,i=l-1,v=S;r>v;++v){var I=P[v],f=l*v;SWEEP_EVENTS[N++]=o[f+t],SWEEP_EVENTS[N++]=-(I+1),SWEEP_EVENTS[N++]=o[f+i],SWEEP_EVENTS[N++]=I}for(var v=U;W>v;++v){var I=a[v]+BLUE_FLAG,T=l*v;SWEEP_EVENTS[N++]=e[T+t],SWEEP_EVENTS[N++]=-I,SWEEP_EVENTS[N++]=e[T+i],SWEEP_EVENTS[N++]=I}var n=N>>>1;isort(SWEEP_EVENTS,n);for(var s=0,D=0,v=0;n>v;++v){var p=0|SWEEP_EVENTS[2*v+1];if(p>=BLUE_FLAG)p=p-BLUE_FLAG|0,sqPop(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,D--,p);else if(p>=0)sqPop(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,s--,p);else if(-BLUE_FLAG>=p){p=-p-BLUE_FLAG|0;for(var L=0;s>L;++L){var V=_(RED_SWEEP_QUEUE[L],p);if(void 0!==V)return V}sqPush(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,D++,p)}else{p=-p-1|0;for(var L=0;D>L;++L){var V=_(p,BLUE_SWEEP_QUEUE[L]);if(void 0!==V)return V}sqPush(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,s++,p)}}}function sweepComplete(E,_,S,r,o,P,U,W,e,a){for(var N=0,l=2*E,t=E-1,i=l-1,v=S;r>v;++v){var I=P[v]+1<<1,f=l*v;SWEEP_EVENTS[N++]=o[f+t],SWEEP_EVENTS[N++]=-I,SWEEP_EVENTS[N++]=o[f+i],SWEEP_EVENTS[N++]=I}for(var v=U;W>v;++v){var I=a[v]+1<<1,T=l*v;SWEEP_EVENTS[N++]=e[T+t],SWEEP_EVENTS[N++]=1|-I,SWEEP_EVENTS[N++]=e[T+i],SWEEP_EVENTS[N++]=1|I}var n=N>>>1;isort(SWEEP_EVENTS,n);for(var s=0,D=0,p=0,v=0;n>v;++v){var L=0|SWEEP_EVENTS[2*v+1],V=1&L;if(n-1>v&&L>>1===SWEEP_EVENTS[2*v+3]>>1&&(V=2,v+=1),0>L){for(var B=-(L>>1)-1,C=0;p>C;++C){var Q=_(COMMON_SWEEP_QUEUE[C],B);if(void 0!==Q)return Q}if(0!==V)for(var C=0;s>C;++C){var Q=_(RED_SWEEP_QUEUE[C],B);if(void 0!==Q)return Q}if(1!==V)for(var C=0;D>C;++C){var Q=_(BLUE_SWEEP_QUEUE[C],B);if(void 0!==Q)return Q}0===V?sqPush(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,s++,B):1===V?sqPush(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,D++,B):2===V&&sqPush(COMMON_SWEEP_QUEUE,COMMON_SWEEP_INDEX,p++,B)}else{var B=(L>>1)-1;0===V?sqPop(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,s--,B):1===V?sqPop(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,D--,B):2===V&&sqPop(COMMON_SWEEP_QUEUE,COMMON_SWEEP_INDEX,p--,B)}}}function scanBipartite(E,_,S,r,o,P,U,W,e,a,N,l){var t=0,i=2*E,v=_,I=_+E,f=1,T=1;r?T=BLUE_FLAG:f=BLUE_FLAG;for(var n=o;P>n;++n){var s=n+f,D=i*n;SWEEP_EVENTS[t++]=U[D+v],SWEEP_EVENTS[t++]=-s,SWEEP_EVENTS[t++]=U[D+I],SWEEP_EVENTS[t++]=s}for(var n=e;a>n;++n){var s=n+T,p=i*n;SWEEP_EVENTS[t++]=N[p+v],SWEEP_EVENTS[t++]=-s}var L=t>>>1;isort(SWEEP_EVENTS,L);for(var V=0,n=0;L>n;++n){var B=0|SWEEP_EVENTS[2*n+1];if(0>B){var s=-B,C=!1;if(s>=BLUE_FLAG?(C=!r,s-=BLUE_FLAG):(C=!!r,s-=1),C)sqPush(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,V++,s);else{var Q=l[s],c=i*s,u=N[c+_+1],A=N[c+_+1+E];E:for(var R=0;V>R;++R){var M=RED_SWEEP_QUEUE[R],O=i*M;if(!(A<U[O+_+1]||U[O+_+1+E]<u)){for(var X=_+2;E>X;++X)if(N[c+X+E]<U[O+X]||U[O+X+E]<N[c+X])continue E;var m,q=W[M];if(m=r?S(Q,q):S(q,Q),void 0!==m)return m}}}}else sqPop(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,V--,B-f)}}function scanComplete(E,_,S,r,o,P,U,W,e,a,N){for(var l=0,t=2*E,i=_,v=_+E,I=r;o>I;++I){var f=I+BLUE_FLAG,T=t*I;SWEEP_EVENTS[l++]=P[T+i],SWEEP_EVENTS[l++]=-f,SWEEP_EVENTS[l++]=P[T+v],SWEEP_EVENTS[l++]=f}for(var I=W;e>I;++I){var f=I+1,n=t*I;SWEEP_EVENTS[l++]=a[n+i],SWEEP_EVENTS[l++]=-f}var s=l>>>1;isort(SWEEP_EVENTS,s);for(var D=0,I=0;s>I;++I){var p=0|SWEEP_EVENTS[2*I+1];if(0>p){var f=-p;if(f>=BLUE_FLAG)RED_SWEEP_QUEUE[D++]=f-BLUE_FLAG;else{f-=1;var L=N[f],V=t*f,B=a[V+_+1],C=a[V+_+1+E];E:for(var Q=0;D>Q;++Q){var c=RED_SWEEP_QUEUE[Q],u=U[c];if(u===L)break;var A=t*c;if(!(C<P[A+_+1]||P[A+_+1+E]<B)){for(var R=_+2;E>R;++R)if(a[V+R+E]<P[A+R]||P[A+R+E]<a[V+R])continue E;var M=S(u,L);if(void 0!==M)return M}}}}else{for(var f=p-BLUE_FLAG,Q=D-1;Q>=0;--Q)if(RED_SWEEP_QUEUE[Q]===f){for(var R=Q+1;D>R;++R)RED_SWEEP_QUEUE[R-1]=RED_SWEEP_QUEUE[R];break}--D}}}module.exports={init:sqInit,sweepBipartite:sweepBipartite,sweepComplete:sweepComplete,scanBipartite:scanBipartite,scanComplete:scanComplete};var pool=require("typedarray-pool"),bits=require("bit-twiddle"),isort=require("./sort"),BLUE_FLAG=1<<28,INIT_CAPACITY=1024,RED_SWEEP_QUEUE=pool.mallocInt32(INIT_CAPACITY),RED_SWEEP_INDEX=pool.mallocInt32(INIT_CAPACITY),BLUE_SWEEP_QUEUE=pool.mallocInt32(INIT_CAPACITY),BLUE_SWEEP_INDEX=pool.mallocInt32(INIT_CAPACITY),COMMON_SWEEP_QUEUE=pool.mallocInt32(INIT_CAPACITY),COMMON_SWEEP_INDEX=pool.mallocInt32(INIT_CAPACITY),SWEEP_EVENTS=pool.mallocDouble(8*INIT_CAPACITY);

},{"./sort":182,"bit-twiddle":118,"typedarray-pool":184}],184:[function(require,module,exports){
(function (global,Buffer){
"use strict";function freeArrayBuffer(r){if(r){var e=r.length||r.byteLength,t=bits.log2(e);DATA[t].push(r)}}function freeTypedArray(r){freeArrayBuffer(r.buffer)}function mallocArrayBuffer(r){var r=bits.nextPow2(r),e=bits.log2(r),t=DATA[e];return t.length>0?t.pop():new ArrayBuffer(r)}function mallocUint8(r){return new Uint8Array(mallocArrayBuffer(r),0,r)}function mallocUint16(r){return new Uint16Array(mallocArrayBuffer(2*r),0,r)}function mallocUint32(r){return new Uint32Array(mallocArrayBuffer(4*r),0,r)}function mallocInt8(r){return new Int8Array(mallocArrayBuffer(r),0,r)}function mallocInt16(r){return new Int16Array(mallocArrayBuffer(2*r),0,r)}function mallocInt32(r){return new Int32Array(mallocArrayBuffer(4*r),0,r)}function mallocFloat(r){return new Float32Array(mallocArrayBuffer(4*r),0,r)}function mallocDouble(r){return new Float64Array(mallocArrayBuffer(8*r),0,r)}function mallocUint8Clamped(r){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(r),0,r):mallocUint8(r)}function mallocDataView(r){return new DataView(mallocArrayBuffer(r),0,r)}function mallocBuffer(r){r=bits.nextPow2(r);var e=bits.log2(r),t=BUFFER[e];return t.length>0?t.pop():new Buffer(r)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(r){if(Buffer.isBuffer(r))BUFFER[bits.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var e=r.length||r.byteLength,t=0|bits.log2(e);DATA[t].push(r)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(r){BUFFER[bits.log2(r.length)].push(r)},exports.malloc=function(r,e){if(void 0===e||"arraybuffer"===e)return mallocArrayBuffer(r);switch(e){case"uint8":return mallocUint8(r);case"uint16":return mallocUint16(r);case"uint32":return mallocUint32(r);case"int8":return mallocInt8(r);case"int16":return mallocInt16(r);case"int32":return mallocInt32(r);case"float":case"float32":return mallocFloat(r);case"double":case"float64":return mallocDouble(r);case"uint8_clamped":return mallocUint8Clamped(r);case"buffer":return mallocBuffer(r);case"data":case"dataview":return mallocDataView(r);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var r=0;32>r;++r)POOL.UINT8[r].length=0,POOL.UINT16[r].length=0,POOL.UINT32[r].length=0,POOL.INT8[r].length=0,POOL.INT16[r].length=0,POOL.INT32[r].length=0,POOL.FLOAT[r].length=0,POOL.DOUBLE[r].length=0,POOL.UINT8C[r].length=0,DATA[r].length=0,BUFFER[r].length=0};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"bit-twiddle":118,"buffer":5,"dup":119}],185:[function(require,module,exports){
function compareInt(n,r){return n-r}function compareCells(n,r){var e=n.length,i=n.length-r.length;if(i)return i;switch(e){case 0:return 0;case 1:return n[0]-r[0];case 2:return n[0]+n[1]-r[0]-r[1]||min(n[0],n[1])-min(r[0],r[1]);case 3:var t=n[0]+n[1],m=r[0]+r[1];if(i=t+n[2]-(m+r[2]))return i;var a=min(n[0],n[1]),c=min(r[0],r[1]);return min(a,n[2])-min(c,r[2])||min(a+n[2],t)-min(c+r[2],m);case 4:var u=n[0],s=n[1],o=n[2],l=n[3],f=r[0],p=r[1],v=r[2],h=r[3];return u+s+o+l-(f+p+v+h)||min(u,s,o,l)-min(f,p,v,h,f)||min(u+s,u+o,u+l,s+o,s+l,o+l)-min(f+p,f+v,f+h,p+v,p+h,v+h)||min(u+s+o,u+s+l,u+o+l,s+o+l)-min(f+p+v,f+p+h,f+v+h,p+v+h);default:for(var g=n.slice().sort(compareInt),I=r.slice().sort(compareInt),d=0;e>d;++d)if(i=g[d]-I[d])return i;return 0}}module.exports=compareCells;var min=Math.min;

},{}],186:[function(require,module,exports){
"use strict";function nextafter(e,t){if(isNaN(e)||isNaN(t))return NaN;if(e===t)return e;if(0===e)return 0>t?-SMALLEST_DENORM:SMALLEST_DENORM;var r=doubleBits.hi(e),i=doubleBits.lo(e);return t>e==e>0?i===UINT_MAX?(r+=1,i=0):i+=1:0===i?(i=UINT_MAX,r-=1):i-=1,doubleBits.pack(i,r)}var doubleBits=require("double-bits"),SMALLEST_DENORM=Math.pow(2,-1074),UINT_MAX=-1>>>0;module.exports=nextafter;

},{"double-bits":187}],187:[function(require,module,exports){
(function (Buffer){
function toDoubleLE(e,r){return UINT_VIEW[0]=e,UINT_VIEW[1]=r,DOUBLE_VIEW[0]}function lowUintLE(e){return DOUBLE_VIEW[0]=e,UINT_VIEW[0]}function highUintLE(e){return DOUBLE_VIEW[0]=e,UINT_VIEW[1]}function toDoubleBE(e,r){return UINT_VIEW[1]=e,UINT_VIEW[0]=r,DOUBLE_VIEW[0]}function lowUintBE(e){return DOUBLE_VIEW[0]=e,UINT_VIEW[1]}function highUintBE(e){return DOUBLE_VIEW[0]=e,UINT_VIEW[0]}function toDouble(e,r){return buffer.writeUInt32LE(e,0,!0),buffer.writeUInt32LE(r,4,!0),buffer.readDoubleLE(0,!0)}function lowUint(e){return buffer.writeDoubleLE(e,0,!0),buffer.readUInt32LE(0,!0)}function highUint(e){return buffer.writeDoubleLE(e,0,!0),buffer.readUInt32LE(4,!0)}var hasTypedArrays=!1;if("undefined"!=typeof Float64Array){var DOUBLE_VIEW=new Float64Array(1),UINT_VIEW=new Uint32Array(DOUBLE_VIEW.buffer);DOUBLE_VIEW[0]=1,hasTypedArrays=!0,1072693248===UINT_VIEW[1]?(module.exports=function(e){return DOUBLE_VIEW[0]=e,[UINT_VIEW[0],UINT_VIEW[1]]},module.exports.pack=toDoubleLE,module.exports.lo=lowUintLE,module.exports.hi=highUintLE):1072693248===UINT_VIEW[0]?(module.exports=function(e){return DOUBLE_VIEW[0]=e,[UINT_VIEW[1],UINT_VIEW[0]]},module.exports.pack=toDoubleBE,module.exports.lo=lowUintBE,module.exports.hi=highUintBE):hasTypedArrays=!1}if(!hasTypedArrays){var buffer=new Buffer(8);module.exports=function(e){return buffer.writeDoubleLE(e,0,!0),[buffer.readUInt32LE(0,!0),buffer.readUInt32LE(4,!0)]},module.exports.pack=toDouble,module.exports.lo=lowUint,module.exports.hi=highUint}module.exports.sign=function(e){return module.exports.hi(e)>>>31},module.exports.exponent=function(e){var r=module.exports.hi(e);return(r<<1>>>21)-1023},module.exports.fraction=function(e){var r=module.exports.lo(e),o=module.exports.hi(e),t=1048575&o;return 2146435072&o&&(t+=1<<20),[r,t]},module.exports.denormalized=function(e){var r=module.exports.hi(e);return!(2146435072&r)};

}).call(this,require("buffer").Buffer)
},{"buffer":5}],188:[function(require,module,exports){
"use strict";function add(r,d){for(var a=r.length,e=new Array(a),n=0;a>n;++n)e[n]=bnadd(r[n],d[n]);return e}var bnadd=require("big-rat/add");module.exports=add;

},{"big-rat/add":159}],189:[function(require,module,exports){
"use strict";function float2rat(r){for(var t=new Array(r.length),a=0;a<r.length;++a)t[a]=rat(r[a]);return t}module.exports=float2rat;var rat=require("big-rat");

},{"big-rat":162}],190:[function(require,module,exports){
"use strict";function muls(r,u){for(var e=rat(u),t=r.length,a=new Array(t),l=0;t>l;++l)a[l]=mul(r[l],e);return a}var rat=require("big-rat"),mul=require("big-rat/mul");module.exports=muls;

},{"big-rat":162,"big-rat/mul":171}],191:[function(require,module,exports){
"use strict";function sub(r,u){for(var b=r.length,e=new Array(b),s=0;b>s;++s)e[s]=bnsub(r[s],u[s]);return e}var bnsub=require("big-rat/sub");module.exports=sub;

},{"big-rat/sub":175}],192:[function(require,module,exports){
"use strict";function checkCollinear(r,e,t,n){for(var i=0;2>i;++i){var o=r[i],a=e[i],s=Math.min(o,a),u=Math.max(o,a),c=t[i],m=n[i],h=Math.min(c,m),f=Math.max(c,m);if(s>f||h>u)return!1}return!0}function segmentsIntersect(r,e,t,n){var i=orient(r,t,n),o=orient(e,t,n);if(i>0&&o>0||0>i&&0>o)return!1;var a=orient(t,r,e),s=orient(n,r,e);return a>0&&s>0||0>a&&0>s?!1:0===i&&0===o&&0===a&&0===s?checkCollinear(r,e,t,n):!0}module.exports=segmentsIntersect;var orient=require("robust-orientation")[3];

},{"robust-orientation":138}],193:[function(require,module,exports){
"use strict";"use restrict";function UnionFind(t){this.roots=new Array(t),this.ranks=new Array(t);for(var r=0;t>r;++r)this.roots[r]=r,this.ranks[r]=0}module.exports=UnionFind;var proto=UnionFind.prototype;Object.defineProperty(proto,"length",{get:function(){return this.roots.length}}),proto.makeSet=function(){var t=this.roots.length;return this.roots.push(t),this.ranks.push(0),t},proto.find=function(t){for(var r=t,o=this.roots;o[t]!==t;)t=o[t];for(;o[r]!==t;){var n=o[r];o[r]=t,r=n}return t},proto.link=function(t,r){var o=this.find(t),n=this.find(r);if(o!==n){var i=this.ranks,s=this.roots,e=i[o],h=i[n];h>e?s[o]=n:e>h?s[n]=o:(s[n]=o,++i[o])}};

},{}],194:[function(require,module,exports){
"use strict";function trimLeaves(e,r){for(var t=e2a(e,r.length),a=new Array(r.length),n=new Array(r.length),h=[],l=0;l<r.length;++l){var g=t[l].length;n[l]=g,a[l]=!0,1>=g&&h.push(l)}for(;h.length>0;){var s=h.pop();a[s]=!1;for(var v=t[s],l=0;l<v.length;++l){var o=v[l];0===--n[o]&&h.push(o)}}for(var u=new Array(r.length),f=[],l=0;l<r.length;++l)if(a[l]){var s=f.length;u[l]=s,f.push(r[l])}else u[l]=-1;for(var i=[],l=0;l<e.length;++l){var p=e[l];a[p[0]]&&a[p[1]]&&i.push([u[p[0]],u[p[1]]])}return[i,f]}module.exports=trimLeaves;var e2a=require("edges-to-adjacency-list");

},{"edges-to-adjacency-list":195}],195:[function(require,module,exports){
"use strict";function edgeToAdjacency(r,e){var n=r.length;if("number"!=typeof e){e=0;for(var a=0;n>a;++a){var u=r[a];e=Math.max(e,u[0],u[1])}e=(0|e)+1}e=0|e;for(var o=new Array(e),a=0;e>a;++a)o[a]=[];for(var a=0;n>a;++a){var u=r[a];o[u[0]].push(u[1]),o[u[1]].push(u[0])}for(var t=0;e>t;++t)uniq(o[t],function(r,e){return r-e});return o}module.exports=edgeToAdjacency;var uniq=require("uniq");

},{"uniq":210}],196:[function(require,module,exports){
"use strict";function planarDual(r,e){function n(r,e){var n=u[e][r[e]];n.splice(n.indexOf(r),1)}function a(r,a,t){for(var l,h,o,f=0;2>f;++f)if(u[f][a].length>0){l=u[f][a][0],o=f;break}h=l[1^o];for(var g=0;2>g;++g)for(var p=u[g][a],v=0;v<p.length;++v){var i=p[v],s=i[1^g],c=compareAngle(e[r],e[a],e[h],e[s]);c>0&&(l=i,h=s,o=g)}return t?h:(l&&n(l,o),h)}function t(r,t){var l=u[t][r][0],h=[r];n(l,t);for(var o=l[1^t];;){for(;o!==r;)h.push(o),o=a(h[h.length-2],o,!1);if(u[0][r].length+u[1][r].length===0)break;var f=h[h.length-1],g=r,p=h[1],v=a(f,g,!0);if(compareAngle(e[f],e[g],e[p],e[v])<0)break;h.push(r),o=a(f,g)}return h}function l(r,e){return e[1]===e[e.length-1]}for(var h=0|e.length,o=r.length,u=[new Array(h),new Array(h)],f=0;h>f;++f)u[0][f]=[],u[1][f]=[];for(var f=0;o>f;++f){var g=r[f];u[0][g[0]].push(g),u[1][g[1]].push(g)}for(var p=[],f=0;h>f;++f)u[0][f].length+u[1][f].length===0&&p.push([f]);for(var f=0;h>f;++f)for(var v=0;2>v;++v){for(var i=[];u[v][f].length>0;){var s=(u[0][f].length,t(f,v));l(i,s)?i.push.apply(i,s):(i.length>0&&p.push(i),i=s)}i.length>0&&p.push(i)}return p}module.exports=planarDual;var compareAngle=require("compare-angle");

},{"compare-angle":197}],197:[function(require,module,exports){
"use strict";function testInterior(r,t,e){var o=twoSum(r[0],-t[0]),u=twoSum(r[1],-t[1]),n=twoSum(e[0],-t[0]),i=twoSum(e[1],-t[1]),s=robustSum(robustProduct(o,n),robustProduct(u,i));return s[s.length-1]>=0}function compareAngle(r,t,e,o){var u=orient(t,e,o);if(0===u){var n=sgn(orient(r,t,e)),i=sgn(orient(r,t,o));if(n===i){if(0===n){var s=testInterior(r,t,e),m=testInterior(r,t,o);return s===m?0:s?1:-1}return 0}return 0===i?n>0?-1:testInterior(r,t,o)?-1:1:0===n?i>0?1:testInterior(r,t,e)?1:-1:sgn(i-n)}var a=orient(r,t,e);if(a>0)return u>0&&orient(r,t,o)>0?1:-1;if(0>a)return u>0||orient(r,t,o)>0?1:-1;var c=orient(r,t,o);return c>0?1:testInterior(r,t,e)?1:-1}module.exports=compareAngle;var orient=require("robust-orientation"),sgn=require("signum"),twoSum=require("two-sum"),robustProduct=require("robust-product"),robustSum=require("robust-sum");

},{"robust-orientation":138,"robust-product":199,"robust-sum":208,"signum":200,"two-sum":201}],198:[function(require,module,exports){
"use strict";function scaleLinearExpansion(r,t){var o=r.length;if(1===o){var e=twoProduct(r[0],t);return e[0]?e:[e[1]]}var u=new Array(2*o),a=[.1,.1],n=[.1,.1],c=0;twoProduct(r[0],t,a),a[0]&&(u[c++]=a[0]);for(var i=1;o>i;++i){twoProduct(r[i],t,n);var w=a[1];twoSum(w,n[0],a),a[0]&&(u[c++]=a[0]);var s=n[1],v=a[1],d=s+v,l=d-s,m=v-l;a[1]=d,m&&(u[c++]=m)}return a[1]&&(u[c++]=a[1]),0===c&&(u[c++]=0),u.length=c,u}var twoProduct=require("two-product"),twoSum=require("two-sum");module.exports=scaleLinearExpansion;

},{"two-product":209,"two-sum":201}],199:[function(require,module,exports){
"use strict";function robustProduct(r,t){if(1===r.length)return robustScale(t,r[0]);if(1===t.length)return robustScale(r,t[0]);if(0===r.length||0===t.length)return[0];var e=[0];if(r.length<t.length)for(var u=0;u<r.length;++u)e=robustSum(e,robustScale(t,r[u]));else for(var u=0;u<t.length;++u)e=robustSum(e,robustScale(r,t[u]));return e}var robustSum=require("robust-sum"),robustScale=require("robust-scale");module.exports=robustProduct;

},{"robust-scale":198,"robust-sum":208}],200:[function(require,module,exports){
"use strict";module.exports=function(t){return 0>t?-1:t>0?1:0};

},{}],201:[function(require,module,exports){
"use strict";function fastTwoSum(t,u,o){var r=t+u,s=r-t,e=r-s,a=u-s,f=t-e;return o?(o[0]=f+a,o[1]=r,o):[f+a,r]}module.exports=fastTwoSum;

},{}],202:[function(require,module,exports){
"use strict";function compileSearch(e,n,c,i,r,u){var h=["function ",e,"(a,l,h,",i.join(","),"){",u?"":"var i=",c?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",r?".get(m)":"[m]"];return u?n.indexOf("c")<0?h.push(";if(x===y){return m}else if(x<=y){"):h.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):h.push(";if(",n,"){i=m;"),c?h.push("l=m+1}else{h=m-1}"):h.push("h=m-1}else{l=m+1}"),h.push("}"),u?h.push("return -1};"):h.push("return i};"),h.join("")}function compileBoundsSearch(e,n,c,i){var r=new Function([compileSearch("A","x"+e+"y",n,["y"],!1,i),compileSearch("B","x"+e+"y",n,["y"],!0,i),compileSearch("P","c(x,y)"+e+"0",n,["y","c"],!1,i),compileSearch("Q","c(x,y)"+e+"0",n,["y","c"],!0,i),"function dispatchBsearch",c,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",c].join(""));return r()}module.exports={ge:compileBoundsSearch(">=",!1,"GE"),gt:compileBoundsSearch(">",!1,"GT"),lt:compileBoundsSearch("<",!0,"LT"),le:compileBoundsSearch("<=",!0,"LE"),eq:compileBoundsSearch("-",!0,"EQ",!0)};

},{}],203:[function(require,module,exports){
"use strict";function IntervalTreeNode(t,i,r,e,n){this.mid=t,this.left=i,this.right=r,this.leftPoints=e,this.rightPoints=n,this.count=(i?i.count:0)+(r?r.count:0)+e.length}function copy(t,i){t.mid=i.mid,t.left=i.left,t.right=i.right,t.leftPoints=i.leftPoints,t.rightPoints=i.rightPoints,t.count=i.count}function rebuild(t,i){var r=createIntervalTree(i);t.mid=r.mid,t.left=r.left,t.right=r.right,t.leftPoints=r.leftPoints,t.rightPoints=r.rightPoints,t.count=r.count}function rebuildWithInterval(t,i){var r=t.intervals([]);r.push(i),rebuild(t,r)}function rebuildWithoutInterval(t,i){var r=t.intervals([]),e=r.indexOf(i);return 0>e?NOT_FOUND:(r.splice(e,1),rebuild(t,r),SUCCESS)}function reportLeftRange(t,i,r){for(var e=0;e<t.length&&t[e][0]<=i;++e){var n=r(t[e]);if(n)return n}}function reportRightRange(t,i,r){for(var e=t.length-1;e>=0&&t[e][1]>=i;--e){var n=r(t[e]);if(n)return n}}function reportRange(t,i){for(var r=0;r<t.length;++r){var e=i(t[r]);if(e)return e}}function compareNumbers(t,i){return t-i}function compareBegin(t,i){var r=t[0]-i[0];return r?r:t[1]-i[1]}function compareEnd(t,i){var r=t[1]-i[1];return r?r:t[0]-i[0]}function createIntervalTree(t){if(0===t.length)return null;for(var i=[],r=0;r<t.length;++r)i.push(t[r][0],t[r][1]);i.sort(compareNumbers);for(var e=i[i.length>>1],n=[],o=[],s=[],r=0;r<t.length;++r){var h=t[r];h[1]<e?n.push(h):e<h[0]?o.push(h):s.push(h)}var l=s,u=s.slice();return l.sort(compareBegin),u.sort(compareEnd),new IntervalTreeNode(e,createIntervalTree(n),createIntervalTree(o),l,u)}function IntervalTree(t){this.root=t}function createWrapper(t){return new IntervalTree(t&&0!==t.length?createIntervalTree(t):null)}var bounds=require("binary-search-bounds"),NOT_FOUND=0,SUCCESS=1,EMPTY=2;module.exports=createWrapper;var proto=IntervalTreeNode.prototype;proto.intervals=function(t){return t.push.apply(t,this.leftPoints),this.left&&this.left.intervals(t),this.right&&this.right.intervals(t),t},proto.insert=function(t){var i=this.count-this.leftPoints.length;if(this.count+=1,t[1]<this.mid)this.left?4*(this.left.count+1)>3*(i+1)?rebuildWithInterval(this,t):this.left.insert(t):this.left=createIntervalTree([t]);else if(t[0]>this.mid)this.right?4*(this.right.count+1)>3*(i+1)?rebuildWithInterval(this,t):this.right.insert(t):this.right=createIntervalTree([t]);else{var r=bounds.ge(this.leftPoints,t,compareBegin),e=bounds.ge(this.rightPoints,t,compareEnd);this.leftPoints.splice(r,0,t),this.rightPoints.splice(e,0,t)}},proto.remove=function(t){var i=this.count-this.leftPoints;if(t[1]<this.mid){if(!this.left)return NOT_FOUND;var r=this.right?this.right.count:0;if(4*r>3*(i-1))return rebuildWithoutInterval(this,t);var e=this.left.remove(t);return e===EMPTY?(this.left=null,this.count-=1,SUCCESS):(e===SUCCESS&&(this.count-=1),e)}if(t[0]>this.mid){if(!this.right)return NOT_FOUND;var n=this.left?this.left.count:0;if(4*n>3*(i-1))return rebuildWithoutInterval(this,t);var e=this.right.remove(t);return e===EMPTY?(this.right=null,this.count-=1,SUCCESS):(e===SUCCESS&&(this.count-=1),e)}if(1===this.count)return this.leftPoints[0]===t?EMPTY:NOT_FOUND;if(1===this.leftPoints.length&&this.leftPoints[0]===t){if(this.left&&this.right){for(var o=this,s=this.left;s.right;)o=s,s=s.right;if(o===this)s.right=this.right;else{var h=this.left,e=this.right;o.count-=s.count,o.right=s.left,s.left=h,s.right=e}copy(this,s),this.count=(this.left?this.left.count:0)+(this.right?this.right.count:0)+this.leftPoints.length}else this.left?copy(this,this.left):copy(this,this.right);return SUCCESS}for(var h=bounds.ge(this.leftPoints,t,compareBegin);h<this.leftPoints.length&&this.leftPoints[h][0]===t[0];++h)if(this.leftPoints[h]===t){this.count-=1,this.leftPoints.splice(h,1);for(var e=bounds.ge(this.rightPoints,t,compareEnd);e<this.rightPoints.length&&this.rightPoints[e][1]===t[1];++e)if(this.rightPoints[e]===t)return this.rightPoints.splice(e,1),SUCCESS}return NOT_FOUND},proto.queryPoint=function(t,i){if(t<this.mid){if(this.left){var r=this.left.queryPoint(t,i);if(r)return r}return reportLeftRange(this.leftPoints,t,i)}if(t>this.mid){if(this.right){var r=this.right.queryPoint(t,i);if(r)return r}return reportRightRange(this.rightPoints,t,i)}return reportRange(this.leftPoints,i)},proto.queryInterval=function(t,i,r){if(t<this.mid&&this.left){var e=this.left.queryInterval(t,i,r);if(e)return e}if(i>this.mid&&this.right){var e=this.right.queryInterval(t,i,r);if(e)return e}return i<this.mid?reportLeftRange(this.leftPoints,i,r):t>this.mid?reportRightRange(this.rightPoints,t,r):reportRange(this.leftPoints,r)};var tproto=IntervalTree.prototype;tproto.insert=function(t){this.root?this.root.insert(t):this.root=new IntervalTreeNode(t[0],null,null,[t],[t])},tproto.remove=function(t){if(this.root){var i=this.root.remove(t);return i===EMPTY&&(this.root=null),i!==NOT_FOUND}return!1},tproto.queryPoint=function(t,i){return this.root?this.root.queryPoint(t,i):void 0},tproto.queryInterval=function(t,i,r){return i>=t&&this.root?this.root.queryInterval(t,i,r):void 0},Object.defineProperty(tproto,"count",{get:function(){return this.root?this.root.count:0}}),Object.defineProperty(tproto,"intervals",{get:function(){return this.root?this.root.intervals([]):[]}});

},{"binary-search-bounds":202}],204:[function(require,module,exports){
"use strict";function horizontalOrder(r,e){var t,i;if(e[0][0]<e[1][0])t=e[0],i=e[1];else{if(!(e[0][0]>e[1][0])){var n=Math.min(r[0][1],r[1][1]),o=Math.max(r[0][1],r[1][1]),a=Math.min(e[0][1],e[1][1]),f=Math.max(e[0][1],e[1][1]);return a>o?o-a:n>f?n-f:o-f}t=e[1],i=e[0]}var u,s;r[0][1]<r[1][1]?(u=r[0],s=r[1]):(u=r[1],s=r[0]);var l=orient(i,t,u);return l?l:(l=orient(i,t,s),l?l:s-i)}function orderSegments(r,e){var t,i;if(e[0][0]<e[1][0])t=e[0],i=e[1];else{if(!(e[0][0]>e[1][0]))return horizontalOrder(e,r);t=e[1],i=e[0]}var n,o;if(r[0][0]<r[1][0])n=r[0],o=r[1];else{if(!(r[0][0]>r[1][0]))return-horizontalOrder(r,e);n=r[1],o=r[0]}var a=orient(t,i,o),f=orient(t,i,n);if(0>a){if(0>=f)return a}else if(a>0){if(f>=0)return a}else if(f)return f;if(a=orient(o,n,i),f=orient(o,n,t),0>a){if(0>=f)return a}else if(a>0){if(f>=0)return a}else if(f)return f;return i[0]-o[0]}module.exports=orderSegments;var orient=require("robust-orientation");

},{"robust-orientation":138}],205:[function(require,module,exports){
"use strict";function RBNode(t,e,r,o,i,l){this._color=t,this.key=e,this.value=r,this.left=o,this.right=i,this._count=l}function cloneNode(t){return new RBNode(t._color,t.key,t.value,t.left,t.right,t._count)}function repaint(t,e){return new RBNode(t,e.key,e.value,e.left,e.right,e._count)}function recount(t){t._count=1+(t.left?t.left._count:0)+(t.right?t.right._count:0)}function RedBlackTree(t,e){this._compare=t,this.root=e}function doVisitFull(t,e){if(e.left){var r=doVisitFull(t,e.left);if(r)return r}var r=t(e.key,e.value);return r?r:e.right?doVisitFull(t,e.right):void 0}function doVisitHalf(t,e,r,o){var i=e(t,o.key);if(0>=i){if(o.left){var l=doVisitHalf(t,e,r,o.left);if(l)return l}var l=r(o.key,o.value);if(l)return l}return o.right?doVisitHalf(t,e,r,o.right):void 0}function doVisit(t,e,r,o,i){var l,n=r(t,i.key),c=r(e,i.key);if(0>=n){if(i.left&&(l=doVisit(t,e,r,o,i.left)))return l;if(c>0&&(l=o(i.key,i.value)))return l}return c>0&&i.right?doVisit(t,e,r,o,i.right):void 0}function RedBlackTreeIterator(t,e){this.tree=t,this._stack=e}function swapNode(t,e){t.key=e.key,t.value=e.value,t.left=e.left,t.right=e.right,t._color=e._color,t._count=e._count}function fixDoubleBlack(t){for(var e,r,o,i,l=t.length-1;l>=0;--l){if(e=t[l],0===l)return void(e._color=BLACK);if(r=t[l-1],r.left===e){if(o=r.right,o.right&&o.right._color===RED){if(o=r.right=cloneNode(o),i=o.right=cloneNode(o.right),r.right=o.left,o.left=r,o.right=i,o._color=r._color,e._color=BLACK,r._color=BLACK,i._color=BLACK,recount(r),recount(o),l>1){var n=t[l-2];n.left===r?n.left=o:n.right=o}return void(t[l-1]=o)}if(o.left&&o.left._color===RED){if(o=r.right=cloneNode(o),i=o.left=cloneNode(o.left),r.right=i.left,o.left=i.right,i.left=r,i.right=o,i._color=r._color,r._color=BLACK,o._color=BLACK,e._color=BLACK,recount(r),recount(o),recount(i),l>1){var n=t[l-2];n.left===r?n.left=i:n.right=i}return void(t[l-1]=i)}if(o._color===BLACK){if(r._color===RED)return r._color=BLACK,void(r.right=repaint(RED,o));r.right=repaint(RED,o);continue}if(o=cloneNode(o),r.right=o.left,o.left=r,o._color=r._color,r._color=RED,recount(r),recount(o),l>1){var n=t[l-2];n.left===r?n.left=o:n.right=o}t[l-1]=o,t[l]=r,l+1<t.length?t[l+1]=e:t.push(e),l+=2}else{if(o=r.left,o.left&&o.left._color===RED){if(o=r.left=cloneNode(o),i=o.left=cloneNode(o.left),r.left=o.right,o.right=r,o.left=i,o._color=r._color,e._color=BLACK,r._color=BLACK,i._color=BLACK,recount(r),recount(o),l>1){var n=t[l-2];n.right===r?n.right=o:n.left=o}return void(t[l-1]=o)}if(o.right&&o.right._color===RED){if(o=r.left=cloneNode(o),i=o.right=cloneNode(o.right),r.left=i.right,o.right=i.left,i.right=r,i.left=o,i._color=r._color,r._color=BLACK,o._color=BLACK,e._color=BLACK,recount(r),recount(o),recount(i),l>1){var n=t[l-2];n.right===r?n.right=i:n.left=i}return void(t[l-1]=i)}if(o._color===BLACK){if(r._color===RED)return r._color=BLACK,void(r.left=repaint(RED,o));r.left=repaint(RED,o);continue}if(o=cloneNode(o),r.left=o.right,o.right=r,o._color=r._color,r._color=RED,recount(r),recount(o),l>1){var n=t[l-2];n.right===r?n.right=o:n.left=o}t[l-1]=o,t[l]=r,l+1<t.length?t[l+1]=e:t.push(e),l+=2}}}function defaultCompare(t,e){return e>t?-1:t>e?1:0}function createRBTree(t){return new RedBlackTree(t||defaultCompare,null)}module.exports=createRBTree;var RED=0,BLACK=1,proto=RedBlackTree.prototype;Object.defineProperty(proto,"keys",{get:function(){var t=[];return this.forEach(function(e,r){t.push(e)}),t}}),Object.defineProperty(proto,"values",{get:function(){var t=[];return this.forEach(function(e,r){t.push(r)}),t}}),Object.defineProperty(proto,"length",{get:function(){return this.root?this.root._count:0}}),proto.insert=function(t,e){for(var r=this._compare,o=this.root,i=[],l=[];o;){var n=r(t,o.key);i.push(o),l.push(n),o=0>=n?o.left:o.right}i.push(new RBNode(RED,t,e,null,null,1));for(var c=i.length-2;c>=0;--c){var o=i[c];l[c]<=0?i[c]=new RBNode(o._color,o.key,o.value,i[c+1],o.right,o._count+1):i[c]=new RBNode(o._color,o.key,o.value,o.left,i[c+1],o._count+1)}for(var c=i.length-1;c>1;--c){var f=i[c-1],o=i[c];if(f._color===BLACK||o._color===BLACK)break;var h=i[c-2];if(h.left===f)if(f.left===o){var u=h.right;if(!u||u._color!==RED){if(h._color=RED,h.left=f.right,f._color=BLACK,f.right=h,i[c-2]=f,i[c-1]=o,recount(h),recount(f),c>=3){var a=i[c-3];a.left===h?a.left=f:a.right=f}break}f._color=BLACK,h.right=repaint(BLACK,u),h._color=RED,c-=1}else{var u=h.right;if(!u||u._color!==RED){if(f.right=o.left,h._color=RED,h.left=o.right,o._color=BLACK,o.left=f,o.right=h,i[c-2]=o,i[c-1]=f,recount(h),recount(f),recount(o),c>=3){var a=i[c-3];a.left===h?a.left=o:a.right=o}break}f._color=BLACK,h.right=repaint(BLACK,u),h._color=RED,c-=1}else if(f.right===o){var u=h.left;if(!u||u._color!==RED){if(h._color=RED,h.right=f.left,f._color=BLACK,f.left=h,i[c-2]=f,i[c-1]=o,recount(h),recount(f),c>=3){var a=i[c-3];a.right===h?a.right=f:a.left=f}break}f._color=BLACK,h.left=repaint(BLACK,u),h._color=RED,c-=1}else{var u=h.left;if(!u||u._color!==RED){if(f.left=o.right,h._color=RED,h.right=o.left,o._color=BLACK,o.right=f,o.left=h,i[c-2]=o,i[c-1]=f,recount(h),recount(f),recount(o),c>=3){var a=i[c-3];a.right===h?a.right=o:a.left=o}break}f._color=BLACK,h.left=repaint(BLACK,u),h._color=RED,c-=1}}return i[0]._color=BLACK,new RedBlackTree(r,i[0])},proto.forEach=function(t,e,r){if(this.root)switch(arguments.length){case 1:return doVisitFull(t,this.root);case 2:return doVisitHalf(e,this._compare,t,this.root);case 3:if(this._compare(e,r)>=0)return;return doVisit(e,r,this._compare,t,this.root)}},Object.defineProperty(proto,"begin",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.left;return new RedBlackTreeIterator(this,t)}}),Object.defineProperty(proto,"end",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.right;return new RedBlackTreeIterator(this,t)}}),proto.at=function(t){if(0>t)return new RedBlackTreeIterator(this,[]);for(var e=this.root,r=[];;){if(r.push(e),e.left){if(t<e.left._count){e=e.left;continue}t-=e.left._count}if(!t)return new RedBlackTreeIterator(this,r);if(t-=1,!e.right)break;if(t>=e.right._count)break;e=e.right}return new RedBlackTreeIterator(this,[])},proto.ge=function(t){for(var e=this._compare,r=this.root,o=[],i=0;r;){var l=e(t,r.key);o.push(r),0>=l&&(i=o.length),r=0>=l?r.left:r.right}return o.length=i,new RedBlackTreeIterator(this,o)},proto.gt=function(t){for(var e=this._compare,r=this.root,o=[],i=0;r;){var l=e(t,r.key);o.push(r),0>l&&(i=o.length),r=0>l?r.left:r.right}return o.length=i,new RedBlackTreeIterator(this,o)},proto.lt=function(t){for(var e=this._compare,r=this.root,o=[],i=0;r;){var l=e(t,r.key);o.push(r),l>0&&(i=o.length),r=0>=l?r.left:r.right}return o.length=i,new RedBlackTreeIterator(this,o)},proto.le=function(t){for(var e=this._compare,r=this.root,o=[],i=0;r;){var l=e(t,r.key);o.push(r),l>=0&&(i=o.length),r=0>l?r.left:r.right}return o.length=i,new RedBlackTreeIterator(this,o)},proto.find=function(t){for(var e=this._compare,r=this.root,o=[];r;){var i=e(t,r.key);if(o.push(r),0===i)return new RedBlackTreeIterator(this,o);r=0>=i?r.left:r.right}return new RedBlackTreeIterator(this,[])},proto.remove=function(t){var e=this.find(t);return e?e.remove():this},proto.get=function(t){for(var e=this._compare,r=this.root;r;){var o=e(t,r.key);if(0===o)return r.value;r=0>=o?r.left:r.right}};var iproto=RedBlackTreeIterator.prototype;Object.defineProperty(iproto,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(iproto,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),iproto.clone=function(){return new RedBlackTreeIterator(this.tree,this._stack.slice())},iproto.remove=function(){var t=this._stack;if(0===t.length)return this.tree;var e=new Array(t.length),r=t[t.length-1];e[e.length-1]=new RBNode(r._color,r.key,r.value,r.left,r.right,r._count);for(var o=t.length-2;o>=0;--o){var r=t[o];r.left===t[o+1]?e[o]=new RBNode(r._color,r.key,r.value,e[o+1],r.right,r._count):e[o]=new RBNode(r._color,r.key,r.value,r.left,e[o+1],r._count)}if(r=e[e.length-1],r.left&&r.right){var i=e.length;for(r=r.left;r.right;)e.push(r),r=r.right;var l=e[i-1];e.push(new RBNode(r._color,l.key,l.value,r.left,r.right,r._count)),e[i-1].key=r.key,e[i-1].value=r.value;for(var o=e.length-2;o>=i;--o)r=e[o],e[o]=new RBNode(r._color,r.key,r.value,r.left,e[o+1],r._count);e[i-1].left=e[i]}if(r=e[e.length-1],r._color===RED){var n=e[e.length-2];n.left===r?n.left=null:n.right===r&&(n.right=null),e.pop();for(var o=0;o<e.length;++o)e[o]._count--;return new RedBlackTree(this.tree._compare,e[0])}if(r.left||r.right){r.left?swapNode(r,r.left):r.right&&swapNode(r,r.right),r._color=BLACK;for(var o=0;o<e.length-1;++o)e[o]._count--;return new RedBlackTree(this.tree._compare,e[0])}if(1===e.length)return new RedBlackTree(this.tree._compare,null);for(var o=0;o<e.length;++o)e[o]._count--;var c=e[e.length-2];return fixDoubleBlack(e),c.left===r?c.left=null:c.right=null,new RedBlackTree(this.tree._compare,e[0])},Object.defineProperty(iproto,"key",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1].key:void 0},enumerable:!0}),Object.defineProperty(iproto,"value",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1].value:void 0},enumerable:!0}),Object.defineProperty(iproto,"index",{get:function(){var t=0,e=this._stack;if(0===e.length){var r=this.tree.root;return r?r._count:0}e[e.length-1].left&&(t=e[e.length-1].left._count);for(var o=e.length-2;o>=0;--o)e[o+1]===e[o].right&&(++t,e[o].left&&(t+=e[o].left._count));return t},enumerable:!0}),iproto.next=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.right)for(e=e.right;e;)t.push(e),e=e.left;else for(t.pop();t.length>0&&t[t.length-1].right===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(iproto,"hasNext",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].right)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].left===t[e])return!0;return!1}}),iproto.update=function(t){var e=this._stack;if(0===e.length)throw new Error("Can't update empty node!");var r=new Array(e.length),o=e[e.length-1];r[r.length-1]=new RBNode(o._color,o.key,t,o.left,o.right,o._count);for(var i=e.length-2;i>=0;--i)o=e[i],o.left===e[i+1]?r[i]=new RBNode(o._color,o.key,o.value,r[i+1],o.right,o._count):r[i]=new RBNode(o._color,o.key,o.value,o.left,r[i+1],o._count);return new RedBlackTree(this.tree._compare,r[0])},iproto.prev=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.left)for(e=e.left;e;)t.push(e),e=e.right;else for(t.pop();t.length>0&&t[t.length-1].left===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(iproto,"hasPrev",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].left)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].right===t[e])return!0;return!1}});

},{}],206:[function(require,module,exports){
"use strict";function SlabDecomposition(e,t,r){this.slabs=e,this.coordinates=t,this.horizontal=r}function compareHorizontal(e,t){return e.y-t}function searchBucket(e,t){for(var r=null;e;){var n,i,s=e.key;s[0][0]<s[1][0]?(n=s[0],i=s[1]):(n=s[1],i=s[0]);var o=orient(n,i,t);if(0>o)e=e.left;else if(o>0)if(t[0]!==s[1][0])r=e,e=e.right;else{var a=searchBucket(e.right,t);if(a)return a;e=e.left}else{if(t[0]!==s[1][0])return e;var a=searchBucket(e.right,t);if(a)return a;e=e.left}}return r}function IntervalSegment(e,t,r,n){this.y=e,this.index=t,this.start=r,this.closed=n}function Event(e,t,r,n){this.x=e,this.segment=t,this.create=r,this.index=n}function createSlabDecomposition(e){for(var t=e.length,r=2*t,n=new Array(r),i=0;t>i;++i){var s=e[i],o=s[0][0]<s[1][0];n[2*i]=new Event(s[0][0],s,o,i),n[2*i+1]=new Event(s[1][0],s,!o,i)}n.sort(function(e,t){var r=e.x-t.x;return r?r:(r=e.create-t.create,r?r:Math.min(e.segment[0][1],e.segment[1][1])-Math.min(t.segment[0][1],t.segment[1][1]))});for(var a=createRBTree(orderSegments),u=[],l=[],c=[],i=0;r>i;){for(var h=n[i].x,f=[];r>i;){var m=n[i];if(m.x!==h)break;i+=1,m.segment[0][0]===m.x&&m.segment[1][0]===m.x?m.create&&(m.segment[0][1]<m.segment[1][1]?(f.push(new IntervalSegment(m.segment[0][1],m.index,!0,!0)),f.push(new IntervalSegment(m.segment[1][1],m.index,!1,!1))):(f.push(new IntervalSegment(m.segment[1][1],m.index,!0,!1)),f.push(new IntervalSegment(m.segment[0][1],m.index,!1,!0)))):a=m.create?a.insert(m.segment,m.index):a.remove(m.segment)}u.push(a.root),l.push(h),c.push(f)}return new SlabDecomposition(u,l,c)}module.exports=createSlabDecomposition;var bounds=require("binary-search-bounds"),createRBTree=require("functional-red-black-tree"),orient=require("robust-orientation"),orderSegments=require("./lib/order-segments"),proto=SlabDecomposition.prototype;proto.castUp=function(e){var t=bounds.le(this.coordinates,e[0]);if(0>t)return-1;var r=(this.slabs[t],searchBucket(this.slabs[t],e)),n=-1;if(r&&(n=r.value),this.coordinates[t]===e[0]){var i=null;if(r&&(i=r.key),t>0){var s=searchBucket(this.slabs[t-1],e);s&&(i?orderSegments(s.key,i)>0&&(i=s.key,n=s.value):(n=s.value,i=s.key))}var o=this.horizontal[t];if(o.length>0){var a=bounds.ge(o,e[1],compareHorizontal);if(a<o.length){var u=o[a];if(e[1]===u.y){if(u.closed)return u.index;for(;a<o.length-1&&o[a+1].y===e[1];)if(a+=1,u=o[a],u.closed)return u.index;if(u.y===e[1]&&!u.start){if(a+=1,a>=o.length)return n;u=o[a]}}if(u.start)if(i){var l=orient(i[0],i[1],[e[0],u.y]);i[0][0]>i[1][0]&&(l=-l),l>0&&(n=u.index)}else n=u.index;else u.y!==e[1]&&(n=u.index)}}}return n};

},{"./lib/order-segments":204,"binary-search-bounds":202,"functional-red-black-tree":205,"robust-orientation":138}],207:[function(require,module,exports){
function visitInterval(){return!0}function intervalSearch(r){return function(e,n){var t=r[e];return t?!!t.queryPoint(n,visitInterval):!1}}function buildVerticalIndex(r){for(var e={},n=0;n<r.length;++n){var t=r[n],i=t[0][0],a=t[0][1],l=t[1][1],u=[Math.min(a,l),Math.max(a,l)];i in e?e[i].push(u):e[i]=[u]}for(var o={},s=Object.keys(e),n=0;n<s.length;++n){var c=e[s[n]];o[s[n]]=makeIntervalTree(c)}return intervalSearch(o)}function buildSlabSearch(r,e){return function(n){var t=bsearch.le(e,n[0]);if(0>t)return 1;var i=r[t];if(!i){if(!(t>0&&e[t]===n[0]))return 1;i=r[t-1]}for(var a=1;i;){var l=i.key,u=orient(n,l[0],l[1]);if(l[0][0]<l[1][0])if(0>u)i=i.left;else{if(!(u>0))return 0;a=-1,i=i.right}else if(u>0)i=i.left;else{if(!(0>u))return 0;a=1,i=i.right}}return a}}function classifyEmpty(r){return 1}function createClassifyVertical(r){return function(e){return r(e[0],e[1])?0:1}}function createClassifyPointDegen(r,e){return function(n){return r(n[0],n[1])?0:e(n)}}function preprocessPolygon(r){for(var e=r.length,n=[],t=[],i=0;e>i;++i)for(var a=r[i],l=a.length,u=l-1,o=0;l>o;u=o++){var s=a[u],c=a[o];s[0]===c[0]?t.push([s,c]):n.push([s,c])}if(0===n.length)return 0===t.length?classifyEmpty:createClassifyVertical(buildVerticalIndex(t));var f=makeSlabs(n),v=buildSlabSearch(f.slabs,f.coordinates);return 0===t.length?v:createClassifyPointDegen(buildVerticalIndex(t),v)}module.exports=preprocessPolygon;var orient=require("robust-orientation")[3],makeSlabs=require("slab-decomposition"),makeIntervalTree=require("interval-tree-1d"),bsearch=require("binary-search-bounds");

},{"binary-search-bounds":202,"interval-tree-1d":203,"robust-orientation":138,"slab-decomposition":206}],208:[function(require,module,exports){
"use strict";function scalarScalar(r,a){var n=r+a,e=n-r,t=n-e,l=a-e,o=r-t,u=o+l;return u?[u,n]:[n]}function linearExpansionSum(r,a){var n=0|r.length,e=0|a.length;if(1===n&&1===e)return scalarScalar(r[0],a[0]);var t,l,o=n+e,u=new Array(o),i=0,s=0,c=0,f=Math.abs,h=r[s],v=f(h),S=a[c],g=f(S);g>v?(l=h,s+=1,n>s&&(h=r[s],v=f(h))):(l=S,c+=1,e>c&&(S=a[c],g=f(S))),n>s&&g>v||c>=e?(t=h,s+=1,n>s&&(h=r[s],v=f(h))):(t=S,c+=1,e>c&&(S=a[c],g=f(S)));for(var m,p,x,E,b,d=t+l,w=d-t,y=l-w,A=y,M=d;n>s&&e>c;)g>v?(t=h,s+=1,n>s&&(h=r[s],v=f(h))):(t=S,c+=1,e>c&&(S=a[c],g=f(S))),l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m;for(;n>s;)t=h,l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m,s+=1,n>s&&(h=r[s]);for(;e>c;)t=S,l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m,c+=1,e>c&&(S=a[c]);return A&&(u[i++]=A),M&&(u[i++]=M),i||(u[i++]=0),u.length=i,u}module.exports=linearExpansionSum;

},{}],209:[function(require,module,exports){
"use strict";function twoProduct(t,o,r){var u=t*o,T=SPLITTER*t,P=T-t,c=T-P,e=t-c,a=SPLITTER*o,d=a-o,n=a-d,s=o-n,w=u-c*n,E=w-e*n,I=E-c*s,L=e*s-I;return r?(r[0]=L,r[1]=u,r):[L,u]}module.exports=twoProduct;var SPLITTER=+(Math.pow(2,27)+1);

},{}],210:[function(require,module,exports){
"use strict";function unique_pred(n,e){for(var u=1,t=n.length,i=n[0],r=n[0],o=1;t>o;++o)if(r=i,i=n[o],e(i,r)){if(o===u){u++;continue}n[u++]=i}return n.length=u,n}function unique_eq(n){for(var e=1,u=n.length,t=n[0],i=n[0],r=1;u>r;++r,i=t)if(i=t,t=n[r],t!==i){if(r===e){e++;continue}n[e++]=t}return n.length=e,n}function unique(n,e,u){return 0===n.length?n:e?(u||n.sort(e),unique_pred(n,e)):(u||n.sort(),unique_eq(n))}module.exports=unique;

},{}],211:[function(require,module,exports){
"use strict";function makeArray(r,a){for(var e=new Array(r),n=0;r>n;++n)e[n]=a;return e}function makeArrayOfArrays(r){for(var a=new Array(r),e=0;r>e;++e)a[e]=[];return a}function planarGraphToPolyline(r,a){function e(r){for(var e=r.length,n=[0],o=0;e>o;++o){var t=a[r[o]],u=a[r[(o+1)%e]],i=twoProduct(-t[0],t[1]),l=twoProduct(-t[0],u[1]),f=twoProduct(u[0],t[1]),s=twoProduct(u[0],u[1]);n=robustSum(n,robustSum(robustSum(i,l),robustSum(f,s)))}return n[n.length-1]>0}function n(r){for(var a=r.length,e=0;a>e;++e)if(!S[r[e]])return!1;return!0}var o=trimLeaves(r,a);r=o[0],a=o[1];for(var t=a.length,u=(r.length,e2a(r,a.length)),i=0;t>i;++i)if(u[i].length%2===1)throw new Error("planar-graph-to-polyline: graph must be manifold");var l=planarDual(r,a);l=l.filter(e);for(var f=l.length,s=new Array(f),v=new Array(f),i=0;f>i;++i){s[i]=i;var p=new Array(f),h=l[i].map(function(r){return a[r]}),c=preprocessPolygon([h]),m=0;r:for(var g=0;f>g;++g)if(p[g]=0,i!==g){for(var y=l[g],w=y.length,A=0;w>A;++A){var d=c(a[y[A]]);if(0!==d){0>d&&(p[g]=1,m+=1);continue r}}p[g]=1,m+=1}v[i]=[m,i,p]}v.sort(function(r,a){return a[0]-r[0]});for(var i=0;f>i;++i)for(var p=v[i],q=p[1],b=p[2],g=0;f>g;++g)b[g]&&(s[g]=q);for(var P=makeArrayOfArrays(f),i=0;f>i;++i)P[i].push(s[i]),P[s[i]].push(i);for(var k={},S=makeArray(t,!1),i=0;f>i;++i)for(var y=l[i],w=y.length,g=0;w>g;++g){var x=y[g],D=y[(g+1)%w],G=Math.min(x,D)+":"+Math.max(x,D);if(G in k){var L=k[G];P[L].push(i),P[i].push(L),S[x]=S[D]=!0}else k[G]=i}for(var M=[],O=makeArray(f,-1),i=0;f>i;++i)s[i]!==i||n(l[i])?O[i]=-1:(M.push(i),O[i]=0);for(var o=[];M.length>0;){var T=M.pop(),j=P[T];uniq(j,function(r,a){return r-a});var E,z=j.length,B=O[T];if(0===B){var y=l[T];E=[y]}for(var i=0;z>i;++i){var C=j[i];if(!(O[C]>=0)&&(O[C]=1^B,M.push(C),0===B)){var y=l[C];n(y)||(y.reverse(),E.push(y))}}0===B&&o.push(E)}return o}module.exports=planarGraphToPolyline;var e2a=require("edges-to-adjacency-list"),planarDual=require("planar-dual"),preprocessPolygon=require("point-in-big-polygon"),twoProduct=require("two-product"),robustSum=require("robust-sum"),uniq=require("uniq"),trimLeaves=require("./lib/trim-leaves");

},{"./lib/trim-leaves":194,"edges-to-adjacency-list":195,"planar-dual":196,"point-in-big-polygon":207,"robust-sum":208,"two-product":209,"uniq":210}],212:[function(require,module,exports){
"use strict";"use restrict";function countTrailingZeros(r){var n=32;return r&=-r,r&&n--,65535&r&&(n-=16),16711935&r&&(n-=8),252645135&r&&(n-=4),858993459&r&&(n-=2),1431655765&r&&(n-=1),n}var INT_BITS=32;exports.INT_BITS=INT_BITS,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<INT_BITS-1,exports.sign=function(r){return(r>0)-(0>r)},exports.abs=function(r){var n=r>>INT_BITS-1;return(r^n)-n},exports.min=function(r,n){return n^(r^n)&-(n>r)},exports.max=function(r,n){return r^(r^n)&-(n>r)},exports.isPow2=function(r){return!(r&r-1||!r)},exports.log2=function(r){var n,t;return n=(r>65535)<<4,r>>>=n,t=(r>255)<<3,r>>>=t,n|=t,t=(r>15)<<2,r>>>=t,n|=t,t=(r>3)<<1,r>>>=t,n|=t,n|r>>1},exports.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},exports.popCount=function(r){return r-=r>>>1&1431655765,r=(858993459&r)+(r>>>2&858993459),16843009*(r+(r>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1},exports.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r-(r>>>1)},exports.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,r&=15,27030>>>r&1};var REVERSE_TABLE=new Array(256);!function(r){for(var n=0;256>n;++n){var t=n,e=n,o=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--o;r[n]=e<<o&255}}(REVERSE_TABLE),exports.reverse=function(r){return REVERSE_TABLE[255&r]<<24|REVERSE_TABLE[r>>>8&255]<<16|REVERSE_TABLE[r>>>16&255]<<8|REVERSE_TABLE[r>>>24&255]},exports.interleave2=function(r,n){return r&=65535,r=16711935&(r|r<<8),r=252645135&(r|r<<4),r=858993459&(r|r<<2),r=1431655765&(r|r<<1),n&=65535,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),r|n<<1},exports.deinterleave2=function(r,n){return r=r>>>n&1431655765,r=858993459&(r|r>>>1),r=252645135&(r|r>>>2),r=16711935&(r|r>>>4),r=65535&(r|r>>>16),r<<16>>16},exports.interleave3=function(r,n,t){return r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),n&=1023,n=4278190335&(n|n<<16),n=251719695&(n|n<<8),n=3272356035&(n|n<<4),n=1227133513&(n|n<<2),r|=n<<1,t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),r|t<<2},exports.deinterleave3=function(r,n){return r=r>>>n&1227133513,r=3272356035&(r|r>>>2),r=251719695&(r|r>>>4),r=4278190335&(r|r>>>8),r=1023&(r|r>>>16),r<<22>>22},exports.nextCombination=function(r){var n=r|r-1;return n+1|(~n&-~n)-1>>>countTrailingZeros(r)+1};

},{}],213:[function(require,module,exports){
"use strict";"use restrict";function UnionFind(t){this.roots=new Array(t),this.ranks=new Array(t);for(var n=0;t>n;++n)this.roots[n]=n,this.ranks[n]=0}module.exports=UnionFind,UnionFind.prototype.length=function(){return this.roots.length},UnionFind.prototype.makeSet=function(){var t=this.roots.length;return this.roots.push(t),this.ranks.push(0),t},UnionFind.prototype.find=function(t){for(var n=this.roots;n[t]!==t;){var i=n[t];n[t]=n[i],t=i}return t},UnionFind.prototype.link=function(t,n){var i=this.find(t),o=this.find(n);if(i!==o){var r=this.ranks,s=this.roots,e=r[i],h=r[o];h>e?s[i]=o:e>h?s[o]=i:(s[o]=i,++r[i])}};

},{}],214:[function(require,module,exports){
"use strict";"use restrict";function dimension(e){for(var n=0,r=Math.max,t=0,o=e.length;o>t;++t)n=r(n,e[t].length);return n-1}function countVertices(e){for(var n=-1,r=Math.max,t=0,o=e.length;o>t;++t)for(var l=e[t],i=0,a=l.length;a>i;++i)n=r(n,l[i]);return n+1}function cloneCells(e){for(var n=new Array(e.length),r=0,t=e.length;t>r;++r)n[r]=e[r].slice(0);return n}function compareCells(e,n){var r=e.length,t=e.length-n.length,o=Math.min;if(t)return t;switch(r){case 0:return 0;case 1:return e[0]-n[0];case 2:var l=e[0]+e[1]-n[0]-n[1];return l?l:o(e[0],e[1])-o(n[0],n[1]);case 3:var i=e[0]+e[1],a=n[0]+n[1];if(l=i+e[2]-(a+n[2]))return l;var s=o(e[0],e[1]),u=o(n[0],n[1]),l=o(s,e[2])-o(u,n[2]);return l?l:o(s+e[2],i)-o(u+n[2],a);default:var f=e.slice(0);f.sort();var c=n.slice(0);c.sort();for(var h=0;r>h;++h)if(t=f[h]-c[h])return t;return 0}}function compareZipped(e,n){return compareCells(e[0],n[0])}function normalize(e,n){if(n){for(var r=e.length,t=new Array(r),o=0;r>o;++o)t[o]=[e[o],n[o]];t.sort(compareZipped);for(var o=0;r>o;++o)e[o]=t[o][0],n[o]=t[o][1];return e}return e.sort(compareCells),e}function unique(e){if(0===e.length)return[];for(var n=1,r=e.length,t=1;r>t;++t){var o=e[t];if(compareCells(o,e[t-1])){if(t===n){n++;continue}e[n++]=o}}return e.length=n,e}function findCell(e,n){for(var r=0,t=e.length-1,o=-1;t>=r;){var l=r+t>>1,i=compareCells(e[l],n);0>=i?(0===i&&(o=l),r=l+1):i>0&&(t=l-1)}return o}function incidence(e,n){for(var r=new Array(e.length),t=0,o=r.length;o>t;++t)r[t]=[];for(var l=[],t=0,i=n.length;i>t;++t)for(var a=n[t],s=a.length,u=1,f=1<<s;f>u;++u){l.length=bits.popCount(u);for(var c=0,h=0;s>h;++h)u&1<<h&&(l[c++]=a[h]);var p=findCell(e,l);if(!(0>p))for(;;)if(r[p++].push(t),p>=e.length||0!==compareCells(e[p],l))break}return r}function dual(e,n){if(!n)return incidence(unique(skeleton(e,0)),e,0);for(var r=new Array(n),t=0;n>t;++t)r[t]=[];for(var t=0,o=e.length;o>t;++t)for(var l=e[t],i=0,a=l.length;a>i;++i)r[l[i]].push(t);return r}function explode(e){for(var n=[],r=0,t=e.length;t>r;++r)for(var o=e[r],l=0|o.length,i=1,a=1<<l;a>i;++i){for(var s=[],u=0;l>u;++u)i>>>u&1&&s.push(o[u]);n.push(s)}return normalize(n)}function skeleton(e,n){if(0>n)return[];for(var r=[],t=(1<<n+1)-1,o=0;o<e.length;++o)for(var l=e[o],i=t;i<1<<l.length;i=bits.nextCombination(i)){for(var a=new Array(n+1),s=0,u=0;u<l.length;++u)i&1<<u&&(a[s++]=l[u]);r.push(a)}return normalize(r)}function boundary(e){for(var n=[],r=0,t=e.length;t>r;++r)for(var o=e[r],l=0,i=o.length;i>l;++l){for(var a=new Array(o.length-1),s=0,u=0;i>s;++s)s!==l&&(a[u++]=o[s]);n.push(a)}return normalize(n)}function connectedComponents_dense(e,n){for(var r=new UnionFind(n),t=0;t<e.length;++t)for(var o=e[t],l=0;l<o.length;++l)for(var i=l+1;i<o.length;++i)r.link(o[l],o[i]);for(var a=[],s=r.ranks,t=0;t<s.length;++t)s[t]=-1;for(var t=0;t<e.length;++t){var u=r.find(e[t][0]);s[u]<0?(s[u]=a.length,a.push([e[t].slice(0)])):a[s[u]].push(e[t].slice(0))}return a}function connectedComponents_sparse(e){for(var n=unique(normalize(skeleton(e,0))),r=new UnionFind(n.length),t=0;t<e.length;++t)for(var o=e[t],l=0;l<o.length;++l)for(var i=findCell(n,[o[l]]),a=l+1;a<o.length;++a)r.link(i,findCell(n,[o[a]]));for(var s=[],u=r.ranks,t=0;t<u.length;++t)u[t]=-1;for(var t=0;t<e.length;++t){var f=r.find(findCell(n,[e[t][0]]));u[f]<0?(u[f]=s.length,s.push([e[t].slice(0)])):s[u[f]].push(e[t].slice(0))}return s}function connectedComponents(e,n){return n?connectedComponents_dense(e,n):connectedComponents_sparse(e)}var bits=require("bit-twiddle"),UnionFind=require("union-find");exports.dimension=dimension,exports.countVertices=countVertices,exports.cloneCells=cloneCells,exports.compareCells=compareCells,exports.normalize=normalize,exports.unique=unique,exports.findCell=findCell,exports.incidence=incidence,exports.dual=dual,exports.explode=explode,exports.skeleton=skeleton,exports.boundary=boundary,exports.connectedComponents=connectedComponents;

},{"bit-twiddle":212,"union-find":213}],215:[function(require,module,exports){
"use strict";function errorWeight(r,n,t){var e=Math.abs(orient(r,n,t)),i=Math.sqrt(Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2));return e/i}function simplifyPolygon(r,n,t){function e(r){if(m[r])return 1/0;var t=p[r],e=w[r];return 0>t||0>e?1/0:errorWeight(n[r],n[t],n[e])}function i(r,n){var t=d[r],e=d[n];d[r]=e,d[n]=t,k[t]=n,k[e]=r}function a(r){return y[d[r]]}function o(r){return 1&r?r-1>>1:(r>>1)-1}function f(r){for(var n=a(r);;){var t=n,e=2*r+1,o=2*(r+1),f=r;if(E>e){var u=a(e);t>u&&(f=e,t=u)}if(E>o){var v=a(o);t>v&&(f=o)}if(f===r)return r;i(r,f),r=f}}function u(r){for(var n=a(r);r>0;){var t=o(r);if(t>=0){var e=a(t);if(e>n){i(r,t),r=t;continue}}return r}}function v(){if(E>0){var r=d[0];return i(0,E-1),E-=1,f(0),r}return-1}function c(r,n){var t=d[r];return y[t]===n?r:(y[t]=-(1/0),u(r),v(),y[t]=n,E+=1,u(E-1))}function h(r){if(!m[r]){m[r]=!0;var n=p[r],t=w[r];p[t]>=0&&(p[t]=n),w[n]>=0&&(w[n]=t),k[n]>=0&&c(k[n],e(n)),k[t]>=0&&c(k[t],e(t))}}function s(r,n){if(r[n]<0)return n;var t=n,e=n;do{var i=r[e];if(!m[e]||0>i||i===e)break;if(e=i,i=r[e],!m[e]||0>i||i===e)break;e=i,t=r[t]}while(t!==e);for(var a=n;a!==e;a=r[a])r[a]=e;return e}for(var l=n.length,g=r.length,p=new Array(l),w=new Array(l),y=new Array(l),m=new Array(l),b=0;l>b;++b)p[b]=w[b]=-1,y[b]=1/0,m[b]=!1;for(var b=0;g>b;++b){var A=r[b];if(2!==A.length)throw new Error("Input must be a graph");var q=A[1],M=A[0];-1!==w[M]?w[M]=-2:w[M]=q,-1!==p[q]?p[q]=-2:p[q]=M}for(var d=[],k=new Array(l),b=0;l>b;++b){var x=y[b]=e(b);1/0>x?(k[b]=d.length,d.push(b)):k[b]=-1}for(var E=d.length,b=E>>1;b>=0;--b)f(b);for(;;){var P=v();if(0>P||y[P]>t)break;h(P)}for(var W=[],b=0;l>b;++b)m[b]||(k[b]=W.length,W.push(n[b].slice()));var z=(W.length,[]);return r.forEach(function(r){var n=s(p,r[0]),t=s(w,r[1]);if(n>=0&&t>=0&&n!==t){var e=k[n],i=k[t];e!==i&&z.push([e,i])}}),sc.unique(sc.normalize(z)),{positions:W,edges:z}}module.exports=simplifyPolygon;var orient=require("robust-orientation"),sc=require("simplicial-complex");

},{"robust-orientation":138,"simplicial-complex":214}],216:[function(require,module,exports){
"use strict";function array(r){return"a"+r}function data(r){return"d"+r}function cube(r,e){return"c"+r+"_"+e}function shape(r){return"s"+r}function stride(r,e){return"t"+r+"_"+e}function offset(r){return"o"+r}function scalar(r){return"x"+r}function pointer(r){return"p"+r}function delta(r,e){return"d"+r+"_"+e}function index(r){return"i"+r}function step(r,e){return"u"+r+"_"+e}function pcube(r){return"b"+r}function qcube(r){return"y"+r}function pdelta(r){return"e"+r}function vert(r){return"v"+r}function permBitmask(r,e,t){for(var u=0,a=0;r>a;++a)e&1<<a&&(u|=1<<t[a]);return u}function compileSurfaceProcedure(r,e,t,u,a,n){function o(r,e){l.push("for(",index(a[r]),"=",e,";",index(a[r]),"<",shape(a[r]),";","++",index(a[r]),"){")}function p(r){for(var e=0;h>e;++e)l.push(pointer(e),"+=",step(e,a[r]),";");l.push("}")}function s(r){for(var e=r-1;e>=0;--e)o(e,0);for(var t=[],e=0;h>e;++e)n[e]?t.push(data(e)+".get("+pointer(e)+")"):t.push(data(e)+"["+pointer(e)+"]");for(var e=0;u>e;++e)t.push(scalar(e));l.push(PHASES,"[",POINTER,"++]=phase(",t.join(),");");for(var e=0;r>e;++e)p(e);for(var s=0;h>s;++s)l.push(pointer(s),"+=",step(s,a[r]),";")}function i(r){for(var e=0;h>e;++e)n[e]?l.push(cube(e,0),"=",data(e),".get(",pointer(e),");"):l.push(cube(e,0),"=",data(e),"[",pointer(e),"];");for(var t=[],e=0;h>e;++e)t.push(cube(e,0));for(var e=0;u>e;++e)t.push(scalar(e));l.push(pcube(0),"=",PHASES,"[",POINTER,"]=phase(",t.join(),");");for(var a=1;1<<v>a;++a)l.push(pcube(a),"=",PHASES,"[",POINTER,"+",pdelta(a),"];");for(var o=[],a=1;1<<v>a;++a)o.push("("+pcube(0)+"!=="+pcube(a)+")");l.push("if(",o.join("||"),"){");for(var p=[],e=0;v>e;++e)p.push(index(e));for(var e=0;h>e;++e){p.push(cube(e,0));for(var a=1;1<<v>a;++a)n[e]?l.push(cube(e,a),"=",data(e),".get(",pointer(e),"+",delta(e,a),");"):l.push(cube(e,a),"=",data(e),"[",pointer(e),"+",delta(e,a),"];"),p.push(cube(e,a))}for(var e=0;1<<v>e;++e)p.push(pcube(e));for(var e=0;u>e;++e)p.push(scalar(e));l.push("vertex(",p.join(),");",vert(0),"=",VERTEX_IDS,"[",POINTER,"]=",VERTEX_COUNT,"++;");for(var s=(1<<v)-1,i=pcube(s),a=0;v>a;++a)if(0===(r&~(1<<a))){for(var f=s^1<<a,c=pcube(f),d=[],E=f;E>0;E=E-1&f)d.push(VERTEX_IDS+"["+POINTER+"+"+pdelta(E)+"]");d.push(vert(0));for(var E=0;h>E;++E)1&a?d.push(cube(E,s),cube(E,f)):d.push(cube(E,f),cube(E,s));1&a?d.push(i,c):d.push(c,i);for(var E=0;u>E;++E)d.push(scalar(E));l.push("if(",i,"!==",c,"){","face(",d.join(),")}")}l.push("}",POINTER,"+=1;")}function f(){for(var r=1;1<<v>r;++r)l.push(TEMPORARY,"=",pdelta(r),";",pdelta(r),"=",qcube(r),";",qcube(r),"=",TEMPORARY,";")}function c(r,e){if(0>r)return void i(e);s(r),l.push("if(",shape(a[r]),">0){",index(a[r]),"=1;"),c(r-1,e|1<<a[r]);for(var t=0;h>t;++t)l.push(pointer(t),"+=",step(t,a[r]),";");r===v-1&&(l.push(POINTER,"=0;"),f()),o(r,2),c(r-1,e),r===v-1&&(l.push("if(",index(a[v-1]),"&1){",POINTER,"=0;}"),f()),p(r),l.push("}")}var h=n.length,v=a.length;if(2>v)throw new Error("ndarray-extract-contour: Dimension must be at least 2");for(var d="extractContour"+a.join("_"),l=[],E=[],b=[],O=0;h>O;++O)b.push(array(O));for(var O=0;u>O;++O)b.push(scalar(O));for(var O=0;v>O;++O)E.push(shape(O)+"="+array(0)+".shape["+O+"]|0");for(var O=0;h>O;++O){E.push(data(O)+"="+array(O)+".data",offset(O)+"="+array(O)+".offset|0");for(var P=0;v>P;++P)E.push(stride(O,P)+"="+array(O)+".stride["+P+"]|0")}for(var O=0;h>O;++O){E.push(pointer(O)+"="+offset(O)),E.push(cube(O,0));for(var P=1;1<<v>P;++P){for(var R=[],S=0;v>S;++S)P&1<<S&&R.push("-"+stride(O,S));E.push(delta(O,P)+"=("+R.join("")+")|0"),E.push(cube(O,P)+"=0")}}for(var O=0;h>O;++O)for(var P=0;v>P;++P){var T=[stride(O,a[P])];P>0&&T.push(stride(O,a[P-1])+"*"+shape(a[P-1])),E.push(step(O,a[P])+"=("+T.join("-")+")|0")}for(var O=0;v>O;++O)E.push(index(O)+"=0");E.push(VERTEX_COUNT+"=0");for(var y=["2"],O=v-2;O>=0;--O)y.push(shape(a[O]));E.push(POOL_SIZE+"=("+y.join("*")+")|0",PHASES+"=mallocUint32("+POOL_SIZE+")",VERTEX_IDS+"=mallocUint32("+POOL_SIZE+")",POINTER+"=0"),E.push(pcube(0)+"=0");for(var P=1;1<<v>P;++P){for(var x=[],I=[],S=0;v>S;++S)P&1<<S&&(0===I.length?x.push("1"):x.unshift(I.join("*"))),I.push(shape(a[S]));var m="";x[0].indexOf(shape(a[v-2]))<0&&(m="-");var j=permBitmask(v,P,a);E.push(pdelta(j)+"=(-"+x.join("-")+")|0",qcube(j)+"=("+m+x.join("-")+")|0",pcube(j)+"=0")}E.push(vert(0)+"=0",TEMPORARY+"=0"),c(v-1,0),l.push("freeUint32(",VERTEX_IDS,");freeUint32(",PHASES,");");var _=["'use strict';","function ",d,"(",b.join(),"){","var ",E.join(),";",l.join(""),"}","return ",d].join(""),A=new Function("vertex","face","phase","mallocUint32","freeUint32",_);return A(r,e,t,pool.mallocUint32,pool.freeUint32)}function createSurfaceExtractor(r){function e(r){throw new Error("ndarray-extract-contour: "+r)}"object"!=typeof r&&e("Must specify arguments");var t=r.order;Array.isArray(t)||e("Must specify order");var u=r.arrayArguments||1;1>u&&e("Must have at least one array argument");var a=r.scalarArguments||0;0>a&&e("Scalar arg count must be > 0"),"function"!=typeof r.vertex&&e("Must specify vertex creation function"),"function"!=typeof r.cell&&e("Must specify cell creation function"),"function"!=typeof r.phase&&e("Must specify phase function");for(var n=r.getters||[],o=new Array(u),p=0;u>p;++p)n.indexOf(p)>=0?o[p]=!0:o[p]=!1;return compileSurfaceProcedure(r.vertex,r.cell,r.phase,a,t,o)}var pool=require("typedarray-pool");module.exports=createSurfaceExtractor;var VERTEX_IDS="V",PHASES="P",VERTEX_COUNT="N",POOL_SIZE="Q",POINTER="X",TEMPORARY="T";

},{"typedarray-pool":217}],217:[function(require,module,exports){
(function (global,Buffer){
"use strict";function freeArrayBuffer(r){if(r){var e=r.length||r.byteLength,t=bits.log2(e);DATA[t].push(r)}}function freeTypedArray(r){freeArrayBuffer(r.buffer)}function mallocArrayBuffer(r){var r=bits.nextPow2(r),e=bits.log2(r),t=DATA[e];return t.length>0?t.pop():new ArrayBuffer(r)}function mallocUint8(r){return new Uint8Array(mallocArrayBuffer(r),0,r)}function mallocUint16(r){return new Uint16Array(mallocArrayBuffer(2*r),0,r)}function mallocUint32(r){return new Uint32Array(mallocArrayBuffer(4*r),0,r)}function mallocInt8(r){return new Int8Array(mallocArrayBuffer(r),0,r)}function mallocInt16(r){return new Int16Array(mallocArrayBuffer(2*r),0,r)}function mallocInt32(r){return new Int32Array(mallocArrayBuffer(4*r),0,r)}function mallocFloat(r){return new Float32Array(mallocArrayBuffer(4*r),0,r)}function mallocDouble(r){return new Float64Array(mallocArrayBuffer(8*r),0,r)}function mallocUint8Clamped(r){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(r),0,r):mallocUint8(r)}function mallocDataView(r){return new DataView(mallocArrayBuffer(r),0,r)}function mallocBuffer(r){r=bits.nextPow2(r);var e=bits.log2(r),t=BUFFER[e];return t.length>0?t.pop():new Buffer(r)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(r){if(Buffer.isBuffer(r))BUFFER[bits.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var e=r.length||r.byteLength,t=0|bits.log2(e);DATA[t].push(r)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(r){BUFFER[bits.log2(r.length)].push(r)},exports.malloc=function(r,e){if(void 0===e||"arraybuffer"===e)return mallocArrayBuffer(r);switch(e){case"uint8":return mallocUint8(r);case"uint16":return mallocUint16(r);case"uint32":return mallocUint32(r);case"int8":return mallocInt8(r);case"int16":return mallocInt16(r);case"int32":return mallocInt32(r);case"float":case"float32":return mallocFloat(r);case"double":case"float64":return mallocDouble(r);case"uint8_clamped":return mallocUint8Clamped(r);case"buffer":return mallocBuffer(r);case"data":case"dataview":return mallocDataView(r);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var r=0;32>r;++r)POOL.UINT8[r].length=0,POOL.UINT16[r].length=0,POOL.UINT32[r].length=0,POOL.INT8[r].length=0,POOL.INT16[r].length=0,POOL.INT32[r].length=0,POOL.FLOAT[r].length=0,POOL.DOUBLE[r].length=0,POOL.UINT8C[r].length=0,DATA[r].length=0,BUFFER[r].length=0};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"bit-twiddle":118,"buffer":5,"dup":119}],218:[function(require,module,exports){
function lngamma(a){if(0>a)return Number("0/0");for(var t=p_ln[0],e=p_ln.length-1;e>0;--e)t+=p_ln[e]/(a+e);var r=a+g_ln+.5;return.5*Math.log(2*Math.PI)+(a+.5)*Math.log(r)-r+Math.log(t)-Math.log(a)}var g=7,p=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7],g_ln=607/128,p_ln=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];module.exports=function a(t){if(.5>t)return Math.PI/(Math.sin(Math.PI*t)*a(1-t));if(t>100)return Math.exp(lngamma(t));t-=1;for(var e=p[0],r=1;g+2>r;r++)e+=p[r]/(t+r);var n=t+g+.5;return Math.sqrt(2*Math.PI)*Math.pow(n,t+.5)*Math.exp(-n)*e},module.exports.log=lngamma;

},{}],219:[function(require,module,exports){
(function (global,Buffer){
"use strict";function freeArrayBuffer(r){if(r){var e=r.length||r.byteLength,t=bits.log2(e);DATA[t].push(r)}}function freeTypedArray(r){freeArrayBuffer(r.buffer)}function mallocArrayBuffer(r){var r=bits.nextPow2(r),e=bits.log2(r),t=DATA[e];return t.length>0?t.pop():new ArrayBuffer(r)}function mallocUint8(r){return new Uint8Array(mallocArrayBuffer(r),0,r)}function mallocUint16(r){return new Uint16Array(mallocArrayBuffer(2*r),0,r)}function mallocUint32(r){return new Uint32Array(mallocArrayBuffer(4*r),0,r)}function mallocInt8(r){return new Int8Array(mallocArrayBuffer(r),0,r)}function mallocInt16(r){return new Int16Array(mallocArrayBuffer(2*r),0,r)}function mallocInt32(r){return new Int32Array(mallocArrayBuffer(4*r),0,r)}function mallocFloat(r){return new Float32Array(mallocArrayBuffer(4*r),0,r)}function mallocDouble(r){return new Float64Array(mallocArrayBuffer(8*r),0,r)}function mallocUint8Clamped(r){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(r),0,r):mallocUint8(r)}function mallocDataView(r){return new DataView(mallocArrayBuffer(r),0,r)}function mallocBuffer(r){r=bits.nextPow2(r);var e=bits.log2(r),t=BUFFER[e];return t.length>0?t.pop():new Buffer(r)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(r){if(Buffer.isBuffer(r))BUFFER[bits.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var e=r.length||r.byteLength,t=0|bits.log2(e);DATA[t].push(r)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(r){BUFFER[bits.log2(r.length)].push(r)},exports.malloc=function(r,e){if(void 0===e||"arraybuffer"===e)return mallocArrayBuffer(r);switch(e){case"uint8":return mallocUint8(r);case"uint16":return mallocUint16(r);case"uint32":return mallocUint32(r);case"int8":return mallocInt8(r);case"int16":return mallocInt16(r);case"int32":return mallocInt32(r);case"float":case"float32":return mallocFloat(r);case"double":case"float64":return mallocDouble(r);case"uint8_clamped":return mallocUint8Clamped(r);case"buffer":return mallocBuffer(r);case"data":case"dataview":return mallocDataView(r);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var r=0;32>r;++r)POOL.UINT8[r].length=0,POOL.UINT16[r].length=0,POOL.UINT32[r].length=0,POOL.INT8[r].length=0,POOL.INT16[r].length=0,POOL.INT32[r].length=0,POOL.FLOAT[r].length=0,POOL.DOUBLE[r].length=0,POOL.UINT8C[r].length=0,DATA[r].length=0,BUFFER[r].length=0};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"bit-twiddle":118,"buffer":5,"dup":119}],220:[function(require,module,exports){
"use strict";function permutationSign(r){var o=r.length;if(BRUTE_FORCE_CUTOFF>o){for(var e=1,t=0;o>t;++t)for(var i=0;t>i;++i)if(r[t]<r[i])e=-e;else if(r[t]===r[i])return 0;return e}for(var n=pool.mallocUint8(o),t=0;o>t;++t)n[t]=0;for(var e=1,t=0;o>t;++t)if(!n[t]){var a=1;n[t]=1;for(var i=r[t];i!==t;i=r[i]){if(n[i])return pool.freeUint8(n),0;a+=1,n[i]=1}1&a||(e=-e)}return pool.freeUint8(n),e}module.exports=permutationSign;var BRUTE_FORCE_CUTOFF=32,pool=require("typedarray-pool");

},{"typedarray-pool":219}],221:[function(require,module,exports){
"use strict";function rank(r){var e=r.length;switch(e){case 0:case 1:return 0;case 2:return r[1]}var n,t,o,a=pool.mallocUint32(e),u=pool.mallocUint32(e),i=0;for(inverse(r,u),o=0;e>o;++o)a[o]=r[o];for(o=e-1;o>0;--o)t=u[o],n=a[o],a[o]=a[t],a[t]=n,u[o]=u[n],u[n]=t,i=(i+n)*o;return pool.freeUint32(u),pool.freeUint32(a),i}function unrank(r,e,n){switch(r){case 0:return n?n:[];case 1:return n?(n[0]=0,n):[0];case 2:return n?(e?(n[0]=0,n[1]=1):(n[0]=1,n[1]=0),n):e?[0,1]:[1,0]}n=n||new Array(r);var t,o,a,u=1;for(n[0]=0,a=1;r>a;++a)n[a]=a,u=u*a|0;for(a=r-1;a>0;--a)t=e/u|0,e=e-t*u|0,u=u/a|0,o=0|n[a],n[a]=0|n[t],n[t]=0|o;return n}var pool=require("typedarray-pool"),inverse=require("invert-permutation");exports.rank=rank,exports.unrank=unrank;

},{"invert-permutation":222,"typedarray-pool":223}],222:[function(require,module,exports){
"use strict";function invertPermutation(t,r){r=r||new Array(t.length);for(var e=0;e<t.length;++e)r[t[e]]=e;return r}module.exports=invertPermutation;

},{}],223:[function(require,module,exports){
(function (global,Buffer){
"use strict";function freeArrayBuffer(r){if(r){var e=r.length||r.byteLength,t=bits.log2(e);DATA[t].push(r)}}function freeTypedArray(r){freeArrayBuffer(r.buffer)}function mallocArrayBuffer(r){var r=bits.nextPow2(r),e=bits.log2(r),t=DATA[e];return t.length>0?t.pop():new ArrayBuffer(r)}function mallocUint8(r){return new Uint8Array(mallocArrayBuffer(r),0,r)}function mallocUint16(r){return new Uint16Array(mallocArrayBuffer(2*r),0,r)}function mallocUint32(r){return new Uint32Array(mallocArrayBuffer(4*r),0,r)}function mallocInt8(r){return new Int8Array(mallocArrayBuffer(r),0,r)}function mallocInt16(r){return new Int16Array(mallocArrayBuffer(2*r),0,r)}function mallocInt32(r){return new Int32Array(mallocArrayBuffer(4*r),0,r)}function mallocFloat(r){return new Float32Array(mallocArrayBuffer(4*r),0,r)}function mallocDouble(r){return new Float64Array(mallocArrayBuffer(8*r),0,r)}function mallocUint8Clamped(r){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(r),0,r):mallocUint8(r)}function mallocDataView(r){return new DataView(mallocArrayBuffer(r),0,r)}function mallocBuffer(r){r=bits.nextPow2(r);var e=bits.log2(r),t=BUFFER[e];return t.length>0?t.pop():new Buffer(r)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(r){if(Buffer.isBuffer(r))BUFFER[bits.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var e=r.length||r.byteLength,t=0|bits.log2(e);DATA[t].push(r)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(r){BUFFER[bits.log2(r.length)].push(r)},exports.malloc=function(r,e){if(void 0===e||"arraybuffer"===e)return mallocArrayBuffer(r);switch(e){case"uint8":return mallocUint8(r);case"uint16":return mallocUint16(r);case"uint32":return mallocUint32(r);case"int8":return mallocInt8(r);case"int16":return mallocInt16(r);case"int32":return mallocInt32(r);case"float":case"float32":return mallocFloat(r);case"double":case"float64":return mallocDouble(r);case"uint8_clamped":return mallocUint8Clamped(r);case"buffer":return mallocBuffer(r);case"data":case"dataview":return mallocDataView(r);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var r=0;32>r;++r)POOL.UINT8[r].length=0,POOL.UINT16[r].length=0,POOL.UINT32[r].length=0,POOL.INT8[r].length=0,POOL.INT16[r].length=0,POOL.INT32[r].length=0,POOL.FLOAT[r].length=0,POOL.DOUBLE[r].length=0,POOL.UINT8C[r].length=0,DATA[r].length=0,BUFFER[r].length=0};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"bit-twiddle":118,"buffer":5,"dup":119}],224:[function(require,module,exports){
"use strict";function triangulateCube(r){if(0>r)return[];if(0===r)return[[0]];for(var e=0|Math.round(gamma(r+1)),a=[],u=0;e>u;++u){for(var t=perm.unrank(r,u),n=[0],i=0,m=0;m<t.length;++m)i+=1<<t[m],n.push(i);sgn(t)<1&&(n[0]=i,n[r]=0),a.push(n)}return a}module.exports=triangulateCube;var perm=require("permutation-rank"),sgn=require("permutation-parity"),gamma=require("gamma");

},{"gamma":218,"permutation-parity":220,"permutation-rank":221}],225:[function(require,module,exports){
module.exports=require("cwise-compiler")({args:["array",{offset:[1],array:0},"scalar","scalar","index"],pre:{body:"{}",args:[],thisVars:[],localVars:[]},post:{body:"{}",args:[],thisVars:[],localVars:[]},body:{body:"{\n        var _inline_1_da = _inline_1_arg0_ - _inline_1_arg3_\n        var _inline_1_db = _inline_1_arg1_ - _inline_1_arg3_\n        if((_inline_1_da >= 0) !== (_inline_1_db >= 0)) {\n          _inline_1_arg2_.push(_inline_1_arg4_[0] + 0.5 + 0.5 * (_inline_1_da + _inline_1_db) / (_inline_1_da - _inline_1_db))\n        }\n      }",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg2_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg3_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg4_",lvalue:!1,rvalue:!0,count:1}],thisVars:[],localVars:["_inline_1_da","_inline_1_db"]},funcName:"zeroCrossings"});

},{"cwise-compiler":226}],226:[function(require,module,exports){
"use strict";function Procedure(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function compileCwise(r){var e=new Procedure;e.pre=r.pre,e.body=r.body,e.post=r.post;var s=r.args.slice(0);e.argTypes=s;for(var o=0;o<s.length;++o){var a=s[o];if("array"===a||"object"==typeof a&&a.blockIndices){if(e.argTypes[o]="array",e.arrayArgs.push(o),e.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),e.shimArgs.push("array"+o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===a)e.scalarArgs.push(o),e.shimArgs.push("scalar"+o);else if("index"===a){if(e.indexArgs.push(o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===a){if(e.shapeArgs.push(o),o<e.pre.args.length&&e.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<e.post.args.length&&e.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof a||!a.offset)throw new Error("cwise: Unknown argument type "+s[o]);e.argTypes[o]="offset",e.offsetArgs.push({array:a.array,offset:a.offset}),e.offsetArgIndex.push(o)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>s.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>s.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>s.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!r.printCode||!!r.debug,e.funcName=r.funcName||"cwise",e.blockSize=r.blockSize||64,createThunk(e)}var createThunk=require("./lib/thunk.js");module.exports=compileCwise;

},{"./lib/thunk.js":228}],227:[function(require,module,exports){
"use strict";function innerFill(r,n,e){var s,a,o=r.length,i=n.arrayArgs.length,t=n.indexArgs.length>0,p=[],h=[],u=0,c=0;for(s=0;o>s;++s)h.push(["i",s,"=0"].join(""));for(a=0;i>a;++a)for(s=0;o>s;++s)c=u,u=r[s],0===s?h.push(["d",a,"s",s,"=t",a,"p",u].join("")):h.push(["d",a,"s",s,"=(t",a,"p",u,"-s",c,"*t",a,"p",c,")"].join(""));for(p.push("var "+h.join(",")),s=o-1;s>=0;--s)u=r[s],p.push(["for(i",s,"=0;i",s,"<s",u,";++i",s,"){"].join(""));for(p.push(e),s=0;o>s;++s){for(c=u,u=r[s],a=0;i>a;++a)p.push(["p",a,"+=d",a,"s",s].join(""));t&&(s>0&&p.push(["index[",c,"]-=s",c].join("")),p.push(["++index[",u,"]"].join(""))),p.push("}")}return p.join("\n")}function outerFill(r,n,e,s){for(var a=n.length,o=e.arrayArgs.length,i=e.blockSize,t=e.indexArgs.length>0,p=[],h=0;o>h;++h)p.push(["var offset",h,"=p",h].join(""));for(var h=r;a>h;++h)p.push(["for(var j"+h+"=SS[",n[h],"]|0;j",h,">0;){"].join("")),p.push(["if(j",h,"<",i,"){"].join("")),p.push(["s",n[h],"=j",h].join("")),p.push(["j",h,"=0"].join("")),p.push(["}else{s",n[h],"=",i].join("")),p.push(["j",h,"-=",i,"}"].join("")),t&&p.push(["index[",n[h],"]=j",h].join(""));for(var h=0;o>h;++h){for(var u=["offset"+h],c=r;a>c;++c)u.push(["j",c,"*t",h,"p",n[c]].join(""));p.push(["p",h,"=(",u.join("+"),")"].join(""))}p.push(innerFill(n,e,s));for(var h=r;a>h;++h)p.push("}");return p.join("\n")}function countMatches(r){for(var n=0,e=r[0].length;e>n;){for(var s=1;s<r.length;++s)if(r[s][n]!==r[0][n])return n;++n}return n}function processBlock(r,n,e){for(var s=r.body,a=[],o=[],i=0;i<r.args.length;++i){var t=r.args[i];if(!(t.count<=0)){var p=new RegExp(t.name,"g"),h="",u=n.arrayArgs.indexOf(i);switch(n.argTypes[i]){case"offset":var c=n.offsetArgIndex.indexOf(i),l=n.offsetArgs[c];u=l.array,h="+q"+c;case"array":h="p"+u+h;var f="l"+i,g="a"+u;if(0===n.arrayBlockIndices[u])1===t.count?"generic"===e[u]?t.lvalue?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),o.push([g,".set(",h,",",f,")"].join(""))):s=s.replace(p,[g,".get(",h,")"].join("")):s=s.replace(p,[g,"[",h,"]"].join("")):"generic"===e[u]?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,".set(",h,",",f,")"].join(""))):(a.push(["var ",f,"=",g,"[",h,"]"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,"[",h,"]=",f].join("")));else{for(var j=[t.name],v=[h],y=0;y<Math.abs(n.arrayBlockIndices[u]);y++)j.push("\\s*\\[([^\\]]+)\\]"),v.push("$"+(y+1)+"*t"+u+"b"+y);if(p=new RegExp(j.join(""),"g"),h=v.join("+"),"generic"===e[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");s=s.replace(p,[g,"[",h,"]"].join(""))}break;case"scalar":s=s.replace(p,"Y"+n.scalarArgs.indexOf(i));break;case"index":s=s.replace(p,"index");break;case"shape":s=s.replace(p,"shape")}}}return[a.join("\n"),s,o.join("\n")].join("\n").trim()}function typeSummary(r){for(var n=new Array(r.length),e=!0,s=0;s<r.length;++s){var a=r[s],o=a.match(/\d+/);o=o?o[0]:"",0===a.charAt(0)?n[s]="u"+a.charAt(1)+o:n[s]=a.charAt(0)+o,s>0&&(e=e&&n[s]===n[s-1])}return e?n[0]:n.join("")}function generateCWiseOp(r,n){for(var e=n[1].length-Math.abs(r.arrayBlockIndices[0])|0,s=new Array(r.arrayArgs.length),a=new Array(r.arrayArgs.length),o=0;o<r.arrayArgs.length;++o)a[o]=n[2*o],s[o]=n[2*o+1];for(var i=[],t=[],p=[],h=[],u=[],o=0;o<r.arrayArgs.length;++o){r.arrayBlockIndices[o]<0?(p.push(0),h.push(e),i.push(e),t.push(e+r.arrayBlockIndices[o])):(p.push(r.arrayBlockIndices[o]),h.push(r.arrayBlockIndices[o]+e),i.push(0),t.push(r.arrayBlockIndices[o]));for(var c=[],l=0;l<s[o].length;l++)p[o]<=s[o][l]&&s[o][l]<h[o]&&c.push(s[o][l]-p[o]);u.push(c)}for(var f=["SS"],g=["'use strict'"],j=[],l=0;e>l;++l)j.push(["s",l,"=SS[",l,"]"].join(""));for(var o=0;o<r.arrayArgs.length;++o){f.push("a"+o),f.push("t"+o),f.push("p"+o);for(var l=0;e>l;++l)j.push(["t",o,"p",l,"=t",o,"[",p[o]+l,"]"].join(""));for(var l=0;l<Math.abs(r.arrayBlockIndices[o]);++l)j.push(["t",o,"b",l,"=t",o,"[",i[o]+l,"]"].join(""))}for(var o=0;o<r.scalarArgs.length;++o)f.push("Y"+o);if(r.shapeArgs.length>0&&j.push("shape=SS.slice(0)"),r.indexArgs.length>0){for(var v=new Array(e),o=0;e>o;++o)v[o]="0";j.push(["index=[",v.join(","),"]"].join(""))}for(var o=0;o<r.offsetArgs.length;++o){for(var y=r.offsetArgs[o],d=[],l=0;l<y.offset.length;++l)0!==y.offset[l]&&(1===y.offset[l]?d.push(["t",y.array,"p",l].join("")):d.push([y.offset[l],"*t",y.array,"p",l].join("")));0===d.length?j.push("q"+o+"=0"):j.push(["q",o,"=",d.join("+")].join(""))}var A=uniq([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));j=j.concat(A),g.push("var "+j.join(","));for(var o=0;o<r.arrayArgs.length;++o)g.push("p"+o+"|=0");r.pre.body.length>3&&g.push(processBlock(r.pre,r,a));var k=processBlock(r.body,r,a),b=countMatches(u);e>b?g.push(outerFill(b,u[0],r,k)):g.push(innerFill(u[0],r,k)),r.post.body.length>3&&g.push(processBlock(r.post,r,a)),r.debug&&console.log("-----Generated cwise routine for ",n,":\n"+g.join("\n")+"\n----------");var x=[r.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",b,typeSummary(a)].join(""),w=new Function(["function ",x,"(",f.join(","),"){",g.join("\n"),"} return ",x].join(""));return w()}var uniq=require("uniq");module.exports=generateCWiseOp;

},{"uniq":229}],228:[function(require,module,exports){
"use strict";function createThunk(r){var a=["'use strict'","var CACHED={}"],e=[],s=r.funcName+"_cwise_thunk";a.push(["return function ",s,"(",r.shimArgs.join(","),"){"].join(""));for(var n=[],o=[],h=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],i=[],p=[],t=0;t<r.arrayArgs.length;++t){var c=r.arrayArgs[t];e.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),n.push("t"+c),n.push("r"+c),o.push("t"+c),o.push("r"+c+".join()"),h.push("array"+c+".data"),h.push("array"+c+".stride"),h.push("array"+c+".offset|0"),t>0&&(i.push("array"+r.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[t]))),p.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[t])+"]"))}r.arrayArgs.length>1&&(a.push("if (!("+i.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),a.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),a.push("if (!("+p.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),a.push("}"));for(var t=0;t<r.scalarArgs.length;++t)h.push("scalar"+r.scalarArgs[t]);e.push(["type=[",o.join(","),"].join()"].join("")),e.push("proc=CACHED[type]"),a.push("var "+e.join(",")),a.push(["if(!proc){","CACHED[type]=proc=compile([",n.join(","),"])}","return proc(",h.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+a.join("\n")+"\n----------");var u=new Function("compile",a.join("\n"));return u(compile.bind(void 0,r))}var compile=require("./compile.js");module.exports=createThunk;

},{"./compile.js":227}],229:[function(require,module,exports){
"use strict";function unique_pred(n,e){for(var u=1,t=n.length,i=n[0],r=n[0],o=1;t>o;++o)if(r=i,i=n[o],e(i,r)){if(o===u){u++;continue}n[u++]=i}return n.length=u,n}function unique_eq(n){for(var e=1,u=n.length,t=n[0],i=n[0],r=1;u>r;++r,i=t)if(i=t,t=n[r],t!==i){if(r===e){e++;continue}n[e++]=t}return n.length=e,n}function unique(n,e,u){return 0===n.length?n:e?(u||n.sort(e),unique_pred(n,e)):(u||n.sort(),unique_eq(n))}module.exports=unique;

},{}],230:[function(require,module,exports){
"use strict";function findZeroCrossings(r,e){var o=[];return e=+e||0,core(r.hi(r.shape[0]-1),o,e),o}module.exports=findZeroCrossings;var core=require("./lib/zc-core");

},{"./lib/zc-core":225}],231:[function(require,module,exports){
"use strict";function buildSurfaceNets(r,e){var n=r.length,u=["'use strict';"],s="surfaceNets"+r.join("_")+"d"+e;u.push("var contour=genContour({","order:[",r.join(),"],","scalarArguments: 3,","phase:function phaseFunc(p,a,b,c) { return (p > c)|0 },"),"generic"===e&&u.push("getters:[0],");for(var t=[],o=[],a=0;n>a;++a)t.push("d"+a),o.push("d"+a);for(var a=0;1<<n>a;++a)t.push("v"+a),o.push("v"+a);for(var a=0;1<<n>a;++a)t.push("p"+a),o.push("p"+a);t.push("a","b","c"),o.push("a","c"),u.push("vertex:function vertexFunc(",t.join(),"){");for(var i=[],a=0;1<<n>a;++a)i.push("(p"+a+"<<"+a+")");u.push("var m=(",i.join("+"),")|0;if(m===0||m===",(1<<(1<<n))-1,"){return}");var p=[],c=[];128>=1<<(1<<n)?(u.push("switch(m){"),c=u):u.push("switch(m>>>7){");for(var a=0;1<<(1<<n)>a;++a){if(1<<(1<<n)>128&&a%128===0){p.length>0&&c.push("}}");var h="vExtra"+p.length;u.push("case ",a>>>7,":",h,"(m&0x7f,",o.join(),");break;"),c=["function ",h,"(m,",o.join(),"){switch(m){"],p.push(c)}c.push("case ",127&a,":");for(var v=new Array(n),f=new Array(n),l=new Array(n),g=new Array(n),m=0,d=0;n>d;++d)v[d]=[],f[d]=[],l[d]=0,g[d]=0;for(var d=0;1<<n>d;++d)for(var j=0;n>j;++j){var C=d^1<<j;if(!(C>d)&&!(a&1<<C)!=!(a&1<<d)){var b=1;a&1<<C?f[j].push("v"+C+"-v"+d):(f[j].push("v"+d+"-v"+C),b=-b),0>b?(v[j].push("-v"+d+"-v"+C),l[j]+=2):(v[j].push("v"+d+"+v"+C),l[j]-=2),m+=1;for(var y=0;n>y;++y)y!==j&&(C&1<<y?g[y]+=1:g[y]-=1)}}for(var w=[],j=0;n>j;++j)if(0===v[j].length)w.push("d"+j+"-0.5");else{var A="";l[j]<0?A=l[j]+"*c":l[j]>0&&(A="+"+l[j]+"*c");var x=.5*(v[j].length/m),E=.5+.5*(g[j]/m);w.push("d"+j+"-"+E+"-"+x+"*("+v[j].join("+")+A+")/("+f[j].join("+")+")")}c.push("a.push([",w.join(),"]);","break;")}u.push("}},"),p.length>0&&c.push("}}");for(var N=[],a=0;1<<n-1>a;++a)N.push("v"+a);N.push("c0","c1","p0","p1","a","b","c"),u.push("cell:function cellFunc(",N.join(),"){");var F=triangulateCube(n-1);u.push("if(p0){b.push(",F.map(function(r){return"["+r.map(function(r){return"v"+r})+"]"}).join(),")}else{b.push(",F.map(function(r){var e=r.slice();return e.reverse(),"["+e.map(function(r){return"v"+r})+"]"}).join(),")}}});function ",s,"(array,level){var verts=[],cells=[];contour(array,verts,cells,level);return {positions:verts,cells:cells};} return ",s,";");for(var a=0;a<p.length;++a)u.push(p[a].join(""));var q=new Function("genContour",u.join(""));return q(generateContourExtractor)}function mesh1D(r,e){for(var n=zeroCrossings(r,e),u=n.length,s=new Array(u),t=new Array(u),o=0;u>o;++o)s[o]=[n[o]],t[o]=[o];return{positions:s,cells:t}}function surfaceNets(r,e){if(r.dimension<=0)return{positions:[],cells:[]};if(1===r.dimension)return mesh1D(r,e);var n=r.order.join()+"-"+r.dtype,u=CACHE[n],e=+e||0;return u||(u=CACHE[n]=buildSurfaceNets(r.order,r.dtype)),u(r,e)}module.exports=surfaceNets;var generateContourExtractor=require("ndarray-extract-contour"),triangulateCube=require("triangulate-hypercube"),zeroCrossings=require("zero-crossings"),CACHE={};

},{"ndarray-extract-contour":216,"triangulate-hypercube":224,"zero-crossings":230}],232:[function(require,module,exports){
"use strict";function AxesRange3D(r,e,t){this.lo=r,this.hi=e,this.pixelsPerDataUnit=t}function gradient(r,e,t,a,i){for(var n=0;3>n;++n){for(var s=SCRATCH_P,o=SCRATCH_Q,l=0;3>l;++l)o[l]=s[l]=t[l];o[3]=s[3]=1,o[n]+=1,v4transformMat4(o,o,e),o[3]<0&&(r[n]=1/0),s[n]-=1,v4transformMat4(s,s,e),s[3]<0&&(r[n]=1/0);var m=(s[0]/s[3]-o[0]/o[3])*a,v=(s[1]/s[3]-o[1]/o[3])*i;r[n]=.25*Math.sqrt(m*m+v*v)}return r}function axesProperties(r,e,t,a,i){var n=e.model||identity,s=e.view||identity,o=e.projection||identity,l=r.bounds,i=i||cubeParams(n,s,o,l),m=i.axis;i.edges;m4mul(mvp,s,n),m4mul(mvp,o,mvp);for(var v=RANGES,p=0;3>p;++p)v[p].lo=1/0,v[p].hi=-(1/0),v[p].pixelsPerDataUnit=1/0;var u=getPlanes(m4transpose(mvp,mvp));m4transpose(mvp,mvp);for(var f=0;3>f;++f){var g=(f+1)%3,h=(f+2)%3,A=SCRATCH_X;r:for(var p=0;2>p;++p){var x=[];if(m[f]<0!=!!p){A[f]=l[p][f];for(var C=0;2>C;++C){A[g]=l[C^p][g];for(var P=0;2>P;++P)A[h]=l[P^C^p][h],x.push(A.slice())}for(var C=0;C<u.length;++C){if(0===x.length)continue r;x=splitPoly.positive(x,u[C])}for(var C=0;C<x.length;++C)for(var h=x[C],R=gradient(SCRATCH_X,mvp,h,t,a),P=0;3>P;++P)v[P].lo=Math.min(v[P].lo,h[P]),v[P].hi=Math.max(v[P].hi,h[P]),P!==f&&(v[P].pixelsPerDataUnit=Math.min(v[P].pixelsPerDataUnit,Math.abs(R[P])))}}}return v}module.exports=axesProperties;var getPlanes=require("extract-frustum-planes"),splitPoly=require("split-polygon"),cubeParams=require("./lib/cube.js"),m4mul=require("gl-mat4/multiply"),m4transpose=require("gl-mat4/transpose"),v4transformMat4=require("gl-vec4/transformMat4"),identity=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),mvp=new Float32Array(16),SCRATCH_P=[0,0,0,1],SCRATCH_Q=[0,0,0,1],RANGES=[new AxesRange3D(1/0,-(1/0),1/0),new AxesRange3D(1/0,-(1/0),1/0),new AxesRange3D(1/0,-(1/0),1/0)],SCRATCH_X=[0,0,0];

},{"./lib/cube.js":113,"extract-frustum-planes":120,"gl-mat4/multiply":251,"gl-mat4/transpose":259,"gl-vec4/transformMat4":132,"split-polygon":139}],233:[function(require,module,exports){
"use strict";function saveFBOState(e){var r=e.getParameter(e.FRAMEBUFFER_BINDING),t=e.getParameter(e.RENDERBUFFER_BINDING),o=e.getParameter(e.TEXTURE_BINDING_2D);return[r,t,o]}function restoreFBOState(e,r){e.bindFramebuffer(e.FRAMEBUFFER,r[0]),e.bindRenderbuffer(e.RENDERBUFFER,r[1]),e.bindTexture(e.TEXTURE_2D,r[2])}function lazyInitColorAttachments(e,r){var t=e.getParameter(r.MAX_COLOR_ATTACHMENTS_WEBGL);colorAttachmentArrays=new Array(t+1);for(var o=0;t>=o;++o){for(var E=new Array(t),n=0;o>n;++n)E[n]=e.COLOR_ATTACHMENT0+n;for(var n=o;t>n;++n)E[n]=e.NONE;colorAttachmentArrays[o]=E}}function throwFBOError(e){switch(e){case FRAMEBUFFER_UNSUPPORTED:throw new Error("gl-fbo: Framebuffer unsupported");case FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("gl-fbo: Framebuffer incomplete attachment");case FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("gl-fbo: Framebuffer incomplete dimensions");case FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("gl-fbo: Framebuffer incomplete missing attachment");default:throw new Error("gl-fbo: Framebuffer failed for unspecified reason")}}function initTexture(e,r,t,o,E,n){if(!o)return null;var a=createTexture(e,r,t,E,o);return a.magFilter=e.NEAREST,a.minFilter=e.NEAREST,a.mipSamples=1,a.bind(),e.framebufferTexture2D(e.FRAMEBUFFER,n,e.TEXTURE_2D,a.handle,0),a}function initRenderBuffer(e,r,t,o,E){var n=e.createRenderbuffer();return e.bindRenderbuffer(e.RENDERBUFFER,n),e.renderbufferStorage(e.RENDERBUFFER,o,r,t),e.framebufferRenderbuffer(e.FRAMEBUFFER,E,e.RENDERBUFFER,n),n}function rebuildFBO(e){var r=saveFBOState(e.gl),t=e.gl,o=e.handle=t.createFramebuffer(),E=e._shape[0],n=e._shape[1],a=e.color.length,s=e._ext,i=e._useStencil,_=e._useDepth,f=e._colorType;t.bindFramebuffer(t.FRAMEBUFFER,o);for(var h=0;a>h;++h)e.color[h]=initTexture(t,E,n,f,t.RGBA,t.COLOR_ATTACHMENT0+h);0===a?(e._color_rb=initRenderBuffer(t,E,n,t.RGBA4,t.COLOR_ATTACHMENT0),s&&s.drawBuffersWEBGL(colorAttachmentArrays[0])):a>1&&s.drawBuffersWEBGL(colorAttachmentArrays[a]);var F=t.getExtension("WEBGL_depth_texture");F?i?e.depth=initTexture(t,E,n,F.UNSIGNED_INT_24_8_WEBGL,t.DEPTH_STENCIL,t.DEPTH_STENCIL_ATTACHMENT):_&&(e.depth=initTexture(t,E,n,t.UNSIGNED_SHORT,t.DEPTH_COMPONENT,t.DEPTH_ATTACHMENT)):_&&i?e._depth_rb=initRenderBuffer(t,E,n,t.DEPTH_STENCIL,t.DEPTH_STENCIL_ATTACHMENT):_?e._depth_rb=initRenderBuffer(t,E,n,t.DEPTH_COMPONENT16,t.DEPTH_ATTACHMENT):i&&(e._depth_rb=initRenderBuffer(t,E,n,t.STENCIL_INDEX,t.STENCIL_ATTACHMENT));var l=t.checkFramebufferStatus(t.FRAMEBUFFER);if(l!==t.FRAMEBUFFER_COMPLETE){e._destroyed=!0,t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(e.handle),e.handle=null,e.depth&&(e.depth.dispose(),e.depth=null),e._depth_rb&&(t.deleteRenderbuffer(e._depth_rb),e._depth_rb=null);for(var h=0;h<e.color.length;++h)e.color[h].dispose(),e.color[h]=null;e._color_rb&&(t.deleteRenderbuffer(e._color_rb),e._color_rb=null),restoreFBOState(t,r),throwFBOError(l)}restoreFBOState(t,r)}function Framebuffer(e,r,t,o,E,n,a,s){this.gl=e,this._shape=[0|r,0|t],this._destroyed=!1,this._ext=s,this.color=new Array(E);for(var i=0;E>i;++i)this.color[i]=null;this._color_rb=null,this.depth=null,this._depth_rb=null,this._colorType=o,this._useDepth=n,this._useStencil=a;var _=this,f=[0|r,0|t];Object.defineProperties(f,{0:{get:function(){return _._shape[0]},set:function(e){return _.width=e}},1:{get:function(){return _._shape[1]},set:function(e){return _.height=e}}}),this._shapeVector=f,rebuildFBO(this)}function reshapeFBO(e,r,t){if(e._destroyed)throw new Error("gl-fbo: Can't resize destroyed FBO");if(e._shape[0]!==r||e._shape[1]!==t){var o=e.gl,E=o.getParameter(o.MAX_RENDERBUFFER_SIZE);if(0>r||r>E||0>t||t>E)throw new Error("gl-fbo: Can't resize FBO, invalid dimensions");e._shape[0]=r,e._shape[1]=t;for(var n=saveFBOState(o),a=0;a<e.color.length;++a)e.color[a].shape=e._shape;e._color_rb&&(o.bindRenderbuffer(o.RENDERBUFFER,e._color_rb),o.renderbufferStorage(o.RENDERBUFFER,o.RGBA4,e._shape[0],e._shape[1])),e.depth&&(e.depth.shape=e._shape),e._depth_rb&&(o.bindRenderbuffer(o.RENDERBUFFER,e._depth_rb),e._useDepth&&e._useStencil?o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,e._shape[0],e._shape[1]):e._useDepth?o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,e._shape[0],e._shape[1]):e._useStencil&&o.renderbufferStorage(o.RENDERBUFFER,o.STENCIL_INDEX,e._shape[0],e._shape[1])),o.bindFramebuffer(o.FRAMEBUFFER,e.handle);var s=o.checkFramebufferStatus(o.FRAMEBUFFER);s!==o.FRAMEBUFFER_COMPLETE&&(e.dispose(),restoreFBOState(o,n),throwFBOError(s)),restoreFBOState(o,n)}}function createFBO(e,r,t,o){FRAMEBUFFER_UNSUPPORTED||(FRAMEBUFFER_UNSUPPORTED=e.FRAMEBUFFER_UNSUPPORTED,FRAMEBUFFER_INCOMPLETE_ATTACHMENT=e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT,FRAMEBUFFER_INCOMPLETE_DIMENSIONS=e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT);var E=e.getExtension("WEBGL_draw_buffers");if(!colorAttachmentArrays&&E&&lazyInitColorAttachments(e,E),Array.isArray(r)&&(o=t,t=0|r[1],r=0|r[0]),"number"!=typeof r)throw new Error("gl-fbo: Missing shape parameter");var n=e.getParameter(e.MAX_RENDERBUFFER_SIZE);if(0>r||r>n||0>t||t>n)throw new Error("gl-fbo: Parameters are too large for FBO");o=o||{};var a=1;if("color"in o){if(a=Math.max(0|o.color,0),0>a)throw new Error("gl-fbo: Must specify a nonnegative number of colors");if(a>1){if(!E)throw new Error("gl-fbo: Multiple draw buffer extension not supported");if(a>e.getParameter(E.MAX_COLOR_ATTACHMENTS_WEBGL))throw new Error("gl-fbo: Context does not support "+a+" draw buffers")}}var s=e.UNSIGNED_BYTE,i=e.getExtension("OES_texture_float");if(o["float"]&&a>0){if(!i)throw new Error("gl-fbo: Context does not support floating point textures");s=e.FLOAT}else o.preferFloat&&a>0&&i&&(s=e.FLOAT);var _=!0;"depth"in o&&(_=!!o.depth);var f=!1;return"stencil"in o&&(f=!!o.stencil),new Framebuffer(e,r,t,s,a,_,f,E)}var createTexture=require("gl-texture2d");module.exports=createFBO;var colorAttachmentArrays=null,FRAMEBUFFER_UNSUPPORTED,FRAMEBUFFER_INCOMPLETE_ATTACHMENT,FRAMEBUFFER_INCOMPLETE_DIMENSIONS,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT,proto=Framebuffer.prototype;Object.defineProperties(proto,{shape:{get:function(){return this._destroyed?[0,0]:this._shapeVector},set:function(e){if(Array.isArray(e)||(e=[0|e,0|e]),2!==e.length)throw new Error("gl-fbo: Shape vector must be length 2");var r=0|e[0],t=0|e[1];return reshapeFBO(this,r,t),[r,t]},enumerable:!1},width:{get:function(){return this._destroyed?0:this._shape[0]},set:function(e){return e=0|e,reshapeFBO(this,e,this._shape[1]),e},enumerable:!1},height:{get:function(){return this._destroyed?0:this._shape[1]},set:function(e){return e=0|e,reshapeFBO(this,this._shape[0],e),e},enumerable:!1}}),proto.bind=function(){if(!this._destroyed){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.handle),e.viewport(0,0,this._shape[0],this._shape[1])}},proto.dispose=function(){if(!this._destroyed){this._destroyed=!0;var e=this.gl;e.deleteFramebuffer(this.handle),this.handle=null,this.depth&&(this.depth.dispose(),this.depth=null),this._depth_rb&&(e.deleteRenderbuffer(this._depth_rb),this._depth_rb=null);for(var r=0;r<this.color.length;++r)this.color[r].dispose(),this.color[r]=null;this._color_rb&&(e.deleteRenderbuffer(this._color_rb),this._color_rb=null)}};

},{"gl-texture2d":242}],234:[function(require,module,exports){
"use strict";function fixup(a){if(!a)return EmptyProc;for(var r=0;r<a.args.length;++r){var s=a.args[r];0===r?a.args[r]={name:s,lvalue:!0,rvalue:!!a.rvalue,count:a.count||1}:a.args[r]={name:s,lvalue:!1,rvalue:!0,count:1}}return a.thisVars||(a.thisVars=[]),a.localVars||(a.localVars=[]),a}function pcompile(a){return compile({args:a.args,pre:fixup(a.pre),body:fixup(a.body),post:fixup(a.proc),funcName:a.funcName})}function makeOp(a){for(var r=[],s=0;s<a.args.length;++s)r.push("a"+s);var i=new Function("P",["return function ",a.funcName,"_ndarrayops(",r.join(","),") {P(",r.join(","),");return a0}"].join(""));return i(pcompile(a))}var compile=require("cwise-compiler"),EmptyProc={body:"",args:[],thisVars:[],localVars:[]},assign_ops={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var a in assign_ops){var r=assign_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:a+"eq"}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:a+"seq"})}}();var unary_ops={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var a in unary_ops){var r=unary_ops[a];exports[a]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:a}),exports[a+"eq"]=makeOp({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:a+"eq"})}}();var binary_ops={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var a in binary_ops){var r=binary_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:a+"eq"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:a+"seq"})}}();var math_unary=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var a=0;a<math_unary.length;++a){var r=math_unary[a];exports[r]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),exports[r+"eq"]=makeOp({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var math_comm=["max","min","atan2","pow"];!function(){for(var a=0;a<math_comm.length;++a){var r=math_comm[a];exports[r]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),exports[r+"s"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),exports[r+"eq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),exports[r+"seq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var math_noncomm=["atan2","pow"];!function(){for(var a=0;a<math_noncomm.length;++a){var r=math_noncomm[a];exports[r+"op"]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),exports[r+"ops"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),exports[r+"opeq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),exports[r+"opseq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),exports.any=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),exports.all=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),exports.sum=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),exports.prod=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),exports.norm2squared=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),exports.norm2=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),exports.norminf=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),exports.norm1=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),exports.sup=compile({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.inf=compile({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.argmin=compile({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.argmax=compile({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.random=makeOp({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),exports.assign=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),exports.assigns=makeOp({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),exports.equals=compile({args:["array","array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"});

},{"cwise-compiler":235}],235:[function(require,module,exports){
"use strict";function Procedure(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function compileCwise(r){var e=new Procedure;e.pre=r.pre,e.body=r.body,e.post=r.post;var s=r.args.slice(0);e.argTypes=s;for(var o=0;o<s.length;++o){var a=s[o];if("array"===a||"object"==typeof a&&a.blockIndices){if(e.argTypes[o]="array",e.arrayArgs.push(o),e.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),e.shimArgs.push("array"+o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===a)e.scalarArgs.push(o),e.shimArgs.push("scalar"+o);else if("index"===a){if(e.indexArgs.push(o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===a){if(e.shapeArgs.push(o),o<e.pre.args.length&&e.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<e.post.args.length&&e.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof a||!a.offset)throw new Error("cwise: Unknown argument type "+s[o]);e.argTypes[o]="offset",e.offsetArgs.push({array:a.array,offset:a.offset}),e.offsetArgIndex.push(o)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>s.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>s.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>s.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!r.printCode||!!r.debug,e.funcName=r.funcName||"cwise",e.blockSize=r.blockSize||64,createThunk(e)}var createThunk=require("./lib/thunk.js");module.exports=compileCwise;

},{"./lib/thunk.js":237}],236:[function(require,module,exports){
"use strict";function innerFill(r,n,e){var s,a,o=r.length,i=n.arrayArgs.length,t=n.indexArgs.length>0,p=[],h=[],u=0,c=0;for(s=0;o>s;++s)h.push(["i",s,"=0"].join(""));for(a=0;i>a;++a)for(s=0;o>s;++s)c=u,u=r[s],0===s?h.push(["d",a,"s",s,"=t",a,"p",u].join("")):h.push(["d",a,"s",s,"=(t",a,"p",u,"-s",c,"*t",a,"p",c,")"].join(""));for(p.push("var "+h.join(",")),s=o-1;s>=0;--s)u=r[s],p.push(["for(i",s,"=0;i",s,"<s",u,";++i",s,"){"].join(""));for(p.push(e),s=0;o>s;++s){for(c=u,u=r[s],a=0;i>a;++a)p.push(["p",a,"+=d",a,"s",s].join(""));t&&(s>0&&p.push(["index[",c,"]-=s",c].join("")),p.push(["++index[",u,"]"].join(""))),p.push("}")}return p.join("\n")}function outerFill(r,n,e,s){for(var a=n.length,o=e.arrayArgs.length,i=e.blockSize,t=e.indexArgs.length>0,p=[],h=0;o>h;++h)p.push(["var offset",h,"=p",h].join(""));for(var h=r;a>h;++h)p.push(["for(var j"+h+"=SS[",n[h],"]|0;j",h,">0;){"].join("")),p.push(["if(j",h,"<",i,"){"].join("")),p.push(["s",n[h],"=j",h].join("")),p.push(["j",h,"=0"].join("")),p.push(["}else{s",n[h],"=",i].join("")),p.push(["j",h,"-=",i,"}"].join("")),t&&p.push(["index[",n[h],"]=j",h].join(""));for(var h=0;o>h;++h){for(var u=["offset"+h],c=r;a>c;++c)u.push(["j",c,"*t",h,"p",n[c]].join(""));p.push(["p",h,"=(",u.join("+"),")"].join(""))}p.push(innerFill(n,e,s));for(var h=r;a>h;++h)p.push("}");return p.join("\n")}function countMatches(r){for(var n=0,e=r[0].length;e>n;){for(var s=1;s<r.length;++s)if(r[s][n]!==r[0][n])return n;++n}return n}function processBlock(r,n,e){for(var s=r.body,a=[],o=[],i=0;i<r.args.length;++i){var t=r.args[i];if(!(t.count<=0)){var p=new RegExp(t.name,"g"),h="",u=n.arrayArgs.indexOf(i);switch(n.argTypes[i]){case"offset":var c=n.offsetArgIndex.indexOf(i),l=n.offsetArgs[c];u=l.array,h="+q"+c;case"array":h="p"+u+h;var f="l"+i,g="a"+u;if(0===n.arrayBlockIndices[u])1===t.count?"generic"===e[u]?t.lvalue?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),o.push([g,".set(",h,",",f,")"].join(""))):s=s.replace(p,[g,".get(",h,")"].join("")):s=s.replace(p,[g,"[",h,"]"].join("")):"generic"===e[u]?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,".set(",h,",",f,")"].join(""))):(a.push(["var ",f,"=",g,"[",h,"]"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,"[",h,"]=",f].join("")));else{for(var j=[t.name],v=[h],y=0;y<Math.abs(n.arrayBlockIndices[u]);y++)j.push("\\s*\\[([^\\]]+)\\]"),v.push("$"+(y+1)+"*t"+u+"b"+y);if(p=new RegExp(j.join(""),"g"),h=v.join("+"),"generic"===e[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");s=s.replace(p,[g,"[",h,"]"].join(""))}break;case"scalar":s=s.replace(p,"Y"+n.scalarArgs.indexOf(i));break;case"index":s=s.replace(p,"index");break;case"shape":s=s.replace(p,"shape")}}}return[a.join("\n"),s,o.join("\n")].join("\n").trim()}function typeSummary(r){for(var n=new Array(r.length),e=!0,s=0;s<r.length;++s){var a=r[s],o=a.match(/\d+/);o=o?o[0]:"",0===a.charAt(0)?n[s]="u"+a.charAt(1)+o:n[s]=a.charAt(0)+o,s>0&&(e=e&&n[s]===n[s-1])}return e?n[0]:n.join("")}function generateCWiseOp(r,n){for(var e=n[1].length-Math.abs(r.arrayBlockIndices[0])|0,s=new Array(r.arrayArgs.length),a=new Array(r.arrayArgs.length),o=0;o<r.arrayArgs.length;++o)a[o]=n[2*o],s[o]=n[2*o+1];for(var i=[],t=[],p=[],h=[],u=[],o=0;o<r.arrayArgs.length;++o){r.arrayBlockIndices[o]<0?(p.push(0),h.push(e),i.push(e),t.push(e+r.arrayBlockIndices[o])):(p.push(r.arrayBlockIndices[o]),h.push(r.arrayBlockIndices[o]+e),i.push(0),t.push(r.arrayBlockIndices[o]));for(var c=[],l=0;l<s[o].length;l++)p[o]<=s[o][l]&&s[o][l]<h[o]&&c.push(s[o][l]-p[o]);u.push(c)}for(var f=["SS"],g=["'use strict'"],j=[],l=0;e>l;++l)j.push(["s",l,"=SS[",l,"]"].join(""));for(var o=0;o<r.arrayArgs.length;++o){f.push("a"+o),f.push("t"+o),f.push("p"+o);for(var l=0;e>l;++l)j.push(["t",o,"p",l,"=t",o,"[",p[o]+l,"]"].join(""));for(var l=0;l<Math.abs(r.arrayBlockIndices[o]);++l)j.push(["t",o,"b",l,"=t",o,"[",i[o]+l,"]"].join(""))}for(var o=0;o<r.scalarArgs.length;++o)f.push("Y"+o);if(r.shapeArgs.length>0&&j.push("shape=SS.slice(0)"),r.indexArgs.length>0){for(var v=new Array(e),o=0;e>o;++o)v[o]="0";j.push(["index=[",v.join(","),"]"].join(""))}for(var o=0;o<r.offsetArgs.length;++o){for(var y=r.offsetArgs[o],d=[],l=0;l<y.offset.length;++l)0!==y.offset[l]&&(1===y.offset[l]?d.push(["t",y.array,"p",l].join("")):d.push([y.offset[l],"*t",y.array,"p",l].join("")));0===d.length?j.push("q"+o+"=0"):j.push(["q",o,"=",d.join("+")].join(""))}var A=uniq([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));j=j.concat(A),g.push("var "+j.join(","));for(var o=0;o<r.arrayArgs.length;++o)g.push("p"+o+"|=0");r.pre.body.length>3&&g.push(processBlock(r.pre,r,a));var k=processBlock(r.body,r,a),b=countMatches(u);e>b?g.push(outerFill(b,u[0],r,k)):g.push(innerFill(u[0],r,k)),r.post.body.length>3&&g.push(processBlock(r.post,r,a)),r.debug&&console.log("-----Generated cwise routine for ",n,":\n"+g.join("\n")+"\n----------");var x=[r.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",b,typeSummary(a)].join(""),w=new Function(["function ",x,"(",f.join(","),"){",g.join("\n"),"} return ",x].join(""));return w()}var uniq=require("uniq");module.exports=generateCWiseOp;

},{"uniq":238}],237:[function(require,module,exports){
"use strict";function createThunk(r){var a=["'use strict'","var CACHED={}"],e=[],s=r.funcName+"_cwise_thunk";a.push(["return function ",s,"(",r.shimArgs.join(","),"){"].join(""));for(var n=[],o=[],h=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],i=[],p=[],t=0;t<r.arrayArgs.length;++t){var c=r.arrayArgs[t];e.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),n.push("t"+c),n.push("r"+c),o.push("t"+c),o.push("r"+c+".join()"),h.push("array"+c+".data"),h.push("array"+c+".stride"),h.push("array"+c+".offset|0"),t>0&&(i.push("array"+r.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[t]))),p.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[t])+"]"))}r.arrayArgs.length>1&&(a.push("if (!("+i.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),a.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),a.push("if (!("+p.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),a.push("}"));for(var t=0;t<r.scalarArgs.length;++t)h.push("scalar"+r.scalarArgs[t]);e.push(["type=[",o.join(","),"].join()"].join("")),e.push("proc=CACHED[type]"),a.push("var "+e.join(",")),a.push(["if(!proc){","CACHED[type]=proc=compile([",n.join(","),"])}","return proc(",h.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+a.join("\n")+"\n----------");var u=new Function("compile",a.join("\n"));return u(compile.bind(void 0,r))}var compile=require("./compile.js");module.exports=createThunk;

},{"./compile.js":236}],238:[function(require,module,exports){
"use strict";function unique_pred(n,e){for(var u=1,t=n.length,i=n[0],r=n[0],o=1;t>o;++o)if(r=i,i=n[o],e(i,r)){if(o===u){u++;continue}n[u++]=i}return n.length=u,n}function unique_eq(n){for(var e=1,u=n.length,t=n[0],i=n[0],r=1;u>r;++r,i=t)if(i=t,t=n[r],t!==i){if(r===e){e++;continue}n[e++]=t}return n.length=e,n}function unique(n,e,u){return 0===n.length?n:e?(u||n.sort(e),unique_pred(n,e)):(u||n.sort(),unique_eq(n))}module.exports=unique;

},{}],239:[function(require,module,exports){
"use strict";"use restrict";function countTrailingZeros(r){var n=32;return r&=-r,r&&n--,65535&r&&(n-=16),16711935&r&&(n-=8),252645135&r&&(n-=4),858993459&r&&(n-=2),1431655765&r&&(n-=1),n}var INT_BITS=32;exports.INT_BITS=INT_BITS,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<INT_BITS-1,exports.sign=function(r){return(r>0)-(0>r)},exports.abs=function(r){var n=r>>INT_BITS-1;return(r^n)-n},exports.min=function(r,n){return n^(r^n)&-(n>r)},exports.max=function(r,n){return r^(r^n)&-(n>r)},exports.isPow2=function(r){return!(r&r-1||!r)},exports.log2=function(r){var n,t;return n=(r>65535)<<4,r>>>=n,t=(r>255)<<3,r>>>=t,n|=t,t=(r>15)<<2,r>>>=t,n|=t,t=(r>3)<<1,r>>>=t,n|=t,n|r>>1},exports.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},exports.popCount=function(r){return r-=r>>>1&1431655765,r=(858993459&r)+(r>>>2&858993459),16843009*(r+(r>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1},exports.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r-(r>>>1)},exports.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,r&=15,27030>>>r&1};var REVERSE_TABLE=new Array(256);!function(r){for(var n=0;256>n;++n){var t=n,e=n,o=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--o;r[n]=e<<o&255}}(REVERSE_TABLE),exports.reverse=function(r){return REVERSE_TABLE[255&r]<<24|REVERSE_TABLE[r>>>8&255]<<16|REVERSE_TABLE[r>>>16&255]<<8|REVERSE_TABLE[r>>>24&255]},exports.interleave2=function(r,n){return r&=65535,r=16711935&(r|r<<8),r=252645135&(r|r<<4),r=858993459&(r|r<<2),r=1431655765&(r|r<<1),n&=65535,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),r|n<<1},exports.deinterleave2=function(r,n){return r=r>>>n&1431655765,r=858993459&(r|r>>>1),r=252645135&(r|r>>>2),r=16711935&(r|r>>>4),r=65535&(r|r>>>16),r<<16>>16},exports.interleave3=function(r,n,t){return r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),n&=1023,n=4278190335&(n|n<<16),n=251719695&(n|n<<8),n=3272356035&(n|n<<4),n=1227133513&(n|n<<2),r|=n<<1,t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),r|t<<2},exports.deinterleave3=function(r,n){return r=r>>>n&1227133513,r=3272356035&(r|r>>>2),r=251719695&(r|r>>>4),r=4278190335&(r|r>>>8),r=1023&(r|r>>>16),r<<22>>22},exports.nextCombination=function(r){var n=r|r-1;return n+1|(~n&-~n)-1>>>countTrailingZeros(r)+1};

},{}],240:[function(require,module,exports){
"use strict";function dupe_array(e,r,u){var n=0|e[u];if(0>=n)return[];var t,a=new Array(n);if(u===e.length-1)for(t=0;n>t;++t)a[t]=r;else for(t=0;n>t;++t)a[t]=dupe_array(e,r,u+1);return a}function dupe_number(e,r){var u,n;for(u=new Array(e),n=0;e>n;++n)u[n]=r;return u}function dupe(e,r){switch("undefined"==typeof r&&(r=0),typeof e){case"number":if(e>0)return dupe_number(0|e,r);break;case"object":if("number"==typeof e.length)return dupe_array(e,r,0)}return[]}module.exports=dupe;

},{}],241:[function(require,module,exports){
(function (global,Buffer){
"use strict";function freeArrayBuffer(r){if(r){var e=r.length||r.byteLength,t=bits.log2(e);DATA[t].push(r)}}function freeTypedArray(r){freeArrayBuffer(r.buffer)}function mallocArrayBuffer(r){var r=bits.nextPow2(r),e=bits.log2(r),t=DATA[e];return t.length>0?t.pop():new ArrayBuffer(r)}function mallocUint8(r){return new Uint8Array(mallocArrayBuffer(r),0,r)}function mallocUint16(r){return new Uint16Array(mallocArrayBuffer(2*r),0,r)}function mallocUint32(r){return new Uint32Array(mallocArrayBuffer(4*r),0,r)}function mallocInt8(r){return new Int8Array(mallocArrayBuffer(r),0,r)}function mallocInt16(r){return new Int16Array(mallocArrayBuffer(2*r),0,r)}function mallocInt32(r){return new Int32Array(mallocArrayBuffer(4*r),0,r)}function mallocFloat(r){return new Float32Array(mallocArrayBuffer(4*r),0,r)}function mallocDouble(r){return new Float64Array(mallocArrayBuffer(8*r),0,r)}function mallocUint8Clamped(r){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(r),0,r):mallocUint8(r)}function mallocDataView(r){return new DataView(mallocArrayBuffer(r),0,r)}function mallocBuffer(r){r=bits.nextPow2(r);var e=bits.log2(r),t=BUFFER[e];return t.length>0?t.pop():new Buffer(r)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(r){if(Buffer.isBuffer(r))BUFFER[bits.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var e=r.length||r.byteLength,t=0|bits.log2(e);DATA[t].push(r)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(r){BUFFER[bits.log2(r.length)].push(r)},exports.malloc=function(r,e){if(void 0===e||"arraybuffer"===e)return mallocArrayBuffer(r);switch(e){case"uint8":return mallocUint8(r);case"uint16":return mallocUint16(r);case"uint32":return mallocUint32(r);case"int8":return mallocInt8(r);case"int16":return mallocInt16(r);case"int32":return mallocInt32(r);case"float":case"float32":return mallocFloat(r);case"double":case"float64":return mallocDouble(r);case"uint8_clamped":return mallocUint8Clamped(r);case"buffer":return mallocBuffer(r);case"data":case"dataview":return mallocDataView(r);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var r=0;32>r;++r)POOL.UINT8[r].length=0,POOL.UINT16[r].length=0,POOL.UINT32[r].length=0,POOL.INT8[r].length=0,POOL.INT16[r].length=0,POOL.INT32[r].length=0,POOL.FLOAT[r].length=0,POOL.DOUBLE[r].length=0,POOL.UINT8C[r].length=0,DATA[r].length=0,BUFFER[r].length=0};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"bit-twiddle":239,"buffer":5,"dup":240}],242:[function(require,module,exports){
"use strict";function lazyInitLinearTypes(e){linearTypes=[e.LINEAR,e.NEAREST_MIPMAP_LINEAR,e.LINEAR_MIPMAP_NEAREST,e.LINEAR_MIPMAP_NEAREST],filterTypes=[e.NEAREST,e.LINEAR,e.NEAREST_MIPMAP_NEAREST,e.NEAREST_MIPMAP_LINEAR,e.LINEAR_MIPMAP_NEAREST,e.LINEAR_MIPMAP_LINEAR],wrapTypes=[e.REPEAT,e.CLAMP_TO_EDGE,e.MIRRORED_REPEAT]}function reshapeTexture(e,t,r){var a=e.gl,i=a.getParameter(a.MAX_TEXTURE_SIZE);if(0>t||t>i||0>r||r>i)throw new Error("gl-texture2d: Invalid texture size");return e._shape=[t,r],e.bind(),a.texImage2D(a.TEXTURE_2D,0,e.format,t,r,0,e.format,e.type,null),e._mipLevels=[0],e}function Texture2D(e,t,r,a,i,n){this.gl=e,this.handle=t,this.format=i,this.type=n,this._shape=[r,a],this._mipLevels=[0],this._magFilter=e.NEAREST,this._minFilter=e.NEAREST,this._wrapS=e.CLAMP_TO_EDGE,this._wrapT=e.CLAMP_TO_EDGE,this._anisoSamples=1;var s=this,o=[this._wrapS,this._wrapT];Object.defineProperties(o,[{get:function(){return s._wrapS},set:function(e){return s.wrapS=e}},{get:function(){return s._wrapT},set:function(e){return s.wrapT=e}}]),this._wrapVector=o;var E=[this._shape[0],this._shape[1]];Object.defineProperties(E,[{get:function(){return s._shape[0]},set:function(e){return s.width=e}},{get:function(){return s._shape[1]},set:function(e){return s.height=e}}]),this._shapeVector=E}function isPacked(e,t){return 3===e.length?1===t[2]&&t[1]===e[0]*e[2]&&t[0]===e[2]:1===t[0]&&t[1]===e[0]}function texSubImageArray(e,t,r,a,i,n,s,o){var E=o.dtype,T=o.shape.slice();if(T.length<2||T.length>3)throw new Error("gl-texture2d: Invalid ndarray, must be 2d or 3d");var u=0,l=0,h=isPacked(T,o.stride.slice());"float32"===E?u=e.FLOAT:"float64"===E?(u=e.FLOAT,h=!1,E="float32"):"uint8"===E?u=e.UNSIGNED_BYTE:(u=e.UNSIGNED_BYTE,h=!1,E="uint8");var f=1;if(2===T.length)l=e.LUMINANCE,T=[T[0],T[1],1],o=ndarray(o.data,T,[o.stride[0],o.stride[1],1],o.offset);else{if(3!==T.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===T[2])l=e.ALPHA;else if(2===T[2])l=e.LUMINANCE_ALPHA;else if(3===T[2])l=e.RGB;else{if(4!==T[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");l=e.RGBA}f=T[2]}if(l!==e.LUMINANCE&&l!==e.ALPHA||i!==e.LUMINANCE&&i!==e.ALPHA||(l=i),l!==i)throw new Error("gl-texture2d: Incompatible texture format for setPixels");var _=o.size,p=s.indexOf(a)<0;if(p&&s.push(a),u===n&&h)0===o.offset&&o.data.length===_?p?e.texImage2D(e.TEXTURE_2D,a,i,T[0],T[1],0,i,n,o.data):e.texSubImage2D(e.TEXTURE_2D,a,t,r,T[0],T[1],i,n,o.data):p?e.texImage2D(e.TEXTURE_2D,a,i,T[0],T[1],0,i,n,o.data.subarray(o.offset,o.offset+_)):e.texSubImage2D(e.TEXTURE_2D,a,t,r,T[0],T[1],i,n,o.data.subarray(o.offset,o.offset+_));else{var g;g=n===e.FLOAT?pool.mallocFloat32(_):pool.mallocUint8(_);var d=ndarray(g,T,[T[2],T[2]*T[0],1]);u===e.FLOAT&&n===e.UNSIGNED_BYTE?convertFloatToUint8(d,o):ops.assign(d,o),p?e.texImage2D(e.TEXTURE_2D,a,i,T[0],T[1],0,i,n,g.subarray(0,_)):e.texSubImage2D(e.TEXTURE_2D,a,t,r,T[0],T[1],i,n,g.subarray(0,_)),n===e.FLOAT?pool.freeFloat32(g):pool.freeUint8(g)}}function initTexture(e){var t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t}function createTextureShape(e,t,r,a,i){var n=e.getParameter(e.MAX_TEXTURE_SIZE);if(0>t||t>n||0>r||r>n)throw new Error("gl-texture2d: Invalid texture shape");if(i===e.FLOAT&&!e.getExtension("OES_texture_float"))throw new Error("gl-texture2d: Floating point textures not supported on this platform");var s=initTexture(e);return e.texImage2D(e.TEXTURE_2D,0,a,t,r,0,a,i,null),new Texture2D(e,s,t,r,a,i)}function createTextureDOM(e,t,r,a){var i=initTexture(e);return e.texImage2D(e.TEXTURE_2D,0,r,r,a,t),new Texture2D(e,i,0|t.width,0|t.height,r,a)}function createTextureArray(e,t){var r=t.dtype,a=t.shape.slice(),i=e.getParameter(e.MAX_TEXTURE_SIZE);if(a[0]<0||a[0]>i||a[1]<0||a[1]>i)throw new Error("gl-texture2d: Invalid texture size");var n=isPacked(a,t.stride.slice()),s=0;"float32"===r?s=e.FLOAT:"float64"===r?(s=e.FLOAT,n=!1,r="float32"):"uint8"===r?s=e.UNSIGNED_BYTE:(s=e.UNSIGNED_BYTE,n=!1,r="uint8");var o=0;if(2===a.length)o=e.LUMINANCE,a=[a[0],a[1],1],t=ndarray(t.data,a,[t.stride[0],t.stride[1],1],t.offset);else{if(3!==a.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===a[2])o=e.ALPHA;else if(2===a[2])o=e.LUMINANCE_ALPHA;else if(3===a[2])o=e.RGB;else{if(4!==a[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");o=e.RGBA}}s!==e.FLOAT||e.getExtension("OES_texture_float")||(s=e.UNSIGNED_BYTE,n=!1);var E,T,u=t.size;if(n)E=0===t.offset&&t.data.length===u?t.data:t.data.subarray(t.offset,t.offset+u);else{var l=[a[2],a[2]*a[0],1];T=pool.malloc(u,r);var h=ndarray(T,a,l,0);"float32"!==r&&"float64"!==r||s!==e.UNSIGNED_BYTE?ops.assign(h,t):convertFloatToUint8(h,t),E=T.subarray(0,u)}var f=initTexture(e);return e.texImage2D(e.TEXTURE_2D,0,o,a[0],a[1],0,o,s,E),n||pool.free(T),new Texture2D(e,f,a[0],a[1],o,s)}function createTexture2D(e){if(arguments.length<=1)throw new Error("gl-texture2d: Missing arguments for texture2d constructor");if(linearTypes||lazyInitLinearTypes(e),"number"==typeof arguments[1])return createTextureShape(e,arguments[1],arguments[2],arguments[3]||e.RGBA,arguments[4]||e.UNSIGNED_BYTE);if(Array.isArray(arguments[1]))return createTextureShape(e,0|arguments[1][0],0|arguments[1][1],arguments[2]||e.RGBA,arguments[3]||e.UNSIGNED_BYTE);if("object"==typeof arguments[1]){var t=arguments[1];if(t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof ImageData)return createTextureDOM(e,t,arguments[2]||e.RGBA,arguments[3]||e.UNSIGNED_BYTE);if(t.shape&&t.data&&t.stride)return createTextureArray(e,t)}throw new Error("gl-texture2d: Invalid arguments for texture2d constructor")}var ndarray=require("ndarray"),ops=require("ndarray-ops"),pool=require("typedarray-pool");module.exports=createTexture2D;var linearTypes=null,filterTypes=null,wrapTypes=null,convertFloatToUint8=function(e,t){ops.muls(e,t,255)},proto=Texture2D.prototype;Object.defineProperties(proto,{minFilter:{get:function(){return this._minFilter},set:function(e){this.bind();var t=this.gl;if(this.type===t.FLOAT&&linearTypes.indexOf(e)>=0&&(t.getExtension("OES_texture_float_linear")||(e=t.NEAREST)),filterTypes.indexOf(e)<0)throw new Error("gl-texture2d: Unknown filter mode "+e);return t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),this._minFilter=e}},magFilter:{get:function(){return this._magFilter},set:function(e){this.bind();var t=this.gl;if(this.type===t.FLOAT&&linearTypes.indexOf(e)>=0&&(t.getExtension("OES_texture_float_linear")||(e=t.NEAREST)),filterTypes.indexOf(e)<0)throw new Error("gl-texture2d: Unknown filter mode "+e);return t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),this._magFilter=e}},mipSamples:{get:function(){return this._anisoSamples},set:function(e){var t=this._anisoSamples;if(this._anisoSamples=0|Math.max(e,1),t!==this._anisoSamples){var r=gl.getExtension("EXT_texture_filter_anisotropic");r&&this.gl.texParameterf(this.gl.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY_EXT,this._anisoSamples)}return this._anisoSamples}},wrapS:{get:function(){return this._wrapS},set:function(e){if(this.bind(),wrapTypes.indexOf(e)<0)throw new Error("gl-texture2d: Unknown wrap mode "+e);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,e),this._wrapS=e}},wrapT:{get:function(){return this._wrapT},set:function(e){if(this.bind(),wrapTypes.indexOf(e)<0)throw new Error("gl-texture2d: Unknown wrap mode "+e);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,e),this._wrapT=e}},wrap:{get:function(){return this._wrapVector},set:function(e){if(Array.isArray(e)||(e=[e,e]),2!==e.length)throw new Error("gl-texture2d: Must specify wrap mode for rows and columns");for(var t=0;2>t;++t)if(wrapTypes.indexOf(e[t])<0)throw new Error("gl-texture2d: Unknown wrap mode "+e);this._wrapS=e[0],this._wrapT=e[1];var r=this.gl;return this.bind(),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,this._wrapS),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,this._wrapT),e}},shape:{get:function(){return this._shapeVector},set:function(e){if(Array.isArray(e)){if(2!==e.length)throw new Error("gl-texture2d: Invalid texture shape")}else e=[0|e,0|e];return reshapeTexture(this,0|e[0],0|e[1]),[0|e[0],0|e[1]]}},width:{get:function(){return this._shape[0]},set:function(e){return e=0|e,reshapeTexture(this,e,this._shape[1]),e}},height:{get:function(){return this._shape[1]},set:function(e){return e=0|e,reshapeTexture(this,this._shape[0],e),e}}}),proto.bind=function(e){var t=this.gl;return void 0!==e&&t.activeTexture(t.TEXTURE0+(0|e)),t.bindTexture(t.TEXTURE_2D,this.handle),void 0!==e?0|e:t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0},proto.dispose=function(){this.gl.deleteTexture(this.handle)},proto.generateMipmap=function(){this.bind(),this.gl.generateMipmap(this.gl.TEXTURE_2D);for(var e=Math.min(this._shape[0],this._shape[1]),t=0;e>0;++t,e>>>=1)this._mipLevels.indexOf(t)<0&&this._mipLevels.push(t)},proto.setPixels=function(e,t,r,a){var i=this.gl;if(this.bind(),Array.isArray(t)?(a=r,r=0|t[1],t=0|t[0]):(t=t||0,r=r||0),a=a||0,e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLVideoElement){var n=this._mipLevels.indexOf(a)<0;n?(i.texImage2D(i.TEXTURE_2D,0,this.format,this.format,this.type,e),this._mipLevels.push(a)):i.texSubImage2D(i.TEXTURE_2D,a,t,r,this.format,this.type,e)}else{if(!(e.shape&&e.stride&&e.data))throw new Error("gl-texture2d: Unsupported data type");if(e.shape.length<2||t+e.shape[1]>this._shape[1]>>>a||r+e.shape[0]>this._shape[0]>>>a||0>t||0>r)throw new Error("gl-texture2d: Texture dimensions are out of bounds");texSubImageArray(i,t,r,a,this.format,this.type,this._mipLevels,e)}};

},{"ndarray":296,"ndarray-ops":234,"typedarray-pool":241}],243:[function(require,module,exports){
function clone(e){var n=new Float32Array(16);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}module.exports=clone;

},{}],244:[function(require,module,exports){
function create(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}module.exports=create;

},{}],245:[function(require,module,exports){
function determinant(e){var n=e[0],t=e[1],r=e[2],a=e[3],d=e[4],i=e[5],m=e[6],o=e[7],u=e[8],c=e[9],f=e[10],l=e[11],p=e[12],s=e[13],v=e[14],x=e[15],b=n*i-t*d,g=n*m-r*d,h=n*o-a*d,j=t*m-r*i,k=t*o-a*i,q=r*o-a*m,w=u*s-c*p,y=u*v-f*p,z=u*x-l*p,A=c*v-f*s,B=c*x-l*s,C=f*x-l*v;return b*C-g*B+h*A+j*z-k*y+q*w}module.exports=determinant;

},{}],246:[function(require,module,exports){
function fromQuat(r,o){var t=o[0],u=o[1],a=o[2],e=o[3],f=t+t,m=u+u,n=a+a,Q=t*f,c=u*f,d=u*m,i=a*f,l=a*m,p=a*n,s=e*f,v=e*m,x=e*n;return r[0]=1-d-p,r[1]=c+x,r[2]=i-v,r[3]=0,r[4]=c-x,r[5]=1-Q-p,r[6]=l+s,r[7]=0,r[8]=i+v,r[9]=l-s,r[10]=1-Q-d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}module.exports=fromQuat;

},{}],247:[function(require,module,exports){
function fromRotationTranslation(o,n,t){var r=n[0],a=n[1],i=n[2],e=n[3],f=r+r,l=a+a,m=i+i,s=r*f,u=r*l,R=r*m,T=a*l,c=a*m,d=i*m,p=e*f,v=e*l,x=e*m;return o[0]=1-(T+d),o[1]=u+x,o[2]=R-v,o[3]=0,o[4]=u-x,o[5]=1-(s+d),o[6]=c+p,o[7]=0,o[8]=R+v,o[9]=c-p,o[10]=1-(s+T),o[11]=0,o[12]=t[0],o[13]=t[1],o[14]=t[2],o[15]=1,o}module.exports=fromRotationTranslation;

},{}],248:[function(require,module,exports){
function identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}module.exports=identity;

},{}],249:[function(require,module,exports){
function invert(n,r){var e=r[0],t=r[1],u=r[2],i=r[3],l=r[4],o=r[5],v=r[6],a=r[7],c=r[8],d=r[9],f=r[10],m=r[11],p=r[12],s=r[13],x=r[14],b=r[15],g=e*o-t*l,h=e*v-u*l,j=e*a-i*l,k=t*v-u*o,q=t*a-i*o,w=u*a-i*v,y=c*s-d*p,z=c*x-f*p,A=c*b-m*p,B=d*x-f*s,C=d*b-m*s,D=f*b-m*x,E=g*D-h*C+j*B+k*A-q*z+w*y;return E?(E=1/E,n[0]=(o*D-v*C+a*B)*E,n[1]=(u*C-t*D-i*B)*E,n[2]=(s*w-x*q+b*k)*E,n[3]=(f*q-d*w-m*k)*E,n[4]=(v*A-l*D-a*z)*E,n[5]=(e*D-u*A+i*z)*E,n[6]=(x*j-p*w-b*h)*E,n[7]=(c*w-f*j+m*h)*E,n[8]=(l*C-o*A+a*y)*E,n[9]=(t*A-e*C-i*y)*E,n[10]=(p*q-s*j+b*g)*E,n[11]=(d*j-c*q-m*g)*E,n[12]=(o*z-l*B-v*y)*E,n[13]=(e*B-t*z+u*y)*E,n[14]=(s*h-p*k-x*g)*E,n[15]=(c*k-d*h+f*g)*E,n):null}module.exports=invert;

},{}],250:[function(require,module,exports){
function lookAt(t,a,e,r){var i,o,s,h,n,M,d,q,u,b,l=a[0],y=a[1],k=a[2],v=r[0],A=r[1],c=r[2],f=e[0],m=e[1],p=e[2];return Math.abs(l-f)<1e-6&&Math.abs(y-m)<1e-6&&Math.abs(k-p)<1e-6?identity(t):(d=l-f,q=y-m,u=k-p,b=1/Math.sqrt(d*d+q*q+u*u),d*=b,q*=b,u*=b,i=A*u-c*q,o=c*d-v*u,s=v*q-A*d,b=Math.sqrt(i*i+o*o+s*s),b?(b=1/b,i*=b,o*=b,s*=b):(i=0,o=0,s=0),h=q*s-u*o,n=u*i-d*s,M=d*o-q*i,b=Math.sqrt(h*h+n*n+M*M),b?(b=1/b,h*=b,n*=b,M*=b):(h=0,n=0,M=0),t[0]=i,t[1]=h,t[2]=d,t[3]=0,t[4]=o,t[5]=n,t[6]=q,t[7]=0,t[8]=s,t[9]=M,t[10]=u,t[11]=0,t[12]=-(i*l+o*y+s*k),t[13]=-(h*l+n*y+M*k),t[14]=-(d*l+q*y+u*k),t[15]=1,t)}var identity=require("./identity");module.exports=lookAt;

},{"./identity":248}],251:[function(require,module,exports){
function multiply(l,t,u){var r=t[0],e=t[1],i=t[2],m=t[3],n=t[4],o=t[5],p=t[6],y=t[7],a=t[8],c=t[9],d=t[10],f=t[11],s=t[12],v=t[13],x=t[14],b=t[15],g=u[0],h=u[1],j=u[2],k=u[3];return l[0]=g*r+h*n+j*a+k*s,l[1]=g*e+h*o+j*c+k*v,l[2]=g*i+h*p+j*d+k*x,l[3]=g*m+h*y+j*f+k*b,g=u[4],h=u[5],j=u[6],k=u[7],l[4]=g*r+h*n+j*a+k*s,l[5]=g*e+h*o+j*c+k*v,l[6]=g*i+h*p+j*d+k*x,l[7]=g*m+h*y+j*f+k*b,g=u[8],h=u[9],j=u[10],k=u[11],l[8]=g*r+h*n+j*a+k*s,l[9]=g*e+h*o+j*c+k*v,l[10]=g*i+h*p+j*d+k*x,l[11]=g*m+h*y+j*f+k*b,g=u[12],h=u[13],j=u[14],k=u[15],l[12]=g*r+h*n+j*a+k*s,l[13]=g*e+h*o+j*c+k*v,l[14]=g*i+h*p+j*d+k*x,l[15]=g*m+h*y+j*f+k*b,l}module.exports=multiply;

},{}],252:[function(require,module,exports){
function perspective(e,t,r,p,n){var a=1/Math.tan(t/2),c=1/(p-n);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+p)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*p*c,e[15]=0,e}module.exports=perspective;

},{}],253:[function(require,module,exports){
function rotate(t,a,r,e){var o,n,s,h,u,M,l,c,i,b,d,f,m,p,q,v,x,g,j,k,w,y,z,A,B=e[0],C=e[1],D=e[2],E=Math.sqrt(B*B+C*C+D*D);return Math.abs(E)<1e-6?null:(E=1/E,B*=E,C*=E,D*=E,o=Math.sin(r),n=Math.cos(r),s=1-n,h=a[0],u=a[1],M=a[2],l=a[3],c=a[4],i=a[5],b=a[6],d=a[7],f=a[8],m=a[9],p=a[10],q=a[11],v=B*B*s+n,x=C*B*s+D*o,g=D*B*s-C*o,j=B*C*s-D*o,k=C*C*s+n,w=D*C*s+B*o,y=B*D*s+C*o,z=C*D*s-B*o,A=D*D*s+n,t[0]=h*v+c*x+f*g,t[1]=u*v+i*x+m*g,t[2]=M*v+b*x+p*g,t[3]=l*v+d*x+q*g,t[4]=h*j+c*k+f*w,t[5]=u*j+i*k+m*w,t[6]=M*j+b*k+p*w,t[7]=l*j+d*k+q*w,t[8]=h*y+c*z+f*A,t[9]=u*y+i*z+m*A,t[10]=M*y+b*z+p*A,t[11]=l*y+d*z+q*A,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)}module.exports=rotate;

},{}],254:[function(require,module,exports){
function rotateX(t,o,r){var a=Math.sin(r),e=Math.cos(r),n=o[4],s=o[5],u=o[6],c=o[7],h=o[8],i=o[9],M=o[10],X=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=n*e+h*a,t[5]=s*e+i*a,t[6]=u*e+M*a,t[7]=c*e+X*a,t[8]=h*e-n*a,t[9]=i*e-s*a,t[10]=M*e-u*a,t[11]=X*e-c*a,t}module.exports=rotateX;

},{}],255:[function(require,module,exports){
function rotateY(t,o,r){var a=Math.sin(r),e=Math.cos(r),n=o[0],s=o[1],u=o[2],c=o[3],h=o[8],i=o[9],M=o[10],Y=o[11];return o!==t&&(t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=n*e-h*a,t[1]=s*e-i*a,t[2]=u*e-M*a,t[3]=c*e-Y*a,t[8]=n*a+h*e,t[9]=s*a+i*e,t[10]=u*a+M*e,t[11]=c*a+Y*e,t}module.exports=rotateY;

},{}],256:[function(require,module,exports){
function rotateZ(t,o,r){var a=Math.sin(r),e=Math.cos(r),n=o[0],s=o[1],u=o[2],c=o[3],h=o[4],i=o[5],M=o[6],Z=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=n*e+h*a,t[1]=s*e+i*a,t[2]=u*e+M*a,t[3]=c*e+Z*a,t[4]=h*e-n*a,t[5]=i*e-s*a,t[6]=M*e-u*a,t[7]=Z*e-c*a,t}module.exports=rotateZ;

},{}],257:[function(require,module,exports){
function scale(e,r,a){var c=a[0],l=a[1],n=a[2];return e[0]=r[0]*c,e[1]=r[1]*c,e[2]=r[2]*c,e[3]=r[3]*c,e[4]=r[4]*l,e[5]=r[5]*l,e[6]=r[6]*l,e[7]=r[7]*l,e[8]=r[8]*n,e[9]=r[9]*n,e[10]=r[10]*n,e[11]=r[11]*n,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}module.exports=scale;

},{}],258:[function(require,module,exports){
function translate(t,r,a){var e,n,l,o,s,u,c,d,f,i,m,p,v=a[0],x=a[1],b=a[2];return r===t?(t[12]=r[0]*v+r[4]*x+r[8]*b+r[12],t[13]=r[1]*v+r[5]*x+r[9]*b+r[13],t[14]=r[2]*v+r[6]*x+r[10]*b+r[14],t[15]=r[3]*v+r[7]*x+r[11]*b+r[15]):(e=r[0],n=r[1],l=r[2],o=r[3],s=r[4],u=r[5],c=r[6],d=r[7],f=r[8],i=r[9],m=r[10],p=r[11],t[0]=e,t[1]=n,t[2]=l,t[3]=o,t[4]=s,t[5]=u,t[6]=c,t[7]=d,t[8]=f,t[9]=i,t[10]=m,t[11]=p,t[12]=e*v+s*x+f*b+r[12],t[13]=n*v+u*x+i*b+r[13],t[14]=l*v+c*x+m*b+r[14],t[15]=o*v+d*x+p*b+r[15]),t}module.exports=translate;

},{}],259:[function(require,module,exports){
function transpose(e,r){if(e===r){var s=r[1],n=r[2],o=r[3],t=r[6],a=r[7],p=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=s,e[6]=r[9],e[7]=r[13],e[8]=n,e[9]=t,e[11]=r[14],e[12]=o,e[13]=a,e[14]=p}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}module.exports=transpose;

},{}],260:[function(require,module,exports){
"use strict";"use restrict";function countTrailingZeros(r){var n=32;return r&=-r,r&&n--,65535&r&&(n-=16),16711935&r&&(n-=8),252645135&r&&(n-=4),858993459&r&&(n-=2),1431655765&r&&(n-=1),n}var INT_BITS=32;exports.INT_BITS=INT_BITS,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<INT_BITS-1,exports.sign=function(r){return(r>0)-(0>r)},exports.abs=function(r){var n=r>>INT_BITS-1;return(r^n)-n},exports.min=function(r,n){return n^(r^n)&-(n>r)},exports.max=function(r,n){return r^(r^n)&-(n>r)},exports.isPow2=function(r){return!(r&r-1||!r)},exports.log2=function(r){var n,t;return n=(r>65535)<<4,r>>>=n,t=(r>255)<<3,r>>>=t,n|=t,t=(r>15)<<2,r>>>=t,n|=t,t=(r>3)<<1,r>>>=t,n|=t,n|r>>1},exports.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},exports.popCount=function(r){return r-=r>>>1&1431655765,r=(858993459&r)+(r>>>2&858993459),16843009*(r+(r>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1},exports.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r-(r>>>1)},exports.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,r&=15,27030>>>r&1};var REVERSE_TABLE=new Array(256);!function(r){for(var n=0;256>n;++n){var t=n,e=n,o=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--o;r[n]=e<<o&255}}(REVERSE_TABLE),exports.reverse=function(r){return REVERSE_TABLE[255&r]<<24|REVERSE_TABLE[r>>>8&255]<<16|REVERSE_TABLE[r>>>16&255]<<8|REVERSE_TABLE[r>>>24&255]},exports.interleave2=function(r,n){return r&=65535,r=16711935&(r|r<<8),r=252645135&(r|r<<4),r=858993459&(r|r<<2),r=1431655765&(r|r<<1),n&=65535,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),r|n<<1},exports.deinterleave2=function(r,n){return r=r>>>n&1431655765,r=858993459&(r|r>>>1),r=252645135&(r|r>>>2),r=16711935&(r|r>>>4),r=65535&(r|r>>>16),r<<16>>16},exports.interleave3=function(r,n,t){return r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),n&=1023,n=4278190335&(n|n<<16),n=251719695&(n|n<<8),n=3272356035&(n|n<<4),n=1227133513&(n|n<<2),r|=n<<1,t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),r|t<<2},exports.deinterleave3=function(r,n){return r=r>>>n&1227133513,r=3272356035&(r|r>>>2),r=251719695&(r|r>>>4),r=4278190335&(r|r>>>8),r=1023&(r|r>>>16),r<<22>>22},exports.nextCombination=function(r){var n=r|r-1;return n+1|(~n&-~n)-1>>>countTrailingZeros(r)+1};

},{}],261:[function(require,module,exports){
module.exports=require("cwise-compiler");

},{"cwise-compiler":262}],262:[function(require,module,exports){
"use strict";function Procedure(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function compileCwise(r){var e=new Procedure;e.pre=r.pre,e.body=r.body,e.post=r.post;var s=r.args.slice(0);e.argTypes=s;for(var o=0;o<s.length;++o){var a=s[o];if("array"===a||"object"==typeof a&&a.blockIndices){if(e.argTypes[o]="array",e.arrayArgs.push(o),e.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),e.shimArgs.push("array"+o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===a)e.scalarArgs.push(o),e.shimArgs.push("scalar"+o);else if("index"===a){if(e.indexArgs.push(o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===a){if(e.shapeArgs.push(o),o<e.pre.args.length&&e.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<e.post.args.length&&e.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof a||!a.offset)throw new Error("cwise: Unknown argument type "+s[o]);e.argTypes[o]="offset",e.offsetArgs.push({array:a.array,offset:a.offset}),e.offsetArgIndex.push(o)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>s.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>s.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>s.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!r.printCode||!!r.debug,e.funcName=r.funcName||"cwise",e.blockSize=r.blockSize||64,createThunk(e)}var createThunk=require("./lib/thunk.js");module.exports=compileCwise;

},{"./lib/thunk.js":264}],263:[function(require,module,exports){
"use strict";function innerFill(r,n,e){var s,a,o=r.length,i=n.arrayArgs.length,t=n.indexArgs.length>0,p=[],h=[],u=0,c=0;for(s=0;o>s;++s)h.push(["i",s,"=0"].join(""));for(a=0;i>a;++a)for(s=0;o>s;++s)c=u,u=r[s],0===s?h.push(["d",a,"s",s,"=t",a,"p",u].join("")):h.push(["d",a,"s",s,"=(t",a,"p",u,"-s",c,"*t",a,"p",c,")"].join(""));for(p.push("var "+h.join(",")),s=o-1;s>=0;--s)u=r[s],p.push(["for(i",s,"=0;i",s,"<s",u,";++i",s,"){"].join(""));for(p.push(e),s=0;o>s;++s){for(c=u,u=r[s],a=0;i>a;++a)p.push(["p",a,"+=d",a,"s",s].join(""));t&&(s>0&&p.push(["index[",c,"]-=s",c].join("")),p.push(["++index[",u,"]"].join(""))),p.push("}")}return p.join("\n")}function outerFill(r,n,e,s){for(var a=n.length,o=e.arrayArgs.length,i=e.blockSize,t=e.indexArgs.length>0,p=[],h=0;o>h;++h)p.push(["var offset",h,"=p",h].join(""));for(var h=r;a>h;++h)p.push(["for(var j"+h+"=SS[",n[h],"]|0;j",h,">0;){"].join("")),p.push(["if(j",h,"<",i,"){"].join("")),p.push(["s",n[h],"=j",h].join("")),p.push(["j",h,"=0"].join("")),p.push(["}else{s",n[h],"=",i].join("")),p.push(["j",h,"-=",i,"}"].join("")),t&&p.push(["index[",n[h],"]=j",h].join(""));for(var h=0;o>h;++h){for(var u=["offset"+h],c=r;a>c;++c)u.push(["j",c,"*t",h,"p",n[c]].join(""));p.push(["p",h,"=(",u.join("+"),")"].join(""))}p.push(innerFill(n,e,s));for(var h=r;a>h;++h)p.push("}");return p.join("\n")}function countMatches(r){for(var n=0,e=r[0].length;e>n;){for(var s=1;s<r.length;++s)if(r[s][n]!==r[0][n])return n;++n}return n}function processBlock(r,n,e){for(var s=r.body,a=[],o=[],i=0;i<r.args.length;++i){var t=r.args[i];if(!(t.count<=0)){var p=new RegExp(t.name,"g"),h="",u=n.arrayArgs.indexOf(i);switch(n.argTypes[i]){case"offset":var c=n.offsetArgIndex.indexOf(i),l=n.offsetArgs[c];u=l.array,h="+q"+c;case"array":h="p"+u+h;var f="l"+i,g="a"+u;if(0===n.arrayBlockIndices[u])1===t.count?"generic"===e[u]?t.lvalue?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),o.push([g,".set(",h,",",f,")"].join(""))):s=s.replace(p,[g,".get(",h,")"].join("")):s=s.replace(p,[g,"[",h,"]"].join("")):"generic"===e[u]?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,".set(",h,",",f,")"].join(""))):(a.push(["var ",f,"=",g,"[",h,"]"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,"[",h,"]=",f].join("")));else{for(var j=[t.name],v=[h],y=0;y<Math.abs(n.arrayBlockIndices[u]);y++)j.push("\\s*\\[([^\\]]+)\\]"),v.push("$"+(y+1)+"*t"+u+"b"+y);if(p=new RegExp(j.join(""),"g"),h=v.join("+"),"generic"===e[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");s=s.replace(p,[g,"[",h,"]"].join(""))}break;case"scalar":s=s.replace(p,"Y"+n.scalarArgs.indexOf(i));break;case"index":s=s.replace(p,"index");break;case"shape":s=s.replace(p,"shape")}}}return[a.join("\n"),s,o.join("\n")].join("\n").trim()}function typeSummary(r){for(var n=new Array(r.length),e=!0,s=0;s<r.length;++s){var a=r[s],o=a.match(/\d+/);o=o?o[0]:"",0===a.charAt(0)?n[s]="u"+a.charAt(1)+o:n[s]=a.charAt(0)+o,s>0&&(e=e&&n[s]===n[s-1])}return e?n[0]:n.join("")}function generateCWiseOp(r,n){for(var e=n[1].length-Math.abs(r.arrayBlockIndices[0])|0,s=new Array(r.arrayArgs.length),a=new Array(r.arrayArgs.length),o=0;o<r.arrayArgs.length;++o)a[o]=n[2*o],s[o]=n[2*o+1];for(var i=[],t=[],p=[],h=[],u=[],o=0;o<r.arrayArgs.length;++o){r.arrayBlockIndices[o]<0?(p.push(0),h.push(e),i.push(e),t.push(e+r.arrayBlockIndices[o])):(p.push(r.arrayBlockIndices[o]),h.push(r.arrayBlockIndices[o]+e),i.push(0),t.push(r.arrayBlockIndices[o]));for(var c=[],l=0;l<s[o].length;l++)p[o]<=s[o][l]&&s[o][l]<h[o]&&c.push(s[o][l]-p[o]);u.push(c)}for(var f=["SS"],g=["'use strict'"],j=[],l=0;e>l;++l)j.push(["s",l,"=SS[",l,"]"].join(""));for(var o=0;o<r.arrayArgs.length;++o){f.push("a"+o),f.push("t"+o),f.push("p"+o);for(var l=0;e>l;++l)j.push(["t",o,"p",l,"=t",o,"[",p[o]+l,"]"].join(""));for(var l=0;l<Math.abs(r.arrayBlockIndices[o]);++l)j.push(["t",o,"b",l,"=t",o,"[",i[o]+l,"]"].join(""))}for(var o=0;o<r.scalarArgs.length;++o)f.push("Y"+o);if(r.shapeArgs.length>0&&j.push("shape=SS.slice(0)"),r.indexArgs.length>0){for(var v=new Array(e),o=0;e>o;++o)v[o]="0";j.push(["index=[",v.join(","),"]"].join(""))}for(var o=0;o<r.offsetArgs.length;++o){for(var y=r.offsetArgs[o],d=[],l=0;l<y.offset.length;++l)0!==y.offset[l]&&(1===y.offset[l]?d.push(["t",y.array,"p",l].join("")):d.push([y.offset[l],"*t",y.array,"p",l].join("")));0===d.length?j.push("q"+o+"=0"):j.push(["q",o,"=",d.join("+")].join(""))}var A=uniq([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));j=j.concat(A),g.push("var "+j.join(","));for(var o=0;o<r.arrayArgs.length;++o)g.push("p"+o+"|=0");r.pre.body.length>3&&g.push(processBlock(r.pre,r,a));var k=processBlock(r.body,r,a),b=countMatches(u);e>b?g.push(outerFill(b,u[0],r,k)):g.push(innerFill(u[0],r,k)),r.post.body.length>3&&g.push(processBlock(r.post,r,a)),r.debug&&console.log("-----Generated cwise routine for ",n,":\n"+g.join("\n")+"\n----------");var x=[r.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",b,typeSummary(a)].join(""),w=new Function(["function ",x,"(",f.join(","),"){",g.join("\n"),"} return ",x].join(""));return w()}var uniq=require("uniq");module.exports=generateCWiseOp;

},{"uniq":265}],264:[function(require,module,exports){
"use strict";function createThunk(r){var a=["'use strict'","var CACHED={}"],e=[],s=r.funcName+"_cwise_thunk";a.push(["return function ",s,"(",r.shimArgs.join(","),"){"].join(""));for(var n=[],o=[],h=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],i=[],p=[],t=0;t<r.arrayArgs.length;++t){var c=r.arrayArgs[t];e.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),n.push("t"+c),n.push("r"+c),o.push("t"+c),o.push("r"+c+".join()"),h.push("array"+c+".data"),h.push("array"+c+".stride"),h.push("array"+c+".offset|0"),t>0&&(i.push("array"+r.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[t]))),p.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[t])+"]"))}r.arrayArgs.length>1&&(a.push("if (!("+i.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),a.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),a.push("if (!("+p.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),a.push("}"));for(var t=0;t<r.scalarArgs.length;++t)h.push("scalar"+r.scalarArgs[t]);e.push(["type=[",o.join(","),"].join()"].join("")),e.push("proc=CACHED[type]"),a.push("var "+e.join(",")),a.push(["if(!proc){","CACHED[type]=proc=compile([",n.join(","),"])}","return proc(",h.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+a.join("\n")+"\n----------");var u=new Function("compile",a.join("\n"));return u(compile.bind(void 0,r))}var compile=require("./compile.js");module.exports=createThunk;

},{"./compile.js":263}],265:[function(require,module,exports){
"use strict";function unique_pred(n,e){for(var u=1,t=n.length,i=n[0],r=n[0],o=1;t>o;++o)if(r=i,i=n[o],e(i,r)){if(o===u){u++;continue}n[u++]=i}return n.length=u,n}function unique_eq(n){for(var e=1,u=n.length,t=n[0],i=n[0],r=1;u>r;++r,i=t)if(i=t,t=n[r],t!==i){if(r===e){e++;continue}n[e++]=t}return n.length=e,n}function unique(n,e,u){return 0===n.length?n:e?(u||n.sort(e),unique_pred(n,e)):(u||n.sort(),unique_eq(n))}module.exports=unique;

},{}],266:[function(require,module,exports){
"use strict";function dupe_array(e,r,u){var n=0|e[u];if(0>=n)return[];var t,a=new Array(n);if(u===e.length-1)for(t=0;n>t;++t)a[t]=r;else for(t=0;n>t;++t)a[t]=dupe_array(e,r,u+1);return a}function dupe_number(e,r){var u,n;for(u=new Array(e),n=0;e>n;++n)u[n]=r;return u}function dupe(e,r){switch("undefined"==typeof r&&(r=0),typeof e){case"number":if(e>0)return dupe_number(0|e,r);break;case"object":if("number"==typeof e.length)return dupe_array(e,r,0)}return[]}module.exports=dupe;

},{}],267:[function(require,module,exports){
(function (global,Buffer){
"use strict";function freeArrayBuffer(r){if(r){var e=r.length||r.byteLength,t=bits.log2(e);DATA[t].push(r)}}function freeTypedArray(r){freeArrayBuffer(r.buffer)}function mallocArrayBuffer(r){var r=bits.nextPow2(r),e=bits.log2(r),t=DATA[e];return t.length>0?t.pop():new ArrayBuffer(r)}function mallocUint8(r){return new Uint8Array(mallocArrayBuffer(r),0,r)}function mallocUint16(r){return new Uint16Array(mallocArrayBuffer(2*r),0,r)}function mallocUint32(r){return new Uint32Array(mallocArrayBuffer(4*r),0,r)}function mallocInt8(r){return new Int8Array(mallocArrayBuffer(r),0,r)}function mallocInt16(r){return new Int16Array(mallocArrayBuffer(2*r),0,r)}function mallocInt32(r){return new Int32Array(mallocArrayBuffer(4*r),0,r)}function mallocFloat(r){return new Float32Array(mallocArrayBuffer(4*r),0,r)}function mallocDouble(r){return new Float64Array(mallocArrayBuffer(8*r),0,r)}function mallocUint8Clamped(r){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(r),0,r):mallocUint8(r)}function mallocDataView(r){return new DataView(mallocArrayBuffer(r),0,r)}function mallocBuffer(r){r=bits.nextPow2(r);var e=bits.log2(r),t=BUFFER[e];return t.length>0?t.pop():new Buffer(r)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(r){if(Buffer.isBuffer(r))BUFFER[bits.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var e=r.length||r.byteLength,t=0|bits.log2(e);DATA[t].push(r)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(r){BUFFER[bits.log2(r.length)].push(r)},exports.malloc=function(r,e){if(void 0===e||"arraybuffer"===e)return mallocArrayBuffer(r);switch(e){case"uint8":return mallocUint8(r);case"uint16":return mallocUint16(r);case"uint32":return mallocUint32(r);case"int8":return mallocInt8(r);case"int16":return mallocInt16(r);case"int32":return mallocInt32(r);case"float":case"float32":return mallocFloat(r);case"double":case"float64":return mallocDouble(r);case"uint8_clamped":return mallocUint8Clamped(r);case"buffer":return mallocBuffer(r);case"data":case"dataview":return mallocDataView(r);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var r=0;32>r;++r)POOL.UINT8[r].length=0,POOL.UINT16[r].length=0,POOL.UINT32[r].length=0,POOL.INT8[r].length=0,POOL.INT16[r].length=0,POOL.INT32[r].length=0,POOL.FLOAT[r].length=0,POOL.DOUBLE[r].length=0,POOL.UINT8C[r].length=0,DATA[r].length=0,BUFFER[r].length=0};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"bit-twiddle":260,"buffer":5,"dup":266}],268:[function(require,module,exports){
"use strict";function SelectResult(e,i,t,r,l){this.coord=[e,i],this.id=t,this.value=r,this.distance=l}function SelectBuffer(e,i,t){this.gl=e,this.fbo=i,this.buffer=t,this._readTimeout=null;var r=this;this._readCallback=function(){r.gl&&(i.bind(),e.readPixels(0,0,i.shape[0],i.shape[1],e.RGBA,e.UNSIGNED_BYTE,r.buffer),r._readTimeout=null)}}function createSelectBuffer(e,i){var t=createFBO(e,i),r=pool.mallocUint8(i[0]*i[1]*4);return new SelectBuffer(e,t,r)}module.exports=createSelectBuffer;var createFBO=require("gl-fbo"),pool=require("typedarray-pool"),ndarray=require("ndarray"),nextPow2=require("bit-twiddle").nextPow2,selectRange=require("cwise/lib/wrapper")({args:["array",{offset:[0,0,1],array:0},{offset:[0,0,2],array:0},{offset:[0,0,3],array:0},"scalar","scalar","index"],pre:{body:"{this_closestD2=1e8,this_closestX=-1,this_closestY=-1}",args:[],thisVars:["this_closestD2","this_closestX","this_closestY"],localVars:[]},body:{body:"{if(255>_inline_1_arg0_||255>_inline_1_arg1_||255>_inline_1_arg2_||255>_inline_1_arg3_){var _inline_1_l=_inline_1_arg4_-_inline_1_arg6_[0],_inline_1_a=_inline_1_arg5_-_inline_1_arg6_[1],_inline_1_f=_inline_1_l*_inline_1_l+_inline_1_a*_inline_1_a;_inline_1_f<this_closestD2&&(this_closestD2=_inline_1_f,this_closestX=_inline_1_arg6_[0],this_closestY=_inline_1_arg6_[1])}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg2_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg3_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg4_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg5_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg6_",lvalue:!1,rvalue:!0,count:4}],thisVars:["this_closestD2","this_closestX","this_closestY"],localVars:["_inline_1_a","_inline_1_f","_inline_1_l"]},post:{body:"{return[this_closestX,this_closestY,this_closestD2]}",args:[],thisVars:["this_closestD2","this_closestX","this_closestY"],localVars:[]},debug:!1,funcName:"cwise",blockSize:64}),proto=SelectBuffer.prototype;Object.defineProperty(proto,"shape",{get:function(){return this.gl?this.fbo.shape.slice():[0,0]},set:function(e){if(this.gl){this.fbo.shape=e;var i=this.fbo.shape[0],t=this.fbo.shape[1];if(t*i*4>this.buffer.length){pool.free(this.buffer);for(var r=this.buffer=pool.mallocUint8(nextPow2(t*i*4)),l=0;t*i*4>l;++l)r[l]=255}return e}}}),proto.begin=function(){var e=this.gl;this.shape;e&&(this.fbo.bind(),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT))},proto.end=function(){var e=this.gl;e&&(e.bindFramebuffer(e.FRAMEBUFFER,null),this._readTimeout||clearTimeout(this._readTimeout),this._readTimeout=setTimeout(this._readCallback,1))},proto.query=function(e,i,t){if(!this.gl)return null;var r=this.fbo.shape.slice();e=0|e,i=0|i,"number"!=typeof t&&(t=1);var l=0|Math.min(Math.max(e-t,0),r[0]),s=0|Math.min(Math.max(e+t,0),r[0]),a=0|Math.min(Math.max(i-t,0),r[1]),_=0|Math.min(Math.max(i+t,0),r[1]);if(l>=s||a>=_)return null;var n=[s-l,_-a],o=ndarray(this.buffer,[n[0],n[1],4],[4,4*r[0],1],4*(l+r[0]*a)),u=selectRange(o.hi(n[0],n[1],1),t,t),h=u[0],c=u[1];if(0>h||Math.pow(this.radius,2)<u[2])return null;var f=o.get(h,c,0),g=o.get(h,c,1),d=o.get(h,c,2),p=o.get(h,c,3);return new SelectResult(h+l|0,c+a|0,f,[g,d,p],Math.sqrt(u[2]))},proto.dispose=function(){this.gl&&(this.fbo.dispose(),pool.free(this.buffer),this.gl=null,this._readTimeout&&clearTimeout(this._readTimeout))};

},{"bit-twiddle":260,"cwise/lib/wrapper":261,"gl-fbo":233,"ndarray":296,"typedarray-pool":267}],269:[function(require,module,exports){
"use strict";function Shader(r){this.gl=r,this._vref=this._fref=this._relink=this.vertShader=this.fragShader=this.program=this.attributes=this.uniforms=this.types=null}function compareAttributes(r,e){return r.name<e.name?-1:1}function createShader(r,e,t,a,i){var o=new Shader(r);return o.update(e,t,a,i),o}var createUniformWrapper=require("./lib/create-uniforms"),createAttributeWrapper=require("./lib/create-attributes"),makeReflect=require("./lib/reflect"),shaderCache=require("./lib/shader-cache"),runtime=require("./lib/runtime-reflect"),proto=Shader.prototype;proto.bind=function(){this.program||this._relink(),this.gl.useProgram(this.program)},proto.dispose=function(){this._fref&&this._fref.dispose(),this._vref&&this._vref.dispose(),this.attributes=this.types=this.vertShader=this.fragShader=this.program=this._relink=this._fref=this._vref=null},proto.update=function(r,e,t,a){function i(){s.program=shaderCache.program(n,s._vref,s._fref,m,c);for(var r=0;r<t.length;++r)S[r]=n.getUniformLocation(s.program,t[r].name)}if(!e||1===arguments.length){var o=r;r=o.vertex,e=o.fragment,t=o.uniforms,a=o.attributes}var s=this,n=s.gl,h=s._vref;s._vref=shaderCache.shader(n,n.VERTEX_SHADER,r),h&&h.dispose(),s.vertShader=s._vref.shader;var f=this._fref;if(s._fref=shaderCache.shader(n,n.FRAGMENT_SHADER,e),f&&f.dispose(),s.fragShader=s._fref.shader,!t||!a){var p=n.createProgram();if(n.attachShader(p,s.fragShader),n.attachShader(p,s.vertShader),n.linkProgram(p),!n.getProgramParameter(p,n.LINK_STATUS)){var u=n.getProgramInfoLog(p);throw console.error("gl-shader: Error linking program:",u),new Error("gl-shader: Error linking program:"+u)}t=t||runtime.uniforms(n,p),a=a||runtime.attributes(n,p),n.deleteProgram(p)}a=a.slice(),a.sort(compareAttributes);for(var l=[],m=[],c=[],g=0;g<a.length;++g){var d=a[g];if(d.type.indexOf("mat")>=0){for(var v=0|d.type.charAt(d.type.length-1),_=new Array(v),b=0;v>b;++b)_[b]=c.length,m.push(d.name+"["+b+"]"),"number"==typeof d.location?c.push(d.location+b):Array.isArray(d.location)&&d.location.length===v&&"number"==typeof d.location[b]?c.push(0|d.location[b]):c.push(-1);l.push({name:d.name,type:d.type,locations:_})}else l.push({name:d.name,type:d.type,locations:[c.length]}),m.push(d.name),"number"==typeof d.location?c.push(0|d.location):c.push(-1)}for(var y=0,g=0;g<c.length;++g)if(c[g]<0){for(;c.indexOf(y)>=0;)y+=1;c[g]=y}var S=new Array(t.length);i(),s._relink=i,s.types={uniforms:makeReflect(t),attributes:makeReflect(a)},s.attributes=createAttributeWrapper(n,s,l,c),Object.defineProperty(s,"uniforms",createUniformWrapper(n,s,t,S))},module.exports=createShader;

},{"./lib/create-attributes":270,"./lib/create-uniforms":271,"./lib/reflect":272,"./lib/runtime-reflect":273,"./lib/shader-cache":274}],270:[function(require,module,exports){
"use strict";function ShaderAttribute(t,r,e,i,n,a){this._gl=t,this._wrapper=r,this._index=e,this._locations=i,this._dimension=n,this._constFunc=a}function addVectorAttribute(t,r,e,i,n,a,o){for(var u=["gl","v"],s=[],c=0;n>c;++c)u.push("x"+c),s.push("x"+c);u.push("if(x0.length===void 0){return gl.vertexAttrib"+n+"f(v,"+s.join()+")}else{return gl.vertexAttrib"+n+"fv(v,x0)}");var l=Function.apply(null,u),f=new ShaderAttribute(t,r,e,i,n,l);Object.defineProperty(a,o,{set:function(r){return t.disableVertexAttribArray(i[e]),l(t,i[e],r),r},get:function(){return f},enumerable:!0})}function addMatrixAttribute(t,r,e,i,n,a,o){for(var u=new Array(n),s=new Array(n),c=0;n>c;++c)addVectorAttribute(t,r,e[c],i,n,u,c),s[c]=u[c];Object.defineProperty(u,"location",{set:function(t){if(Array.isArray)for(var r=0;n>r;++r)s[r].location=t[r];else for(var r=0;n>r;++r)result[r]=s[r].location=t+r;return t},get:function(){for(var t=new Array(n),r=0;n>r;++r)t[r]=i[e[r]];return t},enumerable:!0}),u.pointer=function(r,a,o,u){r=r||t.FLOAT,a=!!a,o=o||n*n,u=u||0;for(var s=0;n>s;++s){var c=i[e[s]];t.vertexAttribPointer(c,n,r,a,o,u+s*n),t.enableVertexAttribArray(c)}};var l=new Array(n),f=t["vertexAttrib"+n+"fv"];Object.defineProperty(a,o,{set:function(r){for(var a=0;n>a;++a){var o=i[e[a]];if(t.disableVertexAttribArray(o),Array.isArray(r[0]))f.call(t,o,r[a]);else{for(var u=0;n>u;++u)l[u]=r[n*a+u];f.call(t,o,l)}}return r},get:function(){return u},enumerable:!0})}function createAttributeWrapper(t,r,e,i){for(var n={},a=0,o=e.length;o>a;++a){var u=e[a],s=u.name,c=u.type,l=u.locations;switch(c){case"bool":case"int":case"float":addVectorAttribute(t,r,l[0],i,1,n,s);break;default:if(c.indexOf("vec")>=0){var f=c.charCodeAt(c.length-1)-48;if(2>f||f>4)throw new Error("gl-shader: Invalid data type for attribute "+s+": "+c);addVectorAttribute(t,r,l[0],i,f,n,s)}else{if(!(c.indexOf("mat")>=0))throw new Error("gl-shader: Unknown data type for attribute "+s+": "+c);var f=c.charCodeAt(c.length-1)-48;if(2>f||f>4)throw new Error("gl-shader: Invalid data type for attribute "+s+": "+c);addMatrixAttribute(t,r,l,i,f,n,s)}}}return n}module.exports=createAttributeWrapper;var proto=ShaderAttribute.prototype;proto.pointer=function(t,r,e,i){var n=this,a=n._gl,o=n._locations[n._index];a.vertexAttribPointer(o,n._dimension,t||a.FLOAT,!!r,e||0,i||0),a.enableVertexAttribArray(o)},proto.set=function(t,r,e,i){return this._constFunc(this._locations[this._index],t,r,e,i)},Object.defineProperty(proto,"location",{get:function(){return this._locations[this._index]},set:function(t){return t!==this._locations[this._index]&&(this._locations[this._index]=0|t,this._wrapper.program=null),0|t}});

},{}],271:[function(require,module,exports){
"use strict";function identity(r){var e=new Function("y","return function(){return y}");return e(r)}function makeVector(r,e){for(var n=new Array(r),t=0;r>t;++t)n[t]=e;return n}function createUniformWrapper(r,e,n,t){function a(n){var a=new Function("gl","wrapper","locations","return function(){return gl.getUniform(wrapper.program,locations["+n+"])}");return a(r,e,t)}function o(r,e,n){switch(n){case"bool":case"int":case"sampler2D":case"samplerCube":return"gl.uniform1i(locations["+e+"],obj"+r+")";case"float":return"gl.uniform1f(locations["+e+"],obj"+r+")";default:var t=n.indexOf("vec");if(!(t>=0&&1>=t&&n.length===4+t)){if(0===n.indexOf("mat")&&4===n.length){var a=n.charCodeAt(n.length-1)-48;if(2>a||a>4)throw new Error("gl-shader: Invalid uniform dimension type for matrix "+name+": "+n);return"gl.uniformMatrix"+a+"fv(locations["+e+"],false,obj"+r+")"}throw new Error("gl-shader: Unknown uniform data type for "+name+": "+n)}var a=n.charCodeAt(n.length-1)-48;if(2>a||a>4)throw new Error("gl-shader: Invalid data type");switch(n.charAt(0)){case"b":case"i":return"gl.uniform"+a+"iv(locations["+e+"],obj"+r+")";case"v":return"gl.uniform"+a+"fv(locations["+e+"],obj"+r+")";default:throw new Error("gl-shader: Unrecognized data type for vector "+name+": "+n)}}}function i(r,e){if("object"!=typeof e)return[[r,e]];var n=[];for(var t in e){var a=e[t],o=r;o+=parseInt(t)+""===t?"["+t+"]":"."+t,"object"==typeof a?n.push.apply(n,i(o,a)):n.push([o,a])}return n}function c(e){for(var a=["return function updateProperty(obj){"],c=i("",e),f=0;f<c.length;++f){var u=c[f],l=u[0],s=u[1];t[s]&&a.push(o(l,s,n[s].type))}a.push("return obj}");var h=new Function("gl","locations",a.join("\n"));return h(r,t)}function f(r){switch(r){case"bool":return!1;case"int":case"sampler2D":case"samplerCube":return 0;case"float":return 0;default:var e=r.indexOf("vec");if(e>=0&&1>=e&&r.length===4+e){var n=r.charCodeAt(r.length-1)-48;if(2>n||n>4)throw new Error("gl-shader: Invalid data type");return"b"===r.charAt(0)?makeVector(n,!1):makeVector(n,0)}if(0===r.indexOf("mat")&&4===r.length){var n=r.charCodeAt(r.length-1)-48;if(2>n||n>4)throw new Error("gl-shader: Invalid uniform dimension type for matrix "+name+": "+r);return makeVector(n*n,0)}throw new Error("gl-shader: Unknown uniform data type for "+name+": "+r)}}function u(r,e,o){if("object"==typeof o){var i=l(o);Object.defineProperty(r,e,{get:identity(i),set:c(o),enumerable:!0,configurable:!1})}else t[o]?Object.defineProperty(r,e,{get:a(o),set:c(o),enumerable:!0,configurable:!1}):r[e]=f(n[o].type)}function l(r){var e;if(Array.isArray(r)){e=new Array(r.length);for(var n=0;n<r.length;++n)u(e,n,r[n])}else{e={};for(var t in r)u(e,t,r[t])}return e}var s=coallesceUniforms(n,!0);return{get:identity(l(s)),set:c(s),enumerable:!0,configurable:!0}}var coallesceUniforms=require("./reflect");module.exports=createUniformWrapper;

},{"./reflect":272}],272:[function(require,module,exports){
"use strict";function makeReflectTypes(e,t){for(var n={},l=0;l<e.length;++l)for(var r=e[l].name,a=r.split("."),s=n,g=0;g<a.length;++g){var h=a[g].split("[");if(h.length>1){h[0]in s||(s[h[0]]=[]),s=s[h[0]];for(var i=1;i<h.length;++i){var p=parseInt(h[i]);i<h.length-1||g<a.length-1?(p in s||(i<h.length-1?s[p]=[]:s[p]={}),s=s[p]):t?s[p]=l:s[p]=e[l].type}}else g<a.length-1?(h[0]in s||(s[h[0]]={}),s=s[h[0]]):t?s[h[0]]=l:s[h[0]]=e[l].type}return n}module.exports=makeReflectTypes;

},{}],273:[function(require,module,exports){
"use strict";function getType(e,t){if(!GL_TABLE){var r=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var T=0;T<r.length;++T){var L=r[T];GL_TABLE[e[L]]=GL_TO_GLSL_TYPES[L]}}return GL_TABLE[t]}function runtimeUniforms(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),T=[],L=0;r>L;++L){var a=e.getActiveUniform(t,L);if(a){var _=getType(e,a.type);if(a.size>1)for(var i=0;i<a.size;++i)T.push({name:a.name.replace("[0]","["+i+"]"),type:_});else T.push({name:a.name,type:_})}}return T}function runtimeAttributes(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),T=[],L=0;r>L;++L){var a=e.getActiveAttrib(t,L);a&&T.push({name:a.name,type:getType(e,a.type)})}return T}exports.uniforms=runtimeUniforms,exports.attributes=runtimeAttributes;var GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"},GL_TABLE=null;

},{}],274:[function(require,module,exports){
"use strict";function ShaderReference(r,e,a,t,o,h,s){this.id=r,this.src=e,this.type=a,this.shader=t,this.count=h,this.programs=[],this.cache=s}function ContextCache(r){this.gl=r,this.shaders=[{},{}],this.programs={}}function compileShader(r,e,a){var t=r.createShader(e);if(r.shaderSource(t,a),r.compileShader(t),!r.getShaderParameter(t,r.COMPILE_STATUS)){var o=r.getShaderInfoLog(t);throw console.error("gl-shader: Error compiling shader:",o),new Error("gl-shader: Error compiling shader:"+o)}return t}function linkProgram(r,e,a,t,o){var h=r.createProgram();r.attachShader(h,e),r.attachShader(h,a);for(var s=0;s<t.length;++s)r.bindAttribLocation(h,o[s],t[s]);if(r.linkProgram(h),!r.getProgramParameter(h,r.LINK_STATUS)){var i=r.getProgramInfoLog(h);throw console.error("gl-shader: Error linking program:",i),new Error("gl-shader: Error linking program:"+i)}return h}function getCache(r){var e=CACHE.get(r);return e||(e=new ContextCache(r),CACHE.set(r,e)),e}function getShaderReference(r,e,a){return getCache(r).getShaderReference(e,a)}function createProgram(r,e,a,t,o){return getCache(r).getProgram(e,a,t,o)}exports.shader=getShaderReference,exports.program=createProgram;var weakMap="undefined"==typeof WeakMap?require("weakmap-shim"):WeakMap,CACHE=new weakMap,SHADER_COUNTER=0;ShaderReference.prototype.dispose=function(){if(0===--this.count){for(var r=this.cache,e=r.gl,a=this.programs,t=0,o=a.length;o>t;++t){var h=r.programs[a[t]];h&&(delete r.programs[t],e.deleteProgram(h))}e.deleteShader(this.shader),delete r.shaders[this.type===e.FRAGMENT_SHADER|0][this.src]}};var proto=ContextCache.prototype;proto.getShaderReference=function(r,e){var a=this.gl,t=this.shaders[r===a.FRAGMENT_SHADER|0],o=t[e];if(o&&a.isShader(o.shader))o.count+=1;else{var h=compileShader(a,r,e);o=t[e]=new ShaderReference(SHADER_COUNTER++,e,r,h,[],1,this)}return o},proto.getProgram=function(r,e,a,t){var o=[r.id,e.id,a.join(":"),t.join(":")].join("@"),h=this.programs[o];return h&&this.gl.isProgram(h)||(this.programs[o]=h=linkProgram(this.gl,r.shader,e.shader,a,t),r.programs.push(o),e.programs.push(o)),h};

},{"weakmap-shim":277}],275:[function(require,module,exports){
function createStore(){var e={};return function(r){if(("object"!=typeof r||null===r)&&"function"!=typeof r)throw new Error("Weakmap-shim: Key must be object");var t=r.valueOf(e);return t&&t.identity===e?t:hiddenStore(r,e)}}var hiddenStore=require("./hidden-store.js");module.exports=createStore;

},{"./hidden-store.js":276}],276:[function(require,module,exports){
function hiddenStore(e,t){var r={identity:t},n=e.valueOf;return Object.defineProperty(e,"valueOf",{value:function(e){return e!==t?n.apply(this,arguments):r},writable:!0}),r}module.exports=hiddenStore;

},{}],277:[function(require,module,exports){
function weakMap(){var e=createStore();return{get:function(r,t){var a=e(r);return a.hasOwnProperty("value")?a.value:t},set:function(r,t){e(r).value=t},has:function(r){return"value"in e(r)},"delete":function(r){return delete e(r).value}}}var createStore=require("./create-store.js");module.exports=weakMap;

},{"./create-store.js":275}],278:[function(require,module,exports){
"use strict";function GLBuffer(e,t,r,i,s){this.gl=e,this.type=t,this.handle=r,this.length=i,this.usage=s}function updateTypeArray(e,t,r,i,s,a){var n=s.length*s.BYTES_PER_ELEMENT;if(0>a)return e.bufferData(t,s,i),n;if(n+a>r)throw new Error("gl-buffer: If resizing buffer, must not specify offset");return e.bufferSubData(t,a,s),r}function makeScratchTypeArray(e,t){for(var r=pool.malloc(e.length,t),i=e.length,s=0;i>s;++s)r[s]=e[s];return r}function isPacked(e,t){for(var r=1,i=t.length-1;i>=0;--i){if(t[i]!==r)return!1;r*=e[i]}return!0}function createBuffer(e,t,r,i){if(r=r||e.ARRAY_BUFFER,i=i||e.DYNAMIC_DRAW,r!==e.ARRAY_BUFFER&&r!==e.ELEMENT_ARRAY_BUFFER)throw new Error("gl-buffer: Invalid type for webgl buffer, must be either gl.ARRAY_BUFFER or gl.ELEMENT_ARRAY_BUFFER");if(i!==e.DYNAMIC_DRAW&&i!==e.STATIC_DRAW&&i!==e.STREAM_DRAW)throw new Error("gl-buffer: Invalid usage for buffer, must be either gl.DYNAMIC_DRAW, gl.STATIC_DRAW or gl.STREAM_DRAW");var s=e.createBuffer(),a=new GLBuffer(e,r,s,0,i);return a.update(t),a}var pool=require("typedarray-pool"),ops=require("ndarray-ops"),ndarray=require("ndarray"),SUPPORTED_TYPES=["uint8","uint8_clamped","uint16","uint32","int8","int16","int32","float32"],proto=GLBuffer.prototype;proto.bind=function(){this.gl.bindBuffer(this.type,this.handle)},proto.unbind=function(){this.gl.bindBuffer(this.type,null)},proto.dispose=function(){this.gl.deleteBuffer(this.handle)},proto.update=function(e,t){if("number"!=typeof t&&(t=-1),this.bind(),"object"==typeof e&&"undefined"!=typeof e.shape){var r=e.dtype;if(SUPPORTED_TYPES.indexOf(r)<0&&(r="float32"),this.type===this.gl.ELEMENT_ARRAY_BUFFER){var i=gl.getExtension("OES_element_index_uint");r=i&&"uint16"!==r?"uint32":"uint16"}if(r===e.dtype&&isPacked(e.shape,e.stride))0===e.offset&&e.data.length===e.shape[0]?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e.data,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e.data.subarray(e.offset,e.shape[0]),t);else{var s=pool.malloc(e.size,r),a=ndarray(s,e.shape);ops.assign(a,e),0>t?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,s,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,s.subarray(0,e.size),t),pool.free(s)}}else if(Array.isArray(e)){var n;n=this.type===this.gl.ELEMENT_ARRAY_BUFFER?makeScratchTypeArray(e,"uint16"):makeScratchTypeArray(e,"float32"),0>t?this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,n,t):this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,n.subarray(0,e.length),t),pool.free(n)}else if("object"==typeof e&&"number"==typeof e.length)this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,e,t);else{if("number"!=typeof e&&void 0!==e)throw new Error("gl-buffer: Invalid data type");if(t>=0)throw new Error("gl-buffer: Cannot specify offset when resizing buffer");e=0|e,0>=e&&(e=1),this.gl.bufferData(this.type,0|e,this.usage),this.length=e}},module.exports=createBuffer;

},{"ndarray":296,"ndarray-ops":279,"typedarray-pool":286}],279:[function(require,module,exports){
"use strict";function fixup(a){if(!a)return EmptyProc;for(var r=0;r<a.args.length;++r){var s=a.args[r];0===r?a.args[r]={name:s,lvalue:!0,rvalue:!!a.rvalue,count:a.count||1}:a.args[r]={name:s,lvalue:!1,rvalue:!0,count:1}}return a.thisVars||(a.thisVars=[]),a.localVars||(a.localVars=[]),a}function pcompile(a){return compile({args:a.args,pre:fixup(a.pre),body:fixup(a.body),post:fixup(a.proc),funcName:a.funcName})}function makeOp(a){for(var r=[],s=0;s<a.args.length;++s)r.push("a"+s);var i=new Function("P",["return function ",a.funcName,"_ndarrayops(",r.join(","),") {P(",r.join(","),");return a0}"].join(""));return i(pcompile(a))}var compile=require("cwise-compiler"),EmptyProc={body:"",args:[],thisVars:[],localVars:[]},assign_ops={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var a in assign_ops){var r=assign_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:a+"eq"}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:a+"seq"})}}();var unary_ops={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var a in unary_ops){var r=unary_ops[a];exports[a]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:a}),exports[a+"eq"]=makeOp({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:a+"eq"})}}();var binary_ops={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var a in binary_ops){var r=binary_ops[a];exports[a]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:a}),exports[a+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:a+"s"}),exports[a+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:a+"eq"}),exports[a+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:a+"seq"})}}();var math_unary=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var a=0;a<math_unary.length;++a){var r=math_unary[a];exports[r]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),exports[r+"eq"]=makeOp({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var math_comm=["max","min","atan2","pow"];!function(){for(var a=0;a<math_comm.length;++a){var r=math_comm[a];exports[r]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),exports[r+"s"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),exports[r+"eq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),exports[r+"seq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var math_noncomm=["atan2","pow"];!function(){for(var a=0;a<math_noncomm.length;++a){var r=math_noncomm[a];exports[r+"op"]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),exports[r+"ops"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),exports[r+"opeq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),exports[r+"opseq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),exports.any=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),exports.all=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),exports.sum=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),exports.prod=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),exports.norm2squared=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),exports.norm2=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),exports.norminf=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),exports.norm1=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),exports.sup=compile({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.inf=compile({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),exports.argmin=compile({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.argmax=compile({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),exports.random=makeOp({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),exports.assign=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),exports.assigns=makeOp({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),exports.equals=compile({args:["array","array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"});

},{"cwise-compiler":280}],280:[function(require,module,exports){
"use strict";function Procedure(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function compileCwise(r){var e=new Procedure;e.pre=r.pre,e.body=r.body,e.post=r.post;var s=r.args.slice(0);e.argTypes=s;for(var o=0;o<s.length;++o){var a=s[o];if("array"===a||"object"==typeof a&&a.blockIndices){if(e.argTypes[o]="array",e.arrayArgs.push(o),e.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),e.shimArgs.push("array"+o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===a)e.scalarArgs.push(o),e.shimArgs.push("scalar"+o);else if("index"===a){if(e.indexArgs.push(o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===a){if(e.shapeArgs.push(o),o<e.pre.args.length&&e.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<e.post.args.length&&e.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof a||!a.offset)throw new Error("cwise: Unknown argument type "+s[o]);e.argTypes[o]="offset",e.offsetArgs.push({array:a.array,offset:a.offset}),e.offsetArgIndex.push(o)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>s.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>s.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>s.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!r.printCode||!!r.debug,e.funcName=r.funcName||"cwise",e.blockSize=r.blockSize||64,createThunk(e)}var createThunk=require("./lib/thunk.js");module.exports=compileCwise;

},{"./lib/thunk.js":282}],281:[function(require,module,exports){
"use strict";function innerFill(r,n,e){var s,a,o=r.length,i=n.arrayArgs.length,t=n.indexArgs.length>0,p=[],h=[],u=0,c=0;for(s=0;o>s;++s)h.push(["i",s,"=0"].join(""));for(a=0;i>a;++a)for(s=0;o>s;++s)c=u,u=r[s],0===s?h.push(["d",a,"s",s,"=t",a,"p",u].join("")):h.push(["d",a,"s",s,"=(t",a,"p",u,"-s",c,"*t",a,"p",c,")"].join(""));for(p.push("var "+h.join(",")),s=o-1;s>=0;--s)u=r[s],p.push(["for(i",s,"=0;i",s,"<s",u,";++i",s,"){"].join(""));for(p.push(e),s=0;o>s;++s){for(c=u,u=r[s],a=0;i>a;++a)p.push(["p",a,"+=d",a,"s",s].join(""));t&&(s>0&&p.push(["index[",c,"]-=s",c].join("")),p.push(["++index[",u,"]"].join(""))),p.push("}")}return p.join("\n")}function outerFill(r,n,e,s){for(var a=n.length,o=e.arrayArgs.length,i=e.blockSize,t=e.indexArgs.length>0,p=[],h=0;o>h;++h)p.push(["var offset",h,"=p",h].join(""));for(var h=r;a>h;++h)p.push(["for(var j"+h+"=SS[",n[h],"]|0;j",h,">0;){"].join("")),p.push(["if(j",h,"<",i,"){"].join("")),p.push(["s",n[h],"=j",h].join("")),p.push(["j",h,"=0"].join("")),p.push(["}else{s",n[h],"=",i].join("")),p.push(["j",h,"-=",i,"}"].join("")),t&&p.push(["index[",n[h],"]=j",h].join(""));for(var h=0;o>h;++h){for(var u=["offset"+h],c=r;a>c;++c)u.push(["j",c,"*t",h,"p",n[c]].join(""));p.push(["p",h,"=(",u.join("+"),")"].join(""))}p.push(innerFill(n,e,s));for(var h=r;a>h;++h)p.push("}");return p.join("\n")}function countMatches(r){for(var n=0,e=r[0].length;e>n;){for(var s=1;s<r.length;++s)if(r[s][n]!==r[0][n])return n;++n}return n}function processBlock(r,n,e){for(var s=r.body,a=[],o=[],i=0;i<r.args.length;++i){var t=r.args[i];if(!(t.count<=0)){var p=new RegExp(t.name,"g"),h="",u=n.arrayArgs.indexOf(i);switch(n.argTypes[i]){case"offset":var c=n.offsetArgIndex.indexOf(i),l=n.offsetArgs[c];u=l.array,h="+q"+c;case"array":h="p"+u+h;var f="l"+i,g="a"+u;if(0===n.arrayBlockIndices[u])1===t.count?"generic"===e[u]?t.lvalue?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),o.push([g,".set(",h,",",f,")"].join(""))):s=s.replace(p,[g,".get(",h,")"].join("")):s=s.replace(p,[g,"[",h,"]"].join("")):"generic"===e[u]?(a.push(["var ",f,"=",g,".get(",h,")"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,".set(",h,",",f,")"].join(""))):(a.push(["var ",f,"=",g,"[",h,"]"].join("")),s=s.replace(p,f),t.lvalue&&o.push([g,"[",h,"]=",f].join("")));else{for(var j=[t.name],v=[h],y=0;y<Math.abs(n.arrayBlockIndices[u]);y++)j.push("\\s*\\[([^\\]]+)\\]"),v.push("$"+(y+1)+"*t"+u+"b"+y);if(p=new RegExp(j.join(""),"g"),h=v.join("+"),"generic"===e[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");s=s.replace(p,[g,"[",h,"]"].join(""))}break;case"scalar":s=s.replace(p,"Y"+n.scalarArgs.indexOf(i));break;case"index":s=s.replace(p,"index");break;case"shape":s=s.replace(p,"shape")}}}return[a.join("\n"),s,o.join("\n")].join("\n").trim()}function typeSummary(r){for(var n=new Array(r.length),e=!0,s=0;s<r.length;++s){var a=r[s],o=a.match(/\d+/);o=o?o[0]:"",0===a.charAt(0)?n[s]="u"+a.charAt(1)+o:n[s]=a.charAt(0)+o,s>0&&(e=e&&n[s]===n[s-1])}return e?n[0]:n.join("")}function generateCWiseOp(r,n){for(var e=n[1].length-Math.abs(r.arrayBlockIndices[0])|0,s=new Array(r.arrayArgs.length),a=new Array(r.arrayArgs.length),o=0;o<r.arrayArgs.length;++o)a[o]=n[2*o],s[o]=n[2*o+1];for(var i=[],t=[],p=[],h=[],u=[],o=0;o<r.arrayArgs.length;++o){r.arrayBlockIndices[o]<0?(p.push(0),h.push(e),i.push(e),t.push(e+r.arrayBlockIndices[o])):(p.push(r.arrayBlockIndices[o]),h.push(r.arrayBlockIndices[o]+e),i.push(0),t.push(r.arrayBlockIndices[o]));for(var c=[],l=0;l<s[o].length;l++)p[o]<=s[o][l]&&s[o][l]<h[o]&&c.push(s[o][l]-p[o]);u.push(c)}for(var f=["SS"],g=["'use strict'"],j=[],l=0;e>l;++l)j.push(["s",l,"=SS[",l,"]"].join(""));for(var o=0;o<r.arrayArgs.length;++o){f.push("a"+o),f.push("t"+o),f.push("p"+o);for(var l=0;e>l;++l)j.push(["t",o,"p",l,"=t",o,"[",p[o]+l,"]"].join(""));for(var l=0;l<Math.abs(r.arrayBlockIndices[o]);++l)j.push(["t",o,"b",l,"=t",o,"[",i[o]+l,"]"].join(""))}for(var o=0;o<r.scalarArgs.length;++o)f.push("Y"+o);if(r.shapeArgs.length>0&&j.push("shape=SS.slice(0)"),r.indexArgs.length>0){for(var v=new Array(e),o=0;e>o;++o)v[o]="0";j.push(["index=[",v.join(","),"]"].join(""))}for(var o=0;o<r.offsetArgs.length;++o){for(var y=r.offsetArgs[o],d=[],l=0;l<y.offset.length;++l)0!==y.offset[l]&&(1===y.offset[l]?d.push(["t",y.array,"p",l].join("")):d.push([y.offset[l],"*t",y.array,"p",l].join("")));0===d.length?j.push("q"+o+"=0"):j.push(["q",o,"=",d.join("+")].join(""))}var A=uniq([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));j=j.concat(A),g.push("var "+j.join(","));for(var o=0;o<r.arrayArgs.length;++o)g.push("p"+o+"|=0");r.pre.body.length>3&&g.push(processBlock(r.pre,r,a));var k=processBlock(r.body,r,a),b=countMatches(u);e>b?g.push(outerFill(b,u[0],r,k)):g.push(innerFill(u[0],r,k)),r.post.body.length>3&&g.push(processBlock(r.post,r,a)),r.debug&&console.log("-----Generated cwise routine for ",n,":\n"+g.join("\n")+"\n----------");var x=[r.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",b,typeSummary(a)].join(""),w=new Function(["function ",x,"(",f.join(","),"){",g.join("\n"),"} return ",x].join(""));return w()}var uniq=require("uniq");module.exports=generateCWiseOp;

},{"uniq":283}],282:[function(require,module,exports){
"use strict";function createThunk(r){var a=["'use strict'","var CACHED={}"],e=[],s=r.funcName+"_cwise_thunk";a.push(["return function ",s,"(",r.shimArgs.join(","),"){"].join(""));for(var n=[],o=[],h=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],i=[],p=[],t=0;t<r.arrayArgs.length;++t){var c=r.arrayArgs[t];e.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),n.push("t"+c),n.push("r"+c),o.push("t"+c),o.push("r"+c+".join()"),h.push("array"+c+".data"),h.push("array"+c+".stride"),h.push("array"+c+".offset|0"),t>0&&(i.push("array"+r.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[t]))),p.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[t])+"]"))}r.arrayArgs.length>1&&(a.push("if (!("+i.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),a.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),a.push("if (!("+p.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),a.push("}"));for(var t=0;t<r.scalarArgs.length;++t)h.push("scalar"+r.scalarArgs[t]);e.push(["type=[",o.join(","),"].join()"].join("")),e.push("proc=CACHED[type]"),a.push("var "+e.join(",")),a.push(["if(!proc){","CACHED[type]=proc=compile([",n.join(","),"])}","return proc(",h.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+a.join("\n")+"\n----------");var u=new Function("compile",a.join("\n"));return u(compile.bind(void 0,r))}var compile=require("./compile.js");module.exports=createThunk;

},{"./compile.js":281}],283:[function(require,module,exports){
"use strict";function unique_pred(n,e){for(var u=1,t=n.length,i=n[0],r=n[0],o=1;t>o;++o)if(r=i,i=n[o],e(i,r)){if(o===u){u++;continue}n[u++]=i}return n.length=u,n}function unique_eq(n){for(var e=1,u=n.length,t=n[0],i=n[0],r=1;u>r;++r,i=t)if(i=t,t=n[r],t!==i){if(r===e){e++;continue}n[e++]=t}return n.length=e,n}function unique(n,e,u){return 0===n.length?n:e?(u||n.sort(e),unique_pred(n,e)):(u||n.sort(),unique_eq(n))}module.exports=unique;

},{}],284:[function(require,module,exports){
"use strict";"use restrict";function countTrailingZeros(r){var n=32;return r&=-r,r&&n--,65535&r&&(n-=16),16711935&r&&(n-=8),252645135&r&&(n-=4),858993459&r&&(n-=2),1431655765&r&&(n-=1),n}var INT_BITS=32;exports.INT_BITS=INT_BITS,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<INT_BITS-1,exports.sign=function(r){return(r>0)-(0>r)},exports.abs=function(r){var n=r>>INT_BITS-1;return(r^n)-n},exports.min=function(r,n){return n^(r^n)&-(n>r)},exports.max=function(r,n){return r^(r^n)&-(n>r)},exports.isPow2=function(r){return!(r&r-1||!r)},exports.log2=function(r){var n,t;return n=(r>65535)<<4,r>>>=n,t=(r>255)<<3,r>>>=t,n|=t,t=(r>15)<<2,r>>>=t,n|=t,t=(r>3)<<1,r>>>=t,n|=t,n|r>>1},exports.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},exports.popCount=function(r){return r-=r>>>1&1431655765,r=(858993459&r)+(r>>>2&858993459),16843009*(r+(r>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1},exports.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r-(r>>>1)},exports.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,r&=15,27030>>>r&1};var REVERSE_TABLE=new Array(256);!function(r){for(var n=0;256>n;++n){var t=n,e=n,o=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--o;r[n]=e<<o&255}}(REVERSE_TABLE),exports.reverse=function(r){return REVERSE_TABLE[255&r]<<24|REVERSE_TABLE[r>>>8&255]<<16|REVERSE_TABLE[r>>>16&255]<<8|REVERSE_TABLE[r>>>24&255]},exports.interleave2=function(r,n){return r&=65535,r=16711935&(r|r<<8),r=252645135&(r|r<<4),r=858993459&(r|r<<2),r=1431655765&(r|r<<1),n&=65535,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),r|n<<1},exports.deinterleave2=function(r,n){return r=r>>>n&1431655765,r=858993459&(r|r>>>1),r=252645135&(r|r>>>2),r=16711935&(r|r>>>4),r=65535&(r|r>>>16),r<<16>>16},exports.interleave3=function(r,n,t){return r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),n&=1023,n=4278190335&(n|n<<16),n=251719695&(n|n<<8),n=3272356035&(n|n<<4),n=1227133513&(n|n<<2),r|=n<<1,t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),r|t<<2},exports.deinterleave3=function(r,n){return r=r>>>n&1227133513,r=3272356035&(r|r>>>2),r=251719695&(r|r>>>4),r=4278190335&(r|r>>>8),r=1023&(r|r>>>16),r<<22>>22},exports.nextCombination=function(r){var n=r|r-1;return n+1|(~n&-~n)-1>>>countTrailingZeros(r)+1};

},{}],285:[function(require,module,exports){
"use strict";function dupe_array(e,r,u){var n=0|e[u];if(0>=n)return[];var t,a=new Array(n);if(u===e.length-1)for(t=0;n>t;++t)a[t]=r;else for(t=0;n>t;++t)a[t]=dupe_array(e,r,u+1);return a}function dupe_number(e,r){var u,n;for(u=new Array(e),n=0;e>n;++n)u[n]=r;return u}function dupe(e,r){switch("undefined"==typeof r&&(r=0),typeof e){case"number":if(e>0)return dupe_number(0|e,r);break;case"object":if("number"==typeof e.length)return dupe_array(e,r,0)}return[]}module.exports=dupe;

},{}],286:[function(require,module,exports){
(function (global,Buffer){
"use strict";function freeArrayBuffer(r){if(r){var e=r.length||r.byteLength,t=bits.log2(e);DATA[t].push(r)}}function freeTypedArray(r){freeArrayBuffer(r.buffer)}function mallocArrayBuffer(r){var r=bits.nextPow2(r),e=bits.log2(r),t=DATA[e];return t.length>0?t.pop():new ArrayBuffer(r)}function mallocUint8(r){return new Uint8Array(mallocArrayBuffer(r),0,r)}function mallocUint16(r){return new Uint16Array(mallocArrayBuffer(2*r),0,r)}function mallocUint32(r){return new Uint32Array(mallocArrayBuffer(4*r),0,r)}function mallocInt8(r){return new Int8Array(mallocArrayBuffer(r),0,r)}function mallocInt16(r){return new Int16Array(mallocArrayBuffer(2*r),0,r)}function mallocInt32(r){return new Int32Array(mallocArrayBuffer(4*r),0,r)}function mallocFloat(r){return new Float32Array(mallocArrayBuffer(4*r),0,r)}function mallocDouble(r){return new Float64Array(mallocArrayBuffer(8*r),0,r)}function mallocUint8Clamped(r){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(r),0,r):mallocUint8(r)}function mallocDataView(r){return new DataView(mallocArrayBuffer(r),0,r)}function mallocBuffer(r){r=bits.nextPow2(r);var e=bits.log2(r),t=BUFFER[e];return t.length>0?t.pop():new Buffer(r)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(r){if(Buffer.isBuffer(r))BUFFER[bits.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var e=r.length||r.byteLength,t=0|bits.log2(e);DATA[t].push(r)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(r){BUFFER[bits.log2(r.length)].push(r)},exports.malloc=function(r,e){if(void 0===e||"arraybuffer"===e)return mallocArrayBuffer(r);switch(e){case"uint8":return mallocUint8(r);case"uint16":return mallocUint16(r);case"uint32":return mallocUint32(r);case"int8":return mallocInt8(r);case"int16":return mallocInt16(r);case"int32":return mallocInt32(r);case"float":case"float32":return mallocFloat(r);case"double":case"float64":return mallocDouble(r);case"uint8_clamped":return mallocUint8Clamped(r);case"buffer":return mallocBuffer(r);case"data":case"dataview":return mallocDataView(r);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var r=0;32>r;++r)POOL.UINT8[r].length=0,POOL.UINT16[r].length=0,POOL.UINT32[r].length=0,POOL.INT8[r].length=0,POOL.INT16[r].length=0,POOL.INT32[r].length=0,POOL.FLOAT[r].length=0,POOL.DOUBLE[r].length=0,POOL.UINT8C[r].length=0,DATA[r].length=0,BUFFER[r].length=0};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer)
},{"bit-twiddle":284,"buffer":5,"dup":285}],287:[function(require,module,exports){
"use strict";function doBind(e,r,t){r?r.bind():e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);var i=0|e.getParameter(e.MAX_VERTEX_ATTRIBS);if(t){if(t.length>i)throw new Error("gl-vao: Too many vertex attributes");for(var f=0;f<t.length;++f){var l=t[f];if(l.buffer){var n=l.buffer,b=l.size||4,a=l.type||e.FLOAT,A=!!l.normalized,o=l.stride||0,s=l.offset||0;n.bind(),e.enableVertexAttribArray(f),e.vertexAttribPointer(f,b,a,A,o,s)}else{if("number"==typeof l)e.vertexAttrib1f(f,l);else if(1===l.length)e.vertexAttrib1f(f,l[0]);else if(2===l.length)e.vertexAttrib2f(f,l[0],l[1]);else if(3===l.length)e.vertexAttrib3f(f,l[0],l[1],l[2]);else{if(4!==l.length)throw new Error("gl-vao: Invalid vertex attribute");e.vertexAttrib4f(f,l[0],l[1],l[2],l[3])}e.disableVertexAttribArray(f)}}for(;i>f;++f)e.disableVertexAttribArray(f)}else{e.bindBuffer(e.ARRAY_BUFFER,null);for(var f=0;i>f;++f)e.disableVertexAttribArray(f)}}module.exports=doBind;

},{}],288:[function(require,module,exports){
"use strict";function VAOEmulated(t){this.gl=t,this._elements=null,this._attributes=null,this._elementsType=t.UNSIGNED_SHORT}function createVAOEmulated(t){return new VAOEmulated(t)}var bindAttribs=require("./do-bind.js");VAOEmulated.prototype.bind=function(){bindAttribs(this.gl,this._elements,this._attributes)},VAOEmulated.prototype.update=function(t,e,i){this._elements=e,this._attributes=t,this._elementsType=i||this.gl.UNSIGNED_SHORT},VAOEmulated.prototype.dispose=function(){},VAOEmulated.prototype.unbind=function(){},VAOEmulated.prototype.draw=function(t,e,i){i=i||0;var s=this.gl;this._elements?s.drawElements(t,e,this._elementsType,i):s.drawArrays(t,i,e)},module.exports=createVAOEmulated;

},{"./do-bind.js":287}],289:[function(require,module,exports){
"use strict";function VertexAttribute(t,e,i,s,r,n){this.location=t,this.dimension=e,this.a=i,this.b=s,this.c=r,this.d=n}function VAONative(t,e,i){this.gl=t,this._ext=e,this.handle=i,this._attribs=[],this._useElements=!1,this._elementsType=t.UNSIGNED_SHORT}function createVAONative(t,e){return new VAONative(t,e,e.createVertexArrayOES())}var bindAttribs=require("./do-bind.js");VertexAttribute.prototype.bind=function(t){switch(this.dimension){case 1:t.vertexAttrib1f(this.location,this.a);break;case 2:t.vertexAttrib2f(this.location,this.a,this.b);break;case 3:t.vertexAttrib3f(this.location,this.a,this.b,this.c);break;case 4:t.vertexAttrib4f(this.location,this.a,this.b,this.c,this.d)}},VAONative.prototype.bind=function(){this._ext.bindVertexArrayOES(this.handle);for(var t=0;t<this._attribs.length;++t)this._attribs[t].bind(this.gl)},VAONative.prototype.unbind=function(){this._ext.bindVertexArrayOES(null)},VAONative.prototype.dispose=function(){this._ext.deleteVertexArrayOES(this.handle)},VAONative.prototype.update=function(t,e,i){if(this.bind(),bindAttribs(this.gl,e,t),this.unbind(),this._attribs.length=0,t)for(var s=0;s<t.length;++s){var r=t[s];"number"==typeof r?this._attribs.push(new VertexAttribute(s,1,r)):Array.isArray(r)&&this._attribs.push(new VertexAttribute(s,r.length,r[0],r[1],r[2],r[3]))}this._useElements=!!e,this._elementsType=i||this.gl.UNSIGNED_SHORT},VAONative.prototype.draw=function(t,e,i){i=i||0;var s=this.gl;this._useElements?s.drawElements(t,e,this._elementsType,i):s.drawArrays(t,i,e)},module.exports=createVAONative;

},{"./do-bind.js":287}],290:[function(require,module,exports){
"use strict";function createVAO(e,t,a,r){var i,u=e.getExtension("OES_vertex_array_object");return i=u?createVAONative(e,u):createVAOEmulated(e),i.update(t,a,r),i}var createVAONative=require("./lib/vao-native.js"),createVAOEmulated=require("./lib/vao-emulated.js");module.exports=createVAO;

},{"./lib/vao-emulated.js":288,"./lib/vao-native.js":289}],291:[function(require,module,exports){
"use strict";var createShader=require("gl-shader"),vertSrc="#define GLSLIFY 1\nprecision mediump float;\n\nattribute vec3 position, color;\nattribute float weight;\n\nuniform mat4 model, view, projection;\nuniform vec3 coordinates[3];\nuniform vec4 colors[3];\nuniform vec2 screenShape;\nuniform float lineWidth;\n\nvarying vec4 fragColor;\n\nvoid main() {\n  vec3 vertexPosition = mix(coordinates[0],\n    mix(coordinates[2], coordinates[1], 0.5 * (position + 1.0)), abs(position));\n\n  vec4 clipPos = projection * view * model * vec4(vertexPosition, 1.0);\n  vec2 clipOffset = (projection * view * model * vec4(color, 0.0)).xy;\n  vec2 delta = weight * clipOffset * screenShape;\n  vec2 lineOffset = normalize(vec2(delta.y, -delta.x)) / screenShape;\n\n  gl_Position   = vec4(clipPos.xy + clipPos.w * 0.5 * lineWidth * lineOffset, clipPos.z, clipPos.w);\n  fragColor     = color.x * colors[0] + color.y * colors[1] + color.z * colors[2];\n}\n",fragSrc="#define GLSLIFY 1\nprecision mediump float;\n\nvarying vec4 fragColor;\n\nvoid main() {\n  gl_FragColor = fragColor;\n}";module.exports=function(e){return createShader(e,vertSrc,fragSrc,null,[{name:"position",type:"vec3"},{name:"color",type:"vec3"},{name:"weight",type:"float"}])};

},{"gl-shader":269}],292:[function(require,module,exports){
"use strict";function AxisSpikes(i,e,s,t){this.gl=i,this.buffer=e,this.vao=s,this.shader=t,this.pixelRatio=1,this.bounds=[[-1e3,-1e3,-1e3],[1e3,1e3,1e3]],this.position=[0,0,0],this.lineWidth=[2,2,2],this.colors=[[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.enabled=[!0,!0,!0],this.drawSides=[!0,!0,!0],this.axes=null}function createSpikes(i,e){function s(i,e,s,o,r,n){var a=[i,e,s,0,0,0,1];a[o+3]=1,a[o]=r,t.push.apply(t,a),a[6]=-1,t.push.apply(t,a),a[o]=n,t.push.apply(t,a),t.push.apply(t,a),a[6]=1,t.push.apply(t,a),a[o]=r,t.push.apply(t,a)}var t=[];s(0,0,0,0,0,1),s(0,0,0,1,0,1),s(0,0,0,2,0,1),s(1,0,0,1,-1,1),s(1,0,0,2,-1,1),s(0,1,0,0,-1,1),s(0,1,0,2,-1,1),s(0,0,1,0,-1,1),s(0,0,1,1,-1,1);var o=createBuffer(i,t),r=createVAO(i,[{type:i.FLOAT,buffer:o,size:3,offset:0,stride:28},{type:i.FLOAT,buffer:o,size:3,offset:12,stride:28},{type:i.FLOAT,buffer:o,size:1,offset:24,stride:28}]),n=createShader(i);n.attributes.position.location=0,n.attributes.color.location=1,n.attributes.weight.location=2;var a=new AxisSpikes(i,o,r,n);return a.update(e),a}var createBuffer=require("gl-buffer"),createVAO=require("gl-vao"),createShader=require("./shaders/index");module.exports=createSpikes;var identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],proto=AxisSpikes.prototype,OUTER_FACE=[0,0,0],INNER_FACE=[0,0,0],SHAPE=[0,0];proto.isTransparent=function(){return!1},proto.drawTransparent=function(i){},proto.draw=function(i){var e=this.gl,s=this.vao,t=this.shader;s.bind(),t.bind();var o,r=i.model||identity,n=i.view||identity,a=i.projection||identity;this.axes&&(o=this.axes.lastCubeProps.axis);for(var d=OUTER_FACE,h=INNER_FACE,p=0;3>p;++p)o&&o[p]<0?(d[p]=this.bounds[0][p],h[p]=this.bounds[1][p]):(d[p]=this.bounds[1][p],h[p]=this.bounds[0][p]);SHAPE[0]=e.drawingBufferWidth,SHAPE[1]=e.drawingBufferHeight,t.uniforms.model=r,t.uniforms.view=n,t.uniforms.projection=a,t.uniforms.coordinates=[this.position,d,h],t.uniforms.colors=this.colors,t.uniforms.screenShape=SHAPE;for(var p=0;3>p;++p)t.uniforms.lineWidth=this.lineWidth[p]*this.pixelRatio,this.enabled[p]&&(s.draw(e.TRIANGLES,6,6*p),this.drawSides[p]&&s.draw(e.TRIANGLES,12,18+12*p));s.unbind()},proto.update=function(i){i&&("bounds"in i&&(this.bounds=i.bounds),"position"in i&&(this.position=i.position),"lineWidth"in i&&(this.lineWidth=i.lineWidth),"colors"in i&&(this.colors=i.colors),"enabled"in i&&(this.enabled=i.enabled),"drawSides"in i&&(this.drawSides=i.drawSides))},proto.dispose=function(){this.vao.dispose(),this.buffer.dispose(),this.shader.dispose()};

},{"./shaders/index":291,"gl-buffer":278,"gl-vao":290}],293:[function(require,module,exports){
"use strict";function mouseListen(e,t){function n(e){var t=!1;return"altKey"in e&&(t=t||e.altKey!==v.alt,v.alt=!!e.altKey),"shiftKey"in e&&(t=t||e.shiftKey!==v.shift,v.shift=!!e.shiftKey),"ctrlKey"in e&&(t=t||e.ctrlKey!==v.control,v.control=!!e.ctrlKey),"metaKey"in e&&(t=t||e.metaKey!==v.meta,v.meta=!!e.metaKey),t}function o(e,o){var r=mouse.x(o),u=mouse.y(o);"buttons"in o&&(e=0|o.buttons),(e!==l||r!==c||u!==f||n(o))&&(l=0|e,c=r||0,f=u||0,t(l,c,f,v))}function r(e){o(0,e)}function u(){(l||c||f||v.shift||v.alt||v.meta||v.control)&&(c=f=0,l=0,v.shift=v.alt=v.control=v.meta=!1,t(0,0,0,v))}function s(e){n(e)&&t(l,c,f,v)}function i(e){0===mouse.buttons(e)?o(0,e):o(l,e)}function a(e){o(l|mouse.buttons(e),e)}function d(e){o(l&~mouse.buttons(e),e)}function m(){y||(y=!0,e.addEventListener("mousemove",i),e.addEventListener("mousedown",a),e.addEventListener("mouseup",d),e.addEventListener("mouseleave",r),e.addEventListener("mouseenter",r),e.addEventListener("mouseout",r),e.addEventListener("mouseover",r),e.addEventListener("blur",u),e.addEventListener("keyup",s),e.addEventListener("keydown",s),e.addEventListener("keypress",s),e!==window&&(window.addEventListener("blur",u),window.addEventListener("keyup",s),window.addEventListener("keydown",s),window.addEventListener("keypress",s)))}t||(t=e,e=window);var l=0,c=0,f=0,v={shift:!1,alt:!1,control:!1,meta:!1},y=!1;m();var L={element:e};return Object.defineProperties(L,{enabled:{get:function(){return y},set:function(e){e&&m()},enumerable:!0},buttons:{get:function(){return l},enumerable:!0},x:{get:function(){return c},enumerable:!0},y:{get:function(){return f},enumerable:!0},mods:{get:function(){return v},enumerable:!0}}),L}module.exports=mouseListen;var mouse=require("mouse-event");

},{"mouse-event":294}],294:[function(require,module,exports){
"use strict";function mouseButtons(e){if("object"==typeof e){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(2===t)return 4;if(3===t)return 2;if(t>0)return 1<<t-1}else if("button"in e){var t=e.button;if(1===t)return 4;if(2===t)return 2;if(t>=0)return 1<<t}}return 0}function mouseElement(e){return e.target||e.srcElement||window}function mouseRelativeX(e){if("object"==typeof e){if("offsetX"in e)return e.offsetX;var t=mouseElement(e),n=t.getBoundingClientRect();return e.clientX-n.left}return 0}function mouseRelativeY(e){if("object"==typeof e){if("offsetY"in e)return e.offsetY;var t=mouseElement(e),n=t.getBoundingClientRect();return e.clientY-n.top}return 0}exports.buttons=mouseButtons,exports.element=mouseElement,exports.x=mouseRelativeX,exports.y=mouseRelativeY;

},{}],295:[function(require,module,exports){
"use strict";function MouseSelect(){this.mouse=[-1,-1],this.screen=null,this.distance=1/0,this.index=null,this.dataCoordinate=null,this.dataPosition=null,this.object=null,this.data=null}function getContext(e,a){var t=null;try{t=e.getContext("webgl",a),t||(t=e.getContext("experimental-webgl",a))}catch(i){return null}return t}function roundUpPow10(e){var a=Math.round(Math.log(Math.abs(e))/Math.log(10));if(0>a){var t=Math.round(Math.pow(10,-a));return Math.ceil(e*t)/t}if(a>0){var t=Math.round(Math.pow(10,a));return Math.ceil(e/t)*t}return Math.ceil(e)}function defaultBool(e){return"boolean"==typeof e?e:!0}function createScene(e){function a(){if(!s&&P.autoResize){var e=l.parentNode,a=1,t=1;e&&e!==document.body?(a=e.clientWidth,t=e.clientHeight):(a=window.innerWidth,t=window.innerHeight);var i=0|Math.ceil(a*P.pixelRatio),r=0|Math.ceil(t*P.pixelRatio);if(i!==l.width||r!==l.height){l.width=i,l.height=r;var o=l.style;o.position=o.position||"absolute",o.left="0px",o.top="0px",o.width=a+"px",o.height=t+"px",M=!0}}}function t(){for(var e=m.length,a=E.length,t=0;a>t;++t)B[t]=0;e:for(var t=0;e>t;++t){var i=m[t],r=i.pickSlots;if(r){for(var o=0;a>o;++o)if(B[o]+r<255){R[t]=o,i.setPickBase(B[o]+1),B[o]+=r;continue e}var n=createSelect(d,L);R[t]=a,E.push(n),B.push(r),i.setPickBase(1),a+=1}else R[t]=-1}for(;a>0&&0===B[a-1];)B.pop(),E.pop().dispose()}function i(){return P.contextLost?!0:void(d.isContextLost()&&(P.contextLost=!0,P.mouseListener.enabled=!1,P.selection.object=null,P.oncontextloss&&P.oncontextloss()))}function r(){if(!i()){d.colorMask(!0,!0,!0,!0),d.depthMask(!0),d.disable(d.BLEND),d.enable(d.DEPTH_TEST);for(var e=m.length,a=E.length,t=0;a>t;++t){var r=E[t];r.shape=S,r.begin();for(var o=0;e>o;++o)if(R[o]===t){var n=m[o];n.drawPick&&(n.pixelRatio=1,n.drawPick(k))}r.end()}}}function o(){if(!i()){a();var e=P.camera.tick();k.view=P.camera.matrix,M=M||e,T=T||e,g.pixelRatio=P.pixelRatio,w.pixelRatio=P.pixelRatio;var t=m.length,o=O[0],n=O[1];o[0]=o[1]=o[2]=1/0,n[0]=n[1]=n[2]=-(1/0);for(var s=0;t>s;++s){var l=m[s];l.pixelRatio=P.pixelRatio,l.axes=P.axes,M=M||!!l.dirty,T=T||!!l.dirty;var c=l.bounds;if(c)for(var u=c[0],v=c[1],x=0;3>x;++x)o[x]=Math.min(o[x],u[x]),n[x]=Math.max(n[x],v[x])}var b=P.bounds;if(P.autoBounds)for(var x=0;3>x;++x){if(n[x]<o[x])o[x]=-1,n[x]=1;else{o[x]===n[x]&&(o[x]-=1,n[x]+=1);var R=.05*(n[x]-o[x]);o[x]=o[x]-R,n[x]=n[x]+R}b[0][x]=o[x],b[1][x]=n[x]}for(var B=!1,x=0;3>x;++x)B=B||y[0][x]!==b[0][x]||y[1][x]!==b[1][x],y[0][x]=b[0][x],y[1][x]=b[1][x];if(B){for(var E=[0,0,0],s=0;3>s;++s)E[s]=roundUpPow10((b[1][s]-b[0][s])/10);g.autoTicks?g.update({bounds:b,tickSpacing:E}):g.update({bounds:b})}T=T||B,M=M||B;var q=d.drawingBufferWidth,_=d.drawingBufferHeight;L[0]=q,L[1]=_,S[0]=0|Math.max(q/P.pixelRatio,1),S[1]=0|Math.max(_/P.pixelRatio,1),perspective(C,P.fovy,q/_,P.zNear,P.zFar);for(var s=0;16>s;++s)F[s]=0;F[15]=1;for(var j=0,s=0;3>s;++s)j=Math.max(j,b[1][s]-b[0][s]);for(var s=0;3>s;++s)P.autoScale?F[5*s]=P.aspect[s]/(b[1][s]-b[0][s]):F[5*s]=1/j,P.autoCenter&&(F[12+s]=.5*-F[5*s]*(b[0][s]+b[1][s]));for(var s=0;t>s;++s){var l=m[s];l.axesBounds=b,P.clipToBounds&&(l.clipBounds=b)}if(p.object&&(P.snapToData?w.position=p.dataCoordinate:w.position=p.dataPosition,w.bounds=b),T&&(T=!1,r()),M){P.axesPixels=axesRanges(P.axes,k,q,_),P.onrender&&P.onrender(),d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,q,_);var z=P.clearColor;d.clearColor(z[0],z[1],z[2],z[3]),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT),d.depthMask(!0),d.colorMask(!0,!0,!0,!0),d.enable(d.DEPTH_TEST),d.depthFunc(d.LEQUAL),d.disable(d.BLEND),d.disable(d.CULL_FACE);var A=!1;g.enable&&(A=A||g.isTransparent(),g.draw(k)),w.axes=g,p.object&&w.draw(k),d.disable(d.CULL_FACE);for(var s=0;t>s;++s){var l=m[s];l.axes=g,l.pixelRatio=P.pixelRatio,l.isOpaque&&l.isOpaque()&&l.draw(k),l.isTransparent&&l.isTransparent()&&(A=!0)}if(A){f.shape=L,f.bind(),d.clear(d.DEPTH_BUFFER_BIT),d.colorMask(!1,!1,!1,!1),d.depthMask(!0),d.depthFunc(d.LESS),g.enable&&g.isTransparent()&&g.drawTransparent(k);for(var s=0;t>s;++s){var l=m[s];l.isOpaque&&l.isOpaque()&&l.draw(k)}d.enable(d.BLEND),d.blendEquation(d.FUNC_ADD),d.blendFunc(d.ONE,d.ONE),d.colorMask(!0,!0,!0,!0),d.depthMask(!1),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),g.isTransparent()&&g.drawTransparent(k);for(var s=0;t>s;++s){var l=m[s];l.isTransparent&&l.isTransparent()&&l.drawTransparent(k)}d.bindFramebuffer(d.FRAMEBUFFER,null),d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA),d.disable(d.DEPTH_TEST),h.bind(),f.color[0].bind(0),h.uniforms.accumBuffer=0,drawTriangle(d),d.disable(d.BLEND)}M=!1;for(var s=0;t>s;++s)m[s].dirty=!1}}}function n(){s||P.contextLost||(requestAnimationFrame(n),o())}e=e||{};var s=!1,l=(e.pixelRatio||parseFloat(window.devicePixelRatio),e.canvas);if(!l)if(l=document.createElement("canvas"),e.container){var c=e.container;c.appendChild(l)}else document.body.appendChild(l);var d=e.gl;if(d||(d=getContext(l,e.glOptions||{premultipliedAlpha:!0,antialias:!0})),!d)throw new Error("webgl not supported");var u=e.bounds||[[-10,-10,-10],[10,10,10]],p=new MouseSelect,f=createFBO(d,[d.drawingBufferWidth,d.drawingBufferHeight],{preferFloat:!0}),h=createShader(d),v=e.camera||{eye:[2,0,0],center:[0,0,0],up:[0,1,0],zoomMin:.1,zoomMax:100,mode:"turntable"},x=e.axes||{},g=createAxes(d,x);g.enable=!x.disable;var b=e.spikes||{},w=createSpikes(d,b),m=[],R=[],B=[],E=[],M=!0,T=!0,C=new Array(16),F=new Array(16),k={view:null,projection:C,model:F},T=!0,L=[d.drawingBufferWidth,d.drawingBufferHeight],P={gl:d,contextLost:!1,pixelRatio:e.pixelRatio||parseFloat(window.devicePixelRatio),canvas:l,selection:p,camera:createCamera(l,v),axes:g,axesPixels:null,spikes:w,bounds:u,objects:m,shape:L,aspect:e.aspectRatio||[1,1,1],pickRadius:e.pickRadius||10,zNear:e.zNear||.01,zFar:e.zFar||1e3,fovy:e.fovy||Math.PI/4,clearColor:e.clearColor||[0,0,0,0],autoResize:defaultBool(e.autoResize),autoBounds:defaultBool(e.autoBounds),autoScale:!!e.autoScale,autoCenter:defaultBool(e.autoCenter),clipToBounds:defaultBool(e.clipToBounds),snapToData:!!e.snapToData,onselect:e.onselect||null,onrender:e.onrender||null,onclick:e.onclick||null,cameraParams:k,oncontextloss:null,mouseListener:null},S=[d.drawingBufferWidth/P.pixelRatio|0,d.drawingBufferHeight/P.pixelRatio|0];P.autoResize&&a(),window.addEventListener("resize",a),P.update=function(e){s||(e=e||{},M=!0,T=!0)},P.add=function(e){s||(e.axes=g,m.push(e),R.push(-1),M=!0,T=!0,t())},P.remove=function(e){if(!s){var a=m.indexOf(e);0>a||(m.splice(a,1),R.pop(),M=!0,T=!0,t())}},P.dispose=function(){if(!s&&(s=!0,window.removeEventListener("resize",a),l.removeEventListener("webglcontextlost",i),P.mouseListener.enabled=!1,!P.contextLost)){g.dispose(),w.dispose();for(var e=0;e<m.length;++e)m[e].dispose();f.dispose();for(var e=0;e<E.length;++e)E[e].dispose();h.dispose(),d=null,g=null,w=null,m=[]}};var q=!1,_=0;P.mouseListener=mouseChange(l,function(e,a,t){if(!s){var i=E.length,r=m.length,o=p.object;p.distance=1/0,p.mouse[0]=a,p.mouse[1]=t,p.object=null,p.screen=null,p.dataCoordinate=p.dataPosition=null;var n=!1;if(e)q=!0;else{q&&(T=!0),q=!1;for(var l=0;i>l;++l){var c=E[l].query(a,S[1]-t-1,P.pickRadius);if(c){if(c.distance>p.distance)continue;for(var d=0;r>d;++d){var u=m[d];if(R[d]===l){var f=u.pick(c);f&&(p.screen=c.coord,p.distance=c.distance,p.object=u,p.index=f.distance,p.dataPosition=f.position,p.dataCoordinate=f.dataCoordinate,p.data=f,n=!0)}}}}}o&&o!==p.object&&(o.highlight&&o.highlight(null),M=!0),p.object&&(p.object.highlight&&p.object.highlight(p.data),M=!0),n=n||p.object!==o,n&&P.onselect&&P.onselect(p),1&e&&!(1&_)&&P.onclick&&P.onclick(p),_=e}}),l.addEventListener("webglcontextlost",i);var O=[[1/0,1/0,1/0],[-(1/0),-(1/0),-(1/0)]],y=[O[0].slice(),O[1].slice()];return n(),P.redraw=function(){s||(M=!0,o())},P}module.exports=createScene;var createCamera=require("3d-view-controls"),createAxes=require("gl-axes3d"),axesRanges=require("gl-axes3d/properties"),createSpikes=require("gl-spikes3d"),createSelect=require("gl-select-static"),createFBO=require("gl-fbo"),drawTriangle=require("a-big-triangle"),mouseChange=require("mouse-change"),perspective=require("gl-mat4/perspective"),createShader=require("./lib/shader");

},{"./lib/shader":64,"3d-view-controls":65,"a-big-triangle":110,"gl-axes3d":111,"gl-axes3d/properties":232,"gl-fbo":233,"gl-mat4/perspective":252,"gl-select-static":268,"gl-spikes3d":292,"mouse-change":293}],296:[function(require,module,exports){
function compare1st(t,r){return t[0]-r[0]}function order(){var t,r=this.stride,e=new Array(r.length);for(t=0;t<e.length;++t)e[t]=[Math.abs(r[t]),t];e.sort(compare1st);var n=new Array(e.length);for(t=0;t<n.length;++t)n[t]=e[t][1];return n}function compileConstructor(t,r){var e=["View",r,"d",t].join("");0>r&&(e="View_Nil"+t);var n="generic"===t;if(-1===r){var o="function "+e+"(a){this.data=a;};var proto="+e+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+e+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+e+"(a){return new "+e+"(a);}",i=new Function(o);return i()}if(0===r){var o="function "+e+"(a,d) {this.data = a;this.offset = d};var proto="+e+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+e+"_copy() {return new "+e+"(this.data,this.offset)};proto.pick=function "+e+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+e+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+e+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+e+"(a,b,c,d){return new "+e+"(a,d)}",i=new Function("TrivialArray",o);return i(CACHED_CONSTRUCTORS[t][0])}var o=["'use strict'"],a=iota(r),s=a.map(function(t){return"i"+t}),u="this.offset+"+a.map(function(t){return"this.stride["+t+"]*i"+t}).join("+"),p=a.map(function(t){return"b"+t}).join(","),f=a.map(function(t){return"c"+t}).join(",");o.push("function "+e+"(a,"+p+","+f+",d){this.data=a","this.shape=["+p+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+e+".prototype","proto.dtype='"+t+"'","proto.dimension="+r),o.push("Object.defineProperty(proto,'size',{get:function "+e+"_size(){return "+a.map(function(t){return"this.shape["+t+"]"}).join("*"),"}})"),1===r?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),4>r?(o.push("function "+e+"_order(){"),2===r?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===r&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+e+"_set("+s.join(",")+",v){"),n?o.push("return this.data.set("+u+",v)}"):o.push("return this.data["+u+"]=v}"),o.push("proto.get=function "+e+"_get("+s.join(",")+"){"),n?o.push("return this.data.get("+u+")}"):o.push("return this.data["+u+"]}"),o.push("proto.index=function "+e+"_index(",s.join(),"){return "+u+"}"),o.push("proto.hi=function "+e+"_hi("+s.join(",")+"){return new "+e+"(this.data,"+a.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")}).join(",")+","+a.map(function(t){return"this.stride["+t+"]"}).join(",")+",this.offset)}");var h=a.map(function(t){return"a"+t+"=this.shape["+t+"]"}),c=a.map(function(t){return"c"+t+"=this.stride["+t+"]"});o.push("proto.lo=function "+e+"_lo("+s.join(",")+"){var b=this.offset,d=0,"+h.join(",")+","+c.join(","));for(var d=0;r>d;++d)o.push("if(typeof i"+d+"==='number'&&i"+d+">=0){d=i"+d+"|0;b+=c"+d+"*d;a"+d+"-=d}");o.push("return new "+e+"(this.data,"+a.map(function(t){return"a"+t}).join(",")+","+a.map(function(t){return"c"+t}).join(",")+",b)}"),o.push("proto.step=function "+e+"_step("+s.join(",")+"){var "+a.map(function(t){return"a"+t+"=this.shape["+t+"]"}).join(",")+","+a.map(function(t){return"b"+t+"=this.stride["+t+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var d=0;r>d;++d)o.push("if(typeof i"+d+"==='number'){d=i"+d+"|0;if(d<0){c+=b"+d+"*(a"+d+"-1);a"+d+"=ceil(-a"+d+"/d)}else{a"+d+"=ceil(a"+d+"/d)}b"+d+"*=d}");o.push("return new "+e+"(this.data,"+a.map(function(t){return"a"+t}).join(",")+","+a.map(function(t){return"b"+t}).join(",")+",c)}");for(var y=new Array(r),l=new Array(r),d=0;r>d;++d)y[d]="a[i"+d+"]",l[d]="b[i"+d+"]";o.push("proto.transpose=function "+e+"_transpose("+s+"){"+s.map(function(t,r){return t+"=("+t+"===undefined?"+r+":"+t+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+e+"(this.data,"+y.join(",")+","+l.join(",")+",this.offset)}"),o.push("proto.pick=function "+e+"_pick("+s+"){var a=[],b=[],c=this.offset");for(var d=0;r>d;++d)o.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this.stride["+d+"]*i"+d+")|0}else{a.push(this.shape["+d+"]);b.push(this.stride["+d+"])}");o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+e+"(data,shape,stride,offset){return new "+e+"(data,"+a.map(function(t){return"shape["+t+"]"}).join(",")+","+a.map(function(t){return"stride["+t+"]"}).join(",")+",offset)}");var i=new Function("CTOR_LIST","ORDER",o.join("\n"));return i(CACHED_CONSTRUCTORS[t],order)}function arrayDType(t){if(isBuffer(t))return"buffer";if(hasTypedArrays)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(t)?"array":"generic"}function wrappedNDArrayCtor(t,r,e,n){if(void 0===t){var o=CACHED_CONSTRUCTORS.array[0];return o([])}"number"==typeof t&&(t=[t]),void 0===r&&(r=[t.length]);var i=r.length;if(void 0===e){e=new Array(i);for(var a=i-1,s=1;a>=0;--a)e[a]=s,s*=r[a]}if(void 0===n){n=0;for(var a=0;i>a;++a)e[a]<0&&(n-=(r[a]-1)*e[a])}for(var u=arrayDType(t),p=CACHED_CONSTRUCTORS[u];p.length<=i+1;)p.push(compileConstructor(u,p.length-1));var o=p[i+1];return o(t,r,e,n)}var iota=require("iota-array"),isBuffer=require("is-buffer"),hasTypedArrays="undefined"!=typeof Float64Array,CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};module.exports=wrappedNDArrayCtor;

},{"iota-array":297,"is-buffer":298}],297:[function(require,module,exports){
"use strict";function iota(r){for(var t=new Array(r),o=0;r>o;++o)t[o]=o;return t}module.exports=iota;

},{}],298:[function(require,module,exports){
module.exports=function(o){return!(null==o||!o.constructor||"function"!=typeof o.constructor.isBuffer||!o.constructor.isBuffer(o))};

},{}],299:[function(require,module,exports){
(function (process){
"use strict";var callable,byObserver;callable=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},byObserver=function(e){var t,n=document.createTextNode(""),o=0;return new e(function(){var e;if(t)return e=t,t=null,"function"==typeof e?void e():void e.forEach(function(e){e()})}).observe(n,{characterData:!0}),function(e){return callable(e),t?void("function"==typeof t?t=[t,e]:t.push(e)):(t=e,void(n.data=o=++o%2))}},module.exports=function(){if("undefined"!=typeof process&&process&&"function"==typeof process.nextTick)return process.nextTick;if("object"==typeof document&&document){if("function"==typeof MutationObserver)return byObserver(MutationObserver);if("function"==typeof WebKitMutationObserver)return byObserver(WebKitMutationObserver)}return"function"==typeof setImmediate?function(e){setImmediate(callable(e))}:"function"==typeof setTimeout?function(e){setTimeout(callable(e),0)}:null}();

}).call(this,require('_process'))
},{"_process":12}],300:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};

},{}],301:[function(require,module,exports){
(function (process){
function Duplex(e){return this instanceof Duplex?(Readable.call(this,e),Writable.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",onend)):new Duplex(e)}function onend(){this.allowHalfOpen||this._writableState.ended||process.nextTick(this.end.bind(this))}function forEach(e,t){for(var i=0,r=e.length;r>i;i++)t(e[i],i)}module.exports=Duplex;var objectKeys=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t},util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable),forEach(objectKeys(Writable.prototype),function(e){Duplex.prototype[e]||(Duplex.prototype[e]=Writable.prototype[e])});

}).call(this,require('_process'))
},{"./_stream_readable":302,"./_stream_writable":303,"_process":12,"core-util-is":304,"inherits":300}],302:[function(require,module,exports){
(function (process){
function ReadableState(e,t){var n=require("./_stream_duplex");e=e||{};var r=e.highWaterMark,i=e.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,t instanceof n&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(e.encoding),this.encoding=e.encoding)}function Readable(e){require("./_stream_duplex");return this instanceof Readable?(this._readableState=new ReadableState(e,this),this.readable=!0,void Stream.call(this)):new Readable(e)}function readableAddChunk(e,t,n,r,i){var a=chunkInvalid(t,n);if(a)e.emit("error",a);else if(util.isNullOrUndefined(n))t.reading=!1,t.ended||onEofChunk(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var d=new Error("stream.push() after EOF");e.emit("error",d)}else if(t.endEmitted&&i){var d=new Error("stream.unshift() after end event");e.emit("error",d)}else!t.decoder||i||r||(n=t.decoder.write(n)),i||(t.reading=!1),t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&emitReadable(e)),maybeReadMore(e,t);else i||(t.reading=!1);return needMoreData(t)}function needMoreData(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function roundUpToNextPowerOf2(e){if(e>=MAX_HWM)e=MAX_HWM;else{e--;for(var t=1;32>t;t<<=1)e|=e>>t;e++}return e}function howMuchToRead(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:isNaN(e)||util.isNull(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:0>=e?0:(e>t.highWaterMark&&(t.highWaterMark=roundUpToNextPowerOf2(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function chunkInvalid(e,t){var n=null;return util.isBuffer(t)||util.isString(t)||util.isNullOrUndefined(t)||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function onEofChunk(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,emitReadable(e)}function emitReadable(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(debug("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?process.nextTick(function(){emitReadable_(e)}):emitReadable_(e))}function emitReadable_(e){debug("emit readable"),e.emit("readable"),flow(e)}function maybeReadMore(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(function(){maybeReadMore_(e,t)}))}function maybeReadMore_(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(debug("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function pipeOnDrain(e){return function(){var t=e._readableState;debug("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&EE.listenerCount(e,"data")&&(t.flowing=!0,flow(e))}}function resume(e,t){t.resumeScheduled||(t.resumeScheduled=!0,process.nextTick(function(){resume_(e,t)}))}function resume_(e,t){t.resumeScheduled=!1,e.emit("resume"),flow(e),t.flowing&&!t.reading&&e.read(0)}function flow(e){var t=e._readableState;if(debug("flow",t.flowing),t.flowing)do var n=e.read();while(null!==n&&t.flowing)}function fromList(e,t){var n,r=t.buffer,i=t.length,a=!!t.decoder,d=!!t.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(d)n=r.shift();else if(!e||e>=i)n=a?r.join(""):Buffer.concat(r,i),r.length=0;else if(e<r[0].length){var o=r[0];n=o.slice(0,e),r[0]=o.slice(e)}else if(e===r[0].length)n=r.shift();else{n=a?"":new Buffer(e);for(var l=0,u=0,s=r.length;s>u&&e>l;u++){var o=r[0],h=Math.min(e-l,o.length);a?n+=o.slice(0,h):o.copy(n,l,0,h),h<o.length?r[0]=o.slice(h):r.shift(),l+=h}}return n}function endReadable(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,process.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function forEach(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n],n)}function indexOf(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}module.exports=Readable;var isArray=require("isarray"),Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;EE.listenerCount||(EE.listenerCount=function(e,t){return e.listeners(t).length});var Stream=require("stream"),util=require("core-util-is");util.inherits=require("inherits");var StringDecoder,debug=require("util");debug=debug&&debug.debuglog?debug.debuglog("stream"):function(){},util.inherits(Readable,Stream),Readable.prototype.push=function(e,t){var n=this._readableState;return util.isString(e)&&!n.objectMode&&(t=t||n.defaultEncoding,t!==n.encoding&&(e=new Buffer(e,t),t="")),readableAddChunk(this,n,e,t,!1)},Readable.prototype.unshift=function(e){var t=this._readableState;return readableAddChunk(this,t,e,"",!0)},Readable.prototype.setEncoding=function(e){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(e),this._readableState.encoding=e,this};var MAX_HWM=8388608;Readable.prototype.read=function(e){debug("read",e);var t=this._readableState,n=e;if((!util.isNumber(e)||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return debug("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?endReadable(this):emitReadable(this),null;if(e=howMuchToRead(e,t),0===e&&t.ended)return 0===t.length&&endReadable(this),null;var r=t.needReadable;debug("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,debug("length less than watermark",r)),(t.ended||t.reading)&&(r=!1,debug("reading or ended",r)),r&&(debug("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),r&&!t.reading&&(e=howMuchToRead(n,t));var i;return i=e>0?fromList(e,t):null,util.isNull(i)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),n!==e&&t.ended&&0===t.length&&endReadable(this),util.isNull(i)||this.emit("data",i),i},Readable.prototype._read=function(e){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(e,t){function n(e){debug("onunpipe"),e===s&&i()}function r(){debug("onend"),e.end()}function i(){debug("cleanup"),e.removeListener("close",o),e.removeListener("finish",l),e.removeListener("drain",g),e.removeListener("error",d),e.removeListener("unpipe",n),s.removeListener("end",r),s.removeListener("end",i),s.removeListener("data",a),!h.awaitDrain||e._writableState&&!e._writableState.needDrain||g()}function a(t){debug("ondata");var n=e.write(t);!1===n&&(debug("false write response, pause",s._readableState.awaitDrain),s._readableState.awaitDrain++,s.pause())}function d(t){debug("onerror",t),u(),e.removeListener("error",d),0===EE.listenerCount(e,"error")&&e.emit("error",t)}function o(){e.removeListener("finish",l),u()}function l(){debug("onfinish"),e.removeListener("close",o),u()}function u(){debug("unpipe"),s.unpipe(e)}var s=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1,debug("pipe count=%d opts=%j",h.pipesCount,t);var f=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,b=f?r:i;h.endEmitted?process.nextTick(b):s.once("end",b),e.on("unpipe",n);var g=pipeOnDrain(s);return e.on("drain",g),s.on("data",a),e._events&&e._events.error?isArray(e._events.error)?e._events.error.unshift(d):e._events.error=[d,e._events.error]:e.on("error",d),e.once("close",o),e.once("finish",l),e.emit("pipe",s),h.flowing||(debug("pipe resume"),s.resume()),e},Readable.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;r>i;i++)n[i].emit("unpipe",this);return this}var i=indexOf(t.pipes,e);return-1===i?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},Readable.prototype.on=function(e,t){var n=Stream.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&this.readable){var r=this._readableState;if(!r.readableListening)if(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading)r.length&&emitReadable(this,r);else{var i=this;process.nextTick(function(){debug("readable nexttick read 0"),i.read(0)})}}return n},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var e=this._readableState;return e.flowing||(debug("resume"),e.flowing=!0,e.reading||(debug("resume read 0"),this.read(0)),resume(this,e)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(debug("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(debug("wrapped data"),t.decoder&&(i=t.decoder.write(i)),i&&(t.objectMode||i.length)){var a=r.push(i);a||(n=!0,e.pause())}});for(var i in e)util.isFunction(e[i])&&util.isUndefined(this[i])&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var a=["error","close","destroy","pause","resume"];return forEach(a,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){debug("wrapped _read",t),n&&(n=!1,e.resume())},r},Readable._fromList=fromList;

}).call(this,require('_process'))
},{"./_stream_duplex":301,"_process":12,"buffer":5,"core-util-is":304,"events":9,"inherits":300,"isarray":305,"stream":24,"string_decoder/":306,"util":4}],303:[function(require,module,exports){
(function (process){
function WriteReq(e,i,t){this.chunk=e,this.encoding=i,this.callback=t}function WritableState(e,i){var t=require("./_stream_duplex");e=e||{};var r=e.highWaterMark,n=e.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.objectMode=!!e.objectMode,i instanceof t&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=e.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){onwrite(i,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function Writable(e){var i=require("./_stream_duplex");return this instanceof Writable||this instanceof i?(this._writableState=new WritableState(e,this),this.writable=!0,void Stream.call(this)):new Writable(e)}function writeAfterEnd(e,i,t){var r=new Error("write after end");e.emit("error",r),process.nextTick(function(){t(r)})}function validChunk(e,i,t,r){var n=!0;if(!(util.isBuffer(t)||util.isString(t)||util.isNullOrUndefined(t)||i.objectMode)){var o=new TypeError("Invalid non-string/buffer chunk");e.emit("error",o),process.nextTick(function(){r(o)}),n=!1}return n}function decodeChunk(e,i,t){return!e.objectMode&&e.decodeStrings!==!1&&util.isString(i)&&(i=new Buffer(i,t)),i}function writeOrBuffer(e,i,t,r,n){t=decodeChunk(i,t,r),util.isBuffer(t)&&(r="buffer");var o=i.objectMode?1:t.length;i.length+=o;var f=i.length<i.highWaterMark;return f||(i.needDrain=!0),i.writing||i.corked?i.buffer.push(new WriteReq(t,r,n)):doWrite(e,i,!1,o,t,r,n),f}function doWrite(e,i,t,r,n,o,f){i.writelen=r,i.writecb=f,i.writing=!0,i.sync=!0,t?e._writev(n,i.onwrite):e._write(n,o,i.onwrite),i.sync=!1}function onwriteError(e,i,t,r,n){t?process.nextTick(function(){i.pendingcb--,n(r)}):(i.pendingcb--,n(r)),e._writableState.errorEmitted=!0,e.emit("error",r)}function onwriteStateUpdate(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function onwrite(e,i){var t=e._writableState,r=t.sync,n=t.writecb;if(onwriteStateUpdate(t),i)onwriteError(e,t,r,i,n);else{var o=needFinish(e,t);o||t.corked||t.bufferProcessing||!t.buffer.length||clearBuffer(e,t),r?process.nextTick(function(){afterWrite(e,t,o,n)}):afterWrite(e,t,o,n)}}function afterWrite(e,i,t,r){t||onwriteDrain(e,i),i.pendingcb--,r(),finishMaybe(e,i)}function onwriteDrain(e,i){0===i.length&&i.needDrain&&(i.needDrain=!1,e.emit("drain"))}function clearBuffer(e,i){if(i.bufferProcessing=!0,e._writev&&i.buffer.length>1){for(var t=[],r=0;r<i.buffer.length;r++)t.push(i.buffer[r].callback);i.pendingcb++,doWrite(e,i,!0,i.length,i.buffer,"",function(e){for(var r=0;r<t.length;r++)i.pendingcb--,t[r](e)}),i.buffer=[]}else{for(var r=0;r<i.buffer.length;r++){var n=i.buffer[r],o=n.chunk,f=n.encoding,u=n.callback,s=i.objectMode?1:o.length;if(doWrite(e,i,!1,s,o,f,u),i.writing){r++;break}}r<i.buffer.length?i.buffer=i.buffer.slice(r):i.buffer.length=0}i.bufferProcessing=!1}function needFinish(e,i){return i.ending&&0===i.length&&!i.finished&&!i.writing}function prefinish(e,i){i.prefinished||(i.prefinished=!0,e.emit("prefinish"))}function finishMaybe(e,i){var t=needFinish(e,i);return t&&(0===i.pendingcb?(prefinish(e,i),i.finished=!0,e.emit("finish")):prefinish(e,i)),t}function endWritable(e,i,t){i.ending=!0,finishMaybe(e,i),t&&(i.finished?process.nextTick(t):e.once("finish",t)),i.ended=!0}module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(e,i,t){var r=this._writableState,n=!1;return util.isFunction(i)&&(t=i,i=null),util.isBuffer(e)?i="buffer":i||(i=r.defaultEncoding),util.isFunction(t)||(t=function(){}),r.ended?writeAfterEnd(this,r,t):validChunk(this,r,e,t)&&(r.pendingcb++,n=writeOrBuffer(this,r,e,i,t)),n},Writable.prototype.cork=function(){var e=this._writableState;e.corked++},Writable.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.buffer.length||clearBuffer(this,e))},Writable.prototype._write=function(e,i,t){t(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(e,i,t){var r=this._writableState;util.isFunction(e)?(t=e,e=null,i=null):util.isFunction(i)&&(t=i,i=null),util.isNullOrUndefined(e)||this.write(e,i),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||endWritable(this,r,t)};

}).call(this,require('_process'))
},{"./_stream_duplex":301,"_process":12,"buffer":5,"core-util-is":304,"inherits":300,"stream":24}],304:[function(require,module,exports){
(function (Buffer){
function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function isBuffer(e){return Buffer.isBuffer(e)}function objectToString(e){return Object.prototype.toString.call(e)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=isBuffer;

}).call(this,require("buffer").Buffer)
},{"buffer":5}],305:[function(require,module,exports){
module.exports=Array.isArray||function(r){return"[object Array]"==Object.prototype.toString.call(r)};

},{}],306:[function(require,module,exports){
function assertEncoding(e){if(e&&!isBufferEncoding(e))throw new Error("Unknown encoding: "+e)}function passThroughWrite(e){return e.toString(this.encoding)}function utf16DetectIncompleteChar(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var Buffer=require("buffer").Buffer,isBufferEncoding=Buffer.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},StringDecoder=exports.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";e=e.slice(r,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var h=t.charCodeAt(t.length-1);if(!(h>=55296&&56319>=h)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,h=t.charCodeAt(i);if(h>=55296&&56319>=h){var c=this.surrogateSize;return this.charLength+=c,this.charReceived+=c,this.charBuffer.copy(this.charBuffer,c,0,c),e.copy(this.charBuffer,0,0,c),t.substring(0,i)}return t},StringDecoder.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(2>=t&&r>>4==14){this.charLength=3;break}if(3>=t&&r>>3==30){this.charLength=4;break}}this.charReceived=t},StringDecoder.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,h=this.charBuffer,i=this.encoding;t+=h.slice(0,r).toString(i)}return t};

},{"buffer":5}],307:[function(require,module,exports){
module.exports=require("./lib/_stream_writable.js");

},{"./lib/_stream_writable.js":303}],308:[function(require,module,exports){
function extend(){for(var r={},e=0;e<arguments.length;e++){var n=arguments[e];for(var t in n)n.hasOwnProperty(t)&&(r[t]=n[t])}return r}module.exports=extend;

},{}],309:[function(require,module,exports){
function creator(t){return function(e,r,n){if("function"==typeof e&&(n=r,r=e,e={}),"function"!=typeof r)throw new Error("`write` must be a function");return"function"!=typeof n&&(n=null),t(e,r,n)}}function prime(t,e,r){return t._write=e,"function"==typeof r&&t.on("finish",r),t}var Writable=require("readable-stream/writable"),inherits=require("inherits"),xtend=require("xtend");module.exports=exports=creator(function(t,e,r){return prime(new Writable(t),e,r)}),exports.obj=creator(function(t,e,r){return t=xtend(t,{objectMode:!0}),prime(new Writable(t),e,r)}),exports.ctor=creator(function(t,e,r){function n(e){Writable.call(this,xtend({},t,e)),"function"==typeof r&&this.on("finish",r)}return inherits(n,Writable),Writable.prototype._write=e,n});

},{"inherits":300,"readable-stream/writable":307,"xtend":308}],310:[function(require,module,exports){
function extend(){for(var r={},e=0;e<arguments.length;e++){var n=arguments[e];for(var t in n)n.hasOwnProperty(t)&&(r[t]=n[t])}return r}module.exports=extend;

},{}],311:[function(require,module,exports){
function readAudio(e,r){e=defaultOpts(e),createMicStream(e,r)}function defaultOpts(e){return e=defined(e,{}),e.channels=defined(e.channels,1),e.buffer=defined(e.buffer,1024),e.highWaterMark=defined(e.highWaterMark,1),e}function createMicStream(e,r){getUserMedia({video:!1,audio:!0},function(a,n){if(a)return r(a);var i=micStream(n,{bufferSize:e.buffer,channels:e.channels}).pipe(micToSamples(e));r(null,i)})}function micToSamples(e){return through.obj({highWaterMark:e.highWaterMark},function(r,a,n){for(var i=Ndarray(new Float32Array(e.buffer*e.channels),[e.buffer,e.channels]),t=0;t<e.buffer;t++)for(var u=0;u<e.channels;u++)i.set(t*e.channels,u,r[u][t]);n(null,i)})}var getUserMedia=require("getusermedia"),through=require("through2"),defined=require("defined"),micStream=require("microphone-stream"),Ndarray=require("ndarray");module.exports=readAudio;

},{"defined":312,"getusermedia":313,"microphone-stream":315,"ndarray":316,"through2":329}],312:[function(require,module,exports){
module.exports=function(){for(var r=0;r<arguments.length;r++)if(void 0!==arguments[r])return arguments[r]};

},{}],313:[function(require,module,exports){
var adapter=require("webrtc-adapter-test");module.exports=function(e,r){var o,a=2===arguments.length,t={video:!0,audio:!0},n="PermissionDeniedError",i="PERMISSION_DENIED",d="ConstraintNotSatisfiedError";return a||(r=e,e=t),navigator.getUserMedia?e.audio||e.video?(localStorage&&"true"===localStorage.useFirefoxFakeDevice&&(e.fake=!0),void navigator.getUserMedia(e,function(e){r(null,e)},function(e){var o;"string"==typeof e?(o=new Error("MediaStreamError"),e===n||e===i?o.name=n:o.name=d):(o=e,o.name||(o[n]?e.name=n:e.name=d)),r(o)})):(o=new Error("MediaStreamError"),o.name="NoMediaRequestedError",window.setTimeout(function(){r(o)},0)):(o=new Error("MediaStreamError"),o.name="NotSupportedError",window.setTimeout(function(){r(o)},0))};

},{"webrtc-adapter-test":314}],314:[function(require,module,exports){
"use strict";function trace(e){if("\n"===e[e.length-1]&&(e=e.substring(0,e.length-1)),window.performance){var t=(window.performance.now()/1e3).toFixed(3);console.log(t+": "+e)}else console.log(e)}function requestUserMedia(e){return new Promise(function(t,n){getUserMedia(e,t,n)})}var getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null,webrtcMinimumVersion=null;if("undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia){if(console.log("This appears to be Firefox"),webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10),webrtcMinimumVersion=31,window.RTCPeerConnection=function(e,t){if(38>webrtcDetectedVersion&&e&&e.iceServers){for(var n=[],r=0;r<e.iceServers.length;r++){var i=e.iceServers[r];if(i.hasOwnProperty("urls"))for(var a=0;a<i.urls.length;a++){var o={url:i.urls[a]};0===i.urls[a].indexOf("turn")&&(o.username=i.username,o.credential=i.credential),n.push(o)}else n.push(e.iceServers[r])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate,getUserMedia=38>webrtcDetectedVersion?function(e,t,n){var r=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0!==r.exact&&(r.min=r.max=r.exact,delete r.exact),(void 0!==r.min||void 0!==r.max)&&t.push(n),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};i[n]={min:r.ideal,max:r.ideal},e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}),t.length&&(e.require=t),e};return console.log("spec: "+JSON.stringify(e)),e.audio=r(e.audio),e.video=r(e.video),console.log("ff37: "+JSON.stringify(e)),navigator.mozGetUserMedia(e,t,n)}:navigator.mozGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:requestUserMedia,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},41>webrtcDetectedVersion){var orgEnumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return orgEnumerateDevices()["catch"](function(e){if("NotFoundError"===e.name)return[];throw e})}}attachMediaStream=function(e,t){e.mozSrcObject=t},reattachMediaStream=function(e,t){console.log("Reattaching media stream"),e.mozSrcObject=t.mozSrcObject}}else navigator.webkitGetUserMedia?(console.log("This appears to be Chrome"),webrtcDetectedBrowser="chrome",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10),webrtcMinimumVersion=38,window.RTCPeerConnection=function(e,t){var n=new webkitRTCPeerConnection(e,t),r=n.getStats.bind(n);return n.getStats=function(e,t,n){if("function"==typeof e)return r(e,t);var i=function(e){var t={},n=e.result();return n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e){t(i(e))};return r(a,e)},n},["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this;return new Promise(function(r,i){t.apply(n,[e[0],function(){r(),e.length>=2&&e[1].apply(null,[])},function(t){i(t),e.length>=3&&e[2].apply(null,[t])}])})}}),getUserMedia=function(e,t,n){var r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var a={};"number"==typeof r.ideal?(a[i("min",n)]=r.ideal,t.optional.push(a),a={},a[i("max",n)]=r.ideal,t.optional.push(a)):(a[i("",n)]=r.ideal,t.optional.push(a))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};return console.log("spec:   "+JSON.stringify(e)),e.audio=r(e.audio),e.video=r(e.video),console.log("chrome: "+JSON.stringify(e)),navigator.webkitGetUserMedia(e,t,n)},navigator.getUserMedia=getUserMedia,attachMediaStream=function(e,t){"undefined"!=typeof e.srcObject?e.srcObject=t:"undefined"!=typeof e.src?e.src=URL.createObjectURL(t):console.log("Error attaching stream to element.")},reattachMediaStream=function(e,t){e.src=t.src},navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:requestUserMedia,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=function(e){return requestUserMedia(e)}),"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){console.log("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){console.log("Dummy mediaDevices.removeEventListener called.")})):navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(console.log("This appears to be Edge"),webrtcDetectedBrowser="edge",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10),webrtcMinimumVersion=12,getUserMedia=navigator.getUserMedia,attachMediaStream=function(e,t){e.srcObject=t},reattachMediaStream=function(e,t){e.srcObject=t.srcObject}):console.log("Browser does not appear to be WebRTC-capable");else console.log("This does not appear to be a browser"),webrtcDetectedBrowser="not a browser";if("undefined"!=typeof module){var RTCPeerConnection;"undefined"!=typeof window&&(RTCPeerConnection=window.RTCPeerConnection),module.exports={RTCPeerConnection:RTCPeerConnection,getUserMedia:getUserMedia,attachMediaStream:attachMediaStream,reattachMediaStream:reattachMediaStream,webrtcDetectedBrowser:webrtcDetectedBrowser,webrtcDetectedVersion:webrtcDetectedVersion,webrtcMinimumVersion:webrtcMinimumVersion}}else"function"==typeof require&&"function"==typeof define&&define([],function(){return{RTCPeerConnection:window.RTCPeerConnection,getUserMedia:getUserMedia,attachMediaStream:attachMediaStream,reattachMediaStream:reattachMediaStream,webrtcDetectedBrowser:webrtcDetectedBrowser,webrtcDetectedVersion:webrtcDetectedVersion,webrtcMinimumVersion:webrtcMinimumVersion}});

},{}],315:[function(require,module,exports){
var through2=require("through2"),micstream=module.exports=function(e,n){function r(e){for(var n=e.inputBuffer,r=(e.outputBuffer,[]),t=0;t<n.numberOfChannels;t++)r.push(n.getChannelData(t));a.write(r)}var t=4096,o=2,u=2;n=n||{},t=n.bufferSize||t,n.channels&&(o=u=n.channels),o=n.inputChannels||o,u=n.outputChannels||u;var a=through2.obj({highWaterMark:1}),i=new window.AudioContext,c=i.createMediaStreamSource(e),h=i.createScriptProcessor(t,o,u);return h.onaudioprocess=r,c.connect(h),h.connect(i.destination),a};

},{"through2":329}],316:[function(require,module,exports){
function compare1st(t,r){return t[0]-r[0]}function order(){var t,r=this.stride,e=new Array(r.length);for(t=0;t<e.length;++t)e[t]=[Math.abs(r[t]),t];e.sort(compare1st);var n=new Array(e.length);for(t=0;t<n.length;++t)n[t]=e[t][1];return n}function compileConstructor(t,r){var e=["View",r,"d",t].join("");0>r&&(e="View_Nil"+t);var n="generic"===t;if(-1===r){var o="function "+e+"(a){this.data=a;};var proto="+e+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+e+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+e+"(a){return new "+e+"(a);}",i=new Function(o);return i()}if(0===r){var o="function "+e+"(a,d) {this.data = a;this.offset = d};var proto="+e+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+e+"_copy() {return new "+e+"(this.data,this.offset)};proto.pick=function "+e+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+e+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+e+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+e+"(a,b,c,d){return new "+e+"(a,d)}",i=new Function("TrivialArray",o);return i(CACHED_CONSTRUCTORS[t][0])}var o=["'use strict'"],a=iota(r),s=a.map(function(t){return"i"+t}),u="this.offset+"+a.map(function(t){return"this.stride["+t+"]*i"+t}).join("+"),p=a.map(function(t){return"b"+t}).join(","),f=a.map(function(t){return"c"+t}).join(",");o.push("function "+e+"(a,"+p+","+f+",d){this.data=a","this.shape=["+p+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+e+".prototype","proto.dtype='"+t+"'","proto.dimension="+r),o.push("Object.defineProperty(proto,'size',{get:function "+e+"_size(){return "+a.map(function(t){return"this.shape["+t+"]"}).join("*"),"}})"),1===r?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),4>r?(o.push("function "+e+"_order(){"),2===r?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===r&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+e+"_set("+s.join(",")+",v){"),n?o.push("return this.data.set("+u+",v)}"):o.push("return this.data["+u+"]=v}"),o.push("proto.get=function "+e+"_get("+s.join(",")+"){"),n?o.push("return this.data.get("+u+")}"):o.push("return this.data["+u+"]}"),o.push("proto.index=function "+e+"_index(",s.join(),"){return "+u+"}"),o.push("proto.hi=function "+e+"_hi("+s.join(",")+"){return new "+e+"(this.data,"+a.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")}).join(",")+","+a.map(function(t){return"this.stride["+t+"]"}).join(",")+",this.offset)}");var h=a.map(function(t){return"a"+t+"=this.shape["+t+"]"}),c=a.map(function(t){return"c"+t+"=this.stride["+t+"]"});o.push("proto.lo=function "+e+"_lo("+s.join(",")+"){var b=this.offset,d=0,"+h.join(",")+","+c.join(","));for(var d=0;r>d;++d)o.push("if(typeof i"+d+"==='number'&&i"+d+">=0){d=i"+d+"|0;b+=c"+d+"*d;a"+d+"-=d}");o.push("return new "+e+"(this.data,"+a.map(function(t){return"a"+t}).join(",")+","+a.map(function(t){return"c"+t}).join(",")+",b)}"),o.push("proto.step=function "+e+"_step("+s.join(",")+"){var "+a.map(function(t){return"a"+t+"=this.shape["+t+"]"}).join(",")+","+a.map(function(t){return"b"+t+"=this.stride["+t+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var d=0;r>d;++d)o.push("if(typeof i"+d+"==='number'){d=i"+d+"|0;if(d<0){c+=b"+d+"*(a"+d+"-1);a"+d+"=ceil(-a"+d+"/d)}else{a"+d+"=ceil(a"+d+"/d)}b"+d+"*=d}");o.push("return new "+e+"(this.data,"+a.map(function(t){return"a"+t}).join(",")+","+a.map(function(t){return"b"+t}).join(",")+",c)}");for(var y=new Array(r),l=new Array(r),d=0;r>d;++d)y[d]="a[i"+d+"]",l[d]="b[i"+d+"]";o.push("proto.transpose=function "+e+"_transpose("+s+"){"+s.map(function(t,r){return t+"=("+t+"===undefined?"+r+":"+t+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+e+"(this.data,"+y.join(",")+","+l.join(",")+",this.offset)}"),o.push("proto.pick=function "+e+"_pick("+s+"){var a=[],b=[],c=this.offset");for(var d=0;r>d;++d)o.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this.stride["+d+"]*i"+d+")|0}else{a.push(this.shape["+d+"]);b.push(this.stride["+d+"])}");o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+e+"(data,shape,stride,offset){return new "+e+"(data,"+a.map(function(t){return"shape["+t+"]"}).join(",")+","+a.map(function(t){return"stride["+t+"]"}).join(",")+",offset)}");var i=new Function("CTOR_LIST","ORDER",o.join("\n"));return i(CACHED_CONSTRUCTORS[t],order)}function arrayDType(t){if(isBuffer(t))return"buffer";if(hasTypedArrays)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(t)?"array":"generic"}function wrappedNDArrayCtor(t,r,e,n){if(void 0===t){var o=CACHED_CONSTRUCTORS.array[0];return o([])}"number"==typeof t&&(t=[t]),void 0===r&&(r=[t.length]);var i=r.length;if(void 0===e){e=new Array(i);for(var a=i-1,s=1;a>=0;--a)e[a]=s,s*=r[a]}if(void 0===n){n=0;for(var a=0;i>a;++a)e[a]<0&&(n-=(r[a]-1)*e[a])}for(var u=arrayDType(t),p=CACHED_CONSTRUCTORS[u];p.length<=i+1;)p.push(compileConstructor(u,p.length-1));var o=p[i+1];return o(t,r,e,n)}var iota=require("iota-array"),isBuffer=require("is-buffer"),hasTypedArrays="undefined"!=typeof Float64Array,CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};module.exports=wrappedNDArrayCtor;

},{"iota-array":317,"is-buffer":318}],317:[function(require,module,exports){
"use strict";function iota(r){for(var t=new Array(r),o=0;r>o;++o)t[o]=o;return t}module.exports=iota;

},{}],318:[function(require,module,exports){
module.exports=function(o){return!(null==o||!o.constructor||"function"!=typeof o.constructor.isBuffer||!o.constructor.isBuffer(o))};

},{}],319:[function(require,module,exports){
(function (process){
function Duplex(e){return this instanceof Duplex?(Readable.call(this,e),Writable.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",onend)):new Duplex(e)}function onend(){this.allowHalfOpen||this._writableState.ended||process.nextTick(this.end.bind(this))}function forEach(e,t){for(var i=0,r=e.length;r>i;i++)t(e[i],i)}module.exports=Duplex;var objectKeys=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t},util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable),forEach(objectKeys(Writable.prototype),function(e){Duplex.prototype[e]||(Duplex.prototype[e]=Writable.prototype[e])});

}).call(this,require('_process'))
},{"./_stream_readable":320,"./_stream_writable":322,"_process":12,"core-util-is":323,"inherits":324}],320:[function(require,module,exports){
(function (process){
function ReadableState(e,t){e=e||{};var n=e.highWaterMark;this.highWaterMark=n||0===n?n:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(e.encoding),this.encoding=e.encoding)}function Readable(e){return this instanceof Readable?(this._readableState=new ReadableState(e,this),this.readable=!0,void Stream.call(this)):new Readable(e)}function readableAddChunk(e,t,n,r,i){var a=chunkInvalid(t,n);if(a)e.emit("error",a);else if(null===n||void 0===n)t.reading=!1,t.ended||onEofChunk(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var d=new Error("stream.push() after EOF");e.emit("error",d)}else if(t.endEmitted&&i){var d=new Error("stream.unshift() after end event");e.emit("error",d)}else!t.decoder||i||r||(n=t.decoder.write(n)),t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):(t.reading=!1,t.buffer.push(n)),t.needReadable&&emitReadable(e),maybeReadMore(e,t);else i||(t.reading=!1);return needMoreData(t)}function needMoreData(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function roundUpToNextPowerOf2(e){if(e>=MAX_HWM)e=MAX_HWM;else{e--;for(var t=1;32>t;t<<=1)e|=e>>t;e++}return e}function howMuchToRead(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:0>=e?0:(e>t.highWaterMark&&(t.highWaterMark=roundUpToNextPowerOf2(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function chunkInvalid(e,t){var n=null;return Buffer.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function onEofChunk(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.length>0?emitReadable(e):endReadable(e)}function emitReadable(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?process.nextTick(function(){emitReadable_(e)}):emitReadable_(e))}function emitReadable_(e){e.emit("readable")}function maybeReadMore(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(function(){maybeReadMore_(e,t)}))}function maybeReadMore_(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function pipeOnDrain(e){return function(){var t=e._readableState;t.awaitDrain--,0===t.awaitDrain&&flow(e)}}function flow(e){function t(e,t,i){var a=e.write(n);!1===a&&r.awaitDrain++}var n,r=e._readableState;for(r.awaitDrain=0;r.pipesCount&&null!==(n=e.read());)if(1===r.pipesCount?t(r.pipes,0,null):forEach(r.pipes,t),e.emit("data",n),r.awaitDrain>0)return;return 0===r.pipesCount?(r.flowing=!1,void(EE.listenerCount(e,"data")>0&&emitDataEvents(e))):void(r.ranOut=!0)}function pipeOnReadable(){this._readableState.ranOut&&(this._readableState.ranOut=!1,flow(this))}function emitDataEvents(e,t){var n=e._readableState;if(n.flowing)throw new Error("Cannot switch to old mode now.");var r=t||!1,i=!1;e.readable=!0,e.pipe=Stream.prototype.pipe,e.on=e.addListener=Stream.prototype.on,e.on("readable",function(){i=!0;for(var t;!r&&null!==(t=e.read());)e.emit("data",t);null===t&&(i=!1,e._readableState.needReadable=!0)}),e.pause=function(){r=!0,this.emit("pause")},e.resume=function(){r=!1,i?process.nextTick(function(){e.emit("readable")}):this.read(0),this.emit("resume")},e.emit("readable")}function fromList(e,t){var n,r=t.buffer,i=t.length,a=!!t.decoder,d=!!t.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(d)n=r.shift();else if(!e||e>=i)n=a?r.join(""):Buffer.concat(r,i),r.length=0;else if(e<r[0].length){var o=r[0];n=o.slice(0,e),r[0]=o.slice(e)}else if(e===r[0].length)n=r.shift();else{n=a?"":new Buffer(e);for(var l=0,s=0,u=r.length;u>s&&e>l;s++){var o=r[0],h=Math.min(e-l,o.length);a?n+=o.slice(0,h):o.copy(n,l,0,h),h<o.length?r[0]=o.slice(h):r.shift(),l+=h}}return n}function endReadable(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,process.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function forEach(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n],n)}function indexOf(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}module.exports=Readable;var isArray=require("isarray"),Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;EE.listenerCount||(EE.listenerCount=function(e,t){return e.listeners(t).length});var Stream=require("stream"),util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;util.inherits(Readable,Stream),Readable.prototype.push=function(e,t){var n=this._readableState;return"string"!=typeof e||n.objectMode||(t=t||n.defaultEncoding,t!==n.encoding&&(e=new Buffer(e,t),t="")),readableAddChunk(this,n,e,t,!1)},Readable.prototype.unshift=function(e){var t=this._readableState;return readableAddChunk(this,t,e,"",!0)},Readable.prototype.setEncoding=function(e){StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(e),this._readableState.encoding=e};var MAX_HWM=8388608;Readable.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var n,r=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return emitReadable(this),null;if(e=howMuchToRead(e,t),0===e&&t.ended)return n=null,t.length>0&&t.decoder&&(n=fromList(e,t),t.length-=n.length),0===t.length&&endReadable(this),n;var i=t.needReadable;return t.length-e<=t.highWaterMark&&(i=!0),(t.ended||t.reading)&&(i=!1),i&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=howMuchToRead(r,t)),n=e>0?fromList(e,t):null,null===n&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&endReadable(this),n},Readable.prototype._read=function(e){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(e,t){function n(e){e===s&&i()}function r(){e.end()}function i(){e.removeListener("close",d),e.removeListener("finish",o),e.removeListener("drain",p),e.removeListener("error",a),e.removeListener("unpipe",n),s.removeListener("end",r),s.removeListener("end",i),(!e._writableState||e._writableState.needDrain)&&p()}function a(t){l(),e.removeListener("error",a),0===EE.listenerCount(e,"error")&&e.emit("error",t)}function d(){e.removeListener("finish",o),l()}function o(){e.removeListener("close",d),l()}function l(){s.unpipe(e)}var s=this,u=this._readableState;switch(u.pipesCount){case 0:u.pipes=e;break;case 1:u.pipes=[u.pipes,e];break;default:u.pipes.push(e)}u.pipesCount+=1;var h=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,f=h?r:i;u.endEmitted?process.nextTick(f):s.once("end",f),e.on("unpipe",n);var p=pipeOnDrain(s);return e.on("drain",p),e._events&&e._events.error?isArray(e._events.error)?e._events.error.unshift(a):e._events.error=[a,e._events.error]:e.on("error",a),e.once("close",d),e.once("finish",o),e.emit("pipe",s),u.flowing||(this.on("readable",pipeOnReadable),u.flowing=!0,process.nextTick(function(){flow(s)})),e},Readable.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",pipeOnReadable),t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",pipeOnReadable),t.flowing=!1;for(var i=0;r>i;i++)n[i].emit("unpipe",this);return this}var i=indexOf(t.pipes,e);return-1===i?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},Readable.prototype.on=function(e,t){var n=Stream.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||emitDataEvents(this),"readable"===e&&this.readable){var r=this._readableState;r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.length&&emitReadable(this,r):this.read(0))}return n},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){emitDataEvents(this),this.read(0),this.emit("resume")},Readable.prototype.pause=function(){emitDataEvents(this,!0),this.emit("pause")},Readable.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)){var a=r.push(i);a||(n=!0,e.pause())}});for(var i in e)"function"==typeof e[i]&&"undefined"==typeof this[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var a=["error","close","destroy","pause","resume"];return forEach(a,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){n&&(n=!1,e.resume())},r},Readable._fromList=fromList;

}).call(this,require('_process'))
},{"_process":12,"buffer":5,"core-util-is":323,"events":9,"inherits":324,"isarray":325,"stream":24,"string_decoder/":326}],321:[function(require,module,exports){
function TransformState(r,t){this.afterTransform=function(r,e){return afterTransform(t,r,e)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform(r,t,e){var n=r._transformState;n.transforming=!1;var a=n.writecb;if(!a)return r.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==e&&void 0!==e&&r.push(e),a&&a(t);var i=r._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&r._read(i.highWaterMark)}function Transform(r){if(!(this instanceof Transform))return new Transform(r);Duplex.call(this,r);var t=(this._transformState=new TransformState(r,this),this);this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(r){done(t,r)}):done(t)})}function done(r,t){if(t)return r.emit("error",t);var e=r._writableState,n=(r._readableState,r._transformState);if(e.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return r.push(null)}module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(r,t){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,r,t)},Transform.prototype._transform=function(r,t,e){throw new Error("not implemented")},Transform.prototype._write=function(r,t,e){var n=this._transformState;if(n.writecb=e,n.writechunk=r,n.writeencoding=t,!n.transforming){var a=this._readableState;(n.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},Transform.prototype._read=function(r){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0};

},{"./_stream_duplex":319,"core-util-is":323,"inherits":324}],322:[function(require,module,exports){
(function (process){
function WriteReq(e,t,i){this.chunk=e,this.encoding=t,this.callback=i}function WritableState(e,t){e=e||{};var i=e.highWaterMark;this.highWaterMark=i||0===i?i:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=e.decodeStrings===!1;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){onwrite(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function Writable(e){var t=require("./_stream_duplex");return this instanceof Writable||this instanceof t?(this._writableState=new WritableState(e,this),this.writable=!0,void Stream.call(this)):new Writable(e)}function writeAfterEnd(e,t,i){var r=new Error("write after end");e.emit("error",r),process.nextTick(function(){i(r)})}function validChunk(e,t,i,r){var n=!0;if(!Buffer.isBuffer(i)&&"string"!=typeof i&&null!==i&&void 0!==i&&!t.objectMode){var f=new TypeError("Invalid non-string/buffer chunk");e.emit("error",f),process.nextTick(function(){r(f)}),n=!1}return n}function decodeChunk(e,t,i){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=new Buffer(t,i)),t}function writeOrBuffer(e,t,i,r,n){i=decodeChunk(t,i,r),Buffer.isBuffer(i)&&(r="buffer");var f=t.objectMode?1:i.length;t.length+=f;var o=t.length<t.highWaterMark;return o||(t.needDrain=!0),t.writing?t.buffer.push(new WriteReq(i,r,n)):doWrite(e,t,f,i,r,n),o}function doWrite(e,t,i,r,n,f){t.writelen=i,t.writecb=f,t.writing=!0,t.sync=!0,e._write(r,n,t.onwrite),t.sync=!1}function onwriteError(e,t,i,r,n){i?process.nextTick(function(){n(r)}):n(r),e._writableState.errorEmitted=!0,e.emit("error",r)}function onwriteStateUpdate(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function onwrite(e,t){var i=e._writableState,r=i.sync,n=i.writecb;if(onwriteStateUpdate(i),t)onwriteError(e,i,r,t,n);else{var f=needFinish(e,i);f||i.bufferProcessing||!i.buffer.length||clearBuffer(e,i),r?process.nextTick(function(){afterWrite(e,i,f,n)}):afterWrite(e,i,f,n)}}function afterWrite(e,t,i,r){i||onwriteDrain(e,t),r(),i&&finishMaybe(e,t)}function onwriteDrain(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function clearBuffer(e,t){t.bufferProcessing=!0;for(var i=0;i<t.buffer.length;i++){var r=t.buffer[i],n=r.chunk,f=r.encoding,o=r.callback,a=t.objectMode?1:n.length;if(doWrite(e,t,a,n,f,o),t.writing){i++;break}}t.bufferProcessing=!1,i<t.buffer.length?t.buffer=t.buffer.slice(i):t.buffer.length=0}function needFinish(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function finishMaybe(e,t){var i=needFinish(e,t);return i&&(t.finished=!0,e.emit("finish")),i}function endWritable(e,t,i){t.ending=!0,finishMaybe(e,t),i&&(t.finished?process.nextTick(i):e.once("finish",i)),t.ended=!0}module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(e,t,i){var r=this._writableState,n=!1;return"function"==typeof t&&(i=t,t=null),Buffer.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof i&&(i=function(){}),r.ended?writeAfterEnd(this,r,i):validChunk(this,r,e,i)&&(n=writeOrBuffer(this,r,e,t,i)),n},Writable.prototype._write=function(e,t,i){i(new Error("not implemented"))},Writable.prototype.end=function(e,t,i){var r=this._writableState;"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),"undefined"!=typeof e&&null!==e&&this.write(e,t),r.ending||r.finished||endWritable(this,r,i)};

}).call(this,require('_process'))
},{"./_stream_duplex":319,"_process":12,"buffer":5,"core-util-is":323,"inherits":324,"stream":24}],323:[function(require,module,exports){
(function (Buffer){
function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function isBuffer(e){return Buffer.isBuffer(e)}function objectToString(e){return Object.prototype.toString.call(e)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=isBuffer;

}).call(this,require("buffer").Buffer)
},{"buffer":5}],324:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};

},{}],325:[function(require,module,exports){
module.exports=Array.isArray||function(r){return"[object Array]"==Object.prototype.toString.call(r)};

},{}],326:[function(require,module,exports){
function assertEncoding(e){if(e&&!isBufferEncoding(e))throw new Error("Unknown encoding: "+e)}function passThroughWrite(e){return e.toString(this.encoding)}function utf16DetectIncompleteChar(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var Buffer=require("buffer").Buffer,isBufferEncoding=Buffer.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},StringDecoder=exports.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";e=e.slice(r,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var h=t.charCodeAt(t.length-1);if(!(h>=55296&&56319>=h)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,h=t.charCodeAt(i);if(h>=55296&&56319>=h){var c=this.surrogateSize;return this.charLength+=c,this.charReceived+=c,this.charBuffer.copy(this.charBuffer,c,0,c),e.copy(this.charBuffer,0,0,c),t.substring(0,i)}return t},StringDecoder.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(2>=t&&r>>4==14){this.charLength=3;break}if(3>=t&&r>>3==30){this.charLength=4;break}}this.charReceived=t},StringDecoder.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,h=this.charBuffer,i=this.encoding;t+=h.slice(0,r).toString(i)}return t};

},{"buffer":5}],327:[function(require,module,exports){
module.exports=require("./lib/_stream_transform.js");

},{"./lib/_stream_transform.js":321}],328:[function(require,module,exports){
function extend(){for(var r={},e=0;e<arguments.length;e++){var n=arguments[e];for(var t in n)n.hasOwnProperty(t)&&(r[t]=n[t])}return r}module.exports=extend;

},{}],329:[function(require,module,exports){
(function (process){
function DestroyableTransform(r){Transform.call(this,r),this._destroyed=!1}function noop(r,t,o){o(null,r)}function through2(r){return function(t,o,e){return"function"==typeof t&&(e=o,o=t,t={}),"function"!=typeof o&&(o=noop),"function"!=typeof e&&(e=null),r(t,o,e)}}var Transform=require("readable-stream/transform"),inherits=require("util").inherits,xtend=require("xtend");inherits(DestroyableTransform,Transform),DestroyableTransform.prototype.destroy=function(r){if(!this._destroyed){this._destroyed=!0;var t=this;process.nextTick(function(){r&&t.emit("error",r),t.emit("close")})}},module.exports=through2(function(r,t,o){var e=new DestroyableTransform(r);return e._transform=t,o&&(e._flush=o),e}),module.exports.ctor=through2(function(r,t,o){function e(t){return this instanceof e?(this.options=xtend(r,t),void DestroyableTransform.call(this,this.options)):new e(t)}return inherits(e,DestroyableTransform),e.prototype._transform=t,o&&(e.prototype._flush=o),e}),module.exports.obj=through2(function(r,t,o){var e=new DestroyableTransform(xtend({objectMode:!0,highWaterMark:16},r));return e._transform=t,o&&(e._flush=o),e});

}).call(this,require('_process'))
},{"_process":12,"readable-stream/transform":327,"util":27,"xtend":328}]},{},[1]);
